!function(e){function t(t){for(var n,r,a=t[0],l=t[1],o=0,s=[];o<a.length;o++)r=a[o],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&s.push(i[r][0]),i[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(c&&c(t);s.length;)s.shift()()}var n={},i={1:0};var r={};var a={51:function(){return{"./index_bg.js":{__wbindgen_is_object:function(e){return n[49].exports.ib(e)},__wbg_getwithrefkey_5e6d9547403deab8:function(e,t){return n[49].exports.w(e,t)},__wbindgen_is_undefined:function(e){return n[49].exports.jb(e)},__wbindgen_in:function(e,t){return n[49].exports.gb(e,t)},__wbindgen_object_drop_ref:function(e){return n[49].exports.ob(e)},__wbindgen_number_get:function(e,t){return n[49].exports.mb(e,t)},__wbg_isSafeInteger_bb8e18dd21c97288:function(e){return n[49].exports.G(e)},__wbindgen_string_get:function(e,t){return n[49].exports.pb(e,t)},__wbg_isArray_4c24b343cb13cfb1:function(e){return n[49].exports.F(e)},__wbg_length_fff51ee6522a1a18:function(e){return n[49].exports.J(e)},__wbg_get_44be0491f933a435:function(e,t){return n[49].exports.u(e,t)},__wbg_next_ddb3312ca1c4e32a:function(e){return n[49].exports.R(e)},__wbg_done_5c1f01fb660d73b5:function(e){return n[49].exports.p(e)},__wbg_value_1695675138684bd5:function(e){return n[49].exports.ab(e)},__wbindgen_string_new:function(e,t){return n[49].exports.qb(e,t)},__wbg_log_7bb108d119bafbc1:function(e){return n[49].exports.L(e)},__wbg_new_abda76e883ba8a5f:function(){return n[49].exports.O()},__wbg_stack_658279fe44541cf6:function(e,t){return n[49].exports.W(e,t)},__wbg_error_f851667af71bcfc6:function(e,t){return n[49].exports.q(e,t)},__wbg_iterator_97f0c81209c6c35a:function(){return n[49].exports.H()},__wbg_get_97b561fb56f034b5:function(e,t){return n[49].exports.v(e,t)},__wbindgen_is_function:function(e){return n[49].exports.hb(e)},__wbg_call_cb65541d95d71282:function(e,t){return n[49].exports.m(e,t)},__wbg_next_526fc47e980da008:function(e){return n[49].exports.Q(e)},__wbg_self_1ff1d729e9aae938:function(){return n[49].exports.S()},__wbg_window_5f4faef6c12b79ec:function(){return n[49].exports.cb()},__wbg_globalThis_1d39714405582d3c:function(){return n[49].exports.x()},__wbg_global_651f05c6a0944d1c:function(){return n[49].exports.y()},__wbg_newnoargs_581967eacc0e2604:function(e,t){return n[49].exports.P(e,t)},__wbg_length_72e2208bbc0efc61:function(e){return n[49].exports.I(e)},__wbindgen_memory:function(){return n[49].exports.lb()},__wbg_buffer_085ec1f694018c4f:function(e){return n[49].exports.l(e)},__wbg_new_8125e318e6245eed:function(e){return n[49].exports.N(e)},__wbg_set_5cf90238115182c3:function(e,t,i){return n[49].exports.T(e,t,i)},__wbg_error_fe807da27c4a4ced:function(e){return n[49].exports.r(e)},__wbindgen_error_new:function(e,t){return n[49].exports.fb(e,t)},__wbindgen_object_clone_ref:function(e){return n[49].exports.nb(e)},__wbg_instanceof_Window_e266f02eee43b570:function(e){return n[49].exports.E(e)},__wbg_document_950215a728589a2d:function(e){return n[49].exports.o(e)},__wbg_getElementById_eb93a47327bb5585:function(e,t,i){return n[49].exports.t(e,t,i)},__wbg_instanceof_HtmlCanvasElement_f5f69dab93281ebe:function(e){return n[49].exports.C(e)},__wbg_getContext_3ae404b649cf9287:function(e,t,i){return n[49].exports.s(e,t,i)},__wbg_instanceof_CanvasRenderingContext2d_3e95629461ed9f67:function(e){return n[49].exports.B(e)},__wbg_time_7d2d373d518e95fa:function(e,t){return n[49].exports.Z(e,t)},__wbg_setstrokeStyle_073fc10b086c1727:function(e,t){return n[49].exports.V(e,t)},__wbg_canvas_0629be400c80c8cd:function(e){return n[49].exports.n(e)},__wbg_width_a40e21a22129b197:function(e){return n[49].exports.bb(e)},__wbg_height_98d51321254345a5:function(e){return n[49].exports.z(e)},__wbg_beginPath_0948db80d0d23ce3:function(e){return n[49].exports.k(e)},__wbg_moveTo_b0d9695c44d309f0:function(e,t,i){return n[49].exports.M(e,t,i)},__wbg_lineTo_b902f35217ff96ab:function(e,t,i){return n[49].exports.K(e,t,i)},__wbg_stroke_6e1b85c72caa53ea:function(e){return n[49].exports.X(e)},__wbg_timeEnd_3080975414918110:function(e,t){return n[49].exports.Y(e,t)},__wbindgen_jsval_loose_eq:function(e,t){return n[49].exports.kb(e,t)},__wbindgen_boolean_get:function(e){return n[49].exports.db(e)},__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4:function(e){return n[49].exports.D(e)},__wbg_instanceof_ArrayBuffer_39ac22089b74fddb:function(e){return n[49].exports.A(e)},__wbindgen_debug_string:function(e,t){return n[49].exports.eb(e,t)},__wbindgen_throw:function(e,t){return n[49].exports.rb(e,t)}}}}};function l(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=o);var s,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=function(e){return l.p+""+({}[e]||e)+".js"}(e);var c=new Error;s=function(t){d.onerror=d.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,n[1](c)}i[e]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:d})}),12e4);d.onerror=d.onload=s,document.head.appendChild(d)}return({0:[51]}[e]||[]).forEach((function(e){var n=r[e];if(n)t.push(n);else{var i,o=a[e](),s=fetch(l.p+""+{51:"aca8db8b2c93e9885329"}[e]+".module.wasm");if(o instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)i=Promise.all([WebAssembly.compileStreaming(s),o]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)i=WebAssembly.instantiateStreaming(s,o);else{i=s.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,o)}))}t.push(r[e]=i.then((function(t){return l.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},l.m=e,l.c=n,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)l.d(n,i,function(t){return e[t]}.bind(null,i));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l.oe=function(e){throw console.error(e),e},l.w={};var o=window.webpackJsonp=window.webpackJsonp||[],s=o.push.bind(o);o.push=t,o=o.slice();for(var d=0;d<o.length;d++)t(o[d]);var c=s;l(l.s=48)}([function(e,t,n){"use strict";(function(e){var i=n(15);const{toString:r}=Object.prototype,{getPrototypeOf:a}=Object,l=(o=Object.create(null),e=>{const t=r.call(e);return o[t]||(o[t]=t.slice(8,-1).toLowerCase())});var o;const s=e=>(e=e.toLowerCase(),t=>l(t)===e),d=e=>t=>typeof t===e,{isArray:c}=Array,u=d("undefined");const p=s("ArrayBuffer");const h=d("string"),g=d("function"),m=d("number"),f=e=>null!==e&&"object"==typeof e,y=e=>{if("object"!==l(e))return!1;const t=a(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},v=s("Date"),b=s("File"),w=s("Blob"),E=s("FileList"),S=s("URLSearchParams");function x(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let i,r;if("object"!=typeof e&&(e=[e]),c(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{const r=n?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let l;for(i=0;i<a;i++)l=r[i],t.call(null,e[l],l,e)}}function I(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const k="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:e,_=e=>!u(e)&&e!==k;const T=(N="undefined"!=typeof Uint8Array&&a(Uint8Array),e=>N&&e instanceof N);var N;const C=s("HTMLFormElement"),L=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),A=s("RegExp"),P=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};x(n,(n,r)=>{let a;!1!==(a=t(n,r,e))&&(i[r]=a||n)}),Object.defineProperties(e,i)},B="abcdefghijklmnopqrstuvwxyz",R={DIGIT:"0123456789",ALPHA:B,ALPHA_DIGIT:B+B.toUpperCase()+"0123456789"};const F=s("AsyncFunction");t.a={isArray:c,isArrayBuffer:p,isBuffer:function(e){return null!==e&&!u(e)&&null!==e.constructor&&!u(e.constructor)&&g(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||g(e.append)&&("formdata"===(t=l(e))||"object"===t&&g(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&p(e.buffer),t},isString:h,isNumber:m,isBoolean:e=>!0===e||!1===e,isObject:f,isPlainObject:y,isUndefined:u,isDate:v,isFile:b,isBlob:w,isRegExp:A,isFunction:g,isStream:e=>f(e)&&g(e.pipe),isURLSearchParams:S,isTypedArray:T,isFileList:E,forEach:x,merge:function e(){const{caseless:t}=_(this)&&this||{},n={},i=(i,r)=>{const a=t&&I(n,r)||r;y(n[a])&&y(i)?n[a]=e(n[a],i):y(i)?n[a]=e({},i):c(i)?n[a]=i.slice():n[a]=i};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&x(arguments[e],i);return n},extend:(e,t,n,{allOwnKeys:r}={})=>(x(t,(t,r)=>{n&&g(t)?e[r]=Object(i.a)(t,n):e[r]=t},{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,l,o;const s={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),l=r.length;l-- >0;)o=r[l],i&&!i(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&a(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:l,kindOfTest:s,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return-1!==i&&i===n},toArray:e=>{if(!e)return null;if(c(e))return e;let t=e.length;if(!m(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=n.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const i=[];for(;null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:C,hasOwnProperty:L,hasOwnProp:L,reduceDescriptors:P,freezeMethods:e=>{P(e,(t,n)=>{if(g(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const i=e[n];g(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=e=>{e.forEach(e=>{n[e]=!0})};return c(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:I,global:k,isContextDefined:_,ALPHABET:R,generateString:(e=16,t=R.ALPHA_DIGIT)=>{let n="";const{length:i}=t;for(;e--;)n+=t[Math.random()*i|0];return n},isSpecCompliantForm:function(e){return!!(e&&g(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,i)=>{if(f(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[i]=e;const r=c(e)?[]:{};return x(e,(e,t)=>{const a=n(e,i+1);!u(a)&&(r[t]=a)}),t[i]=void 0,r}}return e};return n(e,0)},isAsyncFn:F,isThenable:e=>e&&(f(e)||g(e))&&g(e.then)&&g(e.catch)}}).call(this,n(12))},function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return I})),n.d(t,"c",(function(){return x})),n.d(t,"d",(function(){return S})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return N})),n.d(t,"g",(function(){return g})),n.d(t,"h",(function(){return _})),n.d(t,"i",(function(){return p})),n.d(t,"j",(function(){return u})),n.d(t,"k",(function(){return C})),n.d(t,"l",(function(){return m})),n.d(t,"m",(function(){return f})),n.d(t,"n",(function(){return v})),n.d(t,"o",(function(){return w})),n.d(t,"p",(function(){return b})),n.d(t,"q",(function(){return y})),n.d(t,"r",(function(){return E}));
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const r=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],a=t+1<e.length,l=a?e[t+1]:0,o=t+2<e.length,s=o?e[t+2]:0,d=r>>2,c=(3&r)<<4|l>>4;let u=(15&l)<<2|s>>6,p=63&s;o||(p=64,a||(u=64)),i.push(n[d],n[c],n[u],n[p])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const a=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&a)}else if(r>239&&r<365){const a=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(a>>10)),t[i++]=String.fromCharCode(56320+(1023&a))}else{const a=e[n++],l=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&a)<<6|63&l)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],a=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const s=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==a||null==o||null==s)throw new l;const d=r<<2|a>>4;if(i.push(d),64!==o){const e=a<<4&240|o>>2;if(i.push(e),64!==s){const e=o<<6&192|s;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=r(e);return a.encodeByteArray(t,!0)}(e).replace(/\./g,"")},s=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const d=()=>
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,c=()=>{try{return d()||(()=>{if(void 0===i||void 0===i.env)return;const e=i.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&s(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},u=e=>{const t=(e=>{var t,n;return null===(n=null===(t=c())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},p=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:"https://securetoken.google.com/"+n,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(a)),""].join(".")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function f(){return"undefined"!=typeof window||y()}function y(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function v(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function b(){return!function(){var t;const n=null===(t=c())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function w(){try{return"object"==typeof indexedDB}catch(e){return!1}}function E(){return new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}function S(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,I.prototype.create)}}class I{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],a=r?function(e,t){return e.replace(k,(e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`})}(r,n):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new x(i,l,n)}}const k=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],a=t[r];if(T(n)&&T(a)){if(!_(n,a))return!1}else if(n!==a)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function T(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N(e,t=1e3,n=2){const i=t*Math.pow(n,e),r=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+r)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function C(e){return e&&e._delegate?e._delegate:e}}).call(this,n(12),n(22))},function(e,t,n){"use strict";var i=n(0);function r(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r)}i.a.inherits(r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:i.a.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const a=r.prototype,l={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{l[e]={value:e}}),Object.defineProperties(r,l),Object.defineProperty(a,"isAxiosError",{value:!0}),r.from=(e,t,n,l,o,s)=>{const d=Object.create(a);return i.a.toFlatObject(e,d,(function(e){return e!==Error.prototype}),e=>"isAxiosError"!==e),r.call(d,e.message,t,n,l,o),d.cause=e,d.name=e.name,s&&Object.assign(d,s),d},t.a=r},function(e,t,n){"use strict";n.d(t,"a",(function(){return E})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return y})),n.d(t,"e",(function(){return x})),n.d(t,"f",(function(){return S})),n.d(t,"g",(function(){return I}));var i=n(6),r=n(4),a=n(1),l=n(17);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const s="@firebase/app",d=new r.b("@firebase/app"),c={[s]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},u=new Map,p=new Map,h=new Map;function g(e,t){try{e.container.addComponent(t)}catch(n){d.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function m(e){const t=e.name;if(h.has(t))return d.debug(`There were multiple attempts to register component ${t}.`),!1;h.set(t,e);for(const t of u.values())g(t,e);for(const t of p.values())g(t,e);return!0}function f(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function y(e,t,n="[DEFAULT]"){f(e,t).clearInstance(n)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const v={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},b=new a.b("app","Firebase",v);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class w{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.a("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw b.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const E="10.13.0";function S(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},t),l=r.name;if("string"!=typeof l||!l)throw b.create("bad-app-name",{appName:String(l)});if(n||(n=Object(a.i)()),!n)throw b.create("no-options");const o=u.get(l);if(o){if(Object(a.h)(n,o.options)&&Object(a.h)(r,o.config))return o;throw b.create("duplicate-app",{appName:l})}const s=new i.b(l);for(const e of h.values())s.addComponent(e);const d=new w(n,r,s);return u.set(l,d),d}function x(e="[DEFAULT]"){const t=u.get(e);if(!t&&"[DEFAULT]"===e&&Object(a.i)())return S();if(!t)throw b.create("no-app",{appName:e});return t}function I(e,t,n){var r;let a=null!==(r=c[e])&&void 0!==r?r:e;n&&(a+="-"+n);const l=a.match(/\s|\//),o=t.match(/\s|\//);if(l||o){const e=[`Unable to register library "${a}" with version "${t}":`];return l&&e.push(`library name "${a}" contains illegal characters (whitespace or "/")`),l&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void d.warn(e.join(" "))}m(new i.a(a+"-version",()=>({library:a,version:t}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const k="firebase-heartbeat-store";let _=null;function T(){return _||(_=Object(l.a)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(k)}catch(e){console.warn(e)}}}}).catch(e=>{throw b.create("idb-open",{originalErrorMessage:e.message})})),_}async function N(e,t){try{const n=(await T()).transaction(k,"readwrite"),i=n.objectStore(k);await i.put(t,C(e)),await n.done}catch(e){if(e instanceof a.c)d.warn(e.message);else{const t=b.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});d.warn(t.message)}}}function C(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new P(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=A();if(console.log("heartbeats",null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats),null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(n=this._heartbeatsCache)||void 0===n?void 0:n.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(e){d.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=A(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),B(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),B(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=Object(a.e)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return d.warn(e),""}}}function A(){return(new Date).toISOString().substring(0,10)}class P{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Object(a.o)()&&Object(a.r)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await T()).transaction(k),n=await t.objectStore(k).get(C(e));return await t.done,n}catch(e){if(e instanceof a.c)d.warn(e.message);else{const t=b.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});d.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return N(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return N(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function B(e){return Object(a.e)(JSON.stringify({version:2,heartbeats:e})).length}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var R;R="",m(new i.a("platform-logger",e=>new o(e),"PRIVATE")),m(new i.a("heartbeat",e=>new L(e),"PRIVATE")),I(s,"0.10.9",R),I(s,"0.10.9","esm2017"),I("fire-js","")},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u}));
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const i=[];var r;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));const a={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},l=r.INFO,o={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},s=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=o[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class d{constructor(e){this.name=e,this._logLevel=l,this._logHandler=s,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?a[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}function c(e){i.forEach(t=>{t.setLogLevel(e)})}function u(e,t){for(const n of i){let i=null;t&&t.level&&(i=a[t.level]),n.userLogHandler=null===e?null:(t,n,...a)=>{const l=a.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(null!=i?i:t.logLevel)&&e({level:r[n].toLowerCase(),message:l,args:a,type:t.name})}}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return i})),n.d(t,"h",(function(){return u})),n.d(t,"i",(function(){return c}));var i,r,a,l,o,s,d,c,u,p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},h={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof p&&p];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,i){if(i)e:{var r=n;e=e.split(".");for(var a=0;a<e.length-1;a++){var l=e[a];if(!(l in r))break e;r=r[l]}(i=i(a=r[e=e[e.length-1]]))!=a&&null!=i&&t(r,e,{configurable:!0,writable:!0,value:i})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,(function(e,t){return t}))}}));
/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var g=g||{},m=this||self;function f(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function y(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function v(e,t,n){return e.call.apply(e.bind,arguments)}function b(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:b).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function S(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var r=Array(arguments.length-2),a=2;a<arguments.length;a++)r[a-2]=arguments[a];return t.prototype[n].apply(e,r)}}function x(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(f(n)){const t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}function k(e){return/^[\s\xa0]*$/.test(e)}function _(){var e=m.navigator;return e&&(e=e.userAgent)?e:""}function T(e){return T[" "](e),e}T[" "]=function(){};var N=!(-1==_().indexOf("Gecko")||-1!=_().toLowerCase().indexOf("webkit")&&-1==_().indexOf("Edge")||-1!=_().indexOf("Trident")||-1!=_().indexOf("MSIE")||-1!=_().indexOf("Edge"));function C(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function L(e){const t={};for(const n in e)t[n]=e[n];return t}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<A.length;t++)n=A[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function B(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function R(e){m.setTimeout(()=>{throw e},0)}function F(){var e=j;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var M=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new D,e=>e.reset());class D{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let O,$=!1,j=new class{constructor(){this.h=this.g=null}add(e,t){const n=M.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},W=()=>{const e=m.Promise.resolve(void 0);O=()=>{e.then(H)}};var H=()=>{for(var e;e=F();){try{e.h.call(e.g)}catch(e){R(e)}var t=M;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}$=!1};function q(){this.s=this.s,this.C=this.C}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}q.prototype.s=!1,q.prototype.ma=function(){this.s||(this.s=!0,this.N())},q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},U.prototype.h=function(){this.defaultPrevented=!0};var z=function(){if(!m.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};m.addEventListener("test",e,t),m.removeEventListener("test",e,t)}catch(e){}return e}();function V(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(N){e:{try{T(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Y[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&V.aa.h.call(this)}}S(V,U);var Y={2:"touch",3:"pen",4:"mouse"};V.prototype.h=function(){V.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var G="closure_listenable_"+(1e6*Math.random()|0),J=0;function X(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++J,this.da=this.fa=!1}function K(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Z(e){this.src=e,this.g={},this.h=0}function Q(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],a=Array.prototype.indexOf.call(r,t,void 0);(i=0<=a)&&Array.prototype.splice.call(r,a,1),i&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ee(e,t,n,i){for(var r=0;r<e.length;++r){var a=e[r];if(!a.da&&a.listener==t&&a.capture==!!n&&a.ha==i)return r}return-1}Z.prototype.add=function(e,t,n,i,r){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var l=ee(e,t,i,r);return-1<l?(t=e[l],n||(t.fa=!1)):((t=new X(t,this.src,a,!!i,r)).fa=n,e.push(t)),t};var te="closure_lm_"+(1e6*Math.random()|0),ne={};function ie(e,t,n,i,r){if(i&&i.once)return function e(t,n,i,r,a){if(Array.isArray(n)){for(var l=0;l<n.length;l++)e(t,n[l],i,r,a);return null}return i=ce(i),t&&t[G]?t.L(n,i,y(r)?!!r.capture:!!r,a):re(t,n,i,!0,r,a)}(e,t,n,i,r);if(Array.isArray(t)){for(var a=0;a<t.length;a++)ie(e,t[a],n,i,r);return null}return n=ce(n),e&&e[G]?e.K(t,n,y(i)?!!i.capture:!!i,r):re(e,t,n,!1,i,r)}function re(e,t,n,i,r,a){if(!t)throw Error("Invalid event type");var l=y(r)?!!r.capture:!!r,o=se(e);if(o||(e[te]=o=new Z(e)),(n=o.add(t,n,i,l,a)).proxy)return n;if(i=function(){const e=oe;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)z||(r=l),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(le(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function ae(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[G])Q(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(le(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=se(t))?(Q(n,e),0==n.h&&(n.src=null,t[te]=null)):K(e)}}}function le(e){return e in ne?ne[e]:ne[e]="on"+e}function oe(e,t){if(e.da)e=!0;else{t=new V(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&ae(e),e=n.call(i,t)}return e}function se(e){return(e=e[te])instanceof Z?e:null}var de="__closure_events_fn_"+(1e9*Math.random()>>>0);function ce(e){return"function"==typeof e?e:(e[de]||(e[de]=function(t){return e.handleEvent(t)}),e[de])}function ue(){q.call(this),this.i=new Z(this),this.M=this,this.F=null}function pe(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new U(t,e);else if(t instanceof U)t.target=t.target||e;else{var r=t;P(t=new U(i,e),r)}if(r=!0,n)for(var a=n.length-1;0<=a;a--){var l=t.g=n[a];r=he(l,i,!0,t)&&r}if(r=he(l=t.g=e,i,!0,t)&&r,r=he(l,i,!1,t)&&r,n)for(a=0;a<n.length;a++)r=he(l=t.g=n[a],i,!1,t)&&r}function he(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,a=0;a<t.length;++a){var l=t[a];if(l&&!l.da&&l.capture==n){var o=l.listener,s=l.ha||l.src;l.fa&&Q(e.i,l),r=!1!==o.call(s,i)&&r}}return r&&!i.defaultPrevented}function ge(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=w(e.handleEvent,e)}return 2147483647<Number(t)?-1:m.setTimeout(e,t||0)}S(ue,q),ue.prototype[G]=!0,ue.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,a){if(Array.isArray(n))for(var l=0;l<n.length;l++)e(t,n[l],i,r,a);else r=y(r)?!!r.capture:!!r,i=ce(i),t&&t[G]?(t=t.i,(n=String(n).toString())in t.g&&(-1<(i=ee(l=t.g[n],i,r,a))&&(K(l[i]),Array.prototype.splice.call(l,i,1),0==l.length&&(delete t.g[n],t.h--)))):t&&(t=se(t))&&(n=t.g[n.toString()],t=-1,n&&(t=ee(n,i,r,a)),(i=-1<t?n[t]:null)&&ae(i))}(this,e,t,n,i)},ue.prototype.N=function(){if(ue.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)K(n[i]);delete t.g[e],t.h--}}this.F=null},ue.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ue.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class me extends q{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ge(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);const n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(m.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fe(e){q.call(this),this.h=e,this.g={}}S(fe,q);var ye=[];function ve(e){C(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ae(e)}),e),e.g={}}fe.prototype.N=function(){fe.aa.N.call(this),ve(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var be=m.JSON.stringify,we=m.JSON.parse;function Ee(){}function Se(e){return e.h||(e.h=e.i())}function xe(){}Ee.prototype.h=null;var Ie={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ke(){U.call(this,"d")}function _e(){U.call(this,"c")}S(ke,U),S(_e,U);var Te={},Ne=null;function Ce(){return Ne=Ne||new ue}function Le(e){U.call(this,Te.La,e)}function Ae(e){const t=Ce();pe(t,new Le(t))}function Pe(e,t){U.call(this,Te.STAT_EVENT,e),this.stat=t}function Be(e){const t=Ce();pe(t,new Pe(t,e))}function Re(e,t){U.call(this,Te.Ma,e),this.size=t}function Fe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return m.setTimeout((function(){e()}),t)}function Me(){this.g=!0}function De(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var a=r[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var l=1;l<r.length;l++)r[l]=""}}}return be(n)}catch(e){return t}}(e,n)+(i?" "+i:"")}))}Te.La="serverreachability",S(Le,U),Te.STAT_EVENT="statevent",S(Pe,U),Te.Ma="timingevent",S(Re,U),Me.prototype.xa=function(){this.g=!1},Me.prototype.info=function(){};var Oe,$e={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},je={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function We(){}function He(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new fe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new qe}function qe(){this.i=null,this.g="",this.h=!1}S(We,Ee),We.prototype.g=function(){return new XMLHttpRequest},We.prototype.i=function(){return{}},Oe=new We;var Ue={},ze={};function Ve(e,t,n){e.L=1,e.v=yt(pt(t)),e.m=n,e.P=!0,Ye(e,null)}function Ye(e,t){e.F=Date.now(),Xe(e),e.A=pt(e.v);var n=e.A,i=e.R;Array.isArray(i)||(i=[String(i)]),At(n.i,"t",i),e.C=0,n=e.j.J,e.h=new qe,e.g=bn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new me(w(e.Y,e,e.g),e.O)),t=e.U,n=e.g,i=e.ca;var r="readystatechange";Array.isArray(r)||(r&&(ye[0]=r.toString()),r=ye);for(var a=0;a<r.length;a++){var l=ie(n,r[a],i||t.handleEvent,!1,t.h||t);if(!l)break;t.g[l.key]=l}t=e.H?L(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ae(),function(e,t,n,i,r,a){e.info((function(){if(e.g)if(a)for(var l="",o=a.split("&"),s=0;s<o.length;s++){var d=o[s].split("=");if(1<d.length){var c=d[0];d=d[1];var u=c.split("_");l=2<=u.length&&"type"==u[1]?l+(c+"=")+d+"&":l+(c+"=redacted&")}}else l=null;else l=a;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+l}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ge(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Je(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?ze:(n=Number(t.substring(n,i)),isNaN(n)?Ue:(i+=1)+n>t.length?ze:(t=t.slice(i,i+n),e.C=i+n,t))}function Xe(e){e.S=Date.now()+e.I,Ke(e,e.I)}function Ke(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Fe(w(e.ba,e),t)}function Ze(e){e.B&&(m.clearTimeout(e.B),e.B=null)}function Qe(e){0==e.j.G||e.J||gn(e.j,e)}function et(e){Ze(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ve(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function tt(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||at(n.h,e)))if(!e.K&&at(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;hn(n),nn(n)}cn(n),Be(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=Fe(w(n.Za,n),6e3));if(1>=rt(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else fn(n,11)}else if((e.K||n.g==e)&&hn(n),!k(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let d=r[t];if(n.T=d[0],d=d[1],2==n.G)if("c"==d[0]){n.K=d[1],n.ia=d[2];const t=d[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const r=d[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));const c=d[5];null!=c&&"number"==typeof c&&0<c&&(i=1.5*c,n.L=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var a=i.h;a.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(a.j=a.l,a.g=new Set,a.h&&(lt(a,a.h),a.h=null))}if(i.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,ft(i.I,i.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var l=e;if((i=n).qa=vn(i,i.J?i.ia:null,i.W),l.K){ot(i.h,l);var o=l,s=i.L;s&&(o.I=s),o.B&&(Ze(o),Xe(o)),i.g=l}else dn(i);0<n.i.length&&an(n)}else"stop"!=d[0]&&"close"!=d[0]||fn(n,7);else 3==n.G&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?fn(n,7):tn(n):"noop"!=d[0]&&n.l&&n.l.ta(d),n.v=0)}Ae()}catch(e){}}He.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Kt(e)?t.j():this.Y(e)},He.prototype.Y=function(e){try{if(e==this.g)e:{const u=Kt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>u)&&(3!=u||this.g&&(this.h.h||this.g.oa()||Zt(this.g)))){this.J||4!=u||7==t||Ae(),Ze(this);var n=this.g.Z();this.X=n;t:if(Ge(this)){var i=Zt(this.g);e="";var r=i.length,a=4==Kt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){et(this),Qe(this);var l="";break t}this.h.i=new m.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(a&&t==r-1)});i.length=0,this.h.g+=e,this.C=0,l=this.h.g}else l=this.g.oa();if(this.o=200==n,function(e,t,n,i,r,a,l){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+a+" "+l}))}(this.i,this.u,this.A,this.l,this.R,u,n),this.o){if(this.T&&!this.K){t:{if(this.g){var o,s=this.g;if((o=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(o)){var d=o;break t}}d=null}if(!(n=d)){this.o=!1,this.s=3,Be(12),et(this),Qe(this);break e}De(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tt(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<l.length;){if(e=Je(this,l),e==ze){4==u&&(this.s=4,Be(14),n=!1),De(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ue){this.s=4,Be(15),De(this.i,this.l,l,"[Invalid Chunk]"),n=!1;break}De(this.i,this.l,e,null),tt(this,e)}if(Ge(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=u||0!=l.length||this.h.h||(this.s=1,Be(16),n=!1),this.o=this.o&&n,n){if(0<l.length&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.ba&&!c.M&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),un(c),c.M=!0,Be(11))}}else De(this.i,this.l,l,"[Invalid Chunked Response]"),et(this),Qe(this)}else De(this.i,this.l,l,null),tt(this,l);4==u&&et(this),this.o&&!this.J&&(4==u?gn(this.j,this):(this.o=!1,Xe(this)))}else(function(e){const t={};e=(e.g&&2<=Kt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(k(e[i]))continue;var n=B(e[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const a=t[r]||[];t[r]=a,a.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<l.indexOf("Unknown SID")?(this.s=3,Be(12)):(this.s=0,Be(13)),et(this),Qe(this)}}}catch(e){}},He.prototype.cancel=function(){this.J=!0,et(this)},He.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Ae(),Be(17)),et(this),this.s=2,Qe(this)):Ke(this,this.S-e)};function nt(e){this.l=e||10,m.PerformanceNavigationTiming?e=0<(e=m.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(m.chrome&&m.chrome.loadTimes&&m.chrome.loadTimes()&&m.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function it(e){return!!e.h||!!e.g&&e.g.size>=e.j}function rt(e){return e.h?1:e.g?e.g.size:0}function at(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function lt(e,t){e.g?e.g.add(t):e.h=t}function ot(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function st(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return x(e.i)}function dt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(f(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(f(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(f(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,a=0;a<r;a++)t.call(void 0,i[a],n&&n[a],e)}nt.prototype.cancel=function(){if(this.i=st(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ct=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ut(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof ut){this.h=e.h,ht(this,e.j),this.o=e.o,this.g=e.g,gt(this,e.s),this.l=e.l;var t=e.i,n=new Tt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),mt(this,n),this.m=e.m}else e&&(t=String(e).match(ct))?(this.h=!1,ht(this,t[1]||"",!0),this.o=vt(t[2]||""),this.g=vt(t[3]||"",!0),gt(this,t[4]),this.l=vt(t[5]||"",!0),mt(this,t[6]||"",!0),this.m=vt(t[7]||"")):(this.h=!1,this.i=new Tt(null,this.h))}function pt(e){return new ut(e)}function ht(e,t,n){e.j=n?vt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function gt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function mt(e,t,n){t instanceof Tt?(e.i=t,function(e,t){t&&!e.j&&(Nt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ct(this,t),At(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=bt(t,kt)),e.i=new Tt(t,e.h))}function ft(e,t,n){e.i.set(t,n)}function yt(e){return ft(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function vt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function bt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,wt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function wt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ut.prototype.toString=function(){var e=[],t=this.j;t&&e.push(bt(t,St,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(bt(t,St,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(bt(n,"/"==n.charAt(0)?It:xt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",bt(n,_t)),e.join("")};var Et,St=/[#\/\?@]/g,xt=/[#\?:]/g,It=/[#\?]/g,kt=/[#\?@]/g,_t=/#/g;function Tt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Nt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var a=e[n].substring(0,i);r=e[n].substring(i+1)}else a=e[n];t(a,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Ct(e,t){Nt(e),t=Pt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Lt(e,t){return Nt(e),t=Pt(e,t),e.g.has(t)}function At(e,t,n){Ct(e,t),0<n.length&&(e.i=null,e.g.set(Pt(e,t),x(n)),e.h+=n.length)}function Pt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Bt(e,t,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(e){}}function Rt(){this.g=new class{stringify(e){return m.JSON.stringify(e,void 0)}parse(e){return m.JSON.parse(e,void 0)}}}function Ft(e,t,n){const i=n||"";try{dt(e,(function(e,n){let r=e;y(e)&&(r=be(e)),t.push(i+n+"="+encodeURIComponent(r))}))}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}function Mt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Dt(e,t){ue.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Ot(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function $t(e){e.readyState=4,e.l=null,e.j=null,e.v=null,jt(e)}function jt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Wt(e){let t="";return C(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Ht(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Wt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ft(e,t,n))}function qt(e){ue.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Tt.prototype).add=function(e,t){Nt(this),this.i=null,e=Pt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Nt(this),this.g.forEach((function(n,i){n.forEach((function(n){e.call(t,n,i,this)}),this)}),this)},e.na=function(){Nt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},e.V=function(e){Nt(this);let t=[];if("string"==typeof e)Lt(this,e)&&(t=t.concat(this.g.get(Pt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Nt(this),this.i=null,Lt(this,e=Pt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const a=encodeURIComponent(String(i)),l=this.V(i);for(i=0;i<l.length;i++){var r=a;""!==l[i]&&(r+="="+encodeURIComponent(String(l[i]))),e.push(r)}}return this.i=e.join("&")},S(Mt,Ee),Mt.prototype.g=function(){return new Dt(this.l,this.j)},Mt.prototype.i=(Et={},function(){return Et}),S(Dt,ue),(e=Dt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,jt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||m).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,$t(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,jt(this)),this.g&&(this.readyState=3,jt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==m.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ot(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?$t(this):jt(this),3==this.readyState&&Ot(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,$t(this))},e.Qa=function(e){this.g&&(this.response=e,$t(this))},e.ga=function(){this.g&&$t(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Dt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),S(qt,ue);var Ut=/^https?$/i,zt=["POST","PUT"];function Vt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Yt(e),Jt(e)}function Yt(e){e.A||(e.A=!0,pe(e,"complete"),pe(e,"error"))}function Gt(e){if(e.h&&void 0!==g&&(!e.v[1]||4!=Kt(e)||2!=e.Z()))if(e.u&&4==Kt(e))ge(e.Ea,0,e);else if(pe(e,"readystatechange"),4==Kt(e)){e.h=!1;try{const l=e.Z();e:switch(l){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===l){var r=String(e.D).match(ct)[1]||null;!r&&m.self&&m.self.location&&(r=m.self.location.protocol.slice(0,-1)),i=!Ut.test(r?r.toLowerCase():"")}n=i}if(n)pe(e,"complete"),pe(e,"success");else{e.m=6;try{var a=2<Kt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Yt(e)}}finally{Jt(e)}}}function Jt(e,t){if(e.g){Xt(e);const n=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||pe(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function Xt(e){e.I&&(m.clearTimeout(e.I),e.I=null)}function Kt(e){return e.g?e.g.readyState:0}function Zt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Qt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function en(e){this.Aa=0,this.i=[],this.j=new Me,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qt("baseRetryDelayMs",5e3,e),this.cb=Qt("retryDelaySeedMs",1e4,e),this.Wa=Qt("forwardChannelMaxRetries",2,e),this.wa=Qt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new nt(e&&e.concurrentRequestLimit),this.Da=new Rt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tn(e){if(rn(e),3==e.G){var t=e.U++,n=pt(e.I);if(ft(n,"SID",e.K),ft(n,"RID",t),ft(n,"TYPE","terminate"),on(e,n),(t=new He(e,e.j,t)).L=2,t.v=yt(pt(n)),n=!1,m.navigator&&m.navigator.sendBeacon)try{n=m.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&m.Image&&((new Image).src=t.v,n=!0),n||(t.g=bn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Xe(t)}yn(e)}function nn(e){e.g&&(un(e),e.g.cancel(),e.g=null)}function rn(e){nn(e),e.u&&(m.clearTimeout(e.u),e.u=null),hn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&m.clearTimeout(e.s),e.s=null)}function an(e){if(!it(e.h)&&!e.s){e.s=!0;var t=e.Ga;O||W(),$||(O(),$=!0),j.add(t,e),e.B=0}}function ln(e,t){var n;n=t?t.l:e.U++;const i=pt(e.I);ft(i,"SID",e.K),ft(i,"RID",n),ft(i,"AID",e.T),on(e,i),e.m&&e.o&&Ht(i,e.m,e.o),n=new He(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=sn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),lt(e.h,n),Ve(n,i,t)}function on(e,t){e.H&&C(e.H,(function(e,n){ft(t,n,e)})),e.l&&dt({},(function(e,n){ft(t,n,e)}))}function sn(e,t,n){n=Math.min(e.i.length,n);var i=e.l?w(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let a=!0;for(let l=0;l<n;l++){let n=r[l].g;const o=r[l].map;if(n-=t,0>n)t=Math.max(0,r[l].g-100),a=!1;else try{Ft(o,e,"req"+n+"_")}catch(e){i&&i(o)}}if(a){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function dn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;O||W(),$||(O(),$=!0),j.add(t,e),e.v=0}}function cn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Fe(w(e.Fa,e),mn(e,e.v)),e.v++,!0)}function un(e){null!=e.A&&(m.clearTimeout(e.A),e.A=null)}function pn(e){e.g=new He(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=pt(e.qa);ft(t,"RID","rpc"),ft(t,"SID",e.K),ft(t,"AID",e.T),ft(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ft(t,"TO",e.ja),ft(t,"TYPE","xmlhttp"),on(e,t),e.m&&e.o&&Ht(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=yt(pt(t)),n.m=null,n.P=!0,Ye(n,e)}function hn(e){null!=e.C&&(m.clearTimeout(e.C),e.C=null)}function gn(e,t){var n=null;if(e.g==t){hn(e),un(e),e.g=null;var i=2}else{if(!at(e.h,t))return;n=t.D,ot(e.h,t),i=1}if(0!=e.G)if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var r=e.B;pe(i=Ce(),new Re(i,n)),an(e)}else dn(e);else if(3==(r=t.s)||0==r&&0<t.X||!(1==i&&function(e,t){return!(rt(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Fe(w(e.Ga,e,t),mn(e,e.B)),e.B++,!0))}(e,t)||2==i&&cn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),r){case 1:fn(e,5);break;case 4:fn(e,10);break;case 3:fn(e,6);break;default:fn(e,2)}}function mn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function fn(e,t){if(e.j.info("Error code "+t),2==t){var n=w(e.fb,e),i=e.Xa;const t=!i;i=new ut(i||"//www.google.com/images/cleardot.gif"),m.location&&"http"==m.location.protocol||ht(i,"https"),yt(i),t?function(e,t){const n=new Me;if(m.Image){const i=new Image;i.onload=E(Bt,n,"TestLoadImage: loaded",!0,t,i),i.onerror=E(Bt,n,"TestLoadImage: error",!1,t,i),i.onabort=E(Bt,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=E(Bt,n,"TestLoadImage: timeout",!1,t,i),m.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){const n=new Me,i=new AbortController,r=setTimeout(()=>{i.abort(),Bt(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:i.signal}).then(e=>{clearTimeout(r),e.ok?Bt(n,"TestPingServer: ok",!0,t):Bt(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(r),Bt(n,"TestPingServer: error",!1,t)})}(i.toString(),n)}else Be(2);e.G=0,e.l&&e.l.sa(t),yn(e),rn(e)}function yn(e){if(e.G=0,e.ka=[],e.l){const t=st(e.h);0==t.length&&0==e.i.length||(I(e.ka,t),I(e.ka,e.i),e.h.i.length=0,x(e.i),e.i.length=0),e.l.ra()}}function vn(e,t,n){var i=n instanceof ut?pt(n):new ut(n);if(""!=i.g)t&&(i.g=t+"."+i.g),gt(i,i.s);else{var r=m.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var a=new ut(null);i&&ht(a,i),t&&(a.g=t),r&&gt(a,r),n&&(a.l=n),i=a}return n=e.D,t=e.ya,n&&t&&ft(i,n,t),ft(i,"VER",e.la),on(e,i),i}function bn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new qt(new Mt({eb:n})):new qt(e.pa)).Ha(e.J),t}function wn(){}function En(){}function Sn(e,t){ue.call(this),this.g=new en(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!k(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!k(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new kn(this)}function xn(e){ke.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function In(){_e.call(this),this.status=1}function kn(e){this.g=e}(e=qt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Oe.g(),this.v=this.o?Se(this.o):Se(Oe),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Vt(this,e)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=m.FormData&&e instanceof m.FormData,!(0<=Array.prototype.indexOf.call(zt,t,void 0))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Xt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Vt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,pe(this,"complete"),pe(this,"abort"),Jt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Jt(this,!0)),qt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Gt(this):this.bb())},e.bb=function(){Gt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Kt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),we(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=en.prototype).la=8,e.G=1,e.connect=function(e,t,n,i){Be(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=vn(this,null,this.W),an(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const r=new He(this,this.j,e);let a=this.o;if(this.S&&(a?(a=L(a),P(a,this.S)):a=this.S),null!==this.m||this.O||(r.H=a,a=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=sn(this,r,t),ft(n=pt(this.I),"RID",e),ft(n,"CVER",22),this.D&&ft(n,"X-HTTP-Session-Id",this.D),on(this,n),a&&(this.O?t="headers="+encodeURIComponent(String(Wt(a)))+"&"+t:this.m&&Ht(n,this.m,a)),lt(this.h,r),this.Ua&&ft(n,"TYPE","init"),this.P?(ft(n,"$req",t),ft(n,"SID","null"),r.T=!0,Ve(r,n,null)):Ve(r,n,t),this.G=2}}else 3==this.G&&(e?ln(this,e):0==this.i.length||it(this.h)||ln(this))},e.Fa=function(){if(this.u=null,pn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Fe(w(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Be(10),nn(this),pn(this))},e.Za=function(){null!=this.C&&(this.C=null,nn(this),cn(this),Be(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Be(2)):(this.j.info("Failed to ping google.com"),Be(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=wn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},En.prototype.g=function(e,t){return new Sn(e,t)},S(Sn,ue),Sn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Sn.prototype.close=function(){tn(this.g)},Sn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=be(e),e=n);t.i.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.Ya++,e)),3==t.G&&an(t)},Sn.prototype.N=function(){this.g.l=null,delete this.j,tn(this.g),delete this.g,Sn.aa.N.call(this)},S(xn,ke),S(In,_e),S(kn,wn),kn.prototype.ua=function(){pe(this.g,"a")},kn.prototype.ta=function(e){pe(this.g,new xn(e))},kn.prototype.sa=function(e){pe(this.g,new In)},kn.prototype.ra=function(){pe(this.g,"b")},En.prototype.createWebChannel=En.prototype.g,Sn.prototype.send=Sn.prototype.o,Sn.prototype.open=Sn.prototype.m,Sn.prototype.close=Sn.prototype.close,u=h.createWebChannelTransport=function(){return new En},c=h.getStatEventTarget=function(){return Ce()},d=h.Event=Te,s=h.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},$e.NO_ERROR=0,$e.TIMEOUT=8,$e.HTTP_ERROR=6,o=h.ErrorCode=$e,je.COMPLETE="complete",l=h.EventType=je,xe.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",ue.prototype.listen=ue.prototype.K,a=h.WebChannel=xe,r=h.FetchXmlHttpFactory=Mt,qt.prototype.listenOnce=qt.prototype.L,qt.prototype.getLastError=qt.prototype.Ka,qt.prototype.getLastErrorCode=qt.prototype.Ba,qt.prototype.getStatus=qt.prototype.Z,qt.prototype.getResponseJson=qt.prototype.Oa,qt.prototype.getResponseText=qt.prototype.oa,qt.prototype.send=qt.prototype.ea,qt.prototype.setWithCredentials=qt.prototype.Ha,i=h.XhrIo=qt}).apply(void 0!==p?p:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}).call(this,n(12))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return l}));var i=n(1);class r{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.a;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const a=this.instances.get(i);return a&&e(a,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,"[DEFAULT]"===i?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:"[DEFAULT]":e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class l{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},,,function(e,t,n){"use strict";(function(e){var i=n(0),r=n(2),a=n(16);function l(e){return i.a.isPlainObject(e)||i.a.isArray(e)}function o(e){return i.a.endsWith(e,"[]")?e.slice(0,-2):e}function s(e,t,n){return e?e.concat(t).map((function(e,t){return e=o(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const d=i.a.toFlatObject(i.a,{},null,(function(e){return/^is[A-Z]/.test(e)}));t.a=function(t,n,c){if(!i.a.isObject(t))throw new TypeError("target must be an object");n=n||new(a.a||FormData);const u=(c=i.a.toFlatObject(c,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!i.a.isUndefined(t[e])}))).metaTokens,p=c.visitor||y,h=c.dots,g=c.indexes,m=(c.Blob||"undefined"!=typeof Blob&&Blob)&&i.a.isSpecCompliantForm(n);if(!i.a.isFunction(p))throw new TypeError("visitor must be a function");function f(t){if(null===t)return"";if(i.a.isDate(t))return t.toISOString();if(!m&&i.a.isBlob(t))throw new r.a("Blob is not supported. Use a Buffer instead.");return i.a.isArrayBuffer(t)||i.a.isTypedArray(t)?m&&"function"==typeof Blob?new Blob([t]):e.from(t):t}function y(e,t,r){let a=e;if(e&&!r&&"object"==typeof e)if(i.a.endsWith(t,"{}"))t=u?t:t.slice(0,-2),e=JSON.stringify(e);else if(i.a.isArray(e)&&function(e){return i.a.isArray(e)&&!e.some(l)}(e)||(i.a.isFileList(e)||i.a.endsWith(t,"[]"))&&(a=i.a.toArray(e)))return t=o(t),a.forEach((function(e,r){!i.a.isUndefined(e)&&null!==e&&n.append(!0===g?s([t],r,h):null===g?t:t+"[]",f(e))})),!1;return!!l(e)||(n.append(s(r,t,h),f(e)),!1)}const v=[],b=Object.assign(d,{defaultVisitor:y,convertValue:f,isVisitable:l});if(!i.a.isObject(t))throw new TypeError("data must be an object");return function e(t,r){if(!i.a.isUndefined(t)){if(-1!==v.indexOf(t))throw Error("Circular reference detected in "+r.join("."));v.push(t),i.a.forEach(t,(function(t,a){!0===(!(i.a.isUndefined(t)||null===t)&&p.call(n,t,i.a.isString(a)?a.trim():a,r,b))&&e(t,r?r.concat(a):[a])})),v.pop()}}(t),n}}).call(this,n(23).Buffer)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var i,r,a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},l={};(function(){var e;
/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var a=e.g[3],l=t+(a^n&(r^a))+i[0]+3614090360&4294967295;l=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=(n=(r=(a=(t=n+(l<<7&4294967295|l>>>25))+((l=a+(r^t&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|l>>>20))+((l=r+(n^a&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|l>>>15))+((l=n+(t^r&(a^t))+i[3]+3250441966&4294967295)<<22&4294967295|l>>>10))+((l=t+(a^n&(r^a))+i[4]+4118548399&4294967295)<<7&4294967295|l>>>25))+((l=a+(r^t&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|l>>>20))+((l=r+(n^a&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|l>>>15))+((l=n+(t^r&(a^t))+i[7]+4249261313&4294967295)<<22&4294967295|l>>>10))+((l=t+(a^n&(r^a))+i[8]+1770035416&4294967295)<<7&4294967295|l>>>25))+((l=a+(r^t&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|l>>>20))+((l=r+(n^a&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|l>>>15))+((l=n+(t^r&(a^t))+i[11]+2304563134&4294967295)<<22&4294967295|l>>>10))+((l=t+(a^n&(r^a))+i[12]+1804603682&4294967295)<<7&4294967295|l>>>25))+((l=a+(r^t&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|l>>>20))+((l=r+(n^a&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|l>>>15))+((l=n+(t^r&(a^t))+i[15]+1236535329&4294967295)<<22&4294967295|l>>>10))+((l=t+(r^a&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|l>>>27))+((l=a+(n^r&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|l>>>23))+((l=r+(t^n&(a^t))+i[11]+643717713&4294967295)<<14&4294967295|l>>>18))+((l=n+(a^t&(r^a))+i[0]+3921069994&4294967295)<<20&4294967295|l>>>12))+((l=t+(r^a&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|l>>>27))+((l=a+(n^r&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|l>>>23))+((l=r+(t^n&(a^t))+i[15]+3634488961&4294967295)<<14&4294967295|l>>>18))+((l=n+(a^t&(r^a))+i[4]+3889429448&4294967295)<<20&4294967295|l>>>12))+((l=t+(r^a&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|l>>>27))+((l=a+(n^r&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|l>>>23))+((l=r+(t^n&(a^t))+i[3]+4107603335&4294967295)<<14&4294967295|l>>>18))+((l=n+(a^t&(r^a))+i[8]+1163531501&4294967295)<<20&4294967295|l>>>12))+((l=t+(r^a&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|l>>>27))+((l=a+(n^r&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|l>>>23))+((l=r+(t^n&(a^t))+i[7]+1735328473&4294967295)<<14&4294967295|l>>>18))+((l=n+(a^t&(r^a))+i[12]+2368359562&4294967295)<<20&4294967295|l>>>12))+((l=t+(n^r^a)+i[5]+4294588738&4294967295)<<4&4294967295|l>>>28))+((l=a+(t^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|l>>>21))+((l=r+(a^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|l>>>16))+((l=n+(r^a^t)+i[14]+4259657740&4294967295)<<23&4294967295|l>>>9))+((l=t+(n^r^a)+i[1]+2763975236&4294967295)<<4&4294967295|l>>>28))+((l=a+(t^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|l>>>21))+((l=r+(a^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|l>>>16))+((l=n+(r^a^t)+i[10]+3200236656&4294967295)<<23&4294967295|l>>>9))+((l=t+(n^r^a)+i[13]+681279174&4294967295)<<4&4294967295|l>>>28))+((l=a+(t^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|l>>>21))+((l=r+(a^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|l>>>16))+((l=n+(r^a^t)+i[6]+76029189&4294967295)<<23&4294967295|l>>>9))+((l=t+(n^r^a)+i[9]+3654602809&4294967295)<<4&4294967295|l>>>28))+((l=a+(t^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|l>>>21))+((l=r+(a^t^n)+i[15]+530742520&4294967295)<<16&4294967295|l>>>16))+((l=n+(r^a^t)+i[2]+3299628645&4294967295)<<23&4294967295|l>>>9))+((l=t+(r^(n|~a))+i[0]+4096336452&4294967295)<<6&4294967295|l>>>26))+((l=a+(n^(t|~r))+i[7]+1126891415&4294967295)<<10&4294967295|l>>>22))+((l=r+(t^(a|~n))+i[14]+2878612391&4294967295)<<15&4294967295|l>>>17))+((l=n+(a^(r|~t))+i[5]+4237533241&4294967295)<<21&4294967295|l>>>11))+((l=t+(r^(n|~a))+i[12]+1700485571&4294967295)<<6&4294967295|l>>>26))+((l=a+(n^(t|~r))+i[3]+2399980690&4294967295)<<10&4294967295|l>>>22))+((l=r+(t^(a|~n))+i[10]+4293915773&4294967295)<<15&4294967295|l>>>17))+((l=n+(a^(r|~t))+i[1]+2240044497&4294967295)<<21&4294967295|l>>>11))+((l=t+(r^(n|~a))+i[8]+1873313359&4294967295)<<6&4294967295|l>>>26))+((l=a+(n^(t|~r))+i[15]+4264355552&4294967295)<<10&4294967295|l>>>22))+((l=r+(t^(a|~n))+i[6]+2734768916&4294967295)<<15&4294967295|l>>>17))+((l=n+(a^(r|~t))+i[13]+1309151649&4294967295)<<21&4294967295|l>>>11))+((a=(t=n+((l=t+(r^(n|~a))+i[4]+4149444226&4294967295)<<6&4294967295|l>>>26))+((l=a+(n^(t|~r))+i[11]+3174756917&4294967295)<<10&4294967295|l>>>22))^((r=a+((l=r+(t^(a|~n))+i[2]+718787259&4294967295)<<15&4294967295|l>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(l<<21&4294967295|l>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+a&4294967295}function a(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var a=0|e[r];i&&a==t||(n[r]=a,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var r=Array(arguments.length-2),a=2;a<arguments.length;a++)r[a-2]=arguments[a];return t.prototype[n].apply(e,r)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var i=t-this.blockSize,r=this.B,a=this.h,l=0;l<t;){if(0==a)for(;l<=i;)n(this,e,l),l+=this.blockSize;if("string"==typeof e){for(;l<t;)if(r[a++]=e.charCodeAt(l++),a==this.blockSize){n(this,r),a=0;break}}else for(;l<t;)if(r[a++]=e[l++],a==this.blockSize){n(this,r),a=0;break}}this.h=a,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var o={};function s(e){return-128<=e&&128>e?function(e,t){var n=o;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new a([0|e],0>e?-1:0)})):new a([0|e],0>e?-1:0)}function d(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(d(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new a(t,0)}var c=s(0),u=s(1),p=s(16777216);function h(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return-1==e.h}function m(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new a(n,~e.h).add(u)}function f(e,t){return e.add(m(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(h(t))throw Error("division by zero");if(h(e))return new v(c,c);if(g(e))return t=b(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new v(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,i=t;0>=i.l(e);)n=w(n),i=w(i);var r=E(n,1),a=E(i,1);for(i=E(i,2),n=E(n,2);!h(i);){var l=a.add(i);0>=l.l(e)&&(r=r.add(n),a=l),i=E(i,1),n=E(n,1)}return t=f(e,r.j(t)),new v(r,t)}for(r=c;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),l=(a=d(n)).j(t);g(l)||0<l.l(e);)l=(a=d(n-=i)).j(t);h(a)&&(a=u),r=r.add(a),e=f(e,l)}return new v(r,e)}function w(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new a(n,e.h)}function E(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,r=[],l=0;l<i;l++)r[l]=0<t?e.i(l+n)>>>t|e.i(l+n+1)<<32-t:e.i(l+n);return new a(r,e.h)}(e=a.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(h(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=d(Math.pow(e,6)),n=this,i="";;){var r=b(n,t).g,a=((0<(n=f(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(h(n=r))return a+i;for(;6>a.length;)a="0"+a;i=a+i}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return g(e=f(this,e))?-1:h(e)?0:1},e.abs=function(){return g(this)?m(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,r=0;r<=t;r++){var l=i+(65535&this.i(r))+(65535&e.i(r)),o=(l>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);i=o>>>16,l&=65535,o&=65535,n[r]=o<<16|l}return new a(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(h(this)||h(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(p)&&0>e.l(p))return d(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<e.g.length;r++){var l=this.i(i)>>>16,o=65535&this.i(i),s=e.i(r)>>>16,u=65535&e.i(r);n[2*i+2*r]+=o*u,y(n,2*i+2*r),n[2*i+2*r+1]+=l*u,y(n,2*i+2*r+1),n[2*i+2*r+1]+=o*s,y(n,2*i+2*r+1),n[2*i+2*r+2]+=l*s,y(n,2*i+2*r+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new a(n,0)},e.A=function(e){return b(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new a(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new a(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new a(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,r=l.Md5=t,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=d(Math.pow(n,8)),r=c,a=0;a<t.length;a+=8){var l=Math.min(8,t.length-a),o=parseInt(t.substring(a,a+l),n);8>l?(l=d(Math.pow(n,l)),r=r.j(l).add(d(o))):r=(r=r.j(i)).add(d(o))}return r},i=l.Integer=a}).apply(void 0!==a?a:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}).call(this,n(12))},,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},,,function(e,t,n){"use strict";function i(e,t){return function(){return e.apply(t,arguments)}}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";t.a=null},function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));let i,r;const a=new WeakMap,l=new WeakMap,o=new WeakMap,s=new WeakMap,d=new WeakMap;let c={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("objectStoreNames"===t)return e.objectStoreNames||o.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function u(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),h(a.get(this))}:function(...t){return h(e.apply(g(this),t))}:function(t,...n){const i=e.call(g(this),t,...n);return o.set(i,t.sort?t.sort():[t]),h(i)}}function p(e){return"function"==typeof e?u(e):(e instanceof IDBTransaction&&function(e){if(l.has(e))return;const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",a),e.removeEventListener("abort",a)},r=()=>{t(),i()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",a),e.addEventListener("abort",a)});l.set(e,t)}(e),t=e,(i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,c):e);var t}function h(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",a)},r=()=>{t(h(e.result)),i()},a=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&a.set(t,e)}).catch(()=>{}),d.set(t,e),t}(e);if(s.has(e))return s.get(e);const t=p(e);return t!==e&&(s.set(e,t),d.set(t,e)),t}const g=e=>d.get(e);function m(e,t,{blocked:n,upgrade:i,blocking:r,terminated:a}={}){const l=indexedDB.open(e,t),o=h(l);return i&&l.addEventListener("upgradeneeded",e=>{i(h(l.result),e.oldVersion,e.newVersion,h(l.transaction),e)}),n&&l.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{a&&e.addEventListener("close",()=>a()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}const f=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],v=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(v.get(t))return v.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=y.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!f.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,r?"readwrite":"readonly");let l=a.store;return i&&(l=l.index(t.shift())),(await Promise.all([l[n](...t),r&&a.done]))[0]};return v.set(t,a),a}c=(e=>({...e,get:(t,n,i)=>b(t,n)||e.get(t,n,i),has:(t,n)=>!!b(t,n)||e.has(t,n)}))(c)},,,,function(e,t,n){"use strict";(function(e,t){var i=n(3),r=n(6),a=n(4),l=n(1),o=n(10);n(5);const s="@firebase/firestore";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}d.UNAUTHENTICATED=new d(null),d.GOOGLE_CREDENTIALS=new d("google-credentials-uid"),d.FIRST_PARTY=new d("first-party-uid"),d.MOCK_USER=new d("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let c="10.13.0";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u=new a.b("@firebase/firestore");function p(e,...t){if(u.logLevel<=a.a.DEBUG){const n=t.map(g);u.debug(`Firestore (${c}): ${e}`,...n)}}function h(e,...t){if(u.logLevel<=a.a.ERROR){const n=t.map(g);u.error(`Firestore (${c}): ${e}`,...n)}}function g(e){if("string"==typeof e)return e;try{
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m(e="Unexpected state"){const t=`FIRESTORE (${c}) INTERNAL ASSERTION FAILED: `+e;throw h(t),new Error(t)}function f(e,t){e||m()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends l.c{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class E{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(d.UNAUTHENTICATED))}shutdown(){}}class S{constructor(e){this.t=e,this.currentUser=d.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new b;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new b,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},l=e=>{p("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>l(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?l(e):(p("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new b)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(p("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(f("string"==typeof t.accessToken),new w(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return f(null===e||"string"==typeof e),new d(e)}}class x{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=d.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class I{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new x(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(d.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class k{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class _{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&p("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);const n=e.token!==this.R;return this.R=e.token,p("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const i=e=>{p("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?i(e):p("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(f("string"==typeof e.token),this.R=e.token,new k(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function T(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const i=T(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%e.length))}return n}}function C(e,t){return e<t?-1:e>t?1:0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class L{constructor(e,t,n){void 0===t?t=0:t>e.length&&m(),void 0===n?n=e.length-t:n>e.length-t&&m(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===L.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof L?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),r=t.get(i);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class A extends L{construct(e,t,n){return new A(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new v(y.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new A(t)}static emptyPath(){return new A([])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class P{constructor(e){this.path=e}static fromPath(e){return new P(A.fromString(e))}static fromName(e){return new P(A.fromString(e).popFirst(5))}static empty(){return new P(A.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===A.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return A.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new P(new A(e.slice()))}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}B.UNKNOWN_ID=-1;function R(e){return"IndexedDbTransactionError"===e.name}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class F{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function M(e){return 0===e&&1/e==-1/0}F.oe=-1;const D=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],O=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],$=O,j=[...$,"indexConfiguration","indexState","indexEntries"];
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class W{constructor(e,t){this.comparator=e,this.root=t||q.EMPTY}insert(e,t){return new W(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,q.BLACK,null,null))}remove(e){return new W(this.comparator,this.root.remove(e,this.comparator).copy(null,null,q.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new H(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new H(this.root,e,this.comparator,!1)}getReverseIterator(){return new H(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new H(this.root,e,this.comparator,!0)}}class H{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class q{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:q.RED,this.left=null!=i?i:q.EMPTY,this.right=null!=r?r:q.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new q(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return q.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return q.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,q.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,q.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw m();if(this.right.isRed())throw m();const e=this.left.check();if(e!==this.right.check())throw m();return e+(this.isRed()?0:1)}}q.EMPTY=null,q.RED=!0,q.BLACK=!1,q.EMPTY=new class{constructor(){this.size=0}get key(){throw m()}get value(){throw m()}get color(){throw m()}get left(){throw m()}get right(){throw m()}copy(e,t,n,i,r){return this}insert(e,t,n){return new q(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class U{constructor(e){this.comparator=e,this.data=new W(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new z(this.data.getIterator())}getIteratorFrom(e){return new z(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof U))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new U(this.comparator);return t.data=e,t}}class z{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class V extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Y{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new V("Invalid base64 string: "+e):e}}(e);return new Y(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Y(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return C(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Y.EMPTY_BYTE_STRING=new Y("");const G=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function J(e){if(f(!!e),"string"==typeof e){let t=0;const n=G.exec(e);if(f(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:X(e.seconds),nanos:X(e.nanos)}}function X(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function K(e){return"string"==typeof e?Y.fromBase64String(e):Y.fromUint8Array(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Z{constructor(e,t,n,i,r,a,l,o,s){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=o,this.useFetchStreams=s}}class Q{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Q("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Q&&e.projectId===this.projectId&&e.database===this.database}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function te(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
new W(P.comparator);new W(P.comparator);new W(P.comparator),new U(P.comparator);new U(C);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ne,ie;(ie=ne||(ne={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
new o.a([4294967295,4294967295],0);Error;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class re{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(X(e.integerValue));else if("doubleValue"in e){const n=X(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),M(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=J(n)),t.Rt(""+(n.seconds||"")),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(K(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?te(e)?this.dt(t,Number.MAX_SAFE_INTEGER):ee(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):m()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const e of Object.keys(n))this.Vt(e,t),this.Tt(n[e],t)}wt(e,t){var n,i;const r=e.fields||{};this.dt(t,53);const a="value",l=(null===(i=null===(n=r[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(X(l)),this.Vt(a,t),this.Tt(r[a],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const e of n)this.Tt(e,t)}yt(e,t){this.dt(t,37),P.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}re.vt=new re;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
new Uint8Array(0);class ae{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ae(e,ae.DEFAULT_COLLECTION_PERCENTILE,ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ae.DEFAULT_COLLECTION_PERCENTILE=10,ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ae.DEFAULT=new ae(41943040,ae.DEFAULT_COLLECTION_PERCENTILE,ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ae.DISABLED=new ae(-1,0,0);function le(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class oe{constructor(e,t,n=1e3,i=1.5,r=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=r,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&p("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class se{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new b,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){const a=Date.now()+n,l=new se(e,t,a,i,r);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new v(y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function de(e,t){if(h("AsyncQueue",`${t}: ${e}`),R(e))return new v(y.UNAVAILABLE,`${t}: ${e}`);throw e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ce,ue;(ue=ce||(ce={})).ea="default",ue.Cache="cache";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class pe{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=d.UNAUTHENTICATED,this.clientId=N.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{p("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(p("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(y.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new b;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=de(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function he(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}const ge=new Map;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class me{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new v(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new v(y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new v(y.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=he(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new v(y.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new v(y.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new v(y.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class fe{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new me({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new v(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new v(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new me(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new E;switch(e.type){case"firstParty":return new I(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new v(y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ge.get(e);t&&(p("ComponentProvider","Removing Datastore"),ge.delete(e),t.terminate())}(this),Promise.resolve()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ye{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new oe(this,"async_queue_retry"),this.Eu=()=>{const e=le();e&&p("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()};const e=le();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=le();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new b;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}async Ru(){if(0!==this.uu.length){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!R(e))throw e;p("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(e=>{this.hu=e,this.Pu=!1;throw h("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)),e}).then(e=>(this.Pu=!1,e))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const i=se.createAndSchedule(this,e,t,n,e=>this.Vu(e));return this.lu.push(i),i}du(){this.hu&&m()}verifyOperationInProgress(){}async mu(){let e;do{e=this.au,await e}while(e!==this.au)}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}class ve extends fe{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new ye,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||be(this),this._firestoreClient.terminate()}}function be(e){var t,n,i;const r=e._freezeSettings(),a=function(e,t,n,i){return new Z(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,he(i.experimentalLongPollingOptions),i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._firestoreClient=new pe(e._authCredentials,e._appCheckCredentials,e._queue,a),(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}new RegExp("[~\\*/\\[\\]]");new WeakMap;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(e,t=!0){!function(e){c=e}(i.a),Object(i.c)(new r.a("firestore",(e,{instanceIdentifier:n,options:i})=>{const r=e.getProvider("app").getImmediate(),a=new ve(new S(e.getProvider("auth-internal")),new _(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new v(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Q(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Object(i.g)(s,"4.7.0",e),Object(i.g)(s,"4.7.0","esm2017")}()}).call(this,n(22),n(23).Buffer)},function(e,t){var n,i,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:l}catch(e){i=l}}();var s,d=[],c=!1,u=-1;function p(){c&&s&&(c=!1,s.length?d=s.concat(d):u=-1,d.length&&h())}function h(){if(!c){var e=o(p);c=!0;for(var t=d.length;t;){for(s=d,d=[];++u<t;)s&&s[u].run();u=-1,t=d.length}s=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===l||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new g(e,t)),1!==d.length||c||o(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var i=n(45),r=n(46),a=n(47);function l(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(l()<t)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=s.prototype:(null===e&&(e=new s(t)),e.length=t),e}function s(e,t,n){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return d(this,e,t,n)}function d(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);s.TYPED_ARRAY_SUPPORT?(e=t).__proto__=s.prototype:e=p(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|g(t,n),r=(e=o(e,i)).write(t,n);r!==i&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(s.isBuffer(t)){var n=0|h(t.length);return 0===(e=o(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?o(e,0):p(e,t);if("Buffer"===t.type&&a(t.data))return p(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(c(t),e=o(e,t<0?0:0|h(t)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|h(t.length);e=o(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function h(e){if(e>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|e}function g(e,t){if(s.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(i)return j(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return N(this,t,n);case"base64":return k(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function f(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function y(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=s.from(t,i)),s.isBuffer(t))return 0===t.length?-1:v(e,t,n,i,r);if("number"==typeof t)return t&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,i,r){var a,l=1,o=e.length,s=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;l=2,o/=2,s/=2,n/=2}function d(e,t){return 1===l?e[t]:e.readUInt16BE(t*l)}if(r){var c=-1;for(a=n;a<o;a++)if(d(e,a)===d(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===s)return c*l}else-1!==c&&(a-=a-c),c=-1}else for(n+s>o&&(n=o-s),a=n;a>=0;a--){for(var u=!0,p=0;p<s;p++)if(d(e,a+p)!==d(t,p)){u=!1;break}if(u)return a}return-1}function b(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var l=0;l<i;++l){var o=parseInt(t.substr(2*l,2),16);if(isNaN(o))return l;e[n+l]=o}return l}function w(e,t,n,i){return H(j(t,e.length-n),e,n,i)}function E(e,t,n,i){return H(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function S(e,t,n,i){return E(e,t,n,i)}function x(e,t,n,i){return H(W(t),e,n,i)}function I(e,t,n,i){return H(function(e,t){for(var n,i,r,a=[],l=0;l<e.length&&!((t-=2)<0);++l)n=e.charCodeAt(l),i=n>>8,r=n%256,a.push(r),a.push(i);return a}(t,e.length-n),e,n,i)}function k(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function _(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var a,l,o,s,d=e[r],c=null,u=d>239?4:d>223?3:d>191?2:1;if(r+u<=n)switch(u){case 1:d<128&&(c=d);break;case 2:128==(192&(a=e[r+1]))&&(s=(31&d)<<6|63&a)>127&&(c=s);break;case 3:a=e[r+1],l=e[r+2],128==(192&a)&&128==(192&l)&&(s=(15&d)<<12|(63&a)<<6|63&l)>2047&&(s<55296||s>57343)&&(c=s);break;case 4:a=e[r+1],l=e[r+2],o=e[r+3],128==(192&a)&&128==(192&l)&&128==(192&o)&&(s=(15&d)<<18|(63&a)<<12|(63&l)<<6|63&o)>65535&&s<1114112&&(c=s)}null===c?(c=65533,u=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=u}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return n}(i)}t.Buffer=s,t.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},t.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=l(),s.poolSize=8192,s._augment=function(e){return e.__proto__=s.prototype,e},s.from=function(e,t,n){return d(null,e,t,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(e,t,n){return function(e,t,n,i){return c(t),t<=0?o(e,t):void 0!==n?"string"==typeof i?o(e,t).fill(n,i):o(e,t).fill(n):o(e,t)}(null,e,t,n)},s.allocUnsafe=function(e){return u(null,e)},s.allocUnsafeSlow=function(e){return u(null,e)},s.isBuffer=function(e){return!(null==e||!e._isBuffer)},s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,a=Math.min(n,i);r<a;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=s.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var l=e[n];if(!s.isBuffer(l))throw new TypeError('"list" argument must be an Array of Buffers');l.copy(i,r),r+=l.length}return i},s.byteLength=g,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},s.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?_(this,0,e):m.apply(this,arguments)},s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,t,n,i,r){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(r>>>=0)-(i>>>=0),l=(n>>>=0)-(t>>>=0),o=Math.min(a,l),d=this.slice(i,r),c=e.slice(t,n),u=0;u<o;++u)if(d[u]!==c[u]){a=d[u],l=c[u];break}return a<l?-1:l<a?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},s.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function T(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function N(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function C(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",a=t;a<n;++a)r+=$(e[a]);return r}function L(e,t,n){for(var i=e.slice(t,n),r="",a=0;a<i.length;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}function A(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,i,r,a){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<a)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function B(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,a=Math.min(e.length-n,2);r<a;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function R(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,a=Math.min(e.length-n,4);r<a;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function F(e,t,n,i,r,a){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,i,a){return a||F(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function D(e,t,n,i,a){return a||F(e,0,n,8),r.write(e,t,n,i,52,8),n+8}s.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),s.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=s.prototype;else{var r=t-e;n=new s(r,void 0);for(var a=0;a<r;++a)n[a]=this[a+e]}return n},s.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i},s.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},s.prototype.readUInt8=function(e,t){return t||A(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return t||A(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return t||A(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},s.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var i=t,r=1,a=this[e+--i];i>0&&(r*=256);)a+=this[e+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},s.prototype.readInt8=function(e,t){return t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){t||A(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){t||A(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return t||A(e,4,this.length),r.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return t||A(e,4,this.length),r.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return t||A(e,8,this.length),r.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return t||A(e,8,this.length),r.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,a=0;for(this[t]=255&e;++a<n&&(r*=256);)this[t+a]=e/r&255;return t+n},s.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,a=1;for(this[t+r]=255&e;--r>=0&&(a*=256);)this[t+r]=e/a&255;return t+n},s.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,255,0),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):R(this,e,t,!0),t+4},s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):R(this,e,t,!1),t+4},s.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var a=0,l=1,o=0;for(this[t]=255&e;++a<n&&(l*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/l>>0)-o&255;return t+n},s.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}var a=n-1,l=1,o=0;for(this[t+a]=255&e;--a>=0&&(l*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/l>>0)-o&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,127,-128),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):R(this,e,t,!0),t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):R(this,e,t,!1),t+4},s.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,a=i-n;if(this===e&&n<t&&t<i)for(r=a-1;r>=0;--r)e[r+t]=this[r+n];else if(a<1e3||!s.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},s.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!s.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var l=s.isBuffer(e)?e:j(new s(e,i).toString()),o=l.length;for(a=0;a<n-t;++a)this[a+t]=l[a%o]}return this};var O=/[^+\/0-9A-Za-z-_]/g;function $(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var n;t=t||1/0;for(var i=e.length,r=null,a=[],l=0;l<i;++l){if((n=e.charCodeAt(l))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(l+1===i){(t-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function W(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(O,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(12))},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";t.byteLength=function(e){var t=d(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,i=d(e),l=i[0],o=i[1],s=new a(function(e,t,n){return 3*(t+n)/4-n}(0,l,o)),c=0,u=o>0?l-4:l;for(n=0;n<u;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=255&t;2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,s[c++]=255&t);1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,s[c++]=t>>8&255,s[c++]=255&t);return s},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,a=[],l=0,o=n-r;l<o;l+=16383)a.push(c(e,l,l+16383>o?o:l+16383));1===r?(t=e[n-1],a.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],a.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return a.join("")};for(var i=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=l.length;o<s;++o)i[o]=l[o],r[l.charCodeAt(o)]=o;function d(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var r,a,l=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),l.push(i[(a=r)>>18&63]+i[a>>12&63]+i[a>>6&63]+i[63&a]);return l.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,i,r){var a,l,o=8*r-i-1,s=(1<<o)-1,d=s>>1,c=-7,u=n?r-1:0,p=n?-1:1,h=e[t+u];for(u+=p,a=h&(1<<-c)-1,h>>=-c,c+=o;c>0;a=256*a+e[t+u],u+=p,c-=8);for(l=a&(1<<-c)-1,a>>=-c,c+=i;c>0;l=256*l+e[t+u],u+=p,c-=8);if(0===a)a=1-d;else{if(a===s)return l?NaN:1/0*(h?-1:1);l+=Math.pow(2,i),a-=d}return(h?-1:1)*l*Math.pow(2,a-i)},t.write=function(e,t,n,i,r,a){var l,o,s,d=8*a-r-1,c=(1<<d)-1,u=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:a-1,g=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,l=c):(l=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-l))<1&&(l--,s*=2),(t+=l+u>=1?p/s:p*Math.pow(2,1-u))*s>=2&&(l++,s/=2),l+u>=c?(o=0,l=c):l+u>=1?(o=(t*s-1)*Math.pow(2,r),l+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,r),l=0));r>=8;e[n+h]=255&o,h+=g,o/=256,r-=8);for(l=l<<r|o,d+=r;d>0;e[n+h]=255&l,h+=g,l/=256,d-=8);e[n+h-g]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"changeWarpColorGridInstance",(function(){return k$})),n.d(t,"changeWeftColorGridInstance",(function(){return _$})),n.d(t,"changeFunctionGridInstance",(function(){return T$})),n.d(t,"changeDensityGridInstance",(function(){return N$})),n.d(t,"changeWarpCreamingGridInstance",(function(){return L$})),n.d(t,"changeSpeedGridInstance",(function(){return C$})),n.d(t,"compressPlanString",(function(){return E$})),n.d(t,"compressSeqPrefixString",(function(){return w$})),n.d(t,"compressSeqString",(function(){return y$})),n.d(t,"densityGridInstance",(function(){return s$})),n.d(t,"speedGridInstance",(function(){return h$})),n.d(t,"dentGridInstance",(function(){return ZO})),n.d(t,"drawFunction",(function(){return m$})),n.d(t,"firstBeamGridInstance",(function(){return p$})),n.d(t,"functionGridInstance",(function(){return l$})),n.d(t,"instanceInitFunction",(function(){return g$})),n.d(t,"loadingAnimationElement",(function(){return OO})),n.d(t,"lSalvageDentGridInstance",(function(){return n$})),n.d(t,"lSalvageMainGridInstance",(function(){return e$})),n.d(t,"lSalVageWeftGridInstance",(function(){return t$})),n.d(t,"mainGridInstance",(function(){return YO})),n.d(t,"reedElement",(function(){return zO})),n.d(t,"rSalvageDentGridInstance",(function(){return a$})),n.d(t,"rSalvageMainGridInstance",(function(){return i$})),n.d(t,"rSalVageWeftGridInstance",(function(){return r$})),n.d(t,"rustPrintObject",(function(){return x$})),n.d(t,"tempWarpGridInstance",(function(){return XO})),n.d(t,"tempWeftGridInstance",(function(){return JO})),n.d(t,"tieupGridInstance",(function(){return QO})),n.d(t,"treadlesElement",(function(){return VO})),n.d(t,"warpColorGridInstance",(function(){return c$})),n.d(t,"warpCreamingGridInstance",(function(){return o$})),n.d(t,"warpGridInstance",(function(){return KO})),n.d(t,"wasm",(function(){return I$})),n.d(t,"weftColorGridInstance",(function(){return d$})),n.d(t,"weftGridInstance",(function(){return GO})),n.d(t,"generateWJLFile",(function(){return v$})),n.d(t,"generateHEBFile",(function(){return b$})),n.d(t,"designFillGridInstance",(function(){return u$})),n.d(t,"setMainGrid",(function(){return S$}));var i={};n.r(i),n.d(i,"hasBrowserEnv",(function(){return lo})),n.d(i,"hasStandardBrowserWebWorkerEnv",(function(){return co})),n.d(i,"hasStandardBrowserEnv",(function(){return oo}));var r={value:()=>{}};function a(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new l(i)}function l(e){this._=e}function o(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function s(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function d(e,t,n){for(var i=0,a=e.length;i<a;++i)if(e[i].name===t){e[i]=r,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}l.prototype=a.prototype={constructor:l,on:function(e,t){var n,i=this._,r=o(e+"",i),a=-1,l=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<l;)if(n=(e=r[a]).type)i[n]=d(i[n],e.name,t);else if(null==t)for(n in i)i[n]=d(i[n],e.name,null);return this}for(;++a<l;)if((n=(e=r[a]).type)&&(n=s(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new l(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(i=this._[e]).length;a<n;++a)i[a].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,a=i.length;r<a;++r)i[r].value.apply(t,n)}};var c=a;function u(){}var p=function(e){return null==e?u:function(){return this.querySelector(e)}};function h(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function g(){return[]}var m=function(e){return null==e?g:function(){return this.querySelectorAll(e)}};var f=function(e){return function(){return this.matches(e)}};function y(e){return function(t){return t.matches(e)}}var v=Array.prototype.find;function b(){return this.firstElementChild}var w=Array.prototype.filter;function E(){return Array.from(this.children)}var S=function(e){return new Array(e.length)};function x(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}x.prototype={constructor:x,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var I=function(e){return function(){return e}};function k(e,t,n,i,r,a){for(var l,o=0,s=t.length,d=a.length;o<d;++o)(l=t[o])?(l.__data__=a[o],i[o]=l):n[o]=new x(e,a[o]);for(;o<s;++o)(l=t[o])&&(r[o]=l)}function _(e,t,n,i,r,a,l){var o,s,d,c=new Map,u=t.length,p=a.length,h=new Array(u);for(o=0;o<u;++o)(s=t[o])&&(h[o]=d=l.call(s,s.__data__,o,t)+"",c.has(d)?r[o]=s:c.set(d,s));for(o=0;o<p;++o)d=l.call(e,a[o],o,a)+"",(s=c.get(d))?(i[o]=s,s.__data__=a[o],c.delete(d)):n[o]=new x(e,a[o]);for(o=0;o<u;++o)(s=t[o])&&c.get(h[o])===s&&(r[o]=s)}function T(e){return e.__data__}function N(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function C(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var L="http://www.w3.org/1999/xhtml",A={svg:"http://www.w3.org/2000/svg",xhtml:L,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},P=function(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),A.hasOwnProperty(t)?{space:A[t],local:e}:e};function B(e){return function(){this.removeAttribute(e)}}function R(e){return function(){this.removeAttributeNS(e.space,e.local)}}function F(e,t){return function(){this.setAttribute(e,t)}}function M(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function D(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function O(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}var j=function(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView};function W(e){return function(){this.style.removeProperty(e)}}function H(e,t,n){return function(){this.style.setProperty(e,t,n)}}function q(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function U(e,t){return e.style.getPropertyValue(t)||j(e).getComputedStyle(e,null).getPropertyValue(t)}function z(e){return function(){delete this[e]}}function V(e,t){return function(){this[e]=t}}function Y(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function G(e){return e.trim().split(/^|\s+/)}function J(e){return e.classList||new X(e)}function X(e){this._node=e,this._names=G(e.getAttribute("class")||"")}function K(e,t){for(var n=J(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function Z(e,t){for(var n=J(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Q(e){return function(){K(this,e)}}function ee(e){return function(){Z(this,e)}}function te(e,t){return function(){(t.apply(this,arguments)?K:Z)(this,e)}}X.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function ne(){this.textContent=""}function ie(e){return function(){this.textContent=e}}function re(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function ae(){this.innerHTML=""}function le(e){return function(){this.innerHTML=e}}function oe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function se(){this.nextSibling&&this.parentNode.appendChild(this)}function de(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ce(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===L&&t.documentElement.namespaceURI===L?t.createElement(e):t.createElementNS(n,e)}}function ue(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}var pe=function(e){var t=P(e);return(t.local?ue:ce)(t)};function he(){return null}function ge(){var e=this.parentNode;e&&e.removeChild(this)}function me(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function fe(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ye(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function ve(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,a=t.length;i<a;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function be(e,t,n){return function(){var i,r=this.__on,a=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var l=0,o=r.length;l<o;++l)if((i=r[l]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),void(i.value=t);this.addEventListener(e.type,a,n),i={type:e.type,name:e.name,value:t,listener:a,options:n},r?r.push(i):this.__on=[i]}}function we(e,t,n){var i=j(e),r=i.CustomEvent;"function"==typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Ee(e,t){return function(){return we(this,e,t)}}function Se(e,t){return function(){return we(this,e,t.apply(this,arguments))}}var xe=[null];function Ie(e,t){this._groups=e,this._parents=t}function ke(){return new Ie([[document.documentElement]],xe)}Ie.prototype=ke.prototype={constructor:Ie,select:function(e){"function"!=typeof e&&(e=p(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var a,l,o=t[r],s=o.length,d=i[r]=new Array(s),c=0;c<s;++c)(a=o[c])&&(l=e.call(a,a.__data__,c,o))&&("__data__"in a&&(l.__data__=a.__data__),d[c]=l);return new Ie(i,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return h(e.apply(this,arguments))}}(e):m(e);for(var t=this._groups,n=t.length,i=[],r=[],a=0;a<n;++a)for(var l,o=t[a],s=o.length,d=0;d<s;++d)(l=o[d])&&(i.push(e.call(l,l.__data__,d,o)),r.push(l));return new Ie(i,r)},selectChild:function(e){return this.select(null==e?b:function(e){return function(){return v.call(this.children,e)}}("function"==typeof e?e:y(e)))},selectChildren:function(e){return this.selectAll(null==e?E:function(e){return function(){return w.call(this.children,e)}}("function"==typeof e?e:y(e)))},filter:function(e){"function"!=typeof e&&(e=f(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var a,l=t[r],o=l.length,s=i[r]=[],d=0;d<o;++d)(a=l[d])&&e.call(a,a.__data__,d,l)&&s.push(a);return new Ie(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,T);var n=t?_:k,i=this._parents,r=this._groups;"function"!=typeof e&&(e=I(e));for(var a=r.length,l=new Array(a),o=new Array(a),s=new Array(a),d=0;d<a;++d){var c=i[d],u=r[d],p=u.length,h=N(e.call(c,c&&c.__data__,d,i)),g=h.length,m=o[d]=new Array(g),f=l[d]=new Array(g),y=s[d]=new Array(p);n(c,u,m,f,y,h,t);for(var v,b,w=0,E=0;w<g;++w)if(v=m[w]){for(w>=E&&(E=w+1);!(b=f[E])&&++E<g;);v._next=b||null}}return(l=new Ie(l,i))._enter=o,l._exit=s,l},enter:function(){return new Ie(this._enter||this._groups.map(S),this._parents)},exit:function(){return new Ie(this._exit||this._groups.map(S),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,a=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?a.remove():n(a),i&&r?i.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,a=i.length,l=Math.min(r,a),o=new Array(r),s=0;s<l;++s)for(var d,c=n[s],u=i[s],p=c.length,h=o[s]=new Array(p),g=0;g<p;++g)(d=c[g]||u[g])&&(h[g]=d);for(;s<r;++s)o[s]=n[s];return new Ie(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],a=r.length-1,l=r[a];--a>=0;)(i=r[a])&&(l&&4^i.compareDocumentPosition(l)&&l.parentNode.insertBefore(i,l),l=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=C);for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var l,o=n[a],s=o.length,d=r[a]=new Array(s),c=0;c<s;++c)(l=o[c])&&(d[c]=l);d.sort(t)}return new Ie(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,a=i.length;r<a;++r){var l=i[r];if(l)return l}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,a=t[n],l=0,o=a.length;l<o;++l)(r=a[l])&&e.call(r,r.__data__,l,a);return this},attr:function(e,t){var n=P(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?R:B:"function"==typeof t?n.local?O:D:n.local?M:F)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?W:"function"==typeof t?q:H)(e,t,null==n?"":n)):U(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?z:"function"==typeof t?Y:V)(e,t)):this.node()[e]},classed:function(e,t){var n=G(e+"");if(arguments.length<2){for(var i=J(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof t?te:t?Q:ee)(n,t))},text:function(e){return arguments.length?this.each(null==e?ne:("function"==typeof e?re:ie)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?ae:("function"==typeof e?oe:le)(e)):this.node().innerHTML},raise:function(){return this.each(se)},lower:function(){return this.each(de)},append:function(e){var t="function"==typeof e?e:pe(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:pe(e),i=null==t?he:"function"==typeof t?t:p(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(ge)},clone:function(e){return this.select(e?fe:me)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,a=ye(e+""),l=a.length;if(!(arguments.length<2)){for(o=t?be:ve,i=0;i<l;++i)this.each(o(a[i],t,n));return this}var o=this.node().__on;if(o)for(var s,d=0,c=o.length;d<c;++d)for(i=0,s=o[d];i<l;++i)if((r=a[i]).type===s.type&&r.name===s.name)return s.value},dispatch:function(e,t){return this.each(("function"==typeof t?Se:Ee)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,r=e[t],a=0,l=r.length;a<l;++a)(i=r[a])&&(yield i)}};var _e=ke;var Te=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function Ne(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Ce(){}var Le="\\s*([+-]?\\d+)\\s*",Ae="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Be=/^#([0-9a-f]{3,8})$/,Re=new RegExp(`^rgb\\(${Le},${Le},${Le}\\)$`),Fe=new RegExp(`^rgb\\(${Pe},${Pe},${Pe}\\)$`),Me=new RegExp(`^rgba\\(${Le},${Le},${Le},${Ae}\\)$`),De=new RegExp(`^rgba\\(${Pe},${Pe},${Pe},${Ae}\\)$`),Oe=new RegExp(`^hsl\\(${Ae},${Pe},${Pe}\\)$`),$e=new RegExp(`^hsla\\(${Ae},${Pe},${Pe},${Ae}\\)$`),je={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function We(){return this.rgb().formatHex()}function He(){return this.rgb().formatRgb()}function qe(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Be.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Ue(t):3===n?new Ge(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?ze(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?ze(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Re.exec(e))?new Ge(t[1],t[2],t[3],1):(t=Fe.exec(e))?new Ge(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Me.exec(e))?ze(t[1],t[2],t[3],t[4]):(t=De.exec(e))?ze(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Oe.exec(e))?et(t[1],t[2]/100,t[3]/100,1):(t=$e.exec(e))?et(t[1],t[2]/100,t[3]/100,t[4]):je.hasOwnProperty(e)?Ue(je[e]):"transparent"===e?new Ge(NaN,NaN,NaN,0):null}function Ue(e){return new Ge(e>>16&255,e>>8&255,255&e,1)}function ze(e,t,n,i){return i<=0&&(e=t=n=NaN),new Ge(e,t,n,i)}function Ve(e){return e instanceof Ce||(e=qe(e)),e?new Ge((e=e.rgb()).r,e.g,e.b,e.opacity):new Ge}function Ye(e,t,n,i){return 1===arguments.length?Ve(e):new Ge(e,t,n,null==i?1:i)}function Ge(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function Je(){return`#${Qe(this.r)}${Qe(this.g)}${Qe(this.b)}`}function Xe(){const e=Ke(this.opacity);return`${1===e?"rgb(":"rgba("}${Ze(this.r)}, ${Ze(this.g)}, ${Ze(this.b)}${1===e?")":`, ${e})`}`}function Ke(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ze(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Qe(e){return((e=Ze(e))<16?"0":"")+e.toString(16)}function et(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new nt(e,t,n,i)}function tt(e){if(e instanceof nt)return new nt(e.h,e.s,e.l,e.opacity);if(e instanceof Ce||(e=qe(e)),!e)return new nt;if(e instanceof nt)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),a=Math.max(t,n,i),l=NaN,o=a-r,s=(a+r)/2;return o?(l=t===a?(n-i)/o+6*(n<i):n===a?(i-t)/o+2:(t-n)/o+4,o/=s<.5?a+r:2-a-r,l*=60):o=s>0&&s<1?0:l,new nt(l,o,s,e.opacity)}function nt(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function it(e){return(e=(e||0)%360)<0?e+360:e}function rt(e){return Math.max(0,Math.min(1,e||0))}function at(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function lt(e,t,n,i,r){var a=e*e,l=a*e;return((1-3*e+3*a-l)*t+(4-6*a+3*l)*n+(1+3*e+3*a-3*l)*i+l*r)/6}Te(Ce,qe,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:We,formatHex:We,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return tt(this).formatHsl()},formatRgb:He,toString:He}),Te(Ge,Ye,Ne(Ce,{brighter(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Ge(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new Ge(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ge(Ze(this.r),Ze(this.g),Ze(this.b),Ke(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Je,formatHex:Je,formatHex8:function(){return`#${Qe(this.r)}${Qe(this.g)}${Qe(this.b)}${Qe(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Xe,toString:Xe})),Te(nt,(function(e,t,n,i){return 1===arguments.length?tt(e):new nt(e,t,n,null==i?1:i)}),Ne(Ce,{brighter(e){return e=null==e?1/.7:Math.pow(1/.7,e),new nt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new nt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Ge(at(e>=240?e-240:e+120,r,i),at(e,r,i),at(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new nt(it(this.h),rt(this.s),rt(this.l),Ke(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Ke(this.opacity);return`${1===e?"hsl(":"hsla("}${it(this.h)}, ${100*rt(this.s)}%, ${100*rt(this.l)}%${1===e?")":`, ${e})`}`}}));var ot=e=>()=>e;function st(e,t){return function(n){return e+n*t}}function dt(e){return 1==(e=+e)?ct:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):ot(isNaN(t)?n:t)}}function ct(e,t){var n=t-e;return n?st(e,n):ot(isNaN(e)?t:e)}var ut=function e(t){var n=dt(t);function i(e,t){var i=n((e=Ye(e)).r,(t=Ye(t)).r),r=n(e.g,t.g),a=n(e.b,t.b),l=ct(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=a(t),e.opacity=l(t),e+""}}return i.gamma=e,i}(1);function pt(e){return function(t){var n,i,r=t.length,a=new Array(r),l=new Array(r),o=new Array(r);for(n=0;n<r;++n)i=Ye(t[n]),a[n]=i.r||0,l[n]=i.g||0,o[n]=i.b||0;return a=e(a),l=e(l),o=e(o),i.opacity=1,function(e){return i.r=a(e),i.g=l(e),i.b=o(e),i+""}}}pt((function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],a=e[i+1],l=i>0?e[i-1]:2*r-a,o=i<t-1?e[i+2]:2*a-r;return lt((n-i/t)*t,l,r,a,o)}})),pt((function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],a=e[i%t],l=e[(i+1)%t],o=e[(i+2)%t];return lt((n-i/t)*t,r,a,l,o)}}));var ht=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},gt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mt=new RegExp(gt.source,"g");var ft,yt,vt=function(e,t){var n,i,r,a=gt.lastIndex=mt.lastIndex=0,l=-1,o=[],s=[];for(e+="",t+="";(n=gt.exec(e))&&(i=mt.exec(t));)(r=i.index)>a&&(r=t.slice(a,r),o[l]?o[l]+=r:o[++l]=r),(n=n[0])===(i=i[0])?o[l]?o[l]+=i:o[++l]=i:(o[++l]=null,s.push({i:l,x:ht(n,i)})),a=mt.lastIndex;return a<t.length&&(r=t.slice(a),o[l]?o[l]+=r:o[++l]=r),o.length<2?s[0]?function(e){return function(t){return e(t)+""}}(s[0].x):function(e){return function(){return e}}(t):(t=s.length,function(e){for(var n,i=0;i<t;++i)o[(n=s[i]).i]=n.x(e);return o.join("")})},bt=0,wt=0,Et=0,St=0,xt=0,It=0,kt="object"==typeof performance&&performance.now?performance:Date,_t="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Tt(){return xt||(_t(Nt),xt=kt.now()+It)}function Nt(){xt=0}function Ct(){this._call=this._time=this._next=null}function Lt(e,t,n){var i=new Ct;return i.restart(e,t,n),i}function At(){xt=(St=kt.now())+It,bt=wt=0;try{!function(){Tt(),++bt;for(var e,t=ft;t;)(e=xt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--bt}()}finally{bt=0,function(){var e,t,n=ft,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:ft=t);yt=e,Bt(i)}(),xt=0}}function Pt(){var e=kt.now(),t=e-St;t>1e3&&(It-=t,St=e)}function Bt(e){bt||(wt&&(wt=clearTimeout(wt)),e-xt>24?(e<1/0&&(wt=setTimeout(At,e-kt.now()-It)),Et&&(Et=clearInterval(Et))):(Et||(St=kt.now(),Et=setInterval(Pt,1e3)),bt=1,_t(At)))}Ct.prototype=Lt.prototype={constructor:Ct,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Tt():+n)+(null==t?0:+t),this._next||yt===this||(yt?yt._next=this:ft=this,yt=this),this._call=e,this._time=n,Bt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Bt())}};var Rt=function(e,t,n){var i=new Ct;return t=null==t?0:+t,i.restart(n=>{i.stop(),e(n+t)},t,n),i},Ft=c("start","end","cancel","interrupt"),Mt=[],Dt=function(e,t,n,i,r,a){var l=e.__transition;if(l){if(n in l)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function a(s){var d,c,u,p;if(1!==n.state)return o();for(d in r)if((p=r[d]).name===n.name){if(3===p.state)return Rt(a);4===p.state?(p.state=6,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[d]):+d<t&&(p.state=6,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[d])}if(Rt((function(){3===n.state&&(n.state=4,n.timer.restart(l,n.delay,n.time),l(s))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(u=n.tween.length),d=0,c=-1;d<u;++d)(p=n.tween[d].value.call(e,e.__data__,n.index,n.group))&&(i[++c]=p);i.length=c+1}}function l(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(o),n.state=5,1),a=-1,l=i.length;++a<l;)i[a].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),o())}function o(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=Lt((function(e){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)}),0,n.time)}(e,n,{name:t,index:i,group:r,on:Ft,tween:Mt,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})};function Ot(e,t){var n=jt(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function $t(e,t){var n=jt(e,t);if(n.state>3)throw new Error("too late; already running");return n}function jt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}var Wt,Ht=function(e,t){var n,i,r,a=e.__transition,l=!0;if(a){for(r in t=null==t?null:t+"",a)(n=a[r]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete a[r]):l=!1;l&&delete e.__transition}},qt=180/Math.PI,Ut={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},zt=function(e,t,n,i,r,a){var l,o,s;return(l=Math.sqrt(e*e+t*t))&&(e/=l,t/=l),(s=e*n+t*i)&&(n-=e*s,i-=t*s),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,s/=o),e*i<t*n&&(e=-e,t=-t,s=-s,l=-l),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*qt,skewX:Math.atan(s)*qt,scaleX:l,scaleY:o}};function Vt(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(a,l){var o=[],s=[];return a=e(a),l=e(l),function(e,i,r,a,l,o){if(e!==r||i!==a){var s=l.push("translate(",null,t,null,n);o.push({i:s-4,x:ht(e,r)},{i:s-2,x:ht(i,a)})}else(r||a)&&l.push("translate("+r+t+a+n)}(a.translateX,a.translateY,l.translateX,l.translateY,o,s),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(r(n)+"rotate(",null,i)-2,x:ht(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(a.rotate,l.rotate,o,s),function(e,t,n,a){e!==t?a.push({i:n.push(r(n)+"skewX(",null,i)-2,x:ht(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(a.skewX,l.skewX,o,s),function(e,t,n,i,a,l){if(e!==n||t!==i){var o=a.push(r(a)+"scale(",null,",",null,")");l.push({i:o-4,x:ht(e,n)},{i:o-2,x:ht(t,i)})}else 1===n&&1===i||a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,l.scaleX,l.scaleY,o,s),a=l=null,function(e){for(var t,n=-1,i=s.length;++n<i;)o[(t=s[n]).i]=t.x(e);return o.join("")}}}var Yt=Vt((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Ut:zt(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),Gt=Vt((function(e){return null==e?Ut:(Wt||(Wt=document.createElementNS("http://www.w3.org/2000/svg","g")),Wt.setAttribute("transform",e),(e=Wt.transform.baseVal.consolidate())?(e=e.matrix,zt(e.a,e.b,e.c,e.d,e.e,e.f)):Ut)}),", ",")",")");function Jt(e,t){var n,i;return function(){var r=$t(this,e),a=r.tween;if(a!==n)for(var l=0,o=(i=n=a).length;l<o;++l)if(i[l].name===t){(i=i.slice()).splice(l,1);break}r.tween=i}}function Xt(e,t,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var a=$t(this,e),l=a.tween;if(l!==i){r=(i=l).slice();for(var o={name:t,value:n},s=0,d=r.length;s<d;++s)if(r[s].name===t){r[s]=o;break}s===d&&r.push(o)}a.tween=r}}function Kt(e,t,n){var i=e._id;return e.each((function(){var e=$t(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return jt(e,i).value[t]}}var Zt=function(e,t){var n;return("number"==typeof t?ht:t instanceof qe?ut:(n=qe(t))?(t=n,ut):vt)(e,t)};function Qt(e){return function(){this.removeAttribute(e)}}function en(e){return function(){this.removeAttributeNS(e.space,e.local)}}function tn(e,t,n){var i,r,a=n+"";return function(){var l=this.getAttribute(e);return l===a?null:l===i?r:r=t(i=l,n)}}function nn(e,t,n){var i,r,a=n+"";return function(){var l=this.getAttributeNS(e.space,e.local);return l===a?null:l===i?r:r=t(i=l,n)}}function rn(e,t,n){var i,r,a;return function(){var l,o,s=n(this);if(null!=s)return(l=this.getAttribute(e))===(o=s+"")?null:l===i&&o===r?a:(r=o,a=t(i=l,s));this.removeAttribute(e)}}function an(e,t,n){var i,r,a;return function(){var l,o,s=n(this);if(null!=s)return(l=this.getAttributeNS(e.space,e.local))===(o=s+"")?null:l===i&&o===r?a:(r=o,a=t(i=l,s));this.removeAttributeNS(e.space,e.local)}}function ln(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function on(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function sn(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&on(e,r)),n}return r._value=t,r}function dn(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&ln(e,r)),n}return r._value=t,r}function cn(e,t){return function(){Ot(this,e).delay=+t.apply(this,arguments)}}function un(e,t){return t=+t,function(){Ot(this,e).delay=t}}function pn(e,t){return function(){$t(this,e).duration=+t.apply(this,arguments)}}function hn(e,t){return t=+t,function(){$t(this,e).duration=t}}function gn(e,t){if("function"!=typeof t)throw new Error;return function(){$t(this,e).ease=t}}function mn(e,t,n){var i,r,a=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?Ot:$t;return function(){var l=a(this,e),o=l.on;o!==i&&(r=(i=o).copy()).on(t,n),l.on=r}}var fn=_e.prototype.constructor;function yn(e){return function(){this.style.removeProperty(e)}}function vn(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function bn(e,t,n){var i,r;function a(){var a=t.apply(this,arguments);return a!==r&&(i=(r=a)&&vn(e,a,n)),i}return a._value=t,a}function wn(e){return function(t){this.textContent=e.call(this,t)}}function En(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&wn(i)),t}return i._value=e,i}var Sn=0;function xn(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function In(){return++Sn}var kn=_e.prototype;xn.prototype=function(e){return _e().transition(e)}.prototype={constructor:xn,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=p(e));for(var i=this._groups,r=i.length,a=new Array(r),l=0;l<r;++l)for(var o,s,d=i[l],c=d.length,u=a[l]=new Array(c),h=0;h<c;++h)(o=d[h])&&(s=e.call(o,o.__data__,h,d))&&("__data__"in o&&(s.__data__=o.__data__),u[h]=s,Dt(u[h],t,n,h,u,jt(o,n)));return new xn(a,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=m(e));for(var i=this._groups,r=i.length,a=[],l=[],o=0;o<r;++o)for(var s,d=i[o],c=d.length,u=0;u<c;++u)if(s=d[u]){for(var p,h=e.call(s,s.__data__,u,d),g=jt(s,n),f=0,y=h.length;f<y;++f)(p=h[f])&&Dt(p,t,n,f,h,g);a.push(h),l.push(s)}return new xn(a,l,t,n)},selectChild:kn.selectChild,selectChildren:kn.selectChildren,filter:function(e){"function"!=typeof e&&(e=f(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var a,l=t[r],o=l.length,s=i[r]=[],d=0;d<o;++d)(a=l[d])&&e.call(a,a.__data__,d,l)&&s.push(a);return new xn(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,a=Math.min(i,r),l=new Array(i),o=0;o<a;++o)for(var s,d=t[o],c=n[o],u=d.length,p=l[o]=new Array(u),h=0;h<u;++h)(s=d[h]||c[h])&&(p[h]=s);for(;o<i;++o)l[o]=t[o];return new xn(l,this._parents,this._name,this._id)},selection:function(){return new fn(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=In(),i=this._groups,r=i.length,a=0;a<r;++a)for(var l,o=i[a],s=o.length,d=0;d<s;++d)if(l=o[d]){var c=jt(l,t);Dt(l,e,n,d,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new xn(i,this._parents,e,n)},call:kn.call,nodes:kn.nodes,node:kn.node,size:kn.size,empty:kn.empty,each:kn.each,on:function(e,t){var n=this._id;return arguments.length<2?jt(this.node(),n).on.on(e):this.each(mn(n,e,t))},attr:function(e,t){var n=P(e),i="transform"===n?Gt:Zt;return this.attrTween(e,"function"==typeof t?(n.local?an:rn)(n,i,Kt(this,"attr."+e,t)):null==t?(n.local?en:Qt)(n):(n.local?nn:tn)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var i=P(e);return this.tween(n,(i.local?sn:dn)(i,t))},style:function(e,t,n){var i="transform"==(e+="")?Yt:Zt;return null==t?this.styleTween(e,function(e,t){var n,i,r;return function(){var a=U(this,e),l=(this.style.removeProperty(e),U(this,e));return a===l?null:a===n&&l===i?r:r=t(n=a,i=l)}}(e,i)).on("end.style."+e,yn(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var i,r,a;return function(){var l=U(this,e),o=n(this),s=o+"";return null==o&&(this.style.removeProperty(e),s=o=U(this,e)),l===s?null:l===i&&s===r?a:(r=s,a=t(i=l,o))}}(e,i,Kt(this,"style."+e,t))).each(function(e,t){var n,i,r,a,l="style."+t,o="end."+l;return function(){var s=$t(this,e),d=s.on,c=null==s.value[l]?a||(a=yn(t)):void 0;d===n&&r===c||(i=(n=d).copy()).on(o,r=c),s.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,r,a=n+"";return function(){var l=U(this,e);return l===a?null:l===i?r:r=t(i=l,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,bn(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(Kt(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,En(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=jt(this.node(),n).tween,a=0,l=r.length;a<l;++a)if((i=r[a]).name===e)return i.value;return null}return this.each((null==t?Jt:Xt)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?cn:un)(t,e)):jt(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?pn:hn)(t,e)):jt(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(gn(t,e)):jt(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;$t(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise((function(a,l){var o={value:l},s={value:function(){0==--r&&a()}};n.each((function(){var n=$t(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(o),t._.interrupt.push(o),t._.end.push(s)),n.on=t})),0===r&&a()}))},[Symbol.iterator]:kn[Symbol.iterator]};var _n={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Tn(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}_e.prototype.interrupt=function(e){return this.each((function(){Ht(this,e)}))},_e.prototype.transition=function(e){var t,n;e instanceof xn?(t=e._id,e=e._name):(t=In(),(n=_n).time=Tt(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var l,o=i[a],s=o.length,d=0;d<s;++d)(l=o[d])&&Dt(l,e,t,d,o,n||Tn(l,t));return new xn(i,this._parents,e,t)};const{abs:Nn,max:Cn,min:Ln}=Math;function An(e){return[+e[0],+e[1]]}function Pn(e){return[An(e[0]),An(e[1])]}["w","e"].map(Bn),["n","s"].map(Bn),["n","w","e","s","nw","ne","sw","se"].map(Bn);function Bn(e){return{type:e}}function Rn(e){return((e=Math.exp(e))+1/e)/2}(function e(t,n,i){function r(e,r){var a,l,o=e[0],s=e[1],d=e[2],c=r[0],u=r[1],p=r[2],h=c-o,g=u-s,m=h*h+g*g;if(m<1e-12)l=Math.log(p/d)/t,a=function(e){return[o+e*h,s+e*g,d*Math.exp(t*e*l)]};else{var f=Math.sqrt(m),y=(p*p-d*d+i*m)/(2*d*n*f),v=(p*p-d*d-i*m)/(2*p*n*f),b=Math.log(Math.sqrt(y*y+1)-y),w=Math.log(Math.sqrt(v*v+1)-v);l=(w-b)/t,a=function(e){var i,r=e*l,a=Rn(b),c=d/(n*f)*(a*(i=t*r+b,((i=Math.exp(2*i))-1)/(i+1))-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[o+c*h,s+c*g,d*a/Rn(t*r+b)]}}return a.duration=1e3*l*t/Math.SQRT2,a}return r.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},r})(Math.SQRT2,2,4);function Fn(e,t,n){this.k=e,this.x=t,this.y=n}Fn.prototype={constructor:Fn,scale:function(e){return 1===e?this:new Fn(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Fn(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new Fn(1,0,0);Fn.prototype;let Mn=!1;const Dn=0,On=0;let $n=4,jn=4;const Wn="DRAWING";let Hn={pixelSize:10,startRow:1,endRow:20,startColumn:0,endColumn:19};let qn=Wn,Un="",zn=10,Vn=3,Yn="radio-weave",Gn=!1,Jn=!1,Xn=!1,Kn=!0,Zn=!0,Qn=!1,ei=!0,ti=!0,ni=!0,ii=!0,ri=!0,ai=!0,li=!1,oi=!0,si="BOTH_VISIBLE",di="INNER_GRID",ci="OUTER_GRID",ui="BOTH_INVISIBLE",pi=null,hi={start:0,end:0},gi={start:0,end:0},mi={start:0,end:0},fi={start:0,end:0};const yi={GRAPHICALYESWITHNUMERICYES:"graphicalYesWithNumericYes",GRAPHICALYESWITHNUMERICNO:"graphicalYesWithNumericNo",GRAPHICALNOWITHNUMERICYES:"graphicalNoWithNumericYes",GRAPHICALNOWITHNUMERICNO:"graphicalNoWithNumericNo",WATERJETLETIS:"waterjetLetis"},vi="draft-pegplan-design-mode",bi="direct-drawing-design-mode",wi="pegplan-design-mode",Ei="draw-on-command-mode",Si="english",xi="hindi",Ii="gujarati",ki="draft-text-design-mode",_i="draft-draw-design-mode",Ti="warp-color-text-design-mode",Ni="warp-color-draw-design-mode",Ci="weft-color-text-design-mode",Li="weft-color-draw-design-mode",Ai="pegplan-text-design-mode",Pi="pegplan-draw-design-mode",Bi="ascending",Ri="descending",Fi="round",Mi="color";let Di=[{loomTypeValue:"none",loomTypeName:"None",noOfHook:0,tableData:{},visibleRow:[]},{loomTypeValue:"pt7",loomTypeName:"Pt-7",elementId:"pt7",noOfHook:0,tableData:{},visibleRow:[]},{loomTypeValue:"rapier-manual-dobby",loomTypeName:"Rapier Manual Dobby",elementId:"rapier-manual-dobby",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"fidder-start":21,"fidder-end":28,"fidder-num":8,"density-start":33,"density-end":40,"density-num":8,"cramming-start":30,"cramming-end":30,"cramming-num":1},visibleRow:["Shaft","Fidder","Cramming","Density"]},{loomTypeValue:".wjl",loomTypeName:"Chines Dobby .wjl",elementId:".wjl",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"fidder-start":21,"fidder-end":28,"fidder-num":8,"cramming-start":30,"cramming-end":30,"cramming-num":1,"density-start":33,"density-end":40,"density-num":8},visibleRow:["Shaft","Fidder","Cramming","Density"]},{loomTypeValue:".heb",elementId:".heb",loomTypeName:"Action Cad .heb",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":24,"shaft-num":24,"fidder-start":33,"fidder-end":40,"fidder-num":8,"cramming-start":25,"cramming-end":25,"cramming-num":1,"density-start":0,"density-end":0,"density-num":0},visibleRow:["Shaft","Cramming","Density","Fidder"]},{loomTypeValue:".dat",elementId:".dat",loomTypeName:"Airjet Dobby .dat",noOfHook:32,tableData:{"shaft-start":1,"shaft-end":16,"shaft-num":16,"fidder-start":17,"fidder-end":24,"fidder-num":8,"density-start":25,"density-end":32,"density-num":8},visibleRow:["Shaft","Fidder","Density"]},{loomTypeValue:"redflag.dat",loomTypeName:"Pifron Airjet .dat",elementId:"redflag.dat",noOfHook:32,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"fidder-start":21,"fidder-end":46,"fidder-num":16,"density-start":47,"density-end":62,"density-num":16},visibleRow:["Shaft","Fidder","Density"]},{loomTypeValue:".bin",loomTypeName:"RIFA .bin",elementId:".bin",noOfHook:32,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"density-start":21,"density-end":23,"density-num":3,"cramming-start":24,"cramming-end":24,"cramming-num":1,"fidder-start":25,"fidder-end":32,"fidder-num":8},visibleRow:["Shaft","Density","Cramming","Fidder"]},{loomTypeValue:"ga731",loomTypeName:"RIFA - GA-731",elementId:"ga731",noOfHook:32,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"density-start":21,"density-end":23,"density-num":3,"cramming-start":24,"cramming-end":24,"cramming-num":1,"fidder-start":25,"fidder-end":32,"fidder-num":8},visibleRow:["Shaft","Density","Cramming","Fidder"]},{loomTypeValue:"ga731II",loomTypeName:"RIFA-GA-731-II",elementId:"ga731II",noOfHook:32,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"density-start":21,"density-end":23,"density-num":3,"cramming-start":24,"cramming-end":24,"cramming-num":1,"fidder-start":25,"fidder-end":32,"fidder-num":8},visibleRow:["Shaft","Density","Cramming","Fidder"]},{loomTypeValue:"spactrum",loomTypeName:"Spactrum",elementId:"spactrum",noOfHook:32,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"fidder-start":21,"fidder-end":28,"fidder-num":8,"density-start":29,"density-end":40,"density-num":12},visibleRow:["Shaft","Fidder","Density"]},{loomTypeValue:"db1-profile",loomTypeName:"Staubli 1859.db1",elementId:"db1-profile",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":28,"shaft-num":28,"fidder-start":1,"fidder-end":8,"fidder-num":8,"cramming-start":9,"cramming-end":9,"cramming-num":1},visibleRow:["Shaft","Fidder","Cramming"]},{loomTypeValue:"bnx-profile",loomTypeName:"Nanjinbana .bnx",elementId:"bnx-profile",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":16,"shaft-num":16,"fidder-start":17,"fidder-end":24,"fidder-num":8,"density-start":25,"density-end":32,"density-num":8},visibleRow:["Shaft","Fidder","Density"]},{loomTypeValue:".htt",loomTypeName:"Niupai .htt",elementId:".htt",noOfHook:32,tableData:{"shaft-start":1,"shaft-end":16,"shaft-num":16,"fidder-start":17,"fidder-end":24,"fidder-num":8,"cramming-start":25,"cramming-end":32,"cramming-num":8},visibleRow:["Shaft","Fidder","Cramming"]},{loomTypeValue:".csv",elementId:".csv",loomTypeName:"Inovamce .csv",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":24,"shaft-num":24,"fidder-start":25,"fidder-end":32,"fidder-num":8,"density-start":33,"density-end":40,"density-num":8},visibleRow:["Shaft","Fidder","Density"]},{loomTypeValue:"xml",elementId:"xml",loomTypeName:"XML",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"fidder-start":21,"fidder-end":28,"fidder-num":8,"cramming-start":30,"cramming-end":30,"cramming-num":1,"density-start":33,"density-end":40,"density-num":8},visibleRow:["Shaft","Fidder","Cramming","Density"]},{loomTypeValue:".rfj",loomTypeName:"Nanjinbana .rfj",elementId:".rfj",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":16,"shaft-num":16,"fidder-start":17,"fidder-end":24,"fidder-num":8,"density-start":25,"density-end":32,"density-num":8},visibleRow:["Shaft","Fidder","Density"]},{loomTypeValue:".txt",loomTypeName:"Txt File",elementId:".txt",noOfHook:40,tableData:{"shaft-start":1,"shaft-end":20,"shaft-num":20,"fidder-start":21,"fidder-end":28,"fidder-num":8,"density-start":29,"density-end":36,"density-num":8},visibleRow:["Shaft","Fidder","Density"]}],Oi=si,$i=!1,ji=!0;let Wi=!1,Hi=!1;let qi=10;const Ui=e=>{$n=e},zi=e=>{jn=e},Vi=e=>{$i=e},Yi=e=>{Un=e},Gi=e=>{Jn=e},Ji=e=>{ai=e},Xi=e=>{oi=e},Ki=e=>{pi=e},Zi=e=>{Zn=e},Qi=e=>{Qn=e},er=e=>{ei=e},tr=()=>{Wi=!Wi},nr=e=>{ti=e},ir="newfile",rr="editfile",ar="",lr="Pegplan",or="Draft",sr="Design",dr="Weft",cr="Warp",ur="Reed",pr="Creaming Bar",hr="Density Bar",gr="Skip Dent",mr="Double Beam",fr="Extra Warp",yr="Speed",vr=["rgb(0,0,0)","rgb(255,128,0)","rgb(255,0,255)","rgb(0,255,255)","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"],br=["rgb(255,0,0)","rgb(0,0,255)","rgb(255,255,0)","rgb(0,255,0)","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"],wr=["rgb(255,255,255)","rgb(255 ,0 ,0)","rgb(0,0,255)","rgb(0,255,0)","rgb(255,0,128)","rgb(255,255,0)","rgb(0,128,255)","rgb(0,128,0)","rgb(255,128,0)","rgb(255,0,255)","rgb(0,255,255)","rgb(192,192,192)","rgb(0,128,128)","rgb(128,0,128)","rgb(0,200,110)","#000000","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"],Er=e=>{ji=e},Sr="Compress",xr="UnCompress",Ir=document.getElementById("l-salvage-weft-canvas"),kr=document.getElementById("l-salvage-main-canvas"),_r=document.getElementById("l-salvage-dent-canvas"),Tr=document.getElementById("left-salvage"),Nr=document.getElementById("Total-Lsalvage"),Cr=Ir.getContext("2d"),Lr=kr.getContext("2d"),Ar=_r.getContext("2d"),Pr=(document.getElementById("l-salvage-weft-subparent"),document.getElementById("l-salvage-dent-container"),document.getElementById("l-salvage-main-subparent"),document.getElementById("l-salvage-dent-click-canvas")),Br=Pr.getContext("2d"),Rr=()=>{Vi(!1)},Fr=e=>{$i&&((e=>{const t=Ir.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=t$.cell_size(),a=parseInt(n/r)+parseInt(i/r)*t$.cols();t$.add_cell(a,e$,KO)})(e),$r())},Mr=e=>{Vi(!0),(e=>{const t=Ir.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=t$.cell_size(),a=parseInt(n/r)+parseInt(i/r)*t$.cols();t$.click_on_cell(a,e$,KO)})(e),$r()},Dr=e=>{e.preventDefault();const t=_r.getBoundingClientRect(),n=n$.cols(),i=(e.clientX-t.left)%(10*n),r=(e.clientY-t.top)%10,a=parseInt(r/10),l=parseInt(i/10)+a*n$.cols();0==e.button?n$.add_click_cell(l,!0):2==e.button&&n$.add_click_cell(l,!1),Hr()},Or=e=>{(e=>{const t=_r.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=n$.cell_size(),a=parseInt(n/r)+parseInt(i/r)*n$.cols();n$.add_cell(a)})(e),Wr()},$r=()=>{const e=t$.cols(),t=t$.rows(),n=t$.cell_size(),i=Dn,r=On,a=document.createElement("canvas");a.width=e*n,a.height=t*n;const l=a.getContext("2d");l.clearRect(0,0,a.width,a.height),Cr.clearRect(0,0,Ir.width,Ir.height),Ir.width=a.width,Ir.height=a.height;for(let a=0;a<e+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.lineWidth=a%$n==0?1.5:.5,l.stroke(),l.closePath();for(let a=0;a<t+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.lineWidth=(t-a)%jn==0?1.5:.5,l.stroke(),l.closePath();const o=new Uint32Array(I$.memory.buffer,t$.cells(),t$.selected_l_salvage_weftgrid_length());if(l.beginPath(),o.forEach(e=>{l.fillRect(e%t$.cols()*n,parseInt(e/t$.cols())*n,n,n)}),l.closePath(),Mn){const e=Cr.createPattern(a,"repeat");Cr.rect(0,0,Ir.width,Ir.height),Cr.fillStyle=e,Cr.fill()}else Cr.drawImage(a,0,0);jr()},jr=()=>{if(Number(Nr.value)>0){const e=e$.cols(),t=e$.rows(),n=1*YO.width(),i=Number(parseFloat(1*YO.height()).toFixed(2)),r=Dn,a=On,l=document.createElement("canvas");l.width=Math.ceil(e*n),l.height=Math.ceil(t*i);const o=l.getContext("2d");o.clearRect(0,0,l.width,l.height),Lr.clearRect(0,0,kr.width,kr.height);for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.lineWidth=l%$n==0?1.5:.5,o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.lineWidth=(t-l)%jn==0?1.5:.5,o.stroke(),o.closePath();const s=new Uint32Array(I$.memory.buffer,e$.cells(),e$.selected_l_salvage_maingrid_length());if(o.beginPath(),s.forEach(e=>{o.fillRect(e%e$.cols()*n,parseInt(e/e$.cols())*i,n,i)}),o.closePath(),Tr.style.width="auto",Mn){kr.width=l.width,kr.height=l.height*Vn;const e=Lr.createPattern(l,"repeat");Lr.rect(0,0,kr.width,kr.height),Lr.fillStyle=e,Lr.fill()}else kr.height=l.height,kr.width=l.width,Lr.drawImage(l,0,0)}},Wr=()=>{const e=n$.cols(),t=n$.rows(),n=n$.cell_size(),i=Dn,r=On,a=document.createElement("canvas");a.width=e*n,a.height=t*n;const l=a.getContext("2d");l.clearRect(0,0,a.width,a.height),Ar.clearRect(0,0,_r.width,_r.height),_r.width=a.width,_r.height=a.height;for(let a=0;a<e+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.stroke(),l.closePath();for(let a=0;a<t+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.stroke(),l.closePath();const o=new Uint32Array(I$.memory.buffer,n$.cells(),n$.selected_l_salvage_dentgrid_length());if(l.beginPath(),o.forEach(t=>{l.fillRect(t%e*n,parseInt(t/e)*n,n,n)}),l.closePath(),Mn){const e=Ar.createPattern(a,"repeat");Ar.rect(0,0,_r.width,_r.height),Ar.fillStyle=e,Ar.fill()}else Ar.drawImage(a,0,0);Hr()},Hr=()=>{const e=new Uint32Array(I$.memory.buffer,n$.click_cells(),n$.click_l_salvage_dentgrid_length()),t=n$.cols(),n=n$.rows(),i=n$.cell_size(),r=Dn,a=On,l=document.createElement("canvas");l.width=t*i,l.height=i;const o=l.getContext("2d");o.clearRect(0,0,l.width,l.height),Br.clearRect(0,0,Pr.width,Pr.height),Pr.width=l.width,Pr.height=l.height;for(let e=0;e<t+1;e++)o.beginPath(),o.strokeStyle="white",o.moveTo(r+e*i,a),o.lineTo(r+e*i,a+n*i),o.stroke(),o.closePath();for(let e=0;e<n+1;e++)o.beginPath(),o.strokeStyle="white",o.moveTo(r,a+e*i),o.lineTo(r+t*i,a+e*i),o.stroke(),o.closePath();if(o.font="10px serif",e.forEach((t,n)=>{t>0&&o.fillText(e[n],(n+1)*i-4,8)}),Mn){const e=Br.createPattern(l,"repeat");Br.rect(0,0,Pr.width,Pr.height),Br.fillStyle=e,Br.fill()}else Br.drawImage(l,0,0)},qr=document.getElementById("r-salvage-weft-canvas"),Ur=document.getElementById("r-salvage-main-canvas"),zr=document.getElementById("right-salvage"),Vr=(document.getElementById("r-salvage-dent-container"),document.getElementById("r-salvage-dent-click-canvas")),Yr=Vr.getContext("2d"),Gr=document.getElementById("r-salvage-dent-canvas"),Jr=document.getElementById("Total-Rsalvage"),Xr=Gr.getContext("2d"),Kr=qr.getContext("2d"),Zr=Ur.getContext("2d"),Qr=(document.getElementById("r-salvage-weft-subparent"),document.getElementById("r-salvage-main-subparent"),e=>{$i&&(ta(e),ia())}),ea=e=>{Vi(!0),na(e),ia()},ta=e=>{const t=qr.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=r$.cell_size(),a=parseInt(n/r)+parseInt(i/r)*r$.cols();r$.add_cell(a,i$,KO)},na=e=>{const t=qr.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=r$.cell_size(),a=parseInt(n/r)+parseInt(i/r)*r$.cols();r$.click_on_cell(a,i$,KO)},ia=()=>{const e=r$.cols(),t=r$.rows(),n=r$.cell_size(),i=Dn,r=On,a=document.createElement("canvas");a.width=e*n,a.height=t*n;const l=a.getContext("2d");l.clearRect(0,0,a.width,a.height),Kr.clearRect(0,0,qr.width,qr.height),qr.width=a.width,qr.height=a.height;for(let a=0;a<e+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.lineWidth=a%$n==0?1.5:.5,l.stroke(),l.closePath();for(let a=0;a<t+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.lineWidth=(t-a)%jn==0?1.5:.5,l.stroke(),l.closePath();const o=new Uint32Array(I$.memory.buffer,r$.cells(),r$.selected_l_salvage_weftgrid_length());if(l.beginPath(),o.forEach(e=>{l.fillRect(e%r$.cols()*n,parseInt(e/r$.cols())*n,n,n)}),l.closePath(),Mn){const e=Kr.createPattern(a,"repeat");Kr.rect(0,0,qr.width,qr.height),Kr.fillStyle=e,Kr.fill()}else Kr.drawImage(a,0,0);ra()},ra=()=>{if(Number(Jr.value)>0){const e=i$.cols(),t=i$.rows(),n=1*YO.width(),i=Number(parseFloat(1*YO.height()).toFixed(2)),r=Dn,a=On,l=document.createElement("canvas");l.width=Math.ceil(e*n),l.height=Math.ceil(t*i);const o=l.getContext("2d");o.clearRect(0,0,l.width,l.height),Zr.clearRect(0,0,Ur.width,Ur.height);for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.lineWidth=l%$n==0?1.5:.5,o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.lineWidth=(t-l)%jn==0?1.5:.5,o.stroke(),o.closePath();const s=new Uint32Array(I$.memory.buffer,i$.cells(),i$.selected_l_salvage_maingrid_length());if(o.beginPath(),s.forEach(e=>{o.fillRect(e%i$.cols()*n,parseInt(e/i$.cols())*i,n,i)}),o.closePath(),zr.style.width="auto",Mn){Ur.width=l.width,Ur.height=l.height*Vn;const e=Zr.createPattern(l,"repeat");Zr.rect(0,0,Ur.width,Ur.height),Zr.fillStyle=e,Zr.fill()}else Ur.height=l.height,Ur.width=l.width,Zr.drawImage(l,0,0)}},aa=()=>{const e=new Uint32Array(I$.memory.buffer,a$.click_cells(),a$.click_l_salvage_dentgrid_length()),t=a$.cols(),n=a$.rows(),i=a$.cell_size(),r=Dn,a=On,l=document.createElement("canvas");l.width=t*i,l.height=i;const o=l.getContext("2d");o.clearRect(0,0,l.width,l.height),Yr.clearRect(0,0,Vr.width,Vr.height),Vr.width=l.width,Vr.height=l.height;for(let e=0;e<t+1;e++)o.beginPath(),o.strokeStyle="white",o.moveTo(r+e*i,a),o.lineTo(r+e*i,a+n*i),o.stroke(),o.closePath();for(let e=0;e<n+1;e++)o.beginPath(),o.strokeStyle="white",o.moveTo(r,a+e*i),o.lineTo(r+t*i,a+e*i),o.stroke(),o.closePath();if(o.font="10px serif",e.forEach((t,n)=>{t>0&&o.fillText(e[n],(n+1)*i-4,8)}),Mn){const e=Yr.createPattern(l,"repeat");Yr.rect(0,0,Vr.width,Vr.height),Yr.fillStyle=e,Yr.fill()}else Yr.drawImage(l,0,0)},la=e=>{e.preventDefault();const t=Gr.getBoundingClientRect(),n=a$.cols(),i=(e.clientX-t.left)%(10*n),r=(e.clientY-t.top)%10,a=parseInt(r/10),l=parseInt(i/10)+a*a$.cols();0==e.button?a$.add_click_cell(l,!0):2==e.button&&a$.add_click_cell(l,!1),aa()},oa=e=>{(e=>{const t=Gr.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=a$.cell_size(),a=parseInt(n/r)+parseInt(i/r)*a$.cols();a$.add_cell(a)})(e),(()=>{const e=a$.cols(),t=a$.rows(),n=a$.cell_size(),i=Dn,r=On,a=document.createElement("canvas");a.width=e*n,a.height=t*n;const l=a.getContext("2d");l.clearRect(0,0,a.width,a.height),Xr.clearRect(0,0,Gr.width,Gr.height),Gr.width=a.width,Gr.height=a.height;for(let a=0;a<e+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.stroke(),l.closePath();for(let a=0;a<t+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.stroke(),l.closePath();const o=new Uint32Array(I$.memory.buffer,a$.cells(),a$.selected_l_salvage_dentgrid_length());if(l.beginPath(),o.forEach(t=>{l.fillRect(t%e*n,parseInt(t/e)*n,n,n)}),l.closePath(),Mn){const e=Xr.createPattern(a,"repeat");Xr.rect(0,0,Gr.width,Gr.height),Xr.fillStyle=e,Xr.fill()}else Xr.drawImage(a,0,0);aa()})()};n(21);const sa=e=>{if(!e.includes("rgb"))return e;const[t,n,i]=e.slice(4,-1).split(","),r=`#${Number(t).toString(16).padStart(2,"0")}${Number(n).toString(16).padStart(2,"0")}${Number(i).toString(16).padStart(2,"0")}`;return console.log("hexcolor us",r.toUpperCase()),r.toUpperCase()};const da=e=>String(e).split("").reverse().join(""),ca=e=>{let t,n,i;return e.match(/^rgb/)?(t=(e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],n=e[2],i=e[3]):(t=(e=+("0x"+e.slice(1).replace(e.length<5&&/./g,"$&$&")))>>16,n=e>>8&255,i=255&e),Math.sqrt(t*t*.299+n*n*.587+i*i*.114)>127.5?"black":"white"};function ua(e,t){let n,i,r;return e.startsWith("#")?[n,i,r]=(e=>e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,n,i)=>"#"+t+t+n+n+i+i).substring(1).match(/.{2}/g).map(e=>parseInt(e,16)))(e):[n,i,r]=e.match(/\d+/g).map(Number),e.startsWith("#")?function(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}(n,i,r):`rgb(${n}, ${i}, ${r})`}function pa(e){const t=e.replace("matrix(","").replace(")","").split(",").map(parseFloat);if(6===t.length){const e=t[0],n=t[3];return console.log("scale x and scale y is",e,n),{scaleX:e,scaleY:n}}return{scaleX:1,scaleY:1}}const ha=0,ga=1,ma=2,fa=3,ya=4,va=5,ba="https://dev.maxweave.com/v1",wa="https://dev.maxweave.com",Ea=e=>{const t=localStorage.getItem("token");let n=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return axios.post(ba+"/user-loom-profile",{userId:n,loomProfileData:e},{headers:{token:t}})},Sa=()=>{const e=localStorage.getItem("token");let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return axios.get(`${ba}/user-loom-profile/${t}`,{headers:{token:e}})};var xa=n(3),Ia=n(4),ka=n(1),_a=n(6),Ta=n(17);const Na={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ca=new ka.b("installations","Installations",Na);function La(e){return e instanceof ka.c&&e.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aa({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Pa(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Ba(e,t){const n=(await t.json()).error;return Ca.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Ra({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Fa(e,{refreshToken:t}){const n=Ra(e);return n.append("Authorization",function(e){return"FIS_v2 "+e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)),n}async function Ma(e){const t=await e();return t.status>=500&&t.status<600?e():t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Da(e){return new Promise(t=>{setTimeout(t,e)})}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Oa=/^[cdef][\w-]{21}$/;function $a(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return function(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e);return Oa.test(t)?t:""}catch(e){return""}}function ja(e){return`${e.appName}!${e.appId}`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa=new Map;function Ha(e,t){const n=ja(e);qa(n,t),function(e,t){const n=za();n&&n.postMessage({key:e,fid:t});Va()}(n,t)}function qa(e,t){const n=Wa.get(e);if(n)for(const e of n)e(t)}let Ua=null;function za(){return!Ua&&"BroadcastChannel"in self&&(Ua=new BroadcastChannel("[Firebase] FID Change"),Ua.onmessage=e=>{qa(e.data.key,e.data.fid)}),Ua}function Va(){0===Wa.size&&Ua&&(Ua.close(),Ua=null)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya="firebase-installations-store";let Ga=null;function Ja(){return Ga||(Ga=Object(Ta.a)("firebase-installations-database",1,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(Ya)}}})),Ga}async function Xa(e,t){const n=ja(e),i=(await Ja()).transaction(Ya,"readwrite"),r=i.objectStore(Ya),a=await r.get(n);return await r.put(t,n),await i.done,a&&a.fid===t.fid||Ha(e,t.fid),t}async function Ka(e){const t=ja(e),n=(await Ja()).transaction(Ya,"readwrite");await n.objectStore(Ya).delete(t),await n.done}async function Za(e,t){const n=ja(e),i=(await Ja()).transaction(Ya,"readwrite"),r=i.objectStore(Ya),a=await r.get(n),l=t(a);return void 0===l?await r.delete(n):await r.put(l,n),await i.done,!l||a&&a.fid===l.fid||Ha(e,l.fid),l}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qa(e){let t;const n=await Za(e.appConfig,n=>{const i=function(e){return nl(e||{fid:$a(),registrationStatus:0})}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){const e=Promise.reject(Ca.create("app-offline"));return{installationEntry:t,registrationPromise:e}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=Aa(e),r=Ra(e),a=t.getImmediate({optional:!0});if(a){const e=await a.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const l={fid:n,authVersion:"FIS_v2",appId:e.appId,sdkVersion:"w:0.6.8"},o={method:"POST",headers:r,body:JSON.stringify(l)},s=await Ma(()=>fetch(i,o));if(s.ok){const e=await s.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:Pa(e.authToken)}}throw await Ba("Create Installation",s)}(e,t);return Xa(e.appConfig,n)}catch(n){throw La(n)&&409===n.customData.serverCode?await Ka(e.appConfig):await Xa(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:el(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function el(e){let t=await tl(e.appConfig);for(;1===t.registrationStatus;)await Da(100),t=await tl(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await Qa(e);return n||t}return t}function tl(e){return Za(e,e=>{if(!e)throw Ca.create("installation-not-found");return nl(e)})}function nl(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}async function il({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${Aa(e)}/${t}/authTokens:generate`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,n),r=Fa(e,n),a=t.getImmediate({optional:!0});if(a){const e=await a.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const l={installation:{sdkVersion:"w:0.6.8",appId:e.appId}},o={method:"POST",headers:r,body:JSON.stringify(l)},s=await Ma(()=>fetch(i,o));if(s.ok){return Pa(await s.json())}throw await Ba("Generate Auth Token",s)}async function rl(e,t=!1){let n;const i=await Za(e.appConfig,i=>{if(!ll(i))throw Ca.create("not-registered");const r=i.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}(r))return i;if(1===r.requestStatus)return n=async function(e,t){let n=await al(e.appConfig);for(;1===n.authToken.requestStatus;)await Da(100),n=await al(e.appConfig);const i=n.authToken;return 0===i.requestStatus?rl(e,t):i}(e,t),i;{if(!navigator.onLine)throw Ca.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await il(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Xa(e.appConfig,i),n}catch(n){if(!La(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Xa(e.appConfig,n)}else await Ka(e.appConfig);throw n}}(e,t),t}});return n?await n:i.authToken}function al(e){return Za(e,e=>{if(!ll(e))throw Ca.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var n;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})}function ll(e){return void 0!==e&&2===e.registrationStatus}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function ol(e,t=!1){const n=e;await async function(e){const{registrationPromise:t}=await Qa(e);t&&await t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n);return(await rl(n,t)).token}function sl(e){return Ca.create("missing-app-config-values",{valueName:e})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dl=e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){if(!e||!e.options)throw sl("App Configuration");if(!e.name)throw sl("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw sl(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:Object(xa.b)(t,"heartbeat"),_delete:()=>Promise.resolve()}},cl=e=>{const t=e.getProvider("app").getImmediate(),n=Object(xa.b)(t,"installations").getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await Qa(t);return i?i.catch(console.error):rl(t).catch(console.error),n.fid}(n),getToken:e=>ol(n,e)}};Object(xa.c)(new _a.a("installations",dl,"PUBLIC")),Object(xa.c)(new _a.a("installations-internal",cl,"PRIVATE")),Object(xa.g)("@firebase/installations","0.6.8"),Object(xa.g)("@firebase/installations","0.6.8","esm2017");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ul="https://www.googletagmanager.com/gtag/js",pl=new Ia.b("@firebase/analytics"),hl={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},gl=new ka.b("analytics","Analytics",hl);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ml(e){if(!e.startsWith(ul)){const t=gl.create("invalid-gtag-resource",{gtagURL:e});return pl.warn(t.message),""}return e}function fl(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function yl(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:ml}),i=document.createElement("script"),r=`${ul}?l=${e}&id=${t}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}function vl(e,t,n,i){return async function(r,...a){try{if("event"===r){const[i,r]=a;await async function(e,t,n,i,r){try{let a=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const i=await fl(n);for(const n of e){const e=i.find(e=>e.measurementId===n),r=e&&t[e.appId];if(!r){a=[];break}a.push(r)}}0===a.length&&(a=Object.values(t)),await Promise.all(a),e("event",i,r||{})}catch(e){pl.error(e)}}(e,t,n,i,r)}else if("config"===r){const[r,l]=a;await async function(e,t,n,i,r,a){const l=i[r];try{if(l)await t[l];else{const e=(await fl(n)).find(e=>e.measurementId===r);e&&await t[e.appId]}}catch(e){pl.error(e)}e("config",r,a)}(e,t,n,i,r,l)}else if("consent"===r){const[t,n]=a;e("consent",t,n)}else if("get"===r){const[t,n,i]=a;e("get",t,n,i)}else if("set"===r){const[t]=a;e("set",t)}else e(r,...a)}catch(e){pl.error(e)}}}const bl=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function wl(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function El(e,t=bl,n){const{appId:i,apiKey:r,measurementId:a}=e.options;if(!i)throw gl.create("no-app-id");if(!r){if(a)return{measurementId:a,appId:i};throw gl.create("no-api-key")}const l=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new Sl;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),async function e(t,{throttleEndTimeMillis:n,backoffCount:i},r,a=bl){var l;const{appId:o,measurementId:s}=t;try{await function(e,t){return new Promise((n,i)=>{const r=Math.max(t-Date.now(),0),a=setTimeout(n,r);e.addEventListener(()=>{clearTimeout(a),i(gl.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(r,n)}catch(e){if(s)return pl.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+s+` provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:s};throw e}try{const e=await async function(e){var t;const{appId:n,apiKey:i}=e,r={method:"GET",headers:wl(i)},a="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),l=await fetch(a,r);if(200!==l.status&&304!==l.status){let e="";try{const n=await l.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw gl.create("config-fetch-failed",{httpStatus:l.status,responseMessage:e})}return l.json()}(t);return a.deleteThrottleMetadata(o),e}catch(n){const d=n;if(!function(e){if(!(e instanceof ka.c&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(d)){if(a.deleteThrottleMetadata(o),s)return pl.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+s+` provided in the "measurementId" field in the local Firebase config. [${null==d?void 0:d.message}]`),{appId:o,measurementId:s};throw n}const c=503===Number(null===(l=null==d?void 0:d.customData)||void 0===l?void 0:l.httpStatus)?Object(ka.f)(i,a.intervalMillis,30):Object(ka.f)(i,a.intervalMillis),u={throttleEndTimeMillis:Date.now()+c,backoffCount:i+1};return a.setThrottleMetadata(o,u),pl.debug(`Calling attemptFetch again in ${c} millis`),e(t,u,r,a)}}({appId:i,apiKey:r,measurementId:a},l,o,t)}class Sl{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xl,Il;function kl(e){Il=e}function _l(e){xl=e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tl(e,t,n,i,r,a,l){var o;const s=El(e);s.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&pl.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>pl.error(e)),t.push(s);const d=async function(){if(!Object(ka.o)())return pl.warn(gl.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Object(ka.r)()}catch(e){return pl.warn(gl.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then(e=>e?i.getId():void 0),[c,u]=await Promise.all([s,d]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(ul)&&n.src.includes(e))return n;return null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)(a)||yl(a,c.measurementId),Il&&(r("consent","default",Il),kl(void 0)),r("js",new Date);const p=null!==(o=null==l?void 0:l.config)&&void 0!==o?o:{};return p.origin="firebase",p.update=!0,null!=u&&(p.firebase_id=u),r("config",c.measurementId,p),xl&&(r("set",xl),_l(void 0)),c.measurementId}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(e){this.app=e}_delete(){return delete Cl[this.app.options.appId],Promise.resolve()}}let Cl={},Ll=[];const Al={};let Pl,Bl,Rl="dataLayer",Fl="gtag",Ml=!1;function Dl(e,t,n){!function(){const e=[];if(Object(ka.n)()&&e.push("This is a browser extension environment."),Object(ka.d)()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=gl.create("invalid-analytics-context",{errorInfo:t});pl.warn(n.message)}}();const i=e.options.appId;if(!i)throw gl.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw gl.create("no-api-key");pl.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Cl[i])throw gl.create("already-exists",{id:i});if(!Ml){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Rl);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,r){let a=function(...e){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(a=window[r]),window[r]=vl(a,e,t,n),{gtagCore:a,wrappedGtag:window[r]}}(Cl,Ll,Al,Rl,Fl);Bl=e,Pl=t,Ml=!0}Cl[i]=Tl(e,Ll,Al,t,Pl,Rl,n);return new Nl(e)}function Ol(e=Object(xa.e)()){e=Object(ka.k)(e);const t=Object(xa.b)(e,"analytics");return t.isInitialized()?t.getImmediate():function(e,t={}){const n=Object(xa.b)(e,"analytics");if(n.isInitialized()){const e=n.getImmediate();if(Object(ka.h)(t,n.getOptions()))return e;throw gl.create("already-initialized")}return n.initialize({options:t})}(e)}function $l(e,t,n){e=Object(ka.k)(e),async function(e,t,n,i){if(i&&i.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(Bl,Cl[e.app.options.appId],t,n).catch(e=>pl.error(e))}function jl(e,t,n,i){e=Object(ka.k)(e),async function(e,t,n,i,r){if(r&&r.global)e("event",n,i);else{const r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(Bl,Cl[e.app.options.appId],t,n,i).catch(e=>pl.error(e))}Object(xa.c)(new _a.a("analytics",(e,{options:t})=>Dl(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),Object(xa.c)(new _a.a("analytics-internal",(function(e){try{const t=e.getProvider("analytics").getImmediate();return{logEvent:(e,n,i)=>jl(t,e,n,i)}}catch(e){throw gl.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Object(xa.g)("@firebase/analytics","0.10.7"),Object(xa.g)("@firebase/analytics","0.10.7","esm2017");const Wl=document.getElementById("confirm-dialog"),Hl=document.getElementById("confirm-dialog-message"),ql=document.getElementById("confirm-dialog-ok-button"),Ul=document.getElementById("confirm-dialog-cancel-button"),zl=(e,t="Yes",n="No")=>(Hl.innerHTML=e,ql.innerHTML=t,Ul.innerHTML=n,Wl.showModal(),new Promise((e,t)=>{const n=e=>{"Escape"==e.key&&(ql.removeEventListener("click",i),Ul.removeEventListener("click",r),Wl.removeEventListener("keydown",n))},i=()=>{Ul.removeEventListener("click",r),Wl.removeEventListener("keydown",n),ql.removeEventListener("click",i),Wl.close(),e(!0)},r=()=>{ql.removeEventListener("click",i),Wl.removeEventListener("keydown",n),Ul.removeEventListener("click",r),Wl.close(),e(!1)};ql.addEventListener("click",i),Ul.addEventListener("click",r),Wl.addEventListener("keydown",n)}));var Vl=n(0),Yl=n(15),Gl=n(9);function Jl(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Xl(e,t){this._pairs=[],e&&Object(Gl.a)(e,this,t)}const Kl=Xl.prototype;Kl.append=function(e,t){this._pairs.push([e,t])},Kl.toString=function(e){const t=e?function(t){return e.call(this,t,Jl)}:Jl;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var Zl=Xl;function Ql(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eo(e,t,n){if(!t)return e;const i=n&&n.encode||Ql,r=n&&n.serialize;let a;if(a=r?r(t,n):Vl.a.isURLSearchParams(t)?t.toString():new Zl(t,n).toString(i),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}var to=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Vl.a.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},no=n(2),ro={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ao={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Zl,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const lo="undefined"!=typeof window&&"undefined"!=typeof document,oo=(so="undefined"!=typeof navigator&&navigator.product,lo&&["ReactNative","NativeScript","NS"].indexOf(so)<0);var so;const co="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;var uo={...i,...ao};var po=function(e){function t(e,n,i,r){let a=e[r++];const l=Number.isFinite(+a),o=r>=e.length;if(a=!a&&Vl.a.isArray(i)?i.length:a,o)return Vl.a.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!l;i[a]&&Vl.a.isObject(i[a])||(i[a]=[]);return t(e,n,i[a],r)&&Vl.a.isArray(i[a])&&(i[a]=function(e){const t={},n=Object.keys(e);let i;const r=n.length;let a;for(i=0;i<r;i++)a=n[i],t[a]=e[a];return t}(i[a])),!l}if(Vl.a.isFormData(e)&&Vl.a.isFunction(e.entries)){const n={};return Vl.a.forEachEntry(e,(e,i)=>{t(function(e){return Vl.a.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),i,n,0)}),n}return null};const ho={transitional:ro,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=Vl.a.isObject(e);r&&Vl.a.isHTMLForm(e)&&(e=new FormData(e));if(Vl.a.isFormData(e))return i&&i?JSON.stringify(po(e)):e;if(Vl.a.isArrayBuffer(e)||Vl.a.isBuffer(e)||Vl.a.isStream(e)||Vl.a.isFile(e)||Vl.a.isBlob(e))return e;if(Vl.a.isArrayBufferView(e))return e.buffer;if(Vl.a.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Object(Gl.a)(e,new uo.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,i){return uo.isNode&&Vl.a.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=Vl.a.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Object(Gl.a)(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),function(e,t,n){if(Vl.a.isString(e))try{return(t||JSON.parse)(e),Vl.a.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ho.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(e&&Vl.a.isString(e)&&(n&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw no.a.from(e,no.a.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:uo.classes.FormData,Blob:uo.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Vl.a.forEach(["delete","get","head","post","put","patch"],e=>{ho.headers[e]={}});var go=ho;const mo=Vl.a.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const fo=Symbol("internals");function yo(e){return e&&String(e).trim().toLowerCase()}function vo(e){return!1===e||null==e?e:Vl.a.isArray(e)?e.map(vo):String(e)}function bo(e,t,n,i,r){return Vl.a.isFunction(i)?i.call(this,t,n):(r&&(t=n),Vl.a.isString(t)?Vl.a.isString(i)?-1!==t.indexOf(i):Vl.a.isRegExp(i)?i.test(t):void 0:void 0)}class wo{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function r(e,t,n){const r=yo(t);if(!r)throw new Error("header name must be a non-empty string");const a=Vl.a.findKey(i,r);(!a||void 0===i[a]||!0===n||void 0===n&&!1!==i[a])&&(i[a||t]=vo(e))}const a=(e,t)=>Vl.a.forEach(e,(e,n)=>r(e,n,t));return Vl.a.isPlainObject(e)||e instanceof this.constructor?a(e,t):Vl.a.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?a((e=>{const t={};let n,i,r;return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),i=e.substring(r+1).trim(),!n||t[n]&&mo[n]||("set-cookie"===n?t[n]?t[n].push(i):t[n]=[i]:t[n]=t[n]?t[n]+", "+i:i)})),t})(e),t):null!=e&&r(t,e,n),this}get(e,t){if(e=yo(e)){const n=Vl.a.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(e);)t[i[1]]=i[2];return t}(e);if(Vl.a.isFunction(t))return t.call(this,e,n);if(Vl.a.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=yo(e)){const n=Vl.a.findKey(this,e);return!(!n||void 0===this[n]||t&&!bo(0,this[n],n,t))}return!1}delete(e,t){const n=this;let i=!1;function r(e){if(e=yo(e)){const r=Vl.a.findKey(n,e);!r||t&&!bo(0,n[r],r,t)||(delete n[r],i=!0)}}return Vl.a.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const r=t[n];e&&!bo(0,this[r],r,e,!0)||(delete this[r],i=!0)}return i}normalize(e){const t=this,n={};return Vl.a.forEach(this,(i,r)=>{const a=Vl.a.findKey(n,r);if(a)return t[a]=vo(i),void delete t[r];const l=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(r):String(r).trim();l!==r&&delete t[r],t[l]=vo(i),n[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Vl.a.forEach(this,(n,i)=>{null!=n&&!1!==n&&(t[i]=e&&Vl.a.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(e=>n.set(e)),n}static accessor(e){const t=(this[fo]=this[fo]={accessors:{}}).accessors,n=this.prototype;function i(e){const i=yo(e);t[i]||(!function(e,t){const n=Vl.a.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+n,{value:function(e,n,r){return this[i].call(this,t,e,n,r)},configurable:!0})})}(n,e),t[i]=!0)}return Vl.a.isArray(e)?e.forEach(i):i(e),this}}wo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Vl.a.reduceDescriptors(wo.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}}),Vl.a.freezeMethods(wo);var Eo=wo;function So(e,t){const n=this||go,i=t||n,r=Eo.from(i.headers);let a=i.data;return Vl.a.forEach(e,(function(e){a=e.call(n,a,r.normalize(),t?t.status:void 0)})),r.normalize(),a}function xo(e){return!(!e||!e.__CANCEL__)}function Io(e,t,n){no.a.call(this,null==e?"canceled":e,no.a.ERR_CANCELED,t,n),this.name="CanceledError"}Vl.a.inherits(Io,no.a,{__CANCEL__:!0});var ko=Io,_o=n(16);var To=uo.hasStandardBrowserEnv?{write(e,t,n,i,r,a){const l=[e+"="+encodeURIComponent(t)];Vl.a.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),Vl.a.isString(i)&&l.push("path="+i),Vl.a.isString(r)&&l.push("domain="+r),!0===a&&l.push("secure"),document.cookie=l.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function No(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var Co=uo.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(n){let i=n;return e&&(t.setAttribute("href",i),i=t.href),t.setAttribute("href",i),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(e){const t=Vl.a.isString(e)?i(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};var Lo=function(e,t){e=e||10;const n=new Array(e),i=new Array(e);let r,a=0,l=0;return t=void 0!==t?t:1e3,function(o){const s=Date.now(),d=i[l];r||(r=s),n[a]=o,i[a]=s;let c=l,u=0;for(;c!==a;)u+=n[c++],c%=e;if(a=(a+1)%e,a===l&&(l=(l+1)%e),s-r<t)return;const p=d&&s-d;return p?Math.round(1e3*u/p):void 0}};function Ao(e,t){let n=0;const i=Lo(50,250);return r=>{const a=r.loaded,l=r.lengthComputable?r.total:void 0,o=a-n,s=i(o);n=a;const d={loaded:a,total:l,progress:l?a/l:void 0,bytes:o,rate:s||void 0,estimated:s&&l&&a<=l?(l-a)/s:void 0,event:r};d[t?"download":"upload"]=!0,e(d)}}var Po="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let i=e.data;const r=Eo.from(e.headers).normalize();let a,l,{responseType:o,withXSRFToken:s}=e;function d(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}if(Vl.a.isFormData(i))if(uo.hasStandardBrowserEnv||uo.hasStandardBrowserWebWorkerEnv)r.setContentType(!1);else if(!1!==(l=r.getContentType())){const[e,...t]=l?l.split(";").map(e=>e.trim()).filter(Boolean):[];r.setContentType([e||"multipart/form-data",...t].join("; "))}let c=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";r.set("Authorization","Basic "+btoa(t+":"+n))}const u=No(e.baseURL,e.url);function p(){if(!c)return;const i=Eo.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());!function(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new no.a("Request failed with status code "+n.status,[no.a.ERR_BAD_REQUEST,no.a.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),d()}),(function(e){n(e),d()}),{data:o&&"text"!==o&&"json"!==o?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:i,config:e,request:c}),c=null}if(c.open(e.method.toUpperCase(),eo(u,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=p:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(p)},c.onabort=function(){c&&(n(new no.a("Request aborted",no.a.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new no.a("Network Error",no.a.ERR_NETWORK,e,c)),c=null},c.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const i=e.transitional||ro;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new no.a(t,i.clarifyTimeoutError?no.a.ETIMEDOUT:no.a.ECONNABORTED,e,c)),c=null},uo.hasStandardBrowserEnv&&(s&&Vl.a.isFunction(s)&&(s=s(e)),s||!1!==s&&Co(u))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&To.read(e.xsrfCookieName);t&&r.set(e.xsrfHeaderName,t)}void 0===i&&r.setContentType(null),"setRequestHeader"in c&&Vl.a.forEach(r.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),Vl.a.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),o&&"json"!==o&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",Ao(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",Ao(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{c&&(n(!t||t.type?new ko(null,e,c):t),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const h=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(u);h&&-1===uo.protocols.indexOf(h)?n(new no.a("Unsupported protocol "+h+":",no.a.ERR_BAD_REQUEST,e)):c.send(i||null)}))};const Bo={http:_o.a,xhr:Po};Vl.a.forEach(Bo,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const Ro=e=>"- "+e,Fo=e=>Vl.a.isFunction(e)||null===e||!1===e;var Mo=e=>{e=Vl.a.isArray(e)?e:[e];const{length:t}=e;let n,i;const r={};for(let a=0;a<t;a++){let t;if(n=e[a],i=n,!Fo(n)&&(i=Bo[(t=String(n)).toLowerCase()],void 0===i))throw new no.a(`Unknown adapter '${t}'`);if(i)break;r[t||"#"+a]=i}if(!i){const e=Object.entries(r).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));let n=t?e.length>1?"since :\n"+e.map(Ro).join("\n"):" "+Ro(e[0]):"as no adapter specified";throw new no.a("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return i};function Do(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ko(null,e)}function Oo(e){Do(e),e.headers=Eo.from(e.headers),e.data=So.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Mo(e.adapter||go.adapter)(e).then((function(t){return Do(e),t.data=So.call(e,e.transformResponse,t),t.headers=Eo.from(t.headers),t}),(function(t){return xo(t)||(Do(e),t&&t.response&&(t.response.data=So.call(e,e.transformResponse,t.response),t.response.headers=Eo.from(t.response.headers))),Promise.reject(t)}))}const $o=e=>e instanceof Eo?e.toJSON():e;function jo(e,t){t=t||{};const n={};function i(e,t,n){return Vl.a.isPlainObject(e)&&Vl.a.isPlainObject(t)?Vl.a.merge.call({caseless:n},e,t):Vl.a.isPlainObject(t)?Vl.a.merge({},t):Vl.a.isArray(t)?t.slice():t}function r(e,t,n){return Vl.a.isUndefined(t)?Vl.a.isUndefined(e)?void 0:i(void 0,e,n):i(e,t,n)}function a(e,t){if(!Vl.a.isUndefined(t))return i(void 0,t)}function l(e,t){return Vl.a.isUndefined(t)?Vl.a.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function o(n,r,a){return a in t?i(n,r):a in e?i(void 0,n):void 0}const s={url:a,method:a,data:a,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:o,headers:(e,t)=>r($o(e),$o(t),!0)};return Vl.a.forEach(Object.keys(Object.assign({},e,t)),(function(i){const a=s[i]||r,l=a(e[i],t[i],i);Vl.a.isUndefined(l)&&a!==o||(n[i]=l)})),n}const Wo={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Wo[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Ho={};Wo.transitional=function(e,t,n){function i(e,t){return"[Axios v1.6.3] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,a)=>{if(!1===e)throw new no.a(i(r," has been removed"+(t?" in "+t:"")),no.a.ERR_DEPRECATED);return t&&!Ho[r]&&(Ho[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,a)}};var qo={assertOptions:function(e,t,n){if("object"!=typeof e)throw new no.a("options must be an object",no.a.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const a=i[r],l=t[a];if(l){const t=e[a],n=void 0===t||l(t,a,e);if(!0!==n)throw new no.a("option "+a+" must be "+n,no.a.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new no.a("Unknown option "+a,no.a.ERR_BAD_OPTION)}},validators:Wo};const Uo=qo.validators;class zo{constructor(e){this.defaults=e,this.interceptors={request:new to,response:new to}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=jo(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;void 0!==n&&qo.assertOptions(n,{silentJSONParsing:Uo.transitional(Uo.boolean),forcedJSONParsing:Uo.transitional(Uo.boolean),clarifyTimeoutError:Uo.transitional(Uo.boolean)},!1),null!=i&&(Vl.a.isFunction(i)?t.paramsSerializer={serialize:i}:qo.assertOptions(i,{encode:Uo.function,serialize:Uo.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=r&&Vl.a.merge(r.common,r[t.method]);r&&Vl.a.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),t.headers=Eo.concat(a,r);const l=[];let o=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,l.unshift(e.fulfilled,e.rejected))}));const s=[];let d;this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)}));let c,u=0;if(!o){const e=[Oo.bind(this),void 0];for(e.unshift.apply(e,l),e.push.apply(e,s),c=e.length,d=Promise.resolve(t);u<c;)d=d.then(e[u++],e[u++]);return d}c=l.length;let p=t;for(u=0;u<c;){const e=l[u++],t=l[u++];try{p=e(p)}catch(e){t.call(this,e);break}}try{d=Oo.call(this,p)}catch(e){return Promise.reject(e)}for(u=0,c=s.length;u<c;)d=d.then(s[u++],s[u++]);return d}getUri(e){return eo(No((e=jo(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}Vl.a.forEach(["delete","get","head","options"],(function(e){zo.prototype[e]=function(t,n){return this.request(jo(n||{},{method:e,url:t,data:(n||{}).data}))}})),Vl.a.forEach(["post","put","patch"],(function(e){function t(t){return function(n,i,r){return this.request(jo(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}zo.prototype[e]=t(),zo.prototype[e+"Form"]=t(!0)}));var Vo=zo;class Yo{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const i=new Promise(e=>{n.subscribe(e),t=e}).then(e);return i.cancel=function(){n.unsubscribe(t)},i},e((function(e,i,r){n.reason||(n.reason=new ko(e,i,r),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new Yo((function(t){e=t})),cancel:e}}}var Go=Yo;const Jo={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Jo).forEach(([e,t])=>{Jo[t]=e});var Xo=Jo;const Ko=function e(t){const n=new Vo(t),i=Object(Yl.a)(Vo.prototype.request,n);return Vl.a.extend(i,Vo.prototype,n,{allOwnKeys:!0}),Vl.a.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(jo(t,n))},i}(go);Ko.Axios=Vo,Ko.CanceledError=ko,Ko.CancelToken=Go,Ko.isCancel=xo,Ko.VERSION="1.6.3",Ko.toFormData=Gl.a,Ko.AxiosError=no.a,Ko.Cancel=Ko.CanceledError,Ko.all=function(e){return Promise.all(e)},Ko.spread=function(e){return function(t){return e.apply(null,t)}},Ko.isAxiosError=function(e){return Vl.a.isObject(e)&&!0===e.isAxiosError},Ko.mergeConfig=jo,Ko.AxiosHeaders=Eo,Ko.formToJSON=e=>po(Vl.a.isHTMLForm(e)?new FormData(e):e),Ko.getAdapter=Mo,Ko.HttpStatusCode=Xo,Ko.default=Ko;var Zo=Ko;const Qo=()=>{const e=localStorage.getItem("token");let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/draft-plan/get-draft-plan/${t}`,{headers:{token:e}})},es=e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/main-design/create",e,{headers:{token:t}})},ts=e=>{const t=localStorage.getItem("token");return Zo.get(`${ba}/main-design/get-from-main-design-id/${e}`,{headers:{token:t}})},ns=(e,t,n={})=>{const i=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/main-design/${r}`,{headers:{token:i},params:{page:e,limit:t,...n}})},is=()=>{const e=localStorage.getItem("token");let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/peg-plan/get-peg-plan/${t}`,{headers:{token:e}})},rs=document.getElementById("selection-tool"),as=document.getElementById("tools-pencil"),ls=document.getElementById("tools-line"),os="pencil",ss="selection",ds="line",cs={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",TOP_RIGHT:"topright",TOP_LEFT:"topleft",BOTTOM_RIGHT:"bottomright",BOTTOM_LEFT:"bottomleft"},us="draw",ps="erase",hs="draw",gs="erase",ms="default",fs="crosshair",ys="crosshair";let vs=os;const bs=e=>{console.log("selected tools is",e),vs=e,e==ds?(as.parentElement.style.backgroundColor="white",rs.parentElement.style.backgroundColor="white",ls.parentElement.style.backgroundColor="#d2cbcba6"):e==os?(ls.parentElement.style.backgroundColor="white",rs.parentElement.style.backgroundColor="white",as.parentElement.style.backgroundColor="#d2cbcba6",console.log("pencil parent element is",as.parentElement)):e==ss&&(ls.parentElement.style.backgroundColor="white",as.parentElement.style.backgroundColor="white",rs.parentElement.style.backgroundColor="#d2cbcba6")},ws=e=>{bs(ss),document.body.style.cursor=fs},Es=e=>{bs(ds),document.body.style.cursor=ys},Ss=e=>{console.log("pencil click called"),bs(os),document.body.style.cursor=ms},xs=document.getElementById("function-canvas-container"),Is=document.getElementById("density-canvas-container"),ks=document.getElementById("speed-canvas-container"),_s=document.getElementById("function-canvas"),Ts=_s.getContext("2d"),Ns=document.getElementById("density-canvas"),Cs=Ns.getContext("2d"),Ls=document.getElementById("speed-canvas"),As=Ls.getContext("2d"),Ps=document.getElementById("weft-color-canvas"),Bs=Ps.getContext("2d"),Rs=document.getElementById("weftcolor-context-menu"),Fs=document.getElementById("weft-color-container");let Ms="A",Ds="A",Os="A",$s={},js={},Ws={},Hs=1,qs=null;const Us=e=>{Ws={...e}},zs=document.getElementById("first-column-container"),Vs=document.getElementById("main-dent-container");document.getElementById("weftSubParent");let Ys=Ci;const Gs=e=>{Ys=e;let t=document.getElementById(e);t&&(t.checked=!0)},Js=e=>{const t=_s.getBoundingClientRect(),n=l$.size,i=Hn.startRow,r=Mn?Hn.endRow:Math.min(n,Hn.endRow),a=Mn?r-i+1:Math.min(r-i+1,n),l=Gn?YO.height():qi,o=n-1-(a-1-parseInt((e.clientY-t.top)/l)+(i-1))%n;console.log("clicked function index ",o),qs||(qs=l$.check_if_element_exist(o)?gs:hs),qs==hs?l$.add_function_cell(o,Ds):qs==gs&&l$.remove_function_cell(o),cd()},Xs=e=>{const t=Ns.getBoundingClientRect(),n=s$.size,i=Hn.startRow,r=Mn?Hn.endRow:Math.min(n,Hn.endRow),a=Mn?r-i+1:Math.min(r-i+1,n),l=Gn?YO.height():qi,o=n-1-(a-1-parseInt((e.clientY-t.top)/l)+(i-1))%n;console.log("clicked function index ",o),s$.update_cell(o,Os),ud()},Ks=e=>{const t=Ls.getBoundingClientRect(),n=h$.size,i=Hn.startRow,r=Mn?Hn.endRow:Math.min(n,Hn.endRow),a=Mn?r-i+1:Math.min(r-i+1,n),l=Gn?YO.height():qi,o=n-1-(a-1-parseInt((e.clientY-t.top)/l)+(i-1))%n;console.log("clicked function index ",o),h$.update_cell(o,Os),sd()},Zs=(e,t=!1)=>{const n=Ps.getBoundingClientRect(),i=d$.size,r=Hn.startRow,a=Mn?Hn.endRow:Math.min(i,Hn.endRow),l=Mn?a-r+1:Math.min(a-r+1,i),o=Gn?YO.height():qi,s=i-1-(l-1-parseInt((e.clientY-n.top)/o)+(r-1))%i;console.log("index ",s),t?d$.update_cell_for_warp_weft_on_move(s):d$.update_cell_for_warp_weft(s,Ms),hd(),"radio-weave"!=Yn&&MN()},Qs=e=>{Ys!=Ci&&(o_(n_.WEFT),0==e.button&&qn==Wn&&(Zs(e),Vi(!0)))},ed=e=>{RN(dr,e),Ys!=Ci&&$i&&qn==Wn&&(Zs(e,!0),Vi(!0))},td=e=>{0==e.button&&(Js(e),Vi(!0))},nd=()=>{Vi(!1),qs=null},id=e=>{o_(n_.FUNCTION),0==e.button&&(Xs(e),Vi(!0))},rd=e=>{o_(n_.FUNCTION),0==e.button&&(Ks(e),Vi(!0))},ad=e=>{RN(pr),$i&&0==e.button&&Js(e)},ld=e=>{RN(hr),$i&&0==e.button&&(Xs(e),Vi(!0))},od=e=>{RN(yr),$i&&0==e.button&&(Ks(e),Vi(!0))},sd=()=>{const e=Hn.startRow,t=Hn.endRow,n=h$.size,i=Mn?t-e+1:Math.min(t-e+1,n),r=Gn?YO.height():qi,a=document.createElement("canvas");if(a.width=15,a.height=i*r,0==a.height||0==a.width)return;const l=a.getContext("2d");l.fillStyle="white",l.fillRect(0,0,a.width,a.height),l.fillStyle="black",As.clearRect(0,0,_s.width,_s.height),l.beginPath();let o=h$.getVisibleCells(e,Mn?t:Math.min(t,n),Mn),s=Mn?t:Math.min(t,n);if(s=s%n==0?n:s%n,o.forEach(e=>{l.fillStyle=js[e.color_code],l.fillRect(0,(e.index-(n-s))*r,15,r)}),l.closePath(),Oi==si){for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(15*e,0),l.lineTo(15*e,i*r),l.lineWidth=.5,l.stroke(),l.closePath();for(let t=0;t<i+1;t++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(15,t*r),l.lineWidth=(i-t+e-1)%jn==0?1.5:.5,l.stroke(),l.closePath()}else if(Oi==di){l.lineWidth=.5;for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(15*e,0),l.lineTo(15*e,i*r),l.stroke(),l.closePath();for(let e=0;e<i+1;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(15,e*r),l.stroke(),l.closePath()}else if(Oi==ci){l.lineWidth=1.5;for(let e=0;e<2;e++)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(15*e,0),l.lineTo(15*e,i*r),l.stroke(),l.closePath());for(let t=0;t<i+1;t++)(i-t+e-1)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(15,t*r),l.stroke(),l.closePath())}else{l.lineWidth=1.5;for(let e=0;e<2;e+=1)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(15*e,0),l.lineTo(15*e,i*r),l.stroke(),l.closePath());for(let e=0;e<i+1;e+=i)(i-e)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(15,e*r),l.stroke(),l.closePath())}Ls.width=a.width,Ls.height=a.height,As.drawImage(a,0,0)},dd=()=>{const e=s$.size,t=Gn?YO.height():qi,n=Dn,i=On,r=document.createElement("canvas");r.width=10,r.height=e*t;const a=r.getContext("2d");if(a.fillStyle="white",a.fillRect(0,0,r.width,r.height),a.fillStyle="black",Cs.clearRect(0,0,_s.width,_s.height),a.beginPath(),s$.cells.forEach(e=>{a.fillStyle=js[e.color_code],a.fillRect(0,e.index*t,10,t)}),a.closePath(),Oi==si){for(let r=0;r<2;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.lineWidth=.5,a.stroke(),a.closePath();for(let r=0;r<e+1;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.lineWidth=(e-r)%jn==0?1.5:.5,a.stroke(),a.closePath()}else if(Oi==di){a.lineWidth=.5;for(let r=0;r<2;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.stroke(),a.closePath();for(let r=0;r<e+1;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.stroke(),a.closePath()}else if(Oi==ci){a.lineWidth=1.5;for(let r=0;r<2;r++)r%$n==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.stroke(),a.closePath());for(let r=0;r<e+1;r++)(e-r)%jn==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.stroke(),a.closePath())}else{a.lineWidth=1.5;for(let r=0;r<2;r+=1)r%$n==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.stroke(),a.closePath());for(let r=0;r<e+1;r+=e)(e-r)%jn==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.stroke(),a.closePath())}Ns.width=r.width,Ns.height=r.height*Hs;const l=Cs.createPattern(r,"repeat");Cs.rect(0,0,Ns.width,Ns.height),Cs.fillStyle=l,Cs.fill()},cd=()=>{const e=Hn.startRow,t=Hn.endRow,n=l$.size,i=Mn?t-e+1:Math.min(t-e+1,n),r=Gn?YO.height():qi,a=document.createElement("canvas");if(a.width=10,a.height=i*r,0==a.height||0==a.width)return;const l=a.getContext("2d");l.fillStyle="white",l.fillRect(0,0,a.width,a.height),l.fillStyle="black",Ts.clearRect(0,0,_s.width,_s.height),l.beginPath();let o=l$.getVisibleCells(e,Mn?t:Math.min(t,n),Mn),s=Mn?t:Math.min(t,n);if(s=s%n==0?n:s%n,o.forEach(e=>{l.fillStyle=$s[e.color_code],l.fillRect(0,(e.index-(n-s))*r,10,r)}),l.closePath(),Oi==si){for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(10*e,0),l.lineTo(10*e,i*r),l.lineWidth=.5,l.stroke(),l.closePath();for(let t=0;t<i+1;t++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(10,t*r),l.lineWidth=(i-t+e-1)%jn==0?1.5:.5,l.stroke(),l.closePath()}else if(Oi==di){l.lineWidth=.5;for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(10*e,0),l.lineTo(10*e,i*r),l.stroke(),l.closePath();for(let e=0;e<i+1;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(10,e*r),l.stroke(),l.closePath()}else if(Oi==ci){l.lineWidth=1.5;for(let e=0;e<2;e++)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(10*e,0),l.lineTo(10*e,i*r),l.stroke(),l.closePath());for(let t=0;t<i+1;t++)(i-t+e-1)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(10,t*r),l.stroke(),l.closePath())}else{l.lineWidth=1.5;for(let e=0;e<2;e+=1)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(10*e,0),l.lineTo(10*e,i*r),l.stroke(),l.closePath());for(let e=0;e<i+1;e+=i)(i-e)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(10,e*r),l.stroke(),l.closePath())}_s.width=a.width,_s.height=a.height,Ts.drawImage(a,0,0)},ud=()=>{const e=Hn.startRow,t=Hn.endRow,n=s$.size,i=Mn?t-e+1:Math.min(t-e+1,n),r=Gn?YO.height():qi,a=document.createElement("canvas");if(a.width=20,a.height=i*r,0==a.height||0==a.width)return;const l=a.getContext("2d");l.fillStyle="white",l.fillRect(0,0,a.width,a.height),l.fillStyle="black",Cs.clearRect(0,0,_s.width,_s.height),l.beginPath();let o=s$.getVisibleCells(e,Mn?t:Math.min(t,n),Mn),s=Mn?t:Math.min(t,n);if(s=s%n==0?n:s%n,o.forEach(e=>{l.fillStyle=js[e.color_code],l.fillRect(0,(e.index-(n-s))*r,20,r)}),l.closePath(),Oi==si){for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(20*e,0),l.lineTo(20*e,i*r),l.lineWidth=.5,l.stroke(),l.closePath();for(let t=0;t<i+1;t++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(20,t*r),l.lineWidth=(i-t+e-1)%jn==0?1.5:.5,l.stroke(),l.closePath()}else if(Oi==di){l.lineWidth=.5;for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(20*e,0),l.lineTo(20*e,i*r),l.stroke(),l.closePath();for(let e=0;e<i+1;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(20,e*r),l.stroke(),l.closePath()}else if(Oi==ci){l.lineWidth=1.5;for(let e=0;e<2;e++)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(20*e,0),l.lineTo(20*e,i*r),l.stroke(),l.closePath());for(let t=0;t<i+1;t++)(i-t+e-1)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(20,t*r),l.stroke(),l.closePath())}else{l.lineWidth=1.5;for(let e=0;e<2;e+=1)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(20*e,0),l.lineTo(20*e,i*r),l.stroke(),l.closePath());for(let e=0;e<i+1;e+=i)(i-e)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(20,e*r),l.stroke(),l.closePath())}Ns.width=a.width,Ns.height=a.height,Cs.drawImage(a,0,0)},pd=()=>{const e=l$.size,t=Gn?YO.height():qi,n=Dn,i=On,r=document.createElement("canvas");r.width=10,r.height=e*t;const a=r.getContext("2d");if(a.fillStyle="white",a.fillRect(0,0,r.width,r.height),a.fillStyle="black",Ts.clearRect(0,0,_s.width,_s.height),a.beginPath(),console.log("functiongrid",l$.cells),l$.cells.forEach(e=>{a.fillStyle="red",a.fillRect(0,e.index*t,10,t)}),a.closePath(),Oi==si){for(let r=0;r<2;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.lineWidth=.5,a.stroke(),a.closePath();for(let r=0;r<e+1;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.lineWidth=(e-r)%jn==0?1.5:.5,a.stroke(),a.closePath()}else if(Oi==di){a.lineWidth=.5;for(let r=0;r<2;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.stroke(),a.closePath();for(let r=0;r<e+1;r++)a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.stroke(),a.closePath()}else if(Oi==ci){a.lineWidth=1.5;for(let r=0;r<2;r++)r%$n==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.stroke(),a.closePath());for(let r=0;r<e+1;r++)(e-r)%jn==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.stroke(),a.closePath())}else{a.lineWidth=1.5;for(let r=0;r<2;r+=1)r%$n==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n+10*r,i),a.lineTo(n+10*r,i+e*t),a.stroke(),a.closePath());for(let r=0;r<e+1;r+=e)(e-r)%jn==0&&(a.beginPath(),a.strokeStyle="grey",a.moveTo(n,i+r*t),a.lineTo(n+10,i+r*t),a.stroke(),a.closePath())}_s.width=r.width,_s.height=r.height*Hs;const l=Ts.createPattern(r,"repeat");Ts.rect(0,0,_s.width,_s.height),Ts.fillStyle=l,Ts.fill()},hd=()=>{const e=Hn.startRow,t=Hn.endRow,n=d$.size,i=Mn?t-e+1:Math.min(t-e+1,n),r=Gn?YO.height():qi,a=document.createElement("canvas");if(a.width=30,a.height=i*r,0==a.height||0==a.width)return;const l=a.getContext("2d");if(l.fillStyle="white",l.fillRect(0,0,a.width,a.height),l.fillStyle="black",Bs.clearRect(0,0,Ps.width,Ps.height),l.beginPath(),d$.getVisibleCells(e,Mn?t:Math.min(t,n),Mn).forEach((e,t)=>{l.fillStyle=$s[e],l.fillRect(0,t*r,30,r)}),l.closePath(),Oi==si){for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(30*e,0),l.lineTo(30*e,i*r),l.lineWidth=.5,l.stroke(),l.closePath();for(let t=0;t<i+1;t++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(30,t*r),l.lineWidth=(i-t+e-1)%jn==0?1.5:.5,l.stroke(),l.closePath()}else if(Oi==di){l.lineWidth=.5;for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(30*e,0),l.lineTo(30*e,i*r),l.stroke(),l.closePath();for(let e=0;e<i+1;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(30,e*r),l.stroke(),l.closePath()}else if(Oi==ci){l.lineWidth=1.5;for(let e=0;e<2;e++)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(30*e,0),l.lineTo(30*e,i*r),l.stroke(),l.closePath());for(let t=0;t<i+1;t++)(i-t+e-1)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,t*r),l.lineTo(30,t*r),l.stroke(),l.closePath())}else{l.lineWidth=1.5;for(let e=0;e<2;e+=1)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(30*e,0),l.lineTo(30*e,i*r),l.stroke(),l.closePath());for(let e=0;e<i+1;e+=i)(i-e)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,e*r),l.lineTo(30,e*r),l.stroke(),l.closePath())}Ps.width=a.width,Ps.height=a.height,Bs.drawImage(a,0,0)},gd=()=>{hd()},md=document.getElementById("dent-canvas"),fd=document.getElementById("dent-click-canvas"),yd=md.getContext("2d"),vd=fd.getContext("2d"),bd=document.getElementById("dent-container"),wd=document.getElementById("dent-click-canvas-container"),Ed=e=>{const t=md.getBoundingClientRect(),n=ZO.cell_size(),i=ZO.cols(),r=ZO.rows(),a=(e.clientX-t.left)%(i*n),l=e.clientY-t.top,o=parseInt(a/n)+Hn.startColumn,s=r-parseInt(l/n)-1;ZO.add_cell_new(s,o%i,YO,KO),Td()},Sd=e=>{Vi(!0),o_(n_.NONE),Ed(e)},xd=()=>{Vi(!1)},Id=e=>{o_(n_.NONE),e.preventDefault();const t=md.getBoundingClientRect(),n=ZO.cell_size(),i=n,r=ZO.cols(),a=(e.clientX-t.left)%(r*n),l=(e.clientY,t.top,parseInt(a/n)+Hn.startColumn);0==e.button?ZO.add_click_cell_new(l%r,!0,YO,KO):2==e.button&&ZO.add_click_cell_new(l%r,!1,YO,KO),Td()},kd=e=>{RN(ur),$i&&Ed(e)},_d=()=>{RN(gr)},Td=()=>{const e=ZO.cols(),t=Hn.startColumn,n=Hn.endColumn,i=Mn?n-t+1:Math.min(n-t+1,e),r=ZO.rows(),a=ZO.cell_size(),l=document.createElement("canvas");l.width=i*a,l.height=r*a;const o=l.getContext("2d");o.fillStyle="white",o.fillRect(0,0,l.width,l.height),o.fillStyle="black";const s=ZO.get_visible_cells(t,Mn?n:Math.min(n,e-1),Mn),d=rL(s)?JSON.parse(s):[];for(let e=0;e<i+1;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(e*a,0),o.lineTo(e*a,r*a),o.lineWidth=(e+t)%$n==0?1.5:.5,o.stroke(),o.closePath();for(let e=0;e<r+1;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(0,e*a),o.lineTo(i*a,e*a),o.stroke(),o.closePath();d.forEach((e,t)=>{o.fillRect(t*a,(r-e)*a,a,a)}),yd.clearRect(0,0,md.width,md.height),bd.style.height=l.height+"px",md.height=l.height,md.width=l.width,yd.drawImage(l,0,0),Nd(),aC()},Nd=()=>{const e=ZO.cols(),t=Hn.startColumn,n=Hn.endColumn,i=Mn?n-t+1:Math.min(n-t+1,e),r=ZO.get_visible_click_cells(t,Mn?n:Math.min(n,e-1),Mn),a=rL(r)?JSON.parse(r):[],l=ZO.rows(),o=ZO.cell_size(),s=document.createElement("canvas");s.width=i*o,s.height=o;const d=s.getContext("2d");d.fillStyle="white",d.fillRect(0,0,s.width,s.height),d.fillStyle="black";for(let e=0;e<i+1;e++)d.beginPath(),d.strokeStyle="white",d.moveTo(e*o,0),d.lineTo(e*o,l*o),d.stroke(),d.closePath();for(let e=0;e<l+1;e++)d.beginPath(),d.strokeStyle="white",d.moveTo(0,e*o),d.lineTo(i*o,e*o),d.stroke(),d.closePath();d.font="10px serif",a.forEach((e,t)=>{e>0&&d.fillText(a[t],(t+1)*o-4,8)}),wd.style.height=s.height+"px",fd.width=s.width,fd.height=s.height,vd.clearRect(0,0,md.width,md.height),vd.drawImage(s,0,0)};let Cd="A",Ld={},Ad={};const Pd=document.getElementById("warp-color-container"),Bd=document.getElementById("warp-color-canvas"),Rd=Bd.getContext("2d"),Fd=document.getElementById("warpcolor-context-menu"),Md=document.getElementById("warp-creaming-canvas"),Dd=Md.getContext("2d"),Od=document.getElementById("warp-creaming-container");let $d=Ti;const jd=e=>{Ad={...e}},Wd=e=>{$d=e;let t=document.getElementById(e);t&&(t.checked=!0)},Hd=()=>{const e=o$.size,t=Hn.startColumn,n=Hn.endColumn,i=Mn?n-t+1:Math.min(Hn.endColumn-t+1,e),r=qi,a=qi,l=document.createElement("canvas");l.width=i*a,l.height=1*r;const o=l.getContext("2d");if(o.fillStyle="white",o.fillRect(0,0,l.width,l.height),o.fillStyle="black",Dd.clearRect(0,0,Md.width,Md.height),o$.getVisibleCells(t,Mn?n:Math.min(Hn.endColumn,e-1),Mn).forEach(e=>{o.fillStyle="red",o.fillRect((e.index-t)*a,0,a,r)}),Oi==si){for(let e=0;e<i+1;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(e*a,0),o.lineTo(e*a,1*r),o.lineWidth=(e+t)%$n==0?1.5:.5,o.stroke(),o.closePath();for(let e=0;e<2;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(0,e*r),o.lineTo(i*a,e*r),o.lineWidth=.5,o.stroke(),o.closePath()}else if(Oi==di){o.lineWidth=.5;for(let e=0;e<i+1;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(e*a,0),o.lineTo(e*a,1*r),o.stroke(),o.closePath();for(let e=0;e<2;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(0,e*r),o.lineTo(i*a,e*r),o.stroke(),o.closePath()}else if(Oi==ci){o.lineWidth=1.5;for(let e=0;e<i+1;e++)(e+t)%$n==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(e*a,0),o.lineTo(e*a,1*r),o.stroke(),o.closePath());for(let e=0;e<2;e++)(1-e)%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(0,e*r),o.lineTo(i*a,e*r),o.stroke(),o.closePath())}else{o.lineWidth=1.5;for(let e=0;e<i+1;e+=i)o.beginPath(),o.strokeStyle="grey",o.moveTo(e*a,0),o.lineTo(e*a,1*r),o.stroke(),o.closePath();for(let e=0;e<2;e+=1)(1-e)%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(0,e*r),o.lineTo(i*a,e*r),o.stroke(),o.closePath())}Md.width=l.width,Md.height=l.height,Dd.drawImage(l,0,0)},qd=()=>{const e=o$.size,t=Hn.startColumn,n=Hn.endColumn,i=Mn?n-t+1:Math.min(Hn.endColumn-t+1,e),r=qi,a=document.createElement("canvas");a.width=i*r,a.height=30;const l=a.getContext("2d");if(l.fillStyle="white",l.fillRect(0,0,a.width,a.height),l.fillStyle="black",l.beginPath(),c$.getVisibleCells(t,Mn?n:Math.min(Hn.endColumn,e-1),Mn).forEach((e,t)=>{l.fillStyle=Ld[e],l.fillRect(t*r,0,r,30)}),l.closePath(),Oi==si){for(let e=0;e<i+1;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(e*r,0),l.lineTo(e*r,30),l.lineWidth=(e+t)%$n==0?1.5:.5,l.stroke(),l.closePath();for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,30*e),l.lineTo(i*r,30*e),l.lineWidth=.5,l.stroke(),l.closePath()}else if(Oi==di){l.lineWidth=.5;for(let e=0;e<i+1;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(e*r,0),l.lineTo(e*r,30),l.stroke(),l.closePath();for(let e=0;e<2;e++)l.beginPath(),l.strokeStyle="grey",l.moveTo(0,30*e),l.lineTo(0+i*r,30*e),l.stroke(),l.closePath()}else if(Oi==ci){l.lineWidth=1.5;for(let e=0;e<i+1;e++)(e+t)%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(e*r,0),l.lineTo(e*r,30),l.stroke(),l.closePath());for(let e=0;e<2;e++)e%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,30*e),l.lineTo(i*r,30*e),l.stroke(),l.closePath())}else{l.lineWidth=1.5;for(let e=0;e<i+1;e+=i)e%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(e*r,0),l.lineTo(e*r,30),l.stroke(),l.closePath());for(let e=0;e<2;e+=1)e%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(0,30*e),l.lineTo(i*r,30*e),l.stroke(),l.closePath())}Pd.style.height=a.height+"px",Bd.width=a.width,Bd.height=a.height,Rd.clearRect(0,0,Bd.width,Bd.height),Rd.drawImage(a,0,0)},Ud=()=>{qd()},zd=(e,t=!1)=>{const n=Bd.getBoundingClientRect(),i=qi,r=(Hn.startColumn+parseInt((e.clientX-n.left)%(c$.size*i)/i))%c$.size;console.log("index is",r),t?c$.update_cell_for_warp_weft_on_move(r):c$.update_cell_for_warp_weft(r,Cd),qd(),"radio-weave"!=Yn&&MN()},Vd=e=>{$d!=Ti&&(o_(n_.WARP),0==e.button&&qn==Wn&&(Vi(!0),zd(e)))},Yd=e=>{(e=>{const t=Md.getBoundingClientRect(),n=qi,i=(parseInt((e.clientX-t.left)%(o$.size*n)/n)+Hn.startColumn)%c$.size;o$.update_function_cell(i,Ds),Hd()})(e),Vi(!0)},Gd=e=>{RN(cr,e),$d!=Ti&&$i&&qn==Wn&&(zd(e,!0),"radio-color"==Yn?YN():"radio-interlacement"==Yn&&GN())},Jd=()=>{RN(fr)},Xd=document.getElementById("main-content"),Kd=()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;const t=localStorage.getItem("token");return Zo.post(ba+"/analytics",{userId:e,isPrint:!0},{headers:{token:t}})},Zd=e=>{let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;const n=localStorage.getItem("token");return Zo.post(ba+"/analytics",{...e,userId:t},{headers:{token:n}})};let Qd="";const ec=document.getElementById("design-notes-model"),tc=document.getElementById("header-design-notes-trigger");let nc,ic,rc;const ac=e=>{Qd=e},lc=()=>{ac(nc.value)},oc=()=>{lc(),dc()},sc=()=>{Uf(),nc.value=Qd,ec.style.display="block",ec.style.animation="slide-down 0.3s ease"},dc=()=>{ec.style.display="none"},cc=(document.getElementById("draft-edit-num"),document.getElementById("total-end-dent"),document.getElementById("edit-salvage-error-message")),uc=document.getElementById("leftSalvageDraft"),pc=document.getElementById("rightSalvageDraft"),hc=document.getElementById("salvage-draft-warp-submit"),gc=document.getElementById("salvage-draft-warp-apply"),mc=document.getElementById("leftWarpTotal"),fc=document.getElementById("rightWarpTotal"),yc=document.getElementById("leftWarpSequence"),vc=document.getElementById("rightWarpSequence"),bc=document.getElementById("edit-salvage-plain-shaft"),wc=document.getElementById("edit-salvage-shaft-position");let Ec={draftPlan:"",warpSeq:""},Sc={draftPlan:"",warpSeq:""};const xc=document.getElementById("edit-salvage-trigger"),Ic=document.getElementById("draft-warp-seq"),kc=(document.getElementById("draft-warp-seq"),(e,t,n,i)=>{let r="",a=[];if("first"==n){let t=0;for(let n=0;n<e;n++)t>=e&&(t=1),a[t]=n+1,t+=1;let n=0;for(;r+=a[n%e]+" ",(n+1)%i==0&&(r+="\n"),n++,0==n||n%e!=0||n%i!=0;);return"["+r.trim()+"]"}if("last"==n){let n=0;for(let t=0;t<e;t++)n>=e&&(n=1),a[n]=t+1,n+=1;a=a.map(n=>n+(t-e));let l=0;for(;r+=a[l%e]+" ",(l+1)%i==0&&(r+="\n"),l++,0==l||l%e!=0||l%i!=0;);return"["+r.trim()+"]"}}),_c=()=>{let e=wc.value,t=Number(bc.value),n=Number(Yp.value),i=Number(Jp.value),r=GO.rows();pc.value=kc(t,r,e,i)+"X"+String(Math.round(Number(Jr.value)/Number(hC(kc(t,r,e,i).replace("[","").replace("]",""))))),vc.value=Jr.value+"A",uc.value=kc(t,r,e,n)+"X"+String(Math.round(Number(Nr.value)/Number(hC(kc(t,r,e,n).replace("[","").replace("]",""))))),yc.value=Nr.value+"A"},Tc=e=>{_c()},Nc=e=>{_c()},Cc=()=>{let e=lC(String(XC(uc.value)).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e))),t=lC(String(XC(pc.value)).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e)));return e!=Number(mc.value)?(cc.style.display="block",cc.innerText="Left salvage total warp length doesn't match with draft plan",!1):t!=Number(fc.value)?(cc.style.display="block",cc.innerHTML="Right salvage total warp length doesn't match with draft plan",!1):(cc.style.display="none",Ec.draftPlan=uc.value,Sc.draftPlan=pc.value,Ec.warpSeq=yc.value,Sc.warpSeq=vc.value,!0)},Lc=()=>{Cc()&&Pc()},Ac=()=>{let e=Number(Vp.value);bc.max=e,Uf(),Bc(),Number(bc.value)||(bc.value=2,_c()),Ic.style.display="block",Ic.style.animation="slide-down 0.3s ease";Ic.querySelector(".modal-title").innerText="Selvedge Draft And Warp Sequence"},Pc=()=>{Ic.style.display="none"},Bc=()=>{let e={2:"[1 2]",4:"[1 2 1 2]",6:"[1 2 1 2 1 2]"};console.log("left salave",Ec),Ec.draftPlan&&Ec.warpSeq?(uc.value=Ec.draftPlan,yc.value=Ec.warpSeq,bc.value=2):(uc.value=e[Number(Yp.value)]+"X"+String(Number(Nr.value)/Number(Yp.value)),yc.value=Nr.value+"A"),Sc.draftPlan&&Sc.warpSeq?(pc.value=Sc.draftPlan,vc.value=Sc.warpSeq,bc.value=2):(pc.value=e[Number(Jp.value)]+"X"+String(Number(Jr.value)/Number(Yp.value)),vc.value=Jr.value+"A"),mc.value=Nr.value,fc.value=Jr.value},Rc=(e,t)=>"warp"==t?Ad[e]&&Ad[e].yarnName?Ad[e].yarnName:e:"weft"==t?Ws[e]&&Ws[e].yarnName?Ws[e].yarnName:e:void 0,Fc=e=>{try{const t=String(e).split("\n").filter(e=>e);let n=[];return t.forEach(e=>{const t=String(e).match(/^\d+/)?String(e).match(/^\d+/)[0]:String(e).match(/\d+/)[0],i=String(e).substr(t.length);let r=t.padStart(4," ")+" - "+i;n.push(r)}),n.join("\n")}catch(t){return e}},Mc=e=>{let t=XC(e).split(/[\s\n]+/),n={};for(let e=0;e<t.length;e++){let i=GC(t[e]),r=parseInt(t[e]);r=isNaN(r)?0:r,n[i]?n[i]+=r:n[i]=r}return n},Dc=document.getElementById("technical-data-modal-trigger"),Oc=document.getElementById("technical-data-modal");let $c,jc,Wc,Hc,qc,Uc,zc,Vc,Yc,Gc,Jc,Xc,Kc,Zc,Qc,eu,tu,nu,iu,ru,au,lu={warpWeavingShrinkage:0,weftFinishShrinkage:0,warpFinishShrinkage:0,weftWeavingShrinkage:0,warpWastage:0,weftWastage:0,warpOnLoomEpi:0,weftOnLoomEpi:0,reedSpaceOnLoomEpi:0,warpGriegeEpi:0,weftGriegeEpi:0,grayWidth:0,warpFinishEpi:0,weftFinishEpi:0,finishWidth:0},ou={sortNo:"",orderNo:"",deliveryDate:"",weave:"",customerName:"",checkedBy:""},su={"warp-loom-epi":"","warp-weaving-shrinkage":"","warp-greige-epi":"","warp-finish-shrinkage":"","warp-finish-epi":"","warp-wastage":"","weft-loom-epi":"","weft-weaving-shrinkage":"","weft-greige-epi":"","weft-finish-shrinkage":"","weft-finish-epi":"","weft-wastage":"","tech-reed-space":"","warp-gray-width":"","warp-finish-width":""};const du=e=>{const t=e.target.id,n=e.target.value;isNaN(Number(n))?e.target.value=isNaN(su[t])?0:su[t]:(su[t]=n,pu(t))},cu=(e,t)=>(t||(t=0),(100*e/(100-(t=Number(t)))).toFixed(2)),uu=(e,t)=>0===Number(e)||isNaN(e)?0:(t||(t=0),(100-100*(t=Number(t))/(e=Number(e))).toFixed(2)),pu=e=>{if("warp-weaving-shrinkage"==e)su["weft-greige-epi"]=cu(su["weft-loom-epi"],su[e]),su["weft-finish-epi"]=cu(su["weft-greige-epi"],su["warp-finish-shrinkage"]);else if("warp-greige-epi"==e)su["weft-weaving-shrinkage"]=uu(su[e],su["warp-loom-epi"]),su["warp-finish-epi"]=cu(su[e],su["weft-finish-shrinkage"]),su["warp-gray-width"]=(Number(Wc)/Number(su["warp-greige-epi"])).toFixed(2),su["warp-finish-width"]=(Number(Wc)/Number(su["warp-finish-epi"])).toFixed(2);else if("warp-finish-shrinkage"==e)su["weft-finish-epi"]=cu(su["weft-greige-epi"],su[e]);else if("warp-finish-epi"==e)su["weft-finish-shrinkage"]=uu(su[e],su["warp-greige-epi"]),su["warp-finish-width"]=(Number(Wc)/Number(su["warp-finish-epi"])).toFixed(2);else if("weft-weaving-shrinkage"==e)su["warp-greige-epi"]=cu(su["warp-loom-epi"],su[e]),su["warp-finish-epi"]=cu(su["warp-greige-epi"],su["weft-finish-shrinkage"]),su["warp-gray-width"]=(Number(Wc)/Number(su["warp-greige-epi"])).toFixed(2),su["warp-finish-width"]=(Number(Wc)/Number(su["warp-finish-epi"])).toFixed(2);else if("weft-greige-epi"==e)su["warp-weaving-shrinkage"]=uu(su[e],su["weft-loom-epi"]),su["weft-finish-epi"]=cu(su[e],su["warp-finish-shrinkage"]);else if("weft-finish-shrinkage"==e)su["warp-finish-epi"]=cu(su["warp-greige-epi"],su[e]),su["warp-finish-width"]=(Number(Wc)/Number(su["warp-finish-epi"])).toFixed(2);else if("weft-finish-epi"==e)su["warp-finish-shrinkage"]=uu(su[e],su["weft-greige-epi"]);else{if("warp-gray-width"==e)return su["warp-greige-epi"]=(Number(Wc)/Number(su[e])).toFixed(2),void pu("warp-greige-epi");if("warp-finish-width"==e)return su["warp-finish-epi"]=(Number(Wc)/Number(su[e])).toFixed(2),void pu("warp-finish-epi")}hu()},hu=()=>{for(let e in su){let t=document.getElementById(e);t&&(t.value=su[e])}eu.value=ou.sortNo,tu.value=ou.orderNo,nu.value=ou.deliveryDate,iu.value=ou.weave,ru.value=ou.customerName,au.value=ou.checkedBy},gu=e=>{"Escape"===e.key&&mu()},mu=()=>{document.removeEventListener("keydown",gu),Oc.style.display="none",(()=>{let e=document.getElementById("technical-data-fabric-tab-content").querySelectorAll("input");for(let t=0;t<e.length;t++)e.item(t).removeEventListener("change",du)})()},fu=()=>{lu.warpFinishShrinkage=su["warp-finish-shrinkage"],lu.warpWeavingShrinkage=su["warp-weaving-shrinkage"],lu.weftWeavingShrinkage=su["weft-weaving-shrinkage"],lu.weftFinishShrinkage=su["weft-finish-shrinkage"],lu.warpWastage=su["warp-wastage"],lu.weftWastage=su["weft-wastage"],lu.warpOnLoomEpi=su["warp-loom-epi"],lu.weftOnLoomEpi=su["weft-loom-epi"],lu.reedSpaceOnLoomEpi=su["tech-reed-space"],lu.warpGriegeEpi=su["warp-greige-epi"],lu.weftGriegeEpi=su["weft-greige-epi"],lu.warpFinishEpi=su["warp-finish-epi"],lu.weftFinishEpi=su["weft-finish-epi"],lu.grayWidth=su["warp-gray-width"],lu.finishWidth=su["warp-finish-width"],ou.checkedBy=au.value,ou.customerName=ru.value,ou.deliveryDate=nu.value,ou.orderNo=tu.value,ou.sortNo=eu.value,ou.weave=iu.value,mu()},yu=()=>{document.addEventListener("keydown",gu),Uf(),(()=>{let e=document.querySelectorAll(".technical-data-tabs h3"),t=document.querySelectorAll(".technical-data-contents section");e.length>0&&t.length>0&&(e[0].classList.add("active"),t[0].classList.add("active"),t[0].style.display="block",t[1].style.display="none",e.forEach((n,i)=>{n.addEventListener("click",()=>{t.forEach(e=>{e.classList.remove("active"),e.style.display="none"}),e.forEach(e=>{e.classList.remove("active")}),t[i].classList.add("active"),t[i].style.display="block",e[i].classList.add("active")})}))})(),(()=>{const e=Ph();Wc=Ju(),su["warp-loom-epi"]=e,su["weft-loom-epi"]=Bh();let t=Wc/e;su["tech-reed-space"]=t.toFixed(2),su["warp-weaving-shrinkage"]=lu.warpWeavingShrinkage,su["warp-finish-shrinkage"]=lu.warpFinishShrinkage,su["weft-weaving-shrinkage"]=lu.weftWeavingShrinkage,su["weft-finish-shrinkage"]=lu.weftFinishShrinkage,su["warp-wastage"]=lu.warpWastage,su["weft-wastage"]=lu.weftWastage,pu("warp-weaving-shrinkage"),pu("weft-weaving-shrinkage"),pu("weft-finish-shrinkage"),pu("warp-finish-shrinkage"),su["warp-gray-width"]=(Number(Wc)/Number(su["warp-greige-epi"])).toFixed(2),su["warp-finish-width"]=(Number(Wc)/Number(su["warp-finish-epi"])).toFixed(2)})(),hu(),(()=>{let e=document.getElementById("technical-data-fabric-tab-content").querySelectorAll("input");for(let t=0;t<e.length;t++)e.item(t).addEventListener("change",du)})(),Oc.style.display="block",Oc.style.animation="slide-down 0.3s ease"},vu="draft-table-shaft",bu="draft-table-ends",wu="draft-table-dent",Eu="draft-table-pattern",Su="draft-table-bodytype",xu="draft-table-innerrepeat",Iu="draft-table-outerrepeat",ku="draft-table-frsr",_u="draft-table-empty",Tu="draft-table-all-repeat";let Nu=[vu,bu,wu,Eu,Tu,xu,Iu,ku,Su,_u],Cu=[[Tu,xu,Iu,ku,_u],[vu],[bu],[wu],[Eu]];const Lu=document.getElementById("File-menu");document.getElementById("fabric-quality");let Au=!0,Pu=0,Bu=0,Ru="",Fu={tar:0,dent:0},Mu="";let Du=[{color:"red",yarndetail:"4272 ABC Yarn"},{color:"red",yarndetail:"4272 ABC Yarn"},{color:"red",yarndetail:"4272 ABC Yarn"}],Ou=[{color:"red",yarndetail:"1 ABC Yarn"},{color:"red",yarndetail:"1 ABC Yarn"},{color:"red",yarndetail:"1 ABC Yarn"}],$u=[],ju=[],Wu=[],Hu=[],qu=[{label:"Design Name",value:"ABC",key:"designName"},{label:"Fabric Quality",value:"ABC",key:"fabricQuality"},{label:"Shaft",value:"ABC",key:"shaft"},{label:"Total Dent",value:"ABC",key:"totalDent"},{label:"EPI",value:"ABC",key:"epi"},{label:"Avg.EPI",value:"ABC",key:"avgEpi"},{label:"Warp",value:"ABC",key:"warp"},{label:"Reed/2 in",value:"ABC",key:"reedPerTwoinch"},{label:"Reed Space",value:"ABC",key:"reedSpace"},{label:"Total Ends",value:"ABC",key:"totalEnds"},{label:"Total Picks",value:"ABC",key:"totalPicks"},{label:"PPI",value:"ABC",key:"ppi"},{label:"Avg PPI",value:"ABC",key:"avgPpi"},{label:"Weft",value:"ABC",key:"weft"},{label:"Party Name",value:"ABC",key:"partyName"},{label:"Designer Name",value:"ABC",key:"designerName"},{label:"Order No",value:"ABC",key:"orderNumber"},{label:"GSM",value:"ABC",key:"gsm"},{label:"GLM",value:"ABC",key:"glm"}],Uu=!1;const zu=(e,t,n)=>{if(!Qy.isFullReedSpaceVisible||!Qy.isSalvageVisible)return"";let i="";const r=document.createElement("tr");console.log("left salavage data is",t);for(let i=0;i<e.length;i++){const a=document.createElement("td");"Part"==e[i]?a.innerHTML=t.partName:"Dent"==e[i]?(a.innerHTML=t.dent,a.classList.add("dentColumn"),n.dent+=Number(t.dent)):"Ends"==e[i]?(a.classList.add("endsColumn"),a.innerHTML=t.ends,n.ends+=Number(t.ends)):"Repeat"==e[i]?a.innerHTML="":"Size"==e[i]?(a.innerHTML=t.size,n.size+=Number(t.size)):(a.innerHTML=t.usedYarns[e[i]]?t.usedYarns[e[i]]:"",n.usedYarns[e[i]]?n.usedYarns[e[i]]+=t.usedYarns[e[i]]?Number(t.usedYarns[e[i]]):0:n.usedYarns[e[i]]=t.usedYarns[e[i]]?Number(t.usedYarns[e[i]]):0),r.appendChild(a)}return i+=`<tr>${r.innerHTML}</tr>`,i},Vu=(e,t,n)=>{if(console.log("rigjht salavage data is",t),!Qy.isFullReedSpaceVisible||!Qy.isSalvageVisible)return"";let i="";const r=document.createElement("tr");for(let i=0;i<e.length;i++){const a=document.createElement("td");"Part"==e[i]?a.innerHTML=t.partName:"Dent"==e[i]?(a.classList.add("dentColumn"),a.innerHTML=t.dent,n.dent+=Number(t.dent)):"Ends"==e[i]?(a.innerHTML=t.ends,a.classList.add("endsColumn"),n.ends+=Number(t.ends)):"Repeat"==e[i]?a.innerHTML="":"Size"==e[i]?a.innerHTML=t.size:(a.innerHTML=t.usedYarns[e[i]]?t.usedYarns[e[i]]:"",n.usedYarns[e[i]]?n.usedYarns[e[i]]+=t.usedYarns[e[i]]?Number(t.usedYarns[e[i]]):0:n.usedYarns[e[i]]=t.usedYarns[e[i]]?Number(t.usedYarns[e[i]]):0,a.innerHTML=t.usedYarns[e[i]]?t.usedYarns[e[i]]:""),r.appendChild(a)}return i+=`<tr>${r.innerHTML}</tr>`,i},Yu=(e,t)=>{if(!Qy.isTotalVisible)return"";let n="";const i=document.createElement("tr");for(let n=0;n<e.length;n++){const r=document.createElement("td");"Part"==e[n]?r.innerHTML=t.partName:"Dent"==e[n]?(r.classList.add("dentColumn"),r.innerHTML=t.dent):"Ends"==e[n]?(r.classList.add("endsColumn"),r.innerHTML=t.ends):"Repeat"==e[n]?r.innerHTML="":"Size"==e[n]?r.innerHTML=Number(t.size).toFixed(2):r.innerHTML=t.usedYarns[e[n]]?t.usedYarns[e[n]]:"",i.appendChild(r)}return n+=`<tr>${i.innerHTML}</tr>`,n},Gu=(e,t,n)=>{let i="",r=Array.isArray(e.withInnerRepeat)?e.withInnerRepeat:[];n.size+=Number(e.size?e.size:"0");for(let a=0;a<r.length;a++){const l=document.createElement("tr");for(let i=0;i<t.length;i++){const o=document.createElement("td");if("Part"==t[i])o.innerHTML=r[a].partName;else if("Dent"==t[i])o.innerHTML=r[a].dent,o.classList.add("dentColumn"),n.dent+=r[a].dent*Number(e.outerRepeat);else if("Ends"==t[i])o.innerHTML=r[a].ends,o.classList.add("endsColumn"),n.ends+=r[a].ends*Number(e.outerRepeat);else if("Repeat"==t[i]){if(0!=a)continue;o.innerHTML=e.outerRepeat,o.rowSpan=r.length}else if("Size"==t[i]){if(0!=a)continue;o.innerHTML=e.size,o.rowSpan=r.length}else o.innerHTML=r[a].usedYarns[t[i]]?r[a].usedYarns[t[i]]:"",n.usedYarns[t[i]]?n.usedYarns[t[i]]+=r[a].usedYarns[t[i]]?Number(r[a].usedYarns[t[i]])*Number(e.outerRepeat):0:n.usedYarns[t[i]]=r[a].usedYarns[t[i]]?Number(r[a].usedYarns[t[i]])*Number(e.outerRepeat):0;l.appendChild(o)}i+=`<tr>${l.innerHTML}</tr>`}return console.log("output string ios",i),i},Ju=()=>{let e=GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1),t=XC(e),n=tL(t);const i=String(t).split("\n").filter(e=>e.length>0).length,r=parseInt(Number(zO.value)/Number(gh.value)*Number(eh.value));let a=String(Math.floor(r/Number(i))),l=r%Number(i),o=GO.new_get_extra_draft_data(ZO,l),s=n*a+tL(XC(o));return Number(Nr.value)&&(s+=Number(Nr.value)),Number(Jr.value)&&(s+=Number(Jr.value)),s},Xu=e=>{let t=[];return Array.isArray(e)&&Nu.forEach(n=>{let i=e.find(e=>e.key==n);i&&t.push(i)}),t};function Ku(){if(Au)return(()=>{let e=Array.isArray(wy)&&wy.length>0?wy[0].tableColumns:[],t=JSON.stringify(Ec)!=JSON.stringify(Sc),n=[{partName:t?"Left Selvedge":"Selvedge",partDraftPlan:Ec.draftPlan,partWarpSeq:Ec.warpSeq,partEnds:hC(XC(Ec.draftPlan)),partDents:eL(XC(Ec.draftPlan))},...t?[{partName:"Right Selvedge",partDraftPlan:Sc.draftPlan,partWarpSeq:Sc.warpSeq,partEnds:hC(XC(Sc.draftPlan)),partDents:eL(XC(Sc.draftPlan))}]:[]],i={partName:"Total",repeatedPart:"",dent:0,size:0,ends:0,usedYarns:{}};Ey.forEach(e=>{i.usedYarns[e]=0}),console.log("draftPartsData are",Kf),console.log("design with part data",wy);let r=[...Kf].map(e=>{let t=[];for(let n=0;n<e.partWarpSeq.length;n++)t.push(TC(e.partDraftPlan,e.partWarpSeq[n]));let n=t[0];return console.log("dentWiseDraftData output is",n),`<div class="each-part-container">\n          <div class="each-part-title">${e.partName}</div>\n          <div class="each-part-table-container">\n            <table class="each-part-table">\n              <tr>\n                <th>Draft</th>\n                <th class="dentColumn">Dent</th>\n                <th>Repeat</th>\n                ${t.map((e,t)=>`<th>Pattern - ${t+1}</th>`).join("")}\n               \n              </tr>\n              ${n.map((e,n)=>`<tr>\n                <td>${e.withInnerRepeat[0].repeatedPart.replace(/\n/g,"<br>")}</td>\n                <td class="dentColumn">${e.dent}</td>\n                <td>${e.outerRepeat}</td>\n                ${t.map((e,t)=>{let i=y$(y$(e[n].pattern));return`<td>${Qy.isYarnNameVisible?KC(i):i}</td>`}).join("")}\n              </tr>`).join("")}\n            </table>\n          </div>\n        </div>`}).join("");return`<div class="draft-with-part-container">\n      <div class="draft-with-part-first-column">\n        ${Qy.isFullReedSpaceVisible&&Qy.isSalvageVisible?[...n].map(e=>`<div class="each-part-container">\n          <div class="each-part-title">${e.partName}</div>\n          <div class="each-part-table-container">\n            <table class="each-part-table">\n              <tr>\n                <th>Draft</th>\n                <th class="dentColumn">Dent</th>\n                <th>Yarn Pattern</th>\n              </tr>\n              <tr>\n                <td>${e.partDraftPlan.replace(/\n/g,"<br>")}</td>\n                <td class="dentColumn">${e.partDents}</td>\n                <td>${Qy.isYarnNameVisible?KC(Array.isArray(e.partWarpSeq)?e.partWarpSeq.join("/\n").replace(/\n/g,"<br>"):e.partWarpSeq.replace(/\n/g,"<br>")):Array.isArray(e.partWarpSeq)?e.partWarpSeq.join("/\n").replace(/\n/g,"<br>"):e.partWarpSeq.replace(/\n/g,"<br>")}</td>\n              </tr>\n            </table>\n          </div>\n        </div>`).join(""):""}\n\n\n          ${r}\n      </div>\n      <div class="draft-with-part-second-column">\n      <table>\n      <tr>\n          ${Array.isArray(e)?e.map(e=>"Dent"==e?`<th class="dentColumn">${e}</th>`:"Ends"==e?`<th class="endsColumn">${e}</th>`:`<th>${Qy.isYarnNameVisible?Rc(e,"warp"):e}</th>`).join(""):""}  \n      </tr>\n      ${zu(e,Iy,i)}\n          ${wy.map(t=>Gu(t,e,i)).join("")}\n            ${Vu(e,ky,i)}\n          ${Yu(e,i)}\n        \n    </table>\n  \n      </div>\n  </div>`})();let e={},t={};Wu=YC(),console.log("table draft data is",Wu);const n=document.createElement("table");QN();let i="<tr>";Nu.forEach(e=>{e==vu&&(i+=`<th class="draftColumn"><pre>${rv("Shaft")}</pre></th>`),e==bu?i+=`<th class="endsColumn"><pre>${rv("Ends")}</pre></th>`:e==wu?i+=`<th class="dentColumn"><pre>${rv("Dent")}</pre></th>`:e==Eu?i+=`<th class="patternColumn"><pre>${rv("Pattern")}</pre></th>`:e==xu?i+=`<th class="firstRepeatColumn"><pre>${rv("Repeat")}</pre></th>`:e==Iu?i+=`<th class="secondRepeatColumn"><pre>${rv("Repeat")}</pre></th>`:e==ku&&(i+=`<th class="frsrColumn"><pre>${rv("FRSR")}</pre></th>`)}),i+="</tr>",n.innerHTML+=i;let r=!1,a=!1,l=!1,o=!1,s=!1,d=!1,c=!1,u=0,p=(GO.cols(),GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1)),h=XC(p);const g=String(h).split("\n").filter(e=>e.length>0).length,m=parseInt(Number(zO.value)/Number(gh.value)*Number(eh.value));let f=String(Math.floor(m/Number(g)));Ju(f,h),e.bodyRepeat=f,e.rightsalvage=Wu.find(e=>"Right Selvedge"==e.Part),e.leftsalvage=Wu.find(e=>"Left Selvedge"==e.Part),t=JSON.parse(JSON.stringify(e));let y=m%Number(g),v=0!=y&&f>0;Pu=f,Bu=v?y:0;{let e=m%Number(g),n=GO.new_get_extra_draft_data(ZO,e),i=tL(XC(n)),r=String(qC(!0)).split("\n").slice(0,hC(n)).join("\n"),a={draft:{outerRepeat:1,pattern:y$(r),withInnerRepeat:[{repeatedPart:n,dent:eL(XC(n)),pattern:y$(r),ends:i,innerRepeat:1}]},dent:eL(XC(n)),tar:i,pattern:"Pattern",Part:"Extra"},l=[];if(String(n).includes("X")){let e=EC(n);Array.isArray(e)&&e.forEach(e=>{l.push({...a,draft:e})})}else l=[a];t.extrapart=a}if(v&&Qy.isFullReedSpaceVisible){let t=Wu.filter(e=>"Right Selvedge"!=e.Part),n=Wu.find(e=>"Right Selvedge"==e.Part),i=m%Number(g),r=GO.new_get_extra_draft_data(ZO,i),a=tL(XC(r));console.log("extra draft string is",r);let l=String(qC(!0)).split("\n").slice(0,hC(XC(r))).join("\n");Ru=y$(l);let o={draft:{outerRepeat:1,pattern:y$(l),withInnerRepeat:[{repeatedPart:r,dent:eL(XC(r)),pattern:y$(l),ends:a,innerRepeat:1}]},dent:eL(XC(r)),tar:a,pattern:"Pattern",Part:"Extra"},s=[];if(String(r).includes("X")){let e=EC(r);Array.isArray(e)&&e.forEach(e=>{s.push({...o,draft:e})})}else s=[o];e.extrapart=o,t=[...t,...s],t=t.map(e=>("Body"==e.Part&&(e.tar=String(Number(e.tar)-a)),e)),n&&t.push(n),Wu=t}console.log("tableDraftData after isExtraNeeded is",Wu);let b=o$.cells,w=oC(Wu,"Body"),E=oC(Wu,"Extra"),S=0,x=!1;Uu=!1,Wu.forEach(e=>{let t=e.draft.outerRepeat,i=e.draft.withInnerRepeat,p=0;"Extra"==e.Part&&(x||(x=!0,S=0)),Array.isArray(i)&&i.forEach((h,g)=>{const m=document.createElement("tr");let y=[];const v=document.createElement("td");v.style.paddingTop="1px",v.style.paddingBottom="1px";const x=document.createElement("pre");let I=VC(h.repeatedPart),k=0;!Qy.isExtraWarpHighlighted||"Body"!=e.Part&&"Extra"!=e.Part?x.innerHTML=I.replace(/\n/g,"<br>"):x.innerHTML=I.replace(/(\d+)/g,e=>{let t=!1;return b.find(e=>e.index==k+S)&&(t=!0),k++,Qy.extraWarpPrintStyle==Fi?`<span style="text-decoration: ${t?"underline":"auto"}">${e}</span>`:`<span style="color: ${t?"red":"black"}">${e}</span>`}).replace(/\n/g,"<br>"),["Body","Extra"].includes(e.Part)&&(S+=h.ends,p+=h.ends),["Body","Extra"].includes(e.Part)&&i.length==g+1&&(S=S-p+e.draft.ends),v.appendChild(x),y.push({key:vu,value:v});const _=document.createElement("td"),T=document.createElement("pre");T.innerHTML=h.ends,_.appendChild(T),_.classList.add("endsColumn"),y.push({key:bu,value:_});const N=document.createElement("td"),C=document.createElement("pre");C.innerHTML=h.dent,N.appendChild(C),N.classList.add("dentColumn"),y.push({key:wu,value:N});const L=document.createElement("td"),A=document.createElement("pre");A.innerHTML=Qy.isYarnNameVisible?KC(SC(h.pattern,!0)):SC(h.pattern,!0),L.appendChild(A),L.classList.add("patternColumn"),y.push({key:Eu,value:L});const P=document.createElement("td"),B=document.createElement("pre");if(B.innerHTML=1==h.innerRepeat?Qy.isShowSingleRepeat?h.innerRepeat:"":h.innerRepeat,Uu||h.innerRepeat>1&&(Uu=!0),P.appendChild(B),P.classList.add("firstRepeatColumn"),y.push({key:xu,value:P}),Object.keys(e).forEach(t=>{if("draft"!=t){if("Part"==t&&!a&&"Body"==e.Part){const e=document.createElement("td");return e.classList.add("designTypeColumn"),e.innerText="Body",e.setAttribute("rowspan",w),a=!0,void y.push({key:Su,value:e})}if("Part"==t&&a&&"Body"==e.Part)return;if("pattern"==t)return;if("tar"==t)return;if("dent"==t)return;if("topbeam"==t)return;if("Part"==t&&!c&&"Extra"==e.Part){const e=document.createElement("td");return e.classList.add("designTypeColumn"),e.innerText="Extra",e.setAttribute("rowspan",E),c=!0,void y.push({key:Su,value:e})}if("Part"==t&&c&&"Extra"==e.Part)return;if("dent"==t&&!l&&"Extra"==e.Part){const n=document.createElement("td");return n.innerHTML=e[t],n.classList.add("dentColumn"),n.setAttribute("rowspan",E),l=!0,void y.push({key:wu,value:n})}if("dent"==t&&l&&"Extra"==e.Part)return;if("tar"==t&&!s&&"Extra"==e.Part){const n=document.createElement("td");return n.classList.add("endsColumn"),n.innerHTML=e[t],n.setAttribute("rowspan",E),s=!0,void y.push({key:bu,value:n})}if("tar"==t&&s&&"Extra"==e.Part)return;if("pattern"==t&&!o&&"Extra"==e.Part){const t=document.createElement("td");return t.classList.add("patternColumn"),t.innerHTML=Qy.isYarnNameVisible?KC(e.draft.pattern):e.draft.pattern,t.setAttribute("rowspan",E),y.push({key:Eu,value:t}),void(o=!0)}if("pattern"==t&&o&&"Extra"==e.Part)return}}),0==u){const e=document.createElement("td");u=i.length;const n=document.createElement("pre");n.innerHTML=1==t?Qy.isShowSingleRepeat?t:"":t,e.appendChild(n),e.classList.add("secondRepeatColumn"),e.setAttribute("rowspan",u),y.push({key:Iu,value:e})}if(u>0&&u--,["Left Selvedge","Right Selvedge"].includes(e.Part)){m.classList.add("salvageColumn");const e=document.createElement("td"),t=document.createElement("pre");t.innerHTML=1,e.appendChild(t),e.classList.add("frsrColumn"),y.push({key:ku,value:e})}if("Extra"==e.Part&&!d){const e=document.createElement("td"),t=document.createElement("pre");t.innerHTML=1,e.appendChild(t),e.classList.add("frsrColumn"),e.setAttribute("rowspan",E),d=!0,y.push({key:ku,value:e})}if(!r&&"Body"==e.Part){const e=document.createElement("td"),t=document.createElement("pre");t.innerHTML=f,e.appendChild(t),e.setAttribute("rowspan",w),e.classList.add("frsrColumn"),y.push({key:ku,value:e}),r=!0}Xu(y).forEach(e=>{m.appendChild(e.value)}),n.appendChild(m)})}),console.log("table Draft data is",Wu);let I=[...new Set(Wu.map(e=>e.Part))];I=I.sort();let k=0,_=0;I.forEach(e=>{let t=Wu.filter(t=>t.Part==e);if("Body"==e)t.forEach(e=>{e.draft.withInnerRepeat.forEach(t=>{_+=t.ends*e.draft.outerRepeat,k+=t.dent*e.draft.outerRepeat})}),Number(f)>0&&Qy.isFullReedSpaceVisible&&(_*=Number(f),k*=Number(f));else if(["Left Selvedge","Right Selvedge"].includes(e)){if(!Qy.isFullReedSpaceVisible||!Qy.isSalvageVisible)return;t.forEach(e=>{e.draft.withInnerRepeat.forEach(e=>{_+=e.ends,k+=e.dent})})}else t.forEach(e=>{e.draft.withInnerRepeat.forEach(t=>{_+=t.ends*e.draft.outerRepeat,k+=t.dent*e.draft.outerRepeat*t.innerRepeat})})});let T=[];const N=document.createElement("tr");N.classList.add("totalRow");const C=document.createElement("td");C.id="draft-total-text-element",C.innerHTML=`<pre>${rv("Total")}</pre>`,T.push({key:vu,value:C});const L=document.createElement("td");L.classList.add("endsColumn"),L.innerHTML=`<pre>${_}\n${rv("Ends")}</pre>`,Fu.tar=_,T.push({key:bu,value:L});const A=document.createElement("td");A.classList.add("dentColumn"),Fu.dent=k,A.innerHTML=`<pre>${k}\n${rv("Dent")}</pre>`,T.push({key:wu,value:A});const P=document.createElement("td");P.classList.add("patternColumn");const B=document.createElement("pre"),R=Bv(e,!1);Mu=Bv(t,!0),B.innerHTML=Qy.isYarnNameVisible?KC(Fc(R)):Fc(R),P.appendChild(B),T.push({key:Eu,value:P});const F=document.createElement("td");let M=0;return Qy.isInnerRepeatVisible&&(M+=1),Qy.isOuterRepeatVisible&&(M+=1),Qy.isFRSRVisible&&(M+=1),F.id="repeatFooterElement",M>0?(F.setAttribute("colspan",M),F.style.display="table-cell"):F.style.display="none",T.push({key:_u,value:F}),Xu(T).forEach(e=>{N.appendChild(e.value)}),n.appendChild(N),(e=>{let t=[];t.push(Number(Yp.value)),t.push(Number(Jp.value));let n=String(e).trim().split("\n"),i=GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1);for(let e=0;e<n.length;e++)"#"!=n[e].trim()&&t.push(n[e].trim().split(" ").filter(e=>"#"!=e).length);t=[...new Set(t)].filter(e=>e).sort(),String(i).includes("#")&&t.push("#");JSON.parse(localStorage.getItem("user")),JSON.parse(localStorage.getItem("company")),n.length;let r=((KO.rows()-l$.cells.length)/Number(lh.value)).toFixed(2),a=((n.length/Number(gh.value)).toFixed(2),Ju()-Number(Nr.value)-Number(Jr.value)),l=eh.value,o=Number(a/Number(l)).toFixed(2),s=l$.cells.length?(KO.rows()/r).toFixed(2):Number(lh.value).toFixed(2),d=Number(eh.value)+Number(Up.value)+Number(qp.value),c=String(d.toFixed(2))+(Number(Up.value)+Number(qp.value)?` = ${Number(eh.value).toFixed(2)} + ${(Number(Up.value)+Number(qp.value)).toFixed(2)}`:"");qu=[{label:"Design Name",value:DE.innerText,key:"designName"},{label:"Shaft",value:GO.rows(),key:"shaft"},{label:"Reed Space",value:c,key:"reedSpace"},{label:`Reed/${gh.value} in`,value:`${zO.value}${t.map(e=>"/"+e).join("")}`,key:"reedPerTwoinch"},{label:"Avg EPI",value:o,key:"avgEpi"},{label:"Total Dent",value:Qp.value,key:"totalDent"},{label:"Pick",value:lh.value,key:"totalPicks"},{label:"Avg.PPI",value:s,key:"avgPpi"},{label:"Total Ends",value:Ju(),key:"totalEnds"}]})(h),`<table class="draft-numeric-table">${n.innerHTML}</table>`}const Zu=e=>{let t=JSON.parse(JSON.stringify(e)),n=Qy.removeShaftElement;return t.forEach((e,t)=>{let i=e.pegplan.split("\n"),r="";i.forEach((e,t)=>{let i=String(e).split(",");i.forEach((e,a)=>{let l=n.filter(t=>Number(t)<Number(e));-1==n.findIndex(t=>Number(t)==Number(e))&&(r+=String(Number(e)-l.length)+""+(a!=i.length-1?",":"")+(0==t&&a==i.length-1?"\n":""))}),0==r.length&&(r+="\n")}),e.pegplan=r}),t};function Qu(e){if(Qy.pegplanViewType==yi.GRAPHICALNOWITHNUMERICNO){let t="",n=0,i=0,r=document.createElement("table"),a=0,l=d$.cells,o=d$.size,s=Zu(e);Qy.pegplanSorting==Ri&&(s.reverse(),s.forEach(e=>{let t=e.pegplan.split("\n");e.pegplan=t.reverse().join("\n")}));Math.max(...s.map(e=>Number(e.no)));return s.forEach((e,d)=>{let c=String(e.pegplan).replace(/\n/g,"<br>");const u=document.createElement("tr");u.setAttribute("valign","center"),u.classList.add("pegplan-print-row"),u.style.height="15px";const p=document.createElement("td");p.classList.add("pegplan-no"),p.textContent=e.no,p.setAttribute("width","65"),u.appendChild(p);const h=document.createElement("td");c.trimEnd().split(/<br>|\n/).forEach(e=>{const t=document.createElement("div");if(t.innerHTML=e,t.style.height="20px",Qy.isUncompreesed&&Qy.isWeftColor){let e=l.find(e=>e.index==o-a-1);t.style.color=$s[e.color_code],a++}h.appendChild(t)}),h.style.paddingLeft="1px",h.classList.add("pegplan-cell"),h.setAttribute("width","400"),u.appendChild(h),r.appendChild(u),n+=1,40==n?(i+=1,t+=`<table class="pegplan-table" style="page-break-after: ${i%2==0&&i>0?"always":"auto"};">${r.innerHTML}</table>`,n=0,r=document.createElement("table")):s.length-1==d&&(t+=`<table class="pegplan-table">${r.innerHTML}</table>`)}),t}return""}const ep=e=>{let t=[yi.GRAPHICALNOWITHNUMERICYES,yi.GRAPHICALYESWITHNUMERICYES].includes(Qy.pegplanViewType),n=[yi.GRAPHICALYESWITHNUMERICNO,yi.GRAPHICALYESWITHNUMERICYES].includes(Qy.pegplanViewType),i=n?"white":"black",r=FC();console.log("fidder color object is",r);const a=KO.cols();let l=Zu(e);console.log("value of col is",a);const o=Qy.isTwoPickLetisEnabled?2*l.length:l.length,s=Dn,d=On,c=document.createElement("canvas");c.width=6*Math.ceil(18*a),c.height=6*Math.ceil(18*o);const u=c.getContext("2d");u.scale(6,6);for(let e=0;e<a+1;e++)u.beginPath(),u.strokeStyle="black",u.moveTo(s+18*e,d),u.lineTo(s+18*e,d+18*o),u.stroke(),u.closePath();for(let e=0;e<o+1;e++)u.beginPath(),u.strokeStyle="black",u.moveTo(s,d+18*e),u.lineTo(s+18*a,d+18*e),u.stroke(),u.closePath();console.log("windoe device pixel ration is",window.devicePixelRatio),Qy.pegplanSorting==Ri&&(l.reverse(),l.forEach(e=>{let t=e.pegplan.split("\n");e.pegplan=t.reverse().join("\n")}));Qy.isCreaming&&Array.isArray(l$.cells)&&l$.cells;let p=gi.start,h=0;l.forEach((e,r)=>{if(Qy.isTwoPickLetisEnabled){let a=String(e.pegplan).includes("\n")?"\n":"<br>",l=(Number(e.no),d$.cells),o=d$.size;String(e.pegplan).split(a).forEach((e,a)=>{let s,c=2*r+a,g=p>0&&String(e).includes(p);Qy.isWeftColor&&(s=l.find(e=>o-e.index-1==h));let m=s?$s[s.color_code]:"black";h++;let f=g?"#ff5e00":m;e.split(",").forEach(e=>{let r=18*(e-1),a=18*c;n&&(u.fillStyle=f,u.fillRect(r+2,a+d+2,14,14)),t&&(u.textAlign="center",u.fillStyle=i,u.font="bold 12px sans-serif",u.fillText(e,r+9,a+13+d))})})}else{let a=r,l=(Number(e.no),p>0&&String(e.pegplan).includes(p));String(e.pegplan).split(",").forEach(e=>{let r=18*(e-1),o=18*a;if(n){if(u.fillStyle="black",Qy.isUncompreesed){let e;Qy.isWeftColor&&(e=d$.cells.find(e=>e.index==d$.size-h-1)),u.fillStyle=e?$s[e.color_code]:"black"}u.fillStyle=l?"#ff5e00":u.fillStyle,u.fillRect(r+2,o+2,14,14)}t&&(u.textAlign="center",u.fillStyle=i,u.font="bold 12px sans-serif",u.fillText(e,r+9,o+13))}),h++}}),u.translate(.5,.5);const g=document.createElement("canvas"),m=g.getContext("2d"),f=l.length,y=Qy.isTwoPickLetisEnabled?36:18;g.width=432,g.height=f*y*6,m.scale(6,6);for(let e=0;e<2;e++)m.beginPath(),m.strokeStyle="black",m.moveTo(s+72*e,d),m.lineTo(s+72*e,d+o*y),m.stroke(),m.closePath();Qy.isTwoPickLetisEnabled&&(m.font="bold 18px sans-serif");Math.max(...l.map(e=>Number(e.no)));for(let e=0;e<f+1;e++)m.beginPath(),m.strokeStyle="black",m.moveTo(s,d+e*y),e>0&&(m.textAlign="center",m.fillText(l[e-1].no,s+36,d+e*y-y/3)),m.lineTo(s+72*a,d+e*y),m.stroke(),m.closePath();const v=document.createElement("canvas");v.width=g.width+c.width,v.height=c.height;const b=v.getContext("2d");b.drawImage(g,0,0),b.drawImage(c,g.width,0),b.translate(.5,.5),v.style.transform=`scale(${parseFloat(1/6).toString()})`;const w=Math.ceil(v.height/8640);let E=document.querySelector(".design-pegplan");E.style.overflow="hidden";for(let e=0;e<w;e++){const t=document.createElement("div"),n=document.createElement("table");n.style.marginLeft="48px",n.style.width="auto";const i=document.createElement("tr");for(let e=0;e<a;e++){const t=document.createElement("th");t.style.width="12px",t.style.fontSize="12px",t.style.border="1px solid black",t.style.fontFamily="Rubik",t.style.padding=0,t.style.textAlign="center",t.innerHTML=e+1,i.appendChild(t)}n.appendChild(i);const r=document.createElement("canvas"),l=r.getContext("2d"),o=108,c=108;r.height=o,r.width=c*a;const u=2;for(let e=0;e<a+1;e++)l.beginPath(),l.strokeStyle="black",l.moveTo(s+e*c,d),l.lineTo(s+e*c,d+u*o),l.textAlign="center",l.font="bold 72px Rubik",l.fillText(e+1,s+e*c+c/2,o/4*3),l.stroke(),l.closePath();for(let e=0;e<u+1;e++)l.beginPath(),l.strokeStyle="black",l.moveTo(s,d+e*o),l.lineTo(s+a*c,d+e*o),l.stroke(),l.closePath();const p=l.getImageData(0,0,r.width,r.height),h=b.getImageData(0,1440*e*6,v.width,1==w?v.height:8640),g=document.createElement("canvas");g.width=h.width,g.height=h.height+108;const m=g.getContext("2d");g.style.transformOrigin="top left",m.putImageData(p,432,0),m.putImageData(h,0,108),g.style.transform=`scale(${parseFloat(1/6).toString()})`,t.appendChild(g),t.style.height=g.height/6+16+"px",t.style.width=g.width/6+16+"px",E.appendChild(t)}E.style.display="grid",E.style.gridTemplateColumns=a>20?"1fr":"1fr 1fr",E.style.width="auto"};function tp(e,t){e=String(e).replace(/\*/g,"X");let n=yC(e);if("warp"==t&&Qy.isFullReedSpaceVisible){n.forEach(e=>{e.frsr=Pu}),console.log("frsrExtraPattern",Ru);let e=yC(Ru);e.forEach(e=>{e.part="extra",e.frsr=1}),n=[...n,...e]}if("warp"==t&&Qy.isFullReedSpaceVisible&&Qy.isSalvageVisible){let e=Number(Nr.value)/Number(Yp.value),t=Number(Jr.value)/Number(Jp.value);if(console.log("leftWarpSeqSalvageElement",yc.value),e>0&&yc.value){let e=""+yc.value;e=String(e).replace(/\*/g,"X");let t=yC(e);t.forEach(e=>{e.part="leftSalvage"}),n=[...t,...n]}if(t>0&&vc.value){let e=""+vc.value;e=String(e).replace(/\*/g,"X");let t=yC(e);t.forEach(e=>{e.part="rightSalvage"}),n=[...n,...t]}}const i=document.createElement("table"),r=document.createElement("tr"),a=document.createElement("th");a.innerHTML=`<pre>${av("Ends - Yarn")}</pre>`,a.style.textAlign="center",a.style.whiteSpace="pre",r.appendChild(a);const l=document.createElement("th");l.innerHTML=`<pre>${av("Repeat")}</pre>`,l.style.textAlign="center",r.appendChild(l);const o=document.createElement("th");if(o.innerHTML=`<pre>${av("Repeat")}</pre>`,o.style.textAlign="center",r.appendChild(o),Qy.isFullReedSpaceVisible&&"warp"==t){const e=document.createElement("th");e.innerHTML=`<pre>${av("Repeat")}</pre>`,e.style.textAlign="center",r.appendChild(e)}let s=!1,d=!1;i.appendChild(r),console.log("seqStringWithRepeat",n),n.forEach((e,r)=>{let a=e.outerRepeat,l=e.frsr;e.innerParts.forEach((r,o)=>{let c=String(r.currentPart).trim(),u=r.innerRepeat,p=String(c).split(" ");p.forEach((r,c)=>{const h=document.createElement("tr");h.setAttribute("valign","top");const g=document.createElement("td");g.classList.add("pegplan-no");let m=Fc(r).replaceAll("\n","<br>"),f=isNaN(parseInt(m))?"1"+("weft"==t?QC(m):ZC(m)):"weft"==t?QC(m):ZC(m),y=document.createElement("pre");if(y.innerHTML=f,g.appendChild(y),g.style.textAlign="left",h.appendChild(g),0==c){const e=document.createElement("td");e.style.paddingLeft="8px",e.innerHTML=`<pre>x ${u}</pre>`,e.rowSpan=p.length,e.style.textAlign="left",e.style.verticalAlign="middle",h.appendChild(e)}if(0==c&&0==o){let i=0;for(let t=0;t<e.innerParts.length;t++){i+=String(e.innerParts[t].currentPart).trim().split(" ").length}const r=document.createElement("td");if(r.style.paddingLeft="8px",r.rowSpan=i,r.innerHTML=`<pre>x ${a}</pre>`,r.style.textAlign="left",r.style.verticalAlign="middle",h.appendChild(r),Qy.isFullReedSpaceVisible&&"warp"==t)if("extra"!=e.part||d)if(e.part||s){if(["leftSalvage","rightSalvage"].includes(e.part)){const e=document.createElement("td");e.style.paddingLeft="8px",e.style.textAlign="left",e.style.verticalAlign="middle",h.appendChild(e)}}else{const e=document.createElement("td");if(e.style.paddingLeft="8px",l){const t=n.reduce((e,t)=>(!t.part&&Array.isArray(t.innerParts)&&t.innerParts.forEach(t=>{if(t.currentPart){const n=t.currentPart.trim().split(" ").length;e+=n}}),e),0);e.rowSpan=t,s=!0,e.innerHTML=`<pre>x ${l}</pre>`}e.style.textAlign="left",e.style.verticalAlign="middle",h.appendChild(e)}else{const e=document.createElement("td");if(e.style.paddingLeft="8px",l){const t=n.reduce((e,t)=>("extra"===t.part&&Array.isArray(t.innerParts)&&t.innerParts.forEach(t=>{if(t.currentPart){const n=t.currentPart.trim().split(" ").length;e+=n}}),e),0);e.rowSpan=t,d=!0,e.innerHTML=`<pre>x ${l}</pre>`}e.style.textAlign="left",e.style.verticalAlign="middle",h.appendChild(e)}}["leftSalvage","rightSalvage"].includes(e.part)&&(h.style.backgroundColor="#d9d9d9"),i.appendChild(h)})})});const c=document.createElement("tr"),u=document.createElement("td"),p=document.createElement("pre");let h=GO.cols();return Qy.isFullReedSpaceVisible&&Qy.isSalvageVisible&&(Ec.draftPlan&&(h+=hC(XC(Ec.draftPlan))),Sc.draftPlan&&(h+=hC(XC(Sc.draftPlan)))),p.innerText="warp"==t?`${Qy.isFullReedSpaceVisible?Ju():h} ${av("Ends")}`:`${d$.size} ${av("Picks")}`,u.appendChild(p),u.colSpan="warp"==t&&Qy.isFullReedSpaceVisible?4:3,c.appendChild(u),i.appendChild(c),`<div style="border:1px solid black;padding:8px;margin-top:10px;"><table class="warp-weft-table">${i.innerHTML}</table></div>`}function np(e,t){console.log("warp weft data is",e);const n=document.createElement("table");return n.innerHTML+=`<tr><td class="warp-info-table-warp-heading" style="width:70px;">${"warp"==t?""+lv("Warp"):""+lv("Weft")}</td><td style="width:80px;">${lv("Count")}</td><td>${lv("Yarn")}</td><td>%</td>${Qy.isAvgEpiPpiVisible&&"weft"==t?`<td>${""+lv("Avg PPI")}</td>`:""}<td>${lv("KGS")}</td><td style="width:70px;">${lv("Total")}</td></tr>`,e.forEach((e,i)=>{const r=document.createElement("tr");r.setAttribute("valign","top");const a=document.createElement("td");a.style.paddingLeft="2px",a.innerHTML=e.yarnname,e.isFooterRow||(a.style.backgroundColor=ua("weft"==t?$s[e.yarnname]:Ld[e.yarnname]),a.style.color=ca(a.style.backgroundColor)),e.isFooterRow&&(a.style.backgroundColor="white",a.style.border="none"),r.appendChild(a);const l=document.createElement("td");l.style.paddingLeft="2px",l.innerHTML=e.type?e.type:"",r.appendChild(l),r.style.borderTop="1px solid black",e.isFooterRow&&(l.style.backgroundColor="white",l.style.border="none");const o=document.createElement("td");o.style.paddingLeft="2px",o.innerHTML="warp"==t?Ad[e.yarnname]?Ad[e.yarnname].yarnName:e.yarnname:Ws[e.yarnname]?Ws[e.yarnname].yarnName:e.yarnname,e.isFooterRow&&(o.style.backgroundColor="white",o.style.border="none"),r.appendChild(o);const s=document.createElement("td");s.style.paddingLeft="2px",s.innerHTML=e.percentage,e.isFooterRow&&(s.style.backgroundColor="white",s.style.border="none"),r.appendChild(s);const d=document.createElement("td");d.style.paddingLeft="2px",d.innerHTML=e.avg,e.isFooterRow&&(d.style.backgroundColor="white",d.style.border="none"),Qy.isAvgEpiPpiVisible&&"weft"==t&&r.appendChild(d);const c=document.createElement("td");c.style.paddingLeft="2px",c.innerHTML=e.weight,r.appendChild(c);const u=document.createElement("td");u.style.paddingLeft="2px",u.innerHTML=e.count?e.count:0,r.appendChild(u),n.appendChild(r)}),`<table class="warp-weft-info-table">${n.innerHTML}</table>`}const ip=(e,t,n)=>{let i;if("frsrColumn"==n?i=2:"firstRepeatColumn"==n?i=4:"secondRepeatColumn"==n&&(i=3),Array.isArray(e))for(let i=0;i<e.length;i++){let r=e[i].querySelectorAll("td");if(r.length>0)for(let a=0;a<r.length;a++)0==i?(r.item(a).style.borderTop=t,0==a&&(r.item(a).style.borderLeft="1px solid black"),r.item(a).classList.contains(n)&&(r.item(a).style.borderRight=t)):i==e.length-1?(r.item(a).style.borderBottom=t,0==a&&(r.item(a).style.borderLeft="1px solid black")):0==a&&(r.item(a).style.borderLeft="1px solid black")}},rp=()=>{(()=>{if(Qy.isBorderVisible){const e=document.querySelector(".draft-numeric-table").querySelectorAll("tr");let t=1;for(t=1;t<e.length-1;){let n=e[t],i=n.querySelector(".firstRepeatColumn"),r=i&&i.getAttribute("rowspan")?parseInt(i.getAttribute("rowspan")):1,a=[];if(!isNaN(r)&&r>1)for(let n=0;n<r;n++)t+n<e.length&&a.push(e[t+n]);else a.push(n);ip(a,"1px solid black","firstRepeatColumn"),t+=r}for(t=1;t<e.length-1;){let n=e[t],i=n.querySelector(".secondRepeatColumn"),r=i&&i.getAttribute("rowspan")?parseInt(i.getAttribute("rowspan")):1,a=[];if(!isNaN(r)&&r>1)for(let n=0;n<r;n++)t+n<e.length&&a.push(e[t+n]);else a.push(n);ip(a,"3px solid black","secondRepeatColumn"),t+=r}for(t=1;t<e.length-1;){let n=e[t],i=n.querySelector(".frsrColumn"),r=i&&i.getAttribute("rowspan")?parseInt(i.getAttribute("rowspan")):1,a=[];if(!isNaN(r)&&r>1)for(let n=0;n<r;n++)t+n<e.length&&a.push(e[t+n]);else a.push(n);ip(a,"double black","frsrColumn"),t+=r}}})(),Qy.isInnerRepeatVisible||Qy.isPatternVisible||Qy.isDentVisible||Qy.isEndsVisible,document.getElementById("draft-total-text-element").setAttribute("colspan",1),Qy.isFRSRVisible||Qy.isOuterRepeatVisible||Qy.isInnerRepeatVisible?document.getElementById("repeatFooterElement").style.display="table-cell":document.getElementById("repeatFooterElement").style.display="none"},ap=()=>{let e=qC();document.getElementById("warp-pattern-data-table-container").innerHTML=tp(e,"warp")},lp=()=>{document.getElementById("print-warp-weft-info").innerHTML=`<div class="warp-info-table-container">\n  ${np($u,"warp")}\n</div>\n<div class="weft-info-table-container">\n  ${np(ju,"weft")}\n</div>`},op=(e,t=!1)=>{Au=wy.length>0,dh.value=KO.rows(),ch.value=GO.cols(),Vp.value=GO.rows(),Hu=WC();let n=Ku();Wu.length<=2&&Hu.length,Du=[],Ou=[],ju=[],$u=[];let i=UC(),r=qC(),a=Mc(i),l=Mc(r);Object.keys(l).forEach(e=>{let t=Ld[e];Ou.push({color:t,yarndetail:e})}),Object.keys(a).forEach(e=>{Du.push({color:$s[e],yarndetail:e})}),Ou.forEach(e=>{if(e.yarndetail.replace(/[^a-zA-Z]+/g,"")&&e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0]){if(-1==$u.findIndex(t=>t.yarnname==e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0])){let t=e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0],n=Ad[t],i=parseInt(Mu.split(/[\s\n]+/).find(e=>e.includes(t)));i=isNaN(i)?0:i,$u.push({yarnname:e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0],type:n&&n.yarnType?`${n.yarnType} ${l_(n.yarnUnit)}`:"",count:i,countInDenier:n&&n.yarnType?s_(n.yarnType,n.yarnUnit,"denier"):0})}$u=$u.sort((e,t)=>e.yarnname<t.yarnname?-1:e.yarnname>t.yarnname?1:0)}}),Du.forEach(e=>{if(e.yarndetail.replace(/[^a-zA-Z]+/g,"")&&e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0]){if(-1==ju.findIndex(t=>t.yarnname==String(e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0]).trim())){let t=e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0],n=Ws[t];ju.push({yarnname:t,type:n&&n.yarnType?`${n.yarnType} ${l_(n.yarnUnit)}`:"",count:a[t]?a[t]:0,yarnUnit:n&&n.yarnUnit?n.yarnUnit:"denier",countInDenier:n&&n.yarnType?s_(n.yarnType,n.yarnUnit,"denier"):0})}ju=ju.sort((e,t)=>e.yarnname<t.yarnname?-1:e.yarnname>t.yarnname?1:0)}});let o=ju.reduce((e,t)=>e+t.count,0),s=Number(zp.value),d=Number(lh.value),c=Ju()-Number(Nr.value)-Number(Jr.value),u=eh.value,p=((KO.rows()-l$.cells.length)/Number(lh.value)).toFixed(2),h=(Number(c/Number(u)).toFixed(2),l$.cells.length?(KO.rows()/p).toFixed(2):Number(lh.value).toFixed(2));ju.forEach(e=>{e.percentage=Number(Number(e.count)/Number(o)*100).toFixed(2),e.weight=(Number(e.countInDenier)*s*(100+Number(lu.weftWeavingShrinkage))*d*e.percentage/9e8).toFixed(2),e.avg=Number(Number(h)*Number(e.percentage)/100).toFixed(2)});let g=ju.reduce((e,t)=>Number(e)+Number(t.weight),0);ju.push({yarnname:"",type:"",count:o,yarnUnit:"",percentage:"",avg:"",isFooterRow:!0,weight:Number(g).toFixed(2)});let m=$u.reduce((e,t)=>e+t.count,0);$u.forEach(e=>{e.weight=(e.countInDenier*e.count*(100+Number(lu.warpWeavingShrinkage))/9e6).toFixed(2),e.percentage=(Number(e.count)/Number(m)*100).toFixed(2),e.avg=Number(Number(h)*Number(e.percentage)/100).toFixed(2)});let f=$u.reduce((e,t)=>Number(e)+Number(t.weight),0);$u.push({yarnname:"",type:"",count:m,avg:"",yarnUnit:"",percentage:"",isFooterRow:!0,weight:Number(f).toFixed(2)});let y=JSON.parse(localStorage.getItem("company")),v=`<div class="close">\n  <span class="close-button">&times;</span>\n</div>\n<div class="modal-title">\n</div>\n<div id="print-preview-container">\n  <div id="print-item" style="padding:5px;" class="direct-print-container">\n    <div id="print-company-details" class="company-details" style="display:${Qy.isHeaderVisible?" flex":"none"}">\n      <div class="company-logo" style="display:none;">\n        <img src="assets/Assert/maxweavelogo.png" alt="company-logo" height="72" />\n      </div>\n      <div class="company-desc">\n        <div class="company-name">\n          <h3>${y.companyName}</h3>\n        </div>\n        <div class="company-address">\n          <p>${y.address},${y.city}</p>\n        </div>\n        <div class="company-telephone-email">\n          <p>Mo.: ${y.mobileNo} </p>\n          <p>email: ${y.email}</p>\n        </div>\n      </div>\n    </div>\n\n    <div id="print-design-details" style="display:${Qy.isDetailsVisible?" flex":"none"}">\n\n      <div id="design-details-table-container">\n\n      </div>\n\n    </div>\n    <div id="print-warp-weft-info" class="design-warping-section" style="display:${Qy.isWarpWeftInfoVisible?" grid":"none"}">\n      <div class="warp-info-table-container">\n        ${np($u,"warp")}\n      </div>\n      <div class="weft-info-table-container">\n        ${np(ju,"weft")}\n      </div>\n\n\n    </div>\n    <div id="print-design-simulation" class="design-simulation"><canvas id="print-design-simulation-canvas"></canvas>\n    </div>\n    <p id="print-design-simlation-page-break" style="page-break-after: always;">&nbsp;</p>\n    <div style="margin-top:10px;">\n      <div class="print-second-column" style="margin-left:${Au?" 0px":"0px"};grid-template-columns:auto">\n\n        <div id="print-design-draft" class="design-draft" style="display:${Qy.isDraftVisible?" block":"none"}">\n          <div id="print-design-draft-container-header" style="padding:4px;">${rv("Drawing")}</div>\n          <div id="print-design-draft-container" style="padding:4px;">${n}\n         \n          </div>\n        </div>\n        <div>\n\n          <div class="design-notes-container">\n            <div>Notes:</div>\n            <div>${Qd}</div>\n          </div>\n\n        </div>\n      </div>\n\n    </div>\n    <p id="print-design-draft-page-break" style="page-break-after: always;">&nbsp;</p>\n    <div id="warp-weft-detail-container">\n  \n      <div id="warp-weft-pattern-container" style="padding:10px;">\n\n        <div class="warp-weft-table-container">\n          <div id="warp-pattern-data-table-container" class="warp-table-container">\n            <div>\n              <pre>${av("Warp Pattern")}</pre>\n            </div>\n            ${tp(r,"warp")}\n          </div>\n          <div class="weft-table-container">\n            <div>\n              <pre>${av("Weft Pattern")}</pre>\n            </div>\n            ${tp(i,"weft")}\n          </div>\n          \n        </div>\n\n      </div>\n\n      <p id="print-design-warp-weft-pattern-page-break" style="page-break-after: always;">&nbsp;</p>\n\n      <div id="print-design-pegplan-container" class="design-pegplan" style="display:${Qy.isPegplanVisible?" grid":"none"}">\n        ${Qu(Hu)}\n\n      </div>\n\n      <div id="print-pegplan-section" class="pegplan-section" style="display:${Qy.isPegplanVisible?" block":"none"}">\n      </div>\n    </div>\n  </div>\n  ${dp(Qy)}`;Ky.querySelector(".modal-content").innerHTML=v,Sortable.create(draftPropList,{handle:".draft-prop-handle",onEnd:function(e){var t,n=e.item;console.log("event is",e),n.id&&(t=function(e,t,n,i){let r=t.find(e=>e.includes(n));if(!r)return e;if(-1===e.findIndex(e=>r.includes(e)))return e;let a=e.filter(e=>!r.includes(e)),l=Math.max(0,Math.min(a.length,i));return a.splice(l,0,...r),a}(Nu,Cu,n.id,e.newIndex),Nu=t,console.log("current=----",Nu),ov())}});let b=Ky.querySelector(".modal-title");const w=Ky.querySelector(".close-button");if(console.log("Close button is",w),w.addEventListener("click",()=>{Yi(""),Ky.style.display="none"}),b.innerText="Print Prview",rp(),e!=yi.GRAPHICALNOWITHNUMERICNO&&ep(Hu),t){let e=document.getElementById("print-item"),t="";for(let e=0;e<160;e++)t+="";$(e).printThis({canvas:!0,beforePrint:()=>{document.title=DE.innerText+" Production Sheet"},pageTitle:"Design Name :- "+DE.innerText,afterPrint:sp})}Lu.classList.remove("absoulte"),Lu.classList.add("none")},sp=async()=>{let e=document.getElementById("print-item");document.body.removeChild(e),document.title="Maxweave",await Kd()},dp=()=>{let e=GO.convert_new_index_to_numeric(ZO),t=XC(e),n=GO.rows(),i=String(t).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e).length);return i=[...new Set([...i])].sort(),`\n  <div class="print-preview-sidebar">\n  <div class="print-preview-sidebar-container">\n    <div class="print-preview-sidebar-container-header">Language</div>\n    <div class="print-preview-sidebar-container-content" style="margin-top:0px;margin-bottom:10px;">\n      <select type="text" name="printpreview-selected-language" id="printpreview-selected-language">\n        <option value="${Si}">English</option>\n        <option value="${xi}">Hindi</option>\n        <option value=${Ii}>Gujarati</option>\n      </select>\n    </div>\n    <div class="print-preview-sidebar-container-header">Part</div>\n    <div class="print-preview-sidebar-container-content">\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-header" ${Qy.isHeaderVisible?"checked":""} />\n        <label for="sidebar-checkbox-header">Company Info</label>\n      </div>\n\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" ${Qy.isDetailsVisible?"checked":""} id="sidebar-checkbox-details" />\n        <label for="sidebar-checkbox-details">Details</label>\n      </div>\n\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-draft" ${Qy.isDraftVisible?"checked":""} />\n        <label for="sidebar-checkbox-draft">Draft</label>\n      </div>\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-simulation" ${Qy.isSimulationVisible?"checked":""} />\n        <label for="sidebar-checkbox-simulation">Simulation</label>\n      </div>\n\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-pegplan" ${Qy.isPegplanVisible?"checked":""} />\n        <label for="sidebar-checkbox-pegplan">Pegplan</label>\n      </div>\n\n      <div style="display:none;">\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-warping-section" ${Qy.isWarpingSectionVisible?"checked":""} />\n        <label for="sidebar-checkbox-warping-section">Warping Section</label>\n      </div>\n\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-warp-weft-pattern" ${Qy.isWarpWeftPatternVisible?"checked":""} />\n        <label for="sidebar-checkbox-warp-pattern">Warp/Weft Pattern</label>\n      </div>\n\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-warp-weft-info" ${Qy.isWarpWeftInfoVisible?"checked":""} />\n        <label for="sidebar-checkbox-warp-weft-info">Warp/Weft Info</label>\n      </div>\n\n\n\n      <div style="padding-left:16px;" >\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-avg-epi-ppi" ${Qy.isWarpWeftInfoVisible?"checked":""} />\n        <label for="sidebar-checkbox-avg-epi-ppi">Avg PPI</label>\n      </div>\n\n      <div>\n        <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-notes" ${Qy.isNotesVisible?"checked":""} />\n        <label for="sidebar-checkbox-notes">Notes</label>\n      </div>\n    </div>\n  </div>\n  <div class="print-preview-sidebar-container">\n    <div class="print-preview-sidebar-container-header">Draft Properties</div>\n    <div id="draftPropList" class="print-preview-sidebar-container-content">\n      <div style="padding-left:16px;" class="printpreview-siderbar-list-container" id="${vu}">\n        <div>\n          <label for="sidebar-checkbox-shaft">Shaft</label>\n        </div>\n        <div class="draft-prop-handle">\n          <img src="assets/drag-handle.svg" style="height:13px;" />\n        </div>\n\n      </div>\n     \n      <div id="${bu}" class="printpreview-siderbar-list-container">\n        <div>\n          <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-ends" ${Qy.isEndsVisible?"checked":""} />\n          <label for="sidebar-checkbox-ends">Ends</label>\n        </div>\n        <div class="draft-prop-handle">\n          <img src="assets/drag-handle.svg" style="height:13px;" />\n        </div>\n      </div>\n\n      <div id="${wu}" class="printpreview-siderbar-list-container">\n        <div>\n          <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-dent" ${Qy.isDentVisible?"checked":""} />\n          <label for="sidebar-checkbox-dent">Dent</label>\n        </div>\n        <div class="draft-prop-handle">\n          <img src="assets/drag-handle.svg" style="height:13px;" />\n        </div>\n      </div>\n\n      <div id="${Eu}">\n        <div class="printpreview-siderbar-list-container">\n          <div>\n            <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-pattern" ${Qy.isPatternVisible?"checked":""} />\n            <label for="sidebar-checkbox-pattern">Pattern</label>\n          </div>\n          <div class="draft-prop-handle">\n            <img src="assets/drag-handle.svg" style="height:13px;" />\n          </div>\n        </div>\n        <div style="padding-left:6px;">\n          <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-yarnname" ${Qy.isYarnNameVisible?"checked":""} />\n          <label for="sidebar-checkbox-yarnname">Yarn Name</label>\n        </div>\n        <div style="padding-left:6px;">\n          <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-vertical-pattern" ${Qy.isVerticalPattern?"checked":""} />\n          <label for="sidebar-checkbox-vertical-pattern">Vertical Pattern</label>\n        </div>\n      </div>\n      \n\n        <div id="${Tu}">\n\n          <div class="printpreview-siderbar-list-container">\n            <div style="padding-left:16px;">\n\n              <label>Repeat</label>\n            </div>\n            <div class="draft-prop-handle">\n              <img src="assets/drag-handle.svg" style="height:13px;" />\n            </div>\n          </div>\n          <div>\n            <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-innerrepeat" ${Qy.isInnerRepeatVisible?"checked":""} />\n            <label for="sidebar-checkbox-innerrepeat">Inner Repeat</label>\n          </div>\n          <div>\n            <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-outerrepeat" ${Qy.isOuterRepeatVisible?"checked":""} />\n            <label for="sidebar-checkbox-outerrepeat">Outer Repeat</label>\n          </div>\n          <div>\n            <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-frsr" ${Qy.isFullReedSpaceVisible?"checked":""} />\n            <label for="sidebar-checkbox-frsr">Full Reed Space Repeat</label>\n          </div>\n          <div style="padding-left:6px;">\n            <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-frsrvisibility" ${Qy.isFRSRVisible?"checked":""} />\n            <label for="sidebar-checkbox-frsrvisibility">FRSR</label>\n          </div>\n\n          <div style="padding-left:6px;">\n            <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-salvage" ${Qy.isSalvageVisible?"checked":""} />\n            <label for="sidebar-checkbox-salvage">Selvedge</label>\n          </div>\n        </div>\n      \n\n      <div class="printpreview-siderbar-list-container">\n        <div>\n          <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-extrawarp" ${Qy.isExtraWarpHighlighted?"checked":""} />\n          <label for="sidebar-checkbox-extrawarp">Extra Warp</label>\n        </div>\n        <div class="draft-prop-handle">\n          <img src="assets/drag-handle.svg" style="height:13px;" />\n        </div>\n      </div>\n      <div style="padding-left:6px;">\n        <input type="radio" name="printpreview-sidebar-extrawarpstyle-type" ${Qy.extraWarpPrintStyle==Mi?"checked":""}\n          value="${Mi}" />\n        <label>Color</label>\n        <input type="radio" name="printpreview-sidebar-extrawarpstyle-type" ${Qy.extraWarpPrintStyle==Fi?"checked":""}\n          value="${Fi}" />\n        <label>Underline</label>\n      </div>\n    </div>\n    <div>\n      <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-total" ${Qy.isTotalVisible?"checked":""} />\n      <label for="sidebar-checkbox-total">Total</label>\n    </div>\n\n    <div>\n    <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-show-single-repeat" ${Qy.isShowSingleRepeat?"checked":""} />\n    <label for="sidebar-show-single-repeat">Show Single Reepat</label>\n  </div>\n  <div>\n  <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-border-visible" ${Qy.isBorderVisible?"checked":""} />\n  <label for="sidebar-border-visible">Border</label>\n</div>\n  </div>\n  <div class="print-preview-sidebar-container">\n    <div class="print-preview-sidebar-container-header">\n      Remove Shaft In Pegplan\n    </div>\n    <div class="print-preview-sidebar-container-content">${(e=>{let t="";for(let n=0;n<e;n++)t+=`<div class="printpreview-remove-shaft-number">${n+1}</div>`;return'<div class="printpreview-removeshaft-container">'+t+"</div>"})(n)}</div>\n  </div>\n  <div class="print-preview-sidebar-container">\n    <div class="print-preview-sidebar-container-header">Pegplan View</div>\n\n    <div class="print-preview-sidebar-container-content">\n      <select type="text" name="printpreview-pegplan-view" id="printpreview-pegplan-view">\n        <option value="${yi.GRAPHICALYESWITHNUMERICNO}">Graphic</option>\n        <option value="${yi.GRAPHICALNOWITHNUMERICNO}">Numeric</option>\n        <option value=${yi.GRAPHICALNOWITHNUMERICYES}>Num Table</option>\n        <option value=${yi.GRAPHICALYESWITHNUMERICYES}>Graphic + Num</option>\n        <option value=${yi.WATERJETLETIS}>Waterjet</option>\n      </select>\n\n      <select type="text" name="printpreview-pegplan-sorting" id="printpreview-pegplan-sorting">\n        <option ${Qy.pegplanSorting==Bi?"selected":""}\n          value=${Bi}>Ascending </option>\n        <option ${Qy.pegplanSorting==Ri?"selected":""}\n          value=${Ri}>Descending</option>\n\n      </select>\n    </div>\n  </div>\n  <div class="print-preview-sidebar-container">\n    <div class="print-preview-sidebar-container-header">\n      Uncompress Dent\n    </div>\n    <div class="print-preview-sidebar-container-content">${(e=>{if(Array.isArray(e)){let t="";for(let n=0;n<e.length;n++)t+=`<div class="printpreview-uncompress-dent">${e[n]}</div>`;return'<div class="printpreview-uncompress-dent-container">'+t+"</div>"}})(i)}</div>\n  </div>\n  <div class="print-preview-sidebar-container" id="sidebar-checkbox-weftselector-ele" style="display: none;">\n    <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-weftselector" ${Qy.isWeftSelector?"checked":""} />\n    <label for="sidebar-checkbox-weftselector">Weft Selector</label>\n  </div>\n\n\n  <div class="print-preview-sidebar-container" id="sidebar-checkbox-weftcolor-ele" >\n  <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-weftcolor" ${Qy.isWeftColor?"checked":""} />\n  <label for="sidebar-checkbox-weftcolor">Weft Color</label>\n</div>\n  <div class="print-preview-sidebar-container" id="sidebar-checkbox-creaming-ele" style="display: none;">\n    <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-creaming" ${Qy.isCreaming?"checked":""} />\n    <label for="sidebar-checkbox-creaming">Creaming</label>\n  </div>\n  <div class="print-preview-sidebar-container" id="sidebar-checkbox-dencity-ele" style="display: none;">\n    <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-dencity" ${Qy.isDencity?"checked":""} />\n    <label for="sidebar-checkbox-dencity">Dencity</label>\n  </div>\n  <div class="print-preview-sidebar-container">\n    <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-twopickletis" ${Qy.isTwoPickLetisEnabled?"checked":""} />\n    <label for="sidebar-checkbox-twopickletis">2 Pick Lettis</label>\n  </div>\n\n  <div class="print-preview-sidebar-container">\n    <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-invertdesign" ${Qy.isInvertDesign?"checked":""} />\n    <label for="sidebar-checkbox-invertdesign">Invert Design</label>\n  </div>\n  <div class="print-preview-sidebar-container">\n    <input type="checkbox" class="printpreview-sidebar-checkbox" id="sidebar-checkbox-uncompressed" ${Qy.isUncompreesed?"checked":""} />\n    <label for="sidebar-checkbox-uncompressed">Uncompressed</label>\n  </div>\n  <div id="print-button">Print</div>\n</div>\n\n`},cp=()=>'<div class="modal-content">\n    <div class="close">\n      <span class="close-button">&times;</span>\n    </div>\n    <div class="modal-title">\n    Notes\n    </div>\n    <div class="modal-desc">\n      <div class="flex modal-form colunm justify-center item-center">\n       \n        <div class="text-area">\n          <textarea name="design-notes" id="design-notes" cols="30" rows="20"></textarea>\n        </div>\n      \n        <hr>\n        <div class="btn-group">\n          <button class="btn-submit" type="button" id="design-notes-apply">Apply</button>\n          <button class="btn-submit" type="button" id="design-notes-ok">ok</button>\n        </div>\n      </div>\n\n    </div>\n  </div>',up=document.getElementById("set-density-trigger"),pp=document.getElementById("set-density-modal");let hp,gp,mp,fp=[],yp=[];const vp=e=>{fp=[...e]},bp=e=>{yp=[...e]},wp=e=>{"Escape"===e.key&&Sp()},Ep=()=>{document.addEventListener("keydown",wp),(()=>{let e=document.getElementsByClassName("dencity-modal-input");console.log("speed object and decncity",fp,yp),fp[0]=lh.value;for(let t=0;t<e.length;t++){let n=e.item(t),i=Number(JC(n.id.split("-").at(-1)));n.value=fp[i-1]?fp[i-1]:""}let t=document.getElementsByClassName("speed-modal-input");for(let e=0;e<t.length;e++){let n=t.item(e),i=Number(JC(n.id.split("-").at(-1)));n.value=yp[i-1]?yp[i-1]:""}})(),Uf(),pp.style.display="block",pp.style.animation="slide-down 0.3s ease",Yi("set-density-modal")},Sp=()=>{document.removeEventListener("keydown",wp),pp.style.display="none",Yi("")},xp=()=>{let e=document.getElementsByClassName("dencity-modal-input");for(let t=0;t<e.length;t++){let n=e.item(t),i=n.value,r=Number(JC(n.id.split("-").at(-1)));isNaN(r)||(fp[r-1]=i)}fp[0]&&(lh.value=parseFloat(fp[0]).toFixed(2));let t=document.getElementsByClassName("speed-modal-input");for(let e=0;e<t.length;e++){let n=t.item(e),i=n.value,r=Number(JC(n.id.split("-").at(-1)));isNaN(r)||(yp[r-1]=i)}Rh(!0)},Ip=()=>{xp(),Sp()},kp=document.getElementById("new-file-modal"),_p=document.querySelector("#new-file-form"),Tp=document.querySelector("#new-file-submit"),Np=document.getElementById("new-file-apply"),Cp=document.getElementById("new-file-modal-error"),Lp=document.getElementById("user-define-endsperdent");let Ap=12,Pp=0,Bp=0,Rp=20,Fp=20,Mp="inch",Dp=20,Op=20,$p=!1,jp=.5,Wp=.5,Hp=45.5;document.getElementById("fabric-type"),document.getElementById("fabric-quality");const qp=document.getElementById("width-Lsalvage"),Up=document.getElementById("width-Rsalvage"),zp=document.getElementById("width-total"),Vp=document.getElementById("shaft"),Yp=document.getElementById("dentWarp-Lsalvage"),Gp=document.getElementById("dentWarp-body"),Jp=document.getElementById("dentWarp-Rsalvage"),Xp=document.getElementById("dent-Lsalvage"),Kp=document.getElementById("dent-body"),Zp=document.getElementById("dent-Rsalvage"),Qp=document.getElementById("dent-total"),eh=document.getElementById("width-body"),th=document.getElementById("Total-Lsalvage"),nh=document.getElementById("Total-body"),ih=document.getElementById("Total-Rsalvage"),rh=document.getElementById("Total-warp-total"),ah=document.getElementById("warp-dencity"),lh=document.getElementById("weft-dencity"),oh=document.getElementById("grid-height"),sh=document.getElementById("grid-width"),dh=document.getElementById("design-height"),ch=document.getElementById("design-width"),uh=document.getElementById("weft-height"),ph=document.getElementById("warp-width"),hh=document.getElementById("unit"),gh=document.getElementById("inch"),mh=kp.querySelector(".close-button"),fh=kp.querySelector("#new-file-cancel");let yh=ir;const vh=e=>{Ap=e},bh=e=>{Pp=e},wh=e=>{Mp=e},Eh=e=>{Bp=e},Sh=e=>{Fp=e},xh=e=>{Rp=e},Ih=e=>{Dp=e},kh=e=>{Op=e},_h=e=>{Number(bc.value)||(bc.value=2,mc.value=th.value,fc.value=ih.value,_c(),Cc(),bc.value=""),jp=Number(e)},Th=e=>{Number(bc.value)||(bc.value=2,mc.value=th.value,fc.value=ih.value,_c(),Cc(),bc.value=""),Wp=Number(e)},Nh=e=>{Hp=Number(e)},Ch=()=>{yh==rr?(Fh(),Rh(!0)):yh==ir&&(Ah(),Rh(!0)),$p||(Yi(""),kp.style.display="none")},Lh=(e,t)=>25e3<e||15e3<t?(nL("Design Height Width are not compatible"),!1):(document.getElementById("statusbar-info-warp").textContent="Warp : "+t,document.getElementById("statusbar-info-weft").textContent="Weft : "+e,!0),Ah=()=>{const e=new FormData(_p),t=Object.fromEntries(e.entries());if(!Lh(Math.floor(t["design-height"]),Math.floor(t["design-width"])))return $p=!0,Cp.style.display="block",Cp.innerText="Design height and width are not compatible",void setTimeout(()=>{Cp.style.display="none",$p=!1},2e3);if(t["design-height"]!=t["weft-height"])return $p=!0,Cp.style.display="block",Cp.innerText="Weft Height Must be Equal To Design Height",void setTimeout(()=>{Cp.style.display="none",$p=!1},2e3);if(t["design-width"]!=t["warp-width"])return $p=!0,Cp.style.display="block",Cp.innerText="Warp Width Must be Equal To Design Width",void setTimeout(()=>{Cp.style.display="none",$p=!1},2e3);bh(Math.floor(t["Total-Lsalvage"])),Eh(Math.floor(t["Total-Rsalvage"])),vh(Math.floor(t.shaft)),Sh(Math.floor(t["design-height"])),xh(Math.floor(t["design-width"])),kh(Math.floor(t["weft-height"])),Ih(Math.floor(t["warp-width"])),zi(Math.floor(t["grid-height"])),Ui(Math.floor(t["grid-width"])),wh(t.unit),_h(t["width-Lsalvage"]),Th(t["width-Rsalvage"]),Nh(t["width-body"]),lu={warpWeavingShrinkage:0,weftFinishShrinkage:0,warpFinishShrinkage:0,weftWeavingShrinkage:0,warpWastage:0,weftWastage:0},DE.innerText="Untitled",k$(new lL(Dp,!1,!1,!0,!1)),_$(new lL(Op,!0,!1,!1,!1)),T$(new lL(Op,!1,!0,!1,!1,!1)),N$(new lL(Op,!1,!1,!1,!1,!0)),C$(new lL(Op,!1,!1,!1,!1,!0)),L$(new lL(Dp,!1,!1,!1,!0,!1)),Bc(),g$&&(g$(),AN({target:{scrollLeft:0}}),$T({target:{scrollTop:0}}),vN.style.width=Rp*qi+"px",xN.style.height=Fp*qi+"px");let n=Number(VO.value);ZO.change_dent_dimension(Rp,2,qi),Xn&&QO.change_treadles_value(n,KO,GO,YO,QO),m$&&m$(),PN()},Ph=()=>{let e=Ju()-Number(th.value)-Number(ih.value);return Math.round(e/Number(eh.value)).toFixed(2)},Bh=()=>{let e=((KO.rows()-l$.cells.length)/Number(lh.value)).toFixed(2);return l$.cells.length?(KO.rows()/e).toFixed(2):Number(lh.value).toFixed(2)},Rh=(e=!1)=>{if(document.getElementById("statusbar-info-shaft").textContent="Shaft : "+KO.cols(),document.getElementById("statusbar-info-warp").textContent="Warp : "+ph.value,document.getElementById("statusbar-info-weft").textContent="Weft : "+uh.value,e){let e=GO.convert_new_index_to_numeric(ZO),t=XC(e),n=(KO.rows(),l$.cells.length,String(t).trim().split("\n")),i=Ju()-Number(th.value)-Number(ih.value);const r=new Set(l$.cells.map(e=>e.index)),a=s$.cells.reduce((e,t)=>{if(!r.has(t.index)){const n=t.color_code;e[n]=(e[n]||0)+1}return e},{});let l=0;Object.keys(a).forEach(e=>{let t=String(e).charCodeAt(0)-65,n=fp[t]?fp[t]:Number(lh.value);l+=parseFloat(a[e])/parseFloat(n)});let o=l.toFixed(2),s=(n.length/(Number(zO.value)/Number(gh.value))).toFixed(2),d=Number(i/Number(eh.value)).toFixed(2),c=l$.cells.length?(KO.rows()/o).toFixed(2):Number(lh.value).toFixed(2);document.getElementById("statusbar-info-avg-epi").textContent="Avg EPI : "+d,document.getElementById("statusbar-info-avg-ppi").textContent="Avg PPI : "+c,document.getElementById("statusbar-info-epi").textContent="EPI : "+Math.round(ah.value).toFixed(2),document.getElementById("statusbar-info-ppi").textContent="PPI : "+lh.value,document.getElementById("statusbar-info-width").textContent=`Width : ${s}"`,document.getElementById("statusbar-info-height").textContent=`Height : ${o}"`}},Fh=()=>{const e=new FormData(_p),t=Object.fromEntries(e.entries());if(!Lh(Math.floor(t["design-height"]),Math.floor(t["design-width"])))return $p=!0,Cp.style.display="block",Cp.innerText="Design height and width are not compatible",void setTimeout(()=>{Cp.style.display="none",$p=!1},2e3);if(t["design-height"]!=t["weft-height"])return $p=!0,Cp.style.display="block",Cp.innerText="Weft Height Must be Equal To Design Height",void setTimeout(()=>{Cp.style.display="none",$p=!1},2e3);if(t["design-width"]!=t["warp-width"])return $p=!0,Cp.style.display="block",Cp.innerText="Warp Width Must be Equal To Design Width",void setTimeout(()=>{Cp.style.display="none",$p=!1},2e3);if(bh(Math.floor(t["Total-Lsalvage"])),Eh(Math.floor(t["Total-Rsalvage"])),vh(Math.floor(t.shaft)),Sh(Math.floor(t["design-height"])),xh(Math.floor(t["design-width"])),kh(Math.floor(t["weft-height"])),Ih(Math.floor(t["warp-width"])),zi(Math.floor(t["grid-height"])),Ui(Math.floor(t["grid-width"])),wh(t.unit),_h(t["width-Lsalvage"]),Th(t["width-Rsalvage"]),Nh(t["width-body"]),c$.update_size(parseInt(ph.value)),o$.update_size(parseInt(ph.value)),d$.update_size(parseInt(uh.value)),l$.update_size(d$.size),s$.update_size(d$.size),h$.update_size(d$.size),Bc(),GO.change_draft_dimension(YO,KO,ZO,p$,QO,Math.floor(t.shaft),Math.floor(t["design-width"]),Math.floor(t["design-height"])),Xn){let e=Number(VO.value);QO.change_treadles_value(e,KO,GO,YO,QO)}m$&&m$(),PN(),Rh(!0)},Mh=()=>{yh==ir&&(dh.value=KO.rows(),ch.value=GO.cols(),Vp.value=GO.rows(),uh.value=d$.size,ph.value=c$.size)},Dh=()=>{const e=document.getElementsByClassName("new-file-form-field");for(let t=0;t<e.length;t++)e[t].addEventListener("change",e=>{const t=new FormData(_p),n=Object.fromEntries(t.entries());qp.value=parseFloat(qp.value).toFixed(2),Up.value=parseFloat(Up.value).toFixed(2),eh.value=parseFloat(eh.value).toFixed(2),zp.value=Number(n["width-Lsalvage"])+Number(n["width-Rsalvage"])+Number(n["width-body"]),Number(Vp.value)>40&&(Vp.value=40),Yp.value=Math.floor(Yp.value),Gp.value=Math.floor(Gp.value),Jp.value=Math.floor(Jp.value),["width-Lsalvage","width-body","width-Rsalvage","reed"].includes(e.target.name)&&(Xp.value=parseInt(Number(n.reed)/Number(n.inch)*Number(n["width-Lsalvage"])),Kp.value=parseInt(Number(n.reed)/Number(n.inch)*Number(n["width-body"])),Zp.value=parseInt(Number(n.reed)/Number(n.inch)*Number(n["width-Rsalvage"]))),["dent-Lsalvage","dent-Rsalvage","dent-body","reed"].includes(e.target.name)&&(qp.value=parseFloat(Number(n["dent-Lsalvage"])*Number(n.inch)/Number(n.reed)).toFixed(2),eh.value=parseFloat(Number(n["dent-body"])*Number(n.inch)/Number(n.reed)).toFixed(2),Up.value=parseFloat(Number(n["dent-Rsalvage"])*Number(n.inch)/Number(n.reed)).toFixed(2)),Qp.value=Number(Xp.value)+Number(Kp.value)+Number(Zp.value),th.value=Xp.value*Number(n["dentWarp-Lsalvage"]),nh.value=Kp.value*Number(n["dentWarp-body"]),ih.value=Zp.value*Number(n["dentWarp-Rsalvage"]),rh.value=Number(th.value)+Number(nh.value)+Number(ih.value),ah.value=Math.round(Number(nh.value)/Number(n["width-body"])).toFixed(2),lh.value=parseFloat(n["weft-dencity"]).toFixed(2)});_h(qp.value),Th(Up.value),Tp.addEventListener("click",e=>{e.preventDefault(),Xd.style.visibility="visible",Ch()}),Np.addEventListener("click",e=>{e.preventDefault(),yh==ir?Ah():Fh()}),Rh(!0),fh.addEventListener("click",Mh),mh.addEventListener("click",Mh)},Oh=e=>{dh.value=KO.rows(),ch.value=GO.cols(),Vp.value=GO.rows(),uh.value=d$.size,ph.value=c$.size,2==Gp.value?Lp.innerHTML="&nbsp;":Lp.innerHTML="User Define",e==sr||e==or||e==lr?(yh=rr,kp.querySelector(".modal-title").innerHTML="<p>Edit File</p>"):(oh.value=4,sh.value=4,Vp.value=12,qp.value=.5,Up.value=.5,eh.value=45.5,gh.value=2,hh.value="inch",zp.value=parseFloat(46.5).toFixed(2),zO.value=96,Xp.value=parseInt(96/Number(gh.value)*Number(.5)),Kp.value=parseInt(96/Number(gh.value)*Number(45.5)),Zp.value=parseInt(96/Number(gh.value)*Number(.5)),Qp.value=Number(Xp.value)+Number(Kp.value)+Number(Zp.value),Yp.value=4,Gp.value=2,Jp.value=4,VO.readOnly=!Xn,th.value=Xp.value*Number(Yp.value),nh.value=Kp.value*Number(Gp.value),ih.value=Zp.value*Number(Jp.value),bh(Number(th.value)),Eh(Number(ih.value)),rh.value=Number(th.value)+Number(nh.value)+Number(ih.value),lh.value=52..toFixed(2),ah.value=Math.round(Number(nh.value)/Number(eh.value)).toFixed(2),dh.value=20,ch.value=20,uh.value=20,ph.value=20,yh=ir,kp.querySelector(".modal-title").innerHTML="<p>New File</p>")},$h=document.getElementById("textarea-contextmenu");let jh=null;function Wh(e){e.addEventListener("contextmenu",t=>{t.preventDefault(),jh=e,$h.style.top=t.clientY+"px",$h.style.left=t.clientX+"px",$h.style.display="block"})}const Hh=document.getElementById("pegplan-edit-num"),qh=document.getElementById("total-picks"),Uh=document.getElementById("current-pick-number"),zh=document.getElementById("edit-pegplan-error-message"),Vh=document.getElementById("edit-pegplan-compress"),Yh=document.getElementById("pegplan-editor-flip-horizontal"),Gh=document.getElementById("pegplan-editor-flip-vertical");let Jh=Sr;const Xh=e=>{let t=String(e.target.value),n={".":" ","{":"[","}":"]","(":"[",")":"]"},i=Hh.selectionStart;t=t.split("").map(e=>n[e]||e).join(""),Hh.value=t,Hh.setSelectionRange(i,i),Hh.focus();let r=XC(t,!0);const a=String(r).split("\n").filter(e=>e.length>0).length;qh.value=a,Kh()},Kh=()=>{let e=0;Hh.value.split("\n").forEach(t=>{e=Math.max(e,30,t.length)}),Hh.cols=e},Zh=e=>{let t=XC(Hh.value.trimEnd()).trimEnd();return e?E$(t):t},Qh=(e=!1)=>{if(cC(Hh.value,"[")!=cC(Hh.value,"]"))return zh.style.display="block",zh.innerText="Check Brackets Properly",setTimeout(()=>{zh.style.display="none"},6e3),!1;zh.style.display="none";let t,n=String(Hh.value).replace(/\n{4,}/g,"\n\n\n"),i=n.split("\n\n"),r=n.split("\n\n\n"),a=XC(Hh.value.trimEnd()).trimEnd(),l=[],o=0;for(let e=0;e<i.length&&e+1!=i.length;e++){o+=cC(XC(i[e]).trim(),"\n")+1,o>0&&l.push(o-1)}let s=[];"\n\n"==n.slice(-2)&&(s.push(o-1),t=o-1),o=0;for(let e=0;e<r.length&&e+1!=r.length;e++){o+=cC(XC(r[e]).trim(),"\n")+1,o>0&&(!t||t>o)&&s.push(o-1)}a=0==a.length?Hh.value:a;let d=0,c=KO.cols();return String(a).split("\n").forEach(e=>{d++,Math.max(...e.split(" "))>c&&(c=Math.max(...e.split(" ")))}),c>40?(zh.style.display="block",zh.innerText="Shaft must be lesser than 40",setTimeout(()=>{zh.style.display="none"},6e3),!1):(zh.style.display="none",!(e&&c>24&&!confirm(`You are input ${c} Shaft, Are you Sure to use More then 24 Shaft?`))&&(KO.new_edit_pegplan_numeric(GO,YO,QO,a.trim(),c,d,Hh.value,l,s),d$.update_size(d),l$.update_size(d),s$.update_size(d),h$.update_size(d),uh.value=d,Yi(""),$T({target:{scrollTop:0}}),GO.change_draft_dimension(YO,KO,ZO,p$,QO,c,Number(ch.value),d),console.log("draft width is after dimension change",GO.cols()),Rh(!0),Jw(),WT(),iE(),PN(),!0))};function eg(){const e=Hh.value,t=Hh.selectionStart,n=e.indexOf("\n",t);let i=e.substring(0,-1===n?e.length:n);const r=cC(i,"["),a=cC(i,"]");if(r>a)for(let e=0;e<r-a;e++)i+="]X1";let l=XC(i).trim();Uh.value=l.split("\n").length}const tg=()=>{Jh=Jh==Sr?xr:Sr,Jh==Sr?(Vh.innerText="+",Hh.value=Zh(!0)):(Vh.innerText="-",Hh.value=Zh(!1))},ng=()=>{Qh(!0)&&(rw.style.display="none")},ig=()=>{DT(),KO.flip_pegplan_horzintally(YO,GO,QO),WT()},rg=()=>{DT(),KO.flip_pegplan_vertically(YO,GO,QO),WT()},ag=(document.getElementById("checkbox-skipped-dent"),document.getElementById("checkbox-function"),document.getElementById("checkbox-extrawarp"),document.getElementById("checkbox-draft-visibility"),document.getElementById("checkbox-reed"),document.getElementById("checkbox-pegplan-visibility"),document.getElementById("checkbox-density"),document.getElementById("checkbox-speed"),document.getElementById("checkbox-doublebeam"));document.getElementById("checkbox-tieupmode"),document.getElementById("checkbox-maindesign"),document.getElementById("form-color-panel"),document.getElementById("checkbox-color-palette"),document.getElementById("checkbox-direct-drawing"),document.getElementById("checkbox-drawing-toolbar"),document.getElementById("checkbox-weft-color"),document.getElementById("checkbox-warp-color");let lg=!0;const og=(e,t)=>{const n=localStorage.getItem("token");return axios.patch(ba+"/folder/rename",{folderName:e,folderId:t},{headers:{token:n}})},sg=(e,t)=>{const n=localStorage.getItem("token");return axios.post(ba+"/folder/paste-items",{selectedItems:e,targetFolderId:t},{headers:{token:n}})},dg=e=>{const t=localStorage.getItem("token");return axios.post(ba+"/folder/delete-item-from-folder",{designItem:e},{headers:{token:t}})},cg=e=>{const t=localStorage.getItem("token");return axios.get(`${ba}/folder/get-children-count/${e}`,{headers:{token:t}})},ug=e=>{const t=localStorage.getItem("token"),n=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return axios.post(ba+"/folder/create-with-name",{parentFolder:e,user:n},{headers:{token:t}})},pg=e=>{const t=localStorage.getItem("token");return axios.get(`${ba}/folder/get-content/${e}`,{headers:{token:t}})},hg=()=>{const e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return axios.get(`${ba}/folder/get-user-root-folder/${t}`,{headers:{token:e}})},gg=e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/color-palette/create",e,{headers:{token:t}})},mg=()=>{const e=localStorage.getItem("token");let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/color-palette/get-color-palette/${t}`,{headers:{token:e}})},fg=document.getElementById("open-color-palette-modal"),yg=document.getElementsByClassName("open-color-palette-trigger");let vg,bg,wg,Eg,Sg,xg=[];const Ig=e=>{if(e.yarnDetail){for(let t=0;t<e.yarnDetail.length;t++){let n=e.yarnDetail[t].yarnLetter,i=e.yarnDetail[t].colorCode,r=e.yarnDetail[t].yarnType,a=e.yarnDetail[t].yarnName,l=e.yarnDetail[t].yarnWarpOrWeft,o=e.yarnDetail[t].yarnUnit;"warp"==l?(Ld[n]=i,(r||a)&&(Ad[n]={yarnType:r,yarnName:a,yarnUnit:o})):"weft"==l?($s[n]=i,(r||a)&&(Ws[n]={yarnType:r,yarnName:a,yarnUnit:o})):"function"==l&&(js[n]=i)}b_()}},kg=e=>{let t=xg.find(t=>t.id==e.target.id);wg=t,(e=>{let t=e.yarnDetail,n=t.filter(e=>"warp"==e.yarnWarpOrWeft),i=t.filter(e=>"weft"==e.yarnWarpOrWeft),r=t.filter(e=>"function"==e.yarnWarpOrWeft);Eg.value=e.name,bg.innerHTML="",bg.innerHTML+=`<div>\n        <div>Warp</div>\n        ${n.map(e=>`<div style="background-color:${e.colorCode};border:1px solid grey;color:${["#000000","rgb(0,0,0)"].includes(e.colorCode)?"white":"black"}">${e.yarnLetter}</div>`).join("")}\n    </div>`,bg.innerHTML+=`<div>\n    <div>Weft</div>\n    ${i.map(e=>`<div style="background-color:${e.colorCode};border:1px solid grey;color:${["#000000","rgb(0,0,0)"].includes(e.colorCode)?"white":"black"}">${e.yarnLetter}</div>`).join("")}\n</div>`,bg.innerHTML+=`<div>\n<div>Fun</div>\n${r.map((e,t)=>`<div style="background-color:${e.colorCode};border:1px solid grey;color:${["#000000","rgb(0,0,0)"].includes(e.colorCode)?"white":"black"}">${t+1}</div>`).join("")}\n</div>`})(wg)},_g=e=>{let t=String(e.target.value);if(t.length>0){let e=xg.filter(e=>String(e.name).toLowerCase().includes(t.toLowerCase()));for(let e=0;e<xg.length;e++){document.getElementById(xg[e].id).style.display="none"}for(let t=0;t<e.length;t++){document.getElementById(e[t].id).style.display="block"}}else for(let e=0;e<xg.length;e++){document.getElementById(xg[e].id).style.display="block"}},Tg=()=>{(async()=>{try{let e=await mg();xg=e.data.DATA,vg.innerHTML="";for(let e=0;e<xg.length;e++)vg.innerHTML+=`<div id="${xg[e].id}">${xg[e].name}</div>`;for(let e=0;e<xg.length;e++){document.getElementById(xg[e].id).addEventListener("click",kg)}}catch(e){console.log("err is",e)}})(),Uf(),fg.style.display="block",fg.style.animation="slide-down 0.3s ease"},Ng=()=>{vg.innerHTML="",fg.style.display="none",Yi("")},Cg=()=>{Ig(wg),Ng()},Lg=document.getElementById("weft-selector-modal"),Ag=document.getElementById("set-weft-selector-trigger");let Pg,Bg,Rg,Fg,Mg={};const Dg=e=>{Mg={...e}},Og=()=>{const e=Lg.querySelector("#modal-desc");e.innerHTML="",e.style.display="flex",e.style.flexDirection="row";const t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");i.innerText="Weft Yarn";const r=document.createElement("div");r.innerText="Selector",t.appendChild(i),n.appendChild(r);const a=document.createElement("form");let l=MC(UC());console.log("Weft Color is",$s),l.forEach(e=>{let n=document.createElement("div");n.innerText=e,t.appendChild(n);const i=document.createElement("div"),r=document.createElement("input");r.name="weft-selector-"+e,r.id="weft-selector-"+e,r.min=1,r.type="text",r.style.width="100%",r.style.height="100%",i.appendChild(r),a.appendChild(i)}),n.appendChild(a),e.appendChild(t),e.appendChild(n),Object.keys(Mg).forEach(e=>{Lg.querySelector("#weft-selector-"+e).value=Mg[e]})},$g=()=>{Uf(),Lg.style.display="block",Lg.style.animation="slide-down 0.3s ease",Og()},jg=()=>{Lg.style.display="none"};const Wg=()=>{let e=Lg.querySelector("form");const t=new FormData(e),n=Object.fromEntries(t);if(function(e){const t=/^(?:[1-8](?:\/[1-8])*)?$/;for(const n in e)if(!t.test(e[n]))return!1;return!0}(n)){let e={};return Object.keys(n).forEach(t=>{e[t.at(-1)]=n[t]}),Dg(e),!0}return i="Please enter valid weft selector",Fg.innerHTML=i,Fg.style.display="block",setTimeout(()=>{Fg.innerHTML="",Fg.style.display="none"},5e3),!1;var i},Hg=()=>{Wg()&&jg()},qg=()=>{jg()},Ug=document.getElementById("save-file-type-modal"),zg="DEVICE",Vg="CLOUD";const Yg=()=>{Ug.style.display="none",Yi("")},Gg=document.getElementById("recent-list-parent"),Jg=e=>{if(LN(null),MT(0),lu.warpWastage=e.warpWastage,lu.warpFinishShrinkage=e.warpFinishShrinkage,lu.warpWeavingShrinkage=e.warpWeavingShrinkage,lu.weftWastage=e.weftWastage,lu.weftFinishShrinkage=e.weftFinishShrinkage,lu.weftWeavingShrinkage=e.weftWeavingShrinkage,ou.designerName=e.designerName,ou.checkedBy=e.checkedBy,ou.contanctNo=e.contanctNo,ou.customerName=e.customerName,ou.deliveryDate=e.deliveryDate,ou.designType=e.designType,ou.remarks=e.remarks,e.name&&(DE.innerText=e.name,(e=>{hh.value=e.unit,Vp.value=e.shaft,zO.value=e.reed,gh.value=e.perinch,qp.value=e.leftSalvageWidth,eh.value=e.bodyWidth,Up.value=e.rightSalvageWidth,Yp.value=e.leftSalvageWarpDent,Gp.value=e.bodyWarpDent,Jp.value=e.rightSalvageWarpDent,ah.value=Math.round(e.warpDencity).toFixed(2),lh.value=parseFloat(e.weftDencity).toFixed(2),dh.value=e.designHeight,ch.value=e.designWidth,uh.value=e.weftHeight,ph.value=e.warpWidth,oh.value=e.gridHeight,sh.value=e.gridWidth,Kp.value=parseInt(Number(e.reed)/Number(e.perinch)*Number(e.bodyWidth)),nh.value=Kp.value*Number(Gp.value),Xp.value=parseInt(Number(zO.value)/Number(gh.value)*Number(qp.value)),Zp.value=parseInt(Number(zO.value)/Number(gh.value)*Number(Up.value)),Qp.value=Number(Xp.value)+Number(Kp.value)+Number(Zp.value),th.value=Xp.value*Number(Yp.value),Jr.value=Zp.value*Number(Jp.value),rh.value=Number(th.value)+Number(nh.value)+Number(Jr.value),zp.value=Number(qp.value)+Number(eh.value)+Number(Up.value),Nh(eh.value),Th(Up.value),_h(qp.value),Rh()})(e)),e.id&&Kg(e),e.designWidth&&xh(Number(e.designWidth)),e.colorPaletteId&&Ig(e.colorPaletteId),e.extraWarp&&o$.set_all_value_from_string(e.extraWarp),rL(e.leftSalvage)&&(e=>{Ec=e,uc.value=Ec.draftPlan,yc.value=Ec.warpSeq})(JSON.parse(e.leftSalvage)),rL(e.rightSalvage)&&(e=>{Sc=e,pc.value=Sc.draftPlan,vc.value=Sc.warpSeq})(JSON.parse(e.rightSalvage)),e.creaming&&l$.set_all_value_from_string(e.creaming),e.density&&rL(e.density)){let t=JSON.parse(e.density);if(t&&Array.isArray(t.cells)&&t.cells.length>0)s$.set_all_value_from_string(e.density,!0);else{let n=Array.apply(null,Array(t.size)).map((function(e,t){return new aL("A",t)}));s$.set_all_value_from_string(e.density,!0),s$.cells=[...n]}}if(e.speed){if(rL(e.speed)){let t=JSON.parse(e.speed);if(t&&Array.isArray(t.cells)&&t.cells.length>0)h$.set_all_value_from_string(e.speed,!0);else{h$.set_all_value_from_string(e.speed,!0);let n=Array.apply(null,Array(t.size)).map((function(e,t){return new aL("A",t)}));s$.cells=[...n]}}}else{let t=Number(e.weftHeight),n=Array.from({length:t},(e,t)=>new aL("A",t));h$.size=t,h$.cells=n}if(Rw(ki),jT(Ai),Wd(Ti),Gs(Ci),e.draftPlan&&e.draftPlan.length>0&&(aE.value=e.draftPlan,GO.change_no_of_rows(Number(e.shaft)),bE()),e.pegPlan&&e.pegPlan.length>0&&(Hh.value=e.pegPlan,KO.change_no_of_cols(Number(e.shaft)),Qh()),e.warpPattern&&e.warpPattern.length>0&&(Pv("warp"),Sv.value=e.warpPattern,c$.setFixNumericText(Sv.value),jv(!1,!1)),e.weftPattern&&e.weftPattern.length>0&&(Pv("weft"),Sv.value=e.weftPattern,d$.setFixNumericText(Sv.value),jv(!1,!1)),e.draftCompressSplitArray&&GO.change_compress_split_array(e.draftCompressSplitArray),e.pegplanCompressSplitArray&&KO.change_compress_split_array(e.pegplanCompressSplitArray),e.pegplanFileSplitArray&&KO.change_file_loop_split_array(e.pegplanFileSplitArray),e.weftCompressSplitArray&&(d$.compressSplitter=e.weftCompressSplitArray),e.warpCompressSplitArray&&(c$.compressSplitter=e.warpCompressSplitArray),e.skipDent){const t=new Uint32Array(e.skipDent.split(","));t.length==ZO.cols()?ZO.change_click_cells(t):ZO.change_click_cells(Array(ZO.cols()).fill(0)),Td()}if(e.notes&&ac(e.notes),e.doubleBeam){let t=new Uint32Array(e.doubleBeam.split(","));t=-1==t.findIndex(e=>![1,2].includes(e))?t:Array(t.length).fill(1),GO.cols()>t.length?p$.reset_cell_from_size(GO.cols()):p$.change_cells(t,GO.cols()),ZN()}e.weftSelectorMapping&&(rL(e.weftSelectorMapping)?Dg(JSON.parse(e.weftSelectorMapping)):Dg({})),e.densityMapping&&(rL(e.densityMapping)?vp(JSON.parse(e.densityMapping)):vp([])),e.speedMapping&&(rL(e.speedMapping)?bp(JSON.parse(e.speedMapping)):bp([])),e.draftWithPart&&Array.isArray(e.draftWithPart.designWithPart)&&Array.isArray(e.draftWithPart.draftParts)&&(Ty(e.draftWithPart.designWithPart),uy(e.draftWithPart.draftParts)),PN(),AN({target:{scrollLeft:0}}),$T({target:{scrollTop:0}}),Rh(!0)},Xg=e=>{let t=localStorage.getItem(vk.RECENT_FILE),n=t?JSON.parse(t):[];n=n.filter(t=>t.id!=e),localStorage.setItem(vk.RECENT_FILE,JSON.stringify(n));for(let e=0;e<n.length;e++)Gg.innerHTML+=` <li class="dropdown-item load-design" id="recent-design-${n[e].id}">\n    <div class="flex item-menu item-center">\n      <p>${n[e].name}</p>\n    </div>\n  </li>\n  <hr/>`;for(let e=0;e<n.length;e++)document.getElementById("recent-design-"+n[e].id).addEventListener("click",()=>{Sm(n[e]),Ki(Vg),Jg(n[e])})},Kg=e=>{let t=localStorage.getItem(vk.RECENT_FILE),n=t?JSON.parse(t):[];n=n.filter(t=>t.id!=e.id),n=[e,...n].slice(0,7),localStorage.setItem(vk.RECENT_FILE,JSON.stringify(n)),Gg.innerHTML="";for(let e=0;e<n.length;e++)Gg.innerHTML+=` <li class="dropdown-item load-design" id="recent-design-${n[e].id}">\n    <div class="flex item-menu item-center">\n      <p>${n[e].name}</p>\n    </div>\n  </li>`;for(let e=0;e<n.length;e++)document.getElementById("recent-design-"+n[e].id).addEventListener("click",()=>{Sm(n[e]),Jg(n[e])})},Zg=()=>{document.getElementsByClassName("load-design");(()=>{let e=localStorage.getItem(vk.RECENT_FILE),t=e?JSON.parse(e):[];Gg.innerHTML="";for(let e=0;e<t.length;e++)Gg.innerHTML+=` <li class="dropdown-item load-design" id="recent-design-${t[e].id}">\n    <div class="flex item-menu item-center">\n    \n      <p>${t[e].name}</p>\n    </div>\n  </li>`;for(let e=0;e<t.length;e++)document.getElementById("recent-design-"+t[e].id).addEventListener("click",()=>{Sm(t[e]),Ki(Vg),Jg(t[e])})})(),DE.innerText="Untitled"},Qg=document.getElementById("open-maindesign-modal");let em=1;let tm=!1,nm=!0;document.getElementById("open-maindesign-modal-trigger");const im="MainDesign",rm="UserFolder";let am,lm,om,sm,dm,cm,um,pm,hm,gm,mm=null,fm=!1,ym=null,vm=null,bm=[],wm=[];const Em=e=>{let t=String(e.currentTarget.id).split("_")[1],n=GE.find(e=>e.item._id==t);e.ctrlKey?-1==bm.findIndex(e=>e.item._id==t)?bm.push(n):bm=bm.filter(e=>e.item._id!=t):bm=[n],console.log("selectedDesignItems",bm),Dm(),hm=n,Im(hm)},Sm=e=>{mm=e},xm=e=>{Cm()},Im=e=>{hm=e,pm.innerHTML="",gm.value=e.item.name},km=e=>{let t=e.uniqueShafts,n=e.uniquePicks,i=e.uniqueEnds;lm.innerHTML='<option value="">All</option>',sm.innerHTML='<option value="">All</option>',om.innerHTML='<option value="">All</option>';for(let e=0;e<t.length;e++){let n=document.createElement("option");n.value=t[e],n.innerHTML=t[e],sm.appendChild(n)}for(let e=0;e<n.length;e++){let t=document.createElement("option");t.value=n[e],t.innerHTML=n[e],lm.appendChild(t)}for(let e=0;e<i.length;e++){let t=document.createElement("option");t.value=i[e],t.innerHTML=i[e],om.appendChild(t)}},_m=async()=>{try{let e=(await(()=>{const e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/main-design/get-dropdown-value/${t}`,{headers:{token:e}})})()).data.DATA;km(e)}catch(e){km({uniqueEnds:[],uniquePicks:[],uniquePicks:uniquePicks})}},Tm=()=>{Yi("open-maindesign-modal"),document.getElementById("mainContextMenu")&&(document.getElementById("mainContextMenu").style.display="none"),_m(),Uf(),(async()=>{Uf(),am.value="",bm=[],hm=null,document.addEventListener("keydown",Mm),Pm()})(),Qg.style.display="block",Qg.style.animation="slide-down 0.3s ease"},Nm=()=>{Yi(""),um.innerHTML="",Qg.style.display="none",hm=null,document.removeEventListener("keydown",Mm),em=1,tm=!1,nm=!0},Cm=async()=>{if(console.log("selectedMainDesignData",hm),hm)if(hm.itemType==im){let e=await ts(hm.item._id);hm=e.data.DATA,Jg(hm),Sm(hm),Nm()}else hm.itemType==rm&&(ym=hm.item._id,Pm())},Lm=async e=>{if("Enter"==e.key)if(hm.itemType==im){let t={mainDesignId:hm.item._id,name:e.target.value};try{let n=await es(t);GE.find(e=>e.id==hm.id).name=e.target.value,hm.item.name=e.target.value,(mm&&mm.id)==hm.item._id&&(DE.innerText=String(e.target.value)),Kg(n.data.DATA),Toastify({text:"File Saved Successfully",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast(),console.log("resData is",n);let i=document.getElementById(`${hm.itemType}_${hm.item._id}`),r=i.querySelector(".open-pegplan-data-content-file-name");r.innerHTML=e.target.value;let a=i.querySelector("input");r.style.display="block",a.style.display="none",gm.value=e.target.value,fm=!1}catch(e){console.log("inside error",e)}}else if(hm.itemType==rm)try{await og(e.target.value,hm.item._id),Toastify({text:"Folder Rename Successfully",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast();let t=document.getElementById(`${hm.itemType}_${hm.item._id}`),n=t.querySelector(".open-pegplan-data-content-file-name");n.innerHTML=e.target.value;let i=t.querySelector("input");n.style.display="block",i.style.display="none",fm=!1,Pm()}catch(e){console.log("inside error",e)}},Am=()=>{ym=vm,Pm()},Pm=async()=>{if(um.innerHTML='<div class="loader"></div>',ym){let e=await pg(ym);ym=e.data.DATA._id,vm=e.data.DATA.parentFolder&&e.data.DATA.parentFolder._id,QE(e.data.DATA.children)}else{let e=await hg();ym=e.data.DATA._id,vm=e.data.DATA.parentFolder&&e.data.DATA.parentFolder._id,QE(e.data.DATA.children)}let e=document.createElement("div");vm&&(e.innerHTML+='\n    <div class="open-pegplan-data-container-content" id="open-main-design-back-button">\n      <div class="open-pegplan-data-content-image">\n        <img src="back-folder.png" width="60">\n      </div>\n      <div class="open-pegplan-data-content-file-name">..</div>\n      <input style="display:none;"/>\n    </div>');for(let t=0;t<GE.length;t++){let n=GE[t].itemType,i=GE[t].item,r=i.name;e.innerHTML+=`\n        <div class="open-pegplan-data-container-content" id="${n}_${i._id}">\n          <div class="open-pegplan-data-content-image">\n            <img src="${n==im?"maxweavefev.png":"folder.png"}" width="${n==im?"100":"60"}">\n          </div>\n          <div class="open-pegplan-data-content-file-name">${r}</div>\n          <input style="display:none;"/>\n        </div>`}um.innerHTML=e.innerHTML;const t=um.querySelector("#open-main-design-back-button");t&&t.addEventListener("dblclick",Am);const n=document.getElementById("renameDeleteMenu");for(let e=0;e<GE.length;e++){let t=GE[e].itemType,i=GE[e].item;const r=um.querySelector("#"+CSS.escape(`${t}_${i._id}`));tT(r,n),r.addEventListener("contextmenu",Em),r.addEventListener("click",Em),r.addEventListener("dblclick",xm)}const i=document.getElementById("rename-trigger-element"),r=document.getElementById("delete-trigger-element");i.addEventListener("click",Bm),r.addEventListener("click",Fm)},Bm=e=>{console.log("rename button clicked",hm),eT(),fm=!0;let t=document.getElementById(`${hm.itemType}_${hm.item._id}`),n=t.querySelector(".open-pegplan-data-content-file-name"),i=t.querySelector("input");n&&(n.style.display="none"),i&&(i.value=hm.item.name,i.style.display="block",i.focus(),i.addEventListener("keydown",Lm))},Rm=async()=>{if(hm.itemType==rm){let e=await cg(hm.item._id);if(console.log("deleteSelectedItem called",e.data),e.data.DATA>0){if(!await zl(`Folder contains ${e.data.DATA} files Are you sure you want to delete it ?`))return;dg(hm).then(e=>{hm.itemType==im&&Xg(hm.item._id),Pm(),hm=null}).catch(e=>console.log("delete design failed"))}}dg(hm).then(e=>{hm.itemType==im&&Xg(hm.item._id),Pm(),hm=null}).catch(e=>console.log("delete design failed"))},Fm=async e=>{await zl("Are you sure you want to permanently delete this file?")?(console.log("delete design",hm),Rm()):console.log("do not delete it")},Mm=async e=>{const t=document.activeElement;if("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable){if("Delete"!=e.key||fm||hm&&(await zl("Are you sure you want to permanently delete this file?")?Rm():console.log("do not delete it")),"Enter"!=e.key||fm||Cm(),e.ctrlKey&&"x"==String(e.key).toLowerCase())if(bm.length>0){bm.find(e=>e.item._id==mm&&mm.id)?nL("Please Close opened design in order to copy it"):(wm=[...bm],Toastify({text:`${bm.length} ${1==bm.length?"File":"Files"} Copied to clipboard`,className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast())}else wm=[],Toastify({text:"Please Select files",className:"error",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast();if(e.ctrlKey&&"v"==String(e.key).toLowerCase()){console.log("copiedDesignItems====>",wm);let e=wm.map(e=>e.item._id);await sg(e,ym),Pm()}if(e.ctrlKey&&"a"==String(e.key).toLowerCase()){let e=GE.filter(e=>"MainDesign"==e.itemType);bm=[...e],Dm()}"Backspace"==e.key&&console.log("eeee",e)}},Dm=()=>{for(let e=0;e<GE.length;e++){let t=GE[e].itemType,n=GE[e].item,i=document.getElementById(`${t}_${n._id}`),r=i.querySelector(".open-pegplan-data-content-file-name"),a=i.querySelector("input");r.style.display="block",a.style.display="none",i.classList.remove("maindesign-file-active")}for(let e=0;e<bm.length;e++){let t=bm[e].itemType,n=bm[e].item;document.getElementById(`${t}_${n._id}`).classList.add("maindesign-file-active")}},Om=async()=>{em=1,nm=!0;const e={name:am.value.trim(),shaft:sm.value.trim(),picks:lm.value.trim(),ends:om.value.trim()};e.picks&&(e.picks=Number(e.picks)),e.shaft&&(e.shaft=Number(e.shaft)),e.ends&&(e.ends=Number(e.ends)),QE([]),um.innerHTML="",await(async(e={})=>{if(!tm&&nm){tm=!0;try{const t=await ns(em,25,e),{data:n,pagination:i}=t.data.DATA;let r=[];Array.isArray(n)&&n.forEach(e=>{r.push({item:(()=>{const t={...e,_id:e.id};return delete t.id,t})(),itemType:"MainDesign"})}),QE(1===em?r:[...GE,...r]);let a=document.createElement("div");for(let e=0;e<GE.length;e++){let t=GE[e].itemType,n=GE[e].item,i=n.name;a.innerHTML+=`\n          <div class="open-pegplan-data-container-content" id="${t}_${n._id}">\n            <div class="open-pegplan-data-content-image">\n              <img src="${t==im?"maxweavefev.png":"folder.png"}" width="${t==im?"100":"60"}">\n            </div>\n            <div class="open-pegplan-data-content-file-name">${i}</div>\n            <input style="display:none;"/>\n          </div>`}um.innerHTML=a.innerHTML;const l=document.getElementById("renameDeleteMenu");for(let e=0;e<GE.length;e++){let t=GE[e].itemType,n=GE[e].item;const i=um.querySelector("#"+CSS.escape(`${t}_${n._id}`));tT(i,l),i.addEventListener("contextmenu",Em),i.addEventListener("click",Em),i.addEventListener("dblclick",xm)}const o=document.getElementById("rename-trigger-element"),s=document.getElementById("delete-trigger-element");o.addEventListener("click",Bm),s.addEventListener("click",Fm),nm=em<i.totalPages,em++}catch(e){console.log("Error fetching designs:",e)}finally{tm=!1}}})(e)},$m=async()=>{console.log("create new folder called");try{await ug(ym),Pm()}catch(e){console.log("err while creating new folder",e)}},jm=()=>{ym=null,am.value="",sm.value="",lm.value="",om.value="",Pm()},Wm=document.getElementById("simulation-model"),Hm=document.getElementById("simulation-model-trigger"),qm=document.getElementById("simulation-header-trigger"),Um="selected",zm="single_repeat",Vm="repeat",Ym="color",Gm="interlacement";let Jm,Xm,Km,Zm,Qm,ef,tf=Vm,nf=Ym,rf=0;const af=(e,t,n,i)=>{const r=Wm.querySelector(".simulation-canvas-container");let a=r.clientHeight-i,l=r.clientWidth;const o=Math.floor(a/t)+10,s=Math.floor(l/e)+10;return a<l?o:s},lf=()=>{const e=document.getElementById("simulation-model-canvas"),t=Wm.querySelector(".simulation-canvas-container"),n=e.getContext("2d"),i=YO.cols(),r=YO.rows();if(i>5e3)return void uf();let a=tf==zm?(()=>{const e=Wm.querySelector(".simulation-canvas-container"),t=new Uint32Array(I$.memory.buffer,ZO.click_cells(),ZO.click_dentgrid_length());let n=0;for(let e=0;e<t.length;e++)t[e]>0&&(n+=t[e]);const i=YO.cols()+n,r=YO.rows();let a=e.clientHeight,l=e.clientWidth;const o=Math.ceil(a/r)+1,s=Math.ceil(l/i)+1;return Math.min(o,s)})():2,l=a*YO.height()/qi,o=a,s=o*qi/YO.height();l=o,a=Math.ceil(s);const d=document.createElement("canvas"),c=d.getContext("2d");let u=nE();d.width=Math.ceil(i*a),d.height=Math.ceil(r*l),c.clearRect(0,0,d.width,d.height),c.fillStyle="white",c.fillRect(0,0,d.width,d.height),c.fillStyle="black";let p={},h={};for(let e=0;e<i;e++){let t=new Uint32Array(I$.memory.buffer,YO.get_col_new_cell(e),YO.get_col_new_cell_length(e)),n=Array.from({length:r},(e,t)=>t+1);if(nf==Ym||nf==Gm&&tf==Vm)t.forEach(t=>{let i=c$.cells.find(t=>t.index==e);i&&(c.fillStyle=Ld[i.color_code],c.fillRect(e*a,(r-t)*l,a,l)),n=n.filter(e=>e!=t)}),n.forEach(t=>{let n=d$.cells.find(e=>e.index==r-t);n&&(c.fillStyle=$s[n.color_code],c.fillRect(e*a,(r-t)*l,a,l))});else if(nf==Gm){let i=tf==zm?1:.2,o=tf==zm?1:.2;t.forEach(t=>{let s=c$.cells.find(t=>t.index==e),d=d$.cells.find(e=>e.index==r-t);s&&(c.fillStyle=Ld[s.color_code],c.fillRect(e*a+i+o,(r-t)*l,a-2*(i+o),l)),d&&(c.fillStyle=$s[d.color_code],c.fillRect(e*a,(r-t)*l+i+o,i,l-2*(i+o)),c.fillRect(e*a+a-i,(r-t)*l+i+o,i,l-2*(i+o)),c.fillStyle="black",c.fillRect(e*a+i,(r-t)*l,o,l),c.fillRect(e*a+a-(i+o),(r-t)*l,o,l),c.fillRect(e*a,(r-t)*l+i,i,o),c.fillRect(e*a+a-i,(r-t)*l+i,i,o),c.fillRect(e*a,(r-t)*l+l-(i+o),i,o),c.fillRect(e*a+a-i,(r-t)*l+l-(i+o),i,o)),n=n.filter(e=>e!=t)}),n.forEach(t=>{let n=d$.cells.find(e=>e.index==r-t),s=c$.cells.find(t=>t.index==e%c$.size);n&&(c.fillStyle=$s[n.color_code],c.fillRect(e*a,(r-t)*l+(i+o),a,l-2*(i+o))),s&&(c.fillStyle=Ld[s.color_code],c.fillRect(e*a+i+o,(r-t)*l,a-2*(i+o),i+o),c.fillRect(e*a+i+o,(r-t)*l+l-i,a-2*(i+o),i+o),c.fillStyle="black",c.fillRect(e*a,(r-t)*l+i,a,o),c.fillRect(e*a,(r-t)*l+l-(i+o),a,o),c.fillRect(e*a+i,(r-t)*l,o,i),c.fillRect(e*a+a-(i+o),(r-t)*l,o,i),c.fillRect(e*a+i,(r-t)*l+l-(i+o),o,i+o),c.fillRect(e*a+a-(i+o),(r-t)*l+l-(i+o),o,i+o))})}}e.width=t.clientWidth,e.height=t.clientHeight;let g=[],m=[],f=[],y=[];f.sort((e,t)=>e.index-t.index),f.forEach((e,t)=>{if(p[e.index]){let t=(g.length+1)*l,n=p[e.index].allIndexes.filter(e=>-1==y.findIndex(t=>t.index==e%i));if(e.index+1==d$.size){let t=(0==g.length?0:g.length*l)-l/2;g.push({newPosition:{x:0,y:t},color:p[e.index].weftColor,indexData:n,weftIndex:e.index})}else g.push({newPosition:{x:0,y:e.index*l+l/2-t},color:p[e.index].weftColor,indexData:n,weftIndex:e.index})}if(0==e.index){const t=c.getImageData(0,0,d.width,l/2);c.clearRect(0,e.index*l+(g.length-1)*l,d.width,l),c.putImageData(t,0,e.index*l+g.length*l)}else{const t=c.getImageData(0,0,d.width,e.index*l);c.clearRect(0,0,d.width,(e.index+1)*l),c.putImageData(t,0,l)}}),g.forEach(e=>{e.newPosition.y=e.newPosition.y+l*g.length,e.weftIndex+1==d$.size&&g.length>1&&(e.newPosition.y=e.newPosition.y-(g.length-1)*l)}),g.forEach((e,t)=>{c.fillStyle=e.color,e.indexData.forEach(t=>{c.fillRect(t%i*a,e.newPosition.y,a,l)}),e.weftIndex+1!=d$.size&&0!=e.weftIndex||(e.indexData.forEach(e=>{c.fillRect(parseInt(e%i)*a,d.height-l/2,a,l)}),c.clearRect(0,0,d.width,g.length*l)),t==g.length-1&&c.clearRect(0,0,d.width,g.length*l)}),console.log("Extra warp cells is",y);let v=!1;y.sort((e,t)=>e.index-t.index),y.forEach((e,t)=>{if(h[e.index]){let t=m.length*a;t=0;let n=h[e.index].allIndexes.filter(e=>-1==f.findIndex(t=>t.index==parseInt(e/i)));if(0==e.index){let t=(c$.size-1)*a-(0==m.length?0:m.length*a)-a/2;m.push({newPosition:{x:t,y:0},color:h[e.index].warpColor,indexData:n,warpIndex:e.index})}else m.push({newPosition:{x:e.index*a-a/2-t,y:0},color:h[e.index].warpColor,indexData:n,warpIndex:e.index})}let n=1==m.length?0:(m.length-1)*a;const r=c.getImageData((e.index+1)*a-n,0,oN.width,oN.height);if(e.index+1==c$.size){const t=c.getImageData(0,0,a/2,d.height);c.clearRect(e.index*a-n,0,d.width,d.height),c.putImageData(t,e.index*a-n,0),v=!0}else c.clearRect(e.index*a-n,0,d.width,d.height),c.putImageData(r,e.index*a-n,0)}),m.forEach((e,t)=>{e.newPosition.x=e.newPosition.x-a*t,0==e.warpIndex&&(e.newPosition.x=e.newPosition.x-(m.length-1)*a)}),console.log("croppedExtraWarpCanvasInfo in simulation model is",m),console.log("croppedFunctionCanvasInfo in simulation model is",g);let b=g.length>0?Math.max(...g.map(e=>e.weftIndex)):0;parseInt(u),m.forEach(e=>{c.fillStyle=e.color,e.indexData.forEach(t=>{c.fillRect(e.newPosition.x,parseInt(t/i)*l+(parseInt(t/i)<=b?g.length*l:0),a,l)}),0==e.warpIndex&&(e.indexData.forEach(e=>{c.fillRect(-a/2,parseInt(e/i)*l+g.length*l,a,l)}),c.clearRect(d.width-m.length*a,0,m.length*a,d.height))});const w=new Uint32Array(I$.memory.buffer,ZO.click_cells(),ZO.click_dentgrid_length()),E={};for(let e=0;e<w.length;e++)if(w[e]>0){let t=0;for(let n=Object.keys(E).length>0?Object.keys(E)[Object.keys(E).length-1]:0;n<e&&0==w[n];n++)t++;E[e+1]=w[e]}console.log("clickedsad",E,w);let S=0;Object.keys(E).forEach((e,t)=>{console.log("inside cliockasdasd",e,E[e]);const n=document.createElement("canvas"),i=n.getContext("2d");n.height=d.height,n.width=d.width-e*a-S*a,i.drawImage(d,e*a+S*a,0,d.width-e*a-S*a,d.height,0,0,n.width,n.height);const r=document.createElement("canvas"),o=r.getContext("2d");r.height=d.height,r.width=S*a+e*a,o.drawImage(d,0,0,S*a+e*a,d.height,0,0,r.width,r.height);const s=document.createElement("canvas"),u=s.getContext("2d");s.width=E[e]*a,s.height=d.height,d$.cells.forEach(t=>{u.fillStyle=$s[t.color_code],u.fillRect(0,t.index*l,E[e]*a,l)}),d.width=d.width+E[e]*a,c.clearRect(0,0,d.width,d,l),c.drawImage(r,0,0,r.width,r.height),c.drawImage(s,r.width,0,s.width,s.height),n.width>0&&c.drawImage(n,r.width+s.width,0,n.width,n.height),S+=E[e]});const x=document.createElement("canvas"),I=x.getContext("2d");if(x.width=d.width-m.length*a,x.height=d.height-g.length*l,console.log("removeWhiteAreaCanvas height is",x.height,x.width),I.drawImage(d,v&&parseInt(u)<=2?a/2:0,g.length*l,x.width,x.height,0,0,x.width,x.height),c.clearRect(0,0,d.width,d.height),d.height=x.height,d.width=x.width,c.drawImage(x,0,0),d.width>t.clientWidth&&d.height>t.clientHeight||tf==zm)n.drawImage(d,0,d.height-e.height,e.width,e.height,0,0,e.width,e.height);else{const t=n.createPattern(d,"repeat");n.rect(0,0,e.width,e.height),n.fillStyle=t,n.fill(),n.drawImage(d,0,0)}},of=()=>{console.log("open model clicked"),Yi("simulation-model"),Uf(),0==rf&&pf(),Wm.style.display="block",Wm.style.animation="slide-down 0.3s ease",tf!=Um&&(Jm.value=Vm,df({target:{value:Vm}}))},sf=()=>{Yi(""),Wm.style.display="none"},df=e=>{let t=e.target.value;tf=t;let n=document.querySelectorAll(".print-selection-show-hide-part");tf==Um?(Qm.style.display="flex",n.forEach(e=>{e.classList.remove("none")}),uf()):(Qm.style.display="none",n.forEach(e=>{e.classList.add("none")}),lf())},cf=e=>{console.log("e.radsa",e.target.value),nf=e.target.value,tf==Um?uf():lf()},uf=(e=!1)=>{let t=document.querySelector("#design-selection-input-part-1");console.log("first element is",t);const n=t.querySelector("#start-x"),i=t.querySelector("#end-x"),r=t.querySelector("#start-y"),a=t.querySelector("#end-y"),l=new Uint32Array(I$.memory.buffer,ZO.click_cells(),ZO.click_dentgrid_length());let o={};for(let e=0;e<l.length;e++)if(l[e]>0){let t=0;for(let n=Object.keys(o).length>0?Object.keys(o)[Object.keys(o).length-1]:0;n<e&&0==l[n];n++)t++;o[e+1]=l[e]}if(0==i.value&&(i.value=40),0==a.value&&(a.value=40),0!=n.value||0!=r.value||0!=i.value||0!=a.value){console.log("inside if condition");const t=document.getElementById("simulation-model-canvas"),l=(Wm.querySelector(".simulation-canvas-container"),t.getContext("2d"));l.clearRect(0,0,t.width,t.height);const s=YO.cols(),d=YO.rows();let c,u;c=e?1080:Math.min(Math.abs(Number(n.value)-Number(i.value)),s),u=Math.min(Math.abs(Number(r.value)-Number(a.value)),d);let p=((e,t)=>{let n={};const i=new Uint32Array(I$.memory.buffer,ZO.cells(),ZO.selected_dentgrid_length());let r=1,a={};for(let e=0;e<i.length;e++){let t=1,l=e;for(;i[e]==i[e+1];)t++,e++;for(let e=0;e<t;e++)a[e+l]=t,n[e+l]=Math.ceil(20/t);t>r&&(r=t)}return n})();const h=10;let g=Object.values(p).reduce((e,t)=>e+t,0);g=0;let m,f=h*u,y=af(c,u,0,f)>10?af(c,u,0,f):10;if(e){y=parseInt(1080/c)}if(e){m=y,console.log("clicked dent index",o,c,s);let e=parseInt(c/s),t={};for(let n=0;n<e;n++)Object.keys(o).forEach(e=>{t[Number(e)+s*n]=o[e]});o={...t}}else{let e=y,t=e*qi/YO.height();m=Math.ceil(e),y=Math.ceil(t)}console.log("simulation-model-trigger maingridasdas",YO.height(),m,qi),t.width=Math.ceil(c*y)+g,t.height=Math.ceil(u*m),l.clearRect(0,0,t.width,t.height),l.fillStyle="white",l.fillRect(0,0,t.width,t.height),l.fillStyle="black";let v={},b={};console.log("clicked dent index is",o);for(let e=0;e<c;e++){let t=new Uint32Array(I$.memory.buffer,YO.get_col_new_cell(e%s),YO.get_col_new_cell_length(e%s)),n=Array.from({length:u},(e,t)=>t+1);if(nf==Ym&&(t.forEach(t=>{let i=c$.cells.find(t=>t.index==e%s);i&&(l.fillStyle=Ld[i.color_code],l.fillRect(e*y,(u-t)*m,y,m)),n=n.filter(e=>e!=t)}),n.forEach(t=>{let n=d$.cells.find(e=>e.index==u-t);n&&(l.fillStyle=$s[n.color_code],l.fillRect(e*y,(u-t)*m,y,m))})),nf==Gm){let i=10,r=IC(p[e],p);i=1,r=1;let a=0;t.forEach(t=>{let o=c$.cells.find(t=>t.index==e),s=d$.cells.find(e=>e.index==u-t);o&&(l.fillStyle=Ld[o.color_code],l.fillRect(e*y+r+a,(u-t)*m,y-2*(r+a),m)),s&&(l.fillStyle=$s[s.color_code],l.fillRect(e*y,(u-t)*m+i+a,r,m-2*(i+a)),l.fillRect(e*y+y-r,(u-t)*m+i+a,r,m-2*(i+a)),l.fillStyle="black",l.fillRect(e*y+r,(u-t)*m,a,m),l.fillRect(e*y+y-(r+a),(u-t)*m,a,m),l.fillRect(e*y,(u-t)*m+i,r,a),l.fillRect(e*y+y-r,(u-t)*m+i,r,a),l.fillRect(e*y,(u-t)*m+m-(i+a),r,a),l.fillRect(e*y+y-r,(u-t)*m+m-(i+a),r,a)),n=n.filter(e=>e!=t)}),n.forEach(t=>{let n=d$.cells.find(e=>e.index==u-t),o=c$.cells.find(t=>t.index==e%c$.size);n&&(l.fillStyle=$s[n.color_code],l.fillRect(e*y,(u-t)*m+(i+a),y,m-2*(i+a))),o&&(l.fillStyle=Ld[o.color_code],l.fillRect(e*y+r+a,(u-t)*m,y-2*(r+a),i+a),l.fillRect(e*y+r+a,(u-t)*m+m-i,y-2*(r+a),i+a),l.fillStyle="black",l.fillRect(e*y,(u-t)*m+i,y,a),l.fillRect(e*y,(u-t)*m+m-(i+a),y,a),l.fillRect(e*y+r,(u-t)*m,a,i),l.fillRect(e*y+y-(r+a),(u-t)*m,a,i),l.fillRect(e*y+r,(u-t)*m+m-(i+a),a,i+a),l.fillRect(e*y+y-(r+a),(u-t)*m+m-(i+a),a,i+a))})}}let w=0;Object.keys(o).forEach((e,n)=>{const i=document.createElement("canvas"),r=i.getContext("2d");i.height=t.height,i.width=t.width-e*y-w*y,r.drawImage(t,e*y+w*y,0,t.width-e*y-w*y,t.height,0,0,i.width,i.height);const a=document.createElement("canvas"),s=a.getContext("2d");a.height=t.height,a.width=w*y+e*y,s.drawImage(t,0,0,w*y+e*y,t.height,0,0,a.width,a.height);const d=document.createElement("canvas"),c=d.getContext("2d");d.width=o[e]*y,d.height=t.height,d$.cells.forEach(t=>{c.fillStyle=$s[t.color_code],c.fillRect(0,t.index*m,o[e]*y,m)}),t.width=t.width+o[e]*y,l.clearRect(0,0,t.width,t,m),l.drawImage(a,0,0,a.width,a.height),l.drawImage(d,a.width,0,d.width,d.height),i.width>0&&l.drawImage(i,a.width+d.width,0,i.width,i.height),w+=o[e]});const E=document.createElement("canvas"),S=E.getContext("2d");if(E.width=t.width,E.height=t.height,S.drawImage(t,0,0,E.width,E.height,0,0,E.width,E.height),l.clearRect(0,0,t.width,t.height),t.height=E.height,t.width=E.width,l.drawImage(E,0,0),!1){let e=[],n=[],i=l$.cells,r=o$.cells;console.log("function Cell mapping data is",v),console.log("Extra warp cell mapping",b),console.log("function ceells are",i),i.sort((e,t)=>e.index-t.index),i.forEach((n,i)=>{if(v[n.index]){let t=(e.length+1)*m,i=v[n.index].allIndexes.filter(e=>-1==r.findIndex(t=>t.index==e%c));if(n.index+1==d$.size){let t=(0==e.length?0:e.length*m)-m/2;e.push({newPosition:{x:0,y:t},color:v[n.index].weftColor,indexData:i,weftIndex:n.index})}else e.push({newPosition:{x:0,y:n.index*m+m/2-t},color:v[n.index].weftColor,indexData:i,weftIndex:n.index})}if(0==n.index){console.log("height/2 is",m/2);const i=l.getImageData(0,0,t.width,m/2);l.clearRect(0,n.index*m+(e.length-1)*m,t.width,m),l.putImageData(i,0,n.index*m+e.length*m)}else{const e=l.getImageData(0,0,t.width,n.index*m);l.clearRect(0,0,t.width,(n.index+1)*m),l.putImageData(e,0,m)}}),e.forEach(t=>{t.newPosition.y=t.newPosition.y+m*e.length,t.weftIndex+1==d$.size&&e.length>1&&(t.newPosition.y=t.newPosition.y-(e.length-1)*m)}),e.forEach((n,i)=>{l.fillStyle=n.color,n.indexData.forEach(e=>{l.fillRect(e%c*y,n.newPosition.y,y,m)}),n.weftIndex+1!=d$.size&&0!=n.weftIndex||(n.indexData.forEach(e=>{l.fillRect(parseInt(e%c)*y,t.height-m/2,y,m)}),l.clearRect(0,0,t.width,e.length*m)),i==e.length-1&&l.clearRect(0,0,t.width,e.length*m)}),r.sort((e,t)=>e.index-t.index),r.forEach((e,r)=>{if(b[e.index]){let t=n.length*y;t=0;let r=b[e.index].allIndexes.filter(e=>-1==i.findIndex(t=>t.index==parseInt(e/c)));if(console.log("extraWarpCells filteredIndex os",r),0==e.index){let t=(c$.size-1)*y-(0==n.length?0:n.length*y)-y/2;n.push({newPosition:{x:t,y:0},color:b[e.index].warpColor,indexData:r,warpIndex:e.index})}else n.push({newPosition:{x:e.index*y-y/2-t,y:0},color:b[e.index].warpColor,indexData:r,warpIndex:e.index})}let a=1==n.length?0:(n.length-1)*y;const o=l.getImageData((e.index+1)*y-a,0,t.width,t.height);if(e.index+1==c$.size){const n=l.getImageData(0,0,y/2,t.height);l.clearRect(e.index*y-a,0,t.width,t.height),l.putImageData(n,e.index*y-a,0)}else l.clearRect(e.index*y-a,0,t.width,t.height),l.putImageData(o,e.index*y-a,0)}),n.forEach((e,t)=>{e.newPosition.x=e.newPosition.x-y*t,0==e.warpIndex&&(e.newPosition.x=e.newPosition.x-(n.length-1)*y)});let a=e.length>0?Math.max(...e.map(e=>e.weftIndex)):0;console.log("maxweftIndex ius",a),console.log("croppedExtraWarpCanvasInfo is",n),console.log("croppedFunctionCanvasInfo is",e),n.forEach(i=>{l.fillStyle=i.color,i.indexData.forEach(t=>{l.fillRect(i.newPosition.x,parseInt(t/c)*m+(parseInt(t/c)<=a?e.length*m:0),y,m)}),0==i.warpIndex&&(i.indexData.forEach(t=>{l.fillRect(-y/2,parseInt(t/c)*m+e.length*m,y,m)}),l.clearRect(t.width-n.length*y,0,n.length*y,t.height))})}}},pf=()=>{let e=document.getElementById("design-selection-input-part-parent");const t=`<div id="design-selection-input-part-${rf+1}" class="design-selection-input-part-class">\n  <div style="display:flex;flex-direction:row;justify-content:space-between;margin-top:10px;">\n    <div>Starting</div>\n    <div><input type="number" value="0" id="start-x" style="width:50px;margin-right:15px;"/><input type="number" value="0" id="start-y" style="width:50px;"/></div>\n  </div>\n\n  <div style="display:flex;flex-diretion:row;justify-content:space-between;margin-top:10px;">\n  <div>End</div>\n  <div><input type="number" value="0" id="end-x" style="width:50px;margin-right:15px;"/><input type="number" value="0" style="width:50px;" id="end-y"/></div>\n</div>\n\n</div><hr style="margin-top:10px;"/>`;e.innerHTML+=t,rf++},hf=()=>{if(tf==Um){uf();let e=document.getElementById("simulation-model-canvas");$(e).printThis({canvas:!0})}else{let e=document.getElementById("simulation-model-canvas");$(e).printThis({canvas:!0})}},gf=()=>{tf==Um&&uf()},mf=document.getElementById("statusbar");const ff=[{part:"View",keyData:[{command:"Repeat",keyName:"F5",Description:"Repeat On/Off"},{command:"Dencity",keyName:"F4",Description:"Dencity On Off"},{command:"Grid",keyName:"Ctrl+G",Description:"Change Grid Mode"},{command:"Rular",keyName:"Ctrl+R",Description:"Rular Show/Hide"},{command:"Skip Dent",keyName:"Alt+T",Description:"Skip Dent Show/Hide"},{command:"Scrollbar",keyName:"Alt+S",Description:"Scrollbar Show/Hide"},{command:"New File",keyName:"Alt+N",Description:"Create New File"}]},{part:"Design",keyData:[{command:"Warp Num Edit",keyName:"Alt+R",Description:"Open Warp Num Edit"},{command:"Weft Num Edit",keyName:"Alt+F",Description:"Open Weft Num Edit"},{command:"Draft Edit Num",keyName:"Alt+D",Description:"Open Draft Num Edit"},{command:"Pegplan Edit Num",keyName:"Alt+E",Description:"Open Pegplan Num Edit"},{command:"Add Row",keyName:"Ctrl+Click",Description:"Add Row In Draftplan And Pegplan"},{command:"Add Column",keyName:"Alt+Click",Description:"Add Column In Draftplan And Pegplan"},{command:"Remove Row",keyName:"Ctrl+Shift+Click",Description:"Remove Row In Draftplan And Pegplan"},{command:"Remove Column",keyName:"Alt+Shift+Click",Description:"Remove Column In Draftplan And Pegplan"}]}],yf=()=>{Wi?(oT.style.display="block",uw.style.display="block"):(oT.style.display="none",uw.style.display="none"),PN()},vf=()=>{ti?(yN.style.opacity="1",iT.style.opacity="1"):(yN.style.opacity="0",iT.style.opacity="0")},bf=()=>{nr(!ti),Ek("isScrollBarVisible",ti),vf(),PN()},wf=()=>{mf.style.display=ni?"none":"flex",ni=!ni,PN()},Ef=()=>{Jw(),WT(),iE(),PN()},Sf=()=>{Jn=!Jn,ag.checked=Jn,JN.style.display=Jn?"block":"none",Ek("isBeamVisible",Jn),Ef()},xf=()=>{(e=>{Hi=!Hi,e.style.display=Hi?"flex":"none"})(wd),Ek("isDentClickCanvasVisible",Hi),Ef()},If=e=>{setTimeout(()=>{let e=iT.scrollTop,t=yN.scrollLeft;PN(),AN({target:{scrollLeft:0}}),$T({target:{scrollTop:0}}),iT.scrollTo(0,e),yN.scrollTo(t,0)},100)},kf=()=>{zn=10,(e=>{Vn=e})(10),Mn=!Mn,Mn||AN({target:{scrollLeft:0}}),Ef(),PN(),OT()},_f=()=>{Oi==si?Oi=di:Oi==di?Oi=ci:Oi==ci?Oi=ui:Oi==ui&&(Oi=si),Ef()},Tf=e=>{""==Un&&(e.shiftKey?e.deltaY<0?yN.scrollLeft+=qi:yN.scrollLeft-=qi:e.deltaY<0?iT.scrollTop-=qi:iT.scrollTop+=qi)},Nf=()=>{vf(),Wi?(oT.style.display="block",uw.style.display="block"):(oT.style.display="none",uw.style.display="none");document.addEventListener("fullscreenchange",If),document.addEventListener("mouseup",()=>{Vi(!1)}),document.addEventListener("keydown",e=>{"F3"==e.code&&(e.preventDefault(),kf()),"F12"==e.code&&e.preventDefault(),["F11"].includes(e.code)?(e.preventDefault(),If()):["Escape"].includes(e.code)?If():"ArrowLeft"==e.code?(console.log("openModelId",Un),0==Un.length&&(e.preventDefault(),yN.scrollLeft-=qi)):"ArrowRight"==e.code?(console.log("openModelId",Un),0==Un.length&&(e.preventDefault(),yN.scrollLeft+=qi)):"ArrowUp"==e.code?0==Un.length&&(e.preventDefault(),iT.scrollTop-=qi):"ArrowDown"==e.code?0==Un.length&&(e.preventDefault(),iT.scrollTop+=qi):"F4"==e.code?e.preventDefault():"F10"==e.code?(e.preventDefault(),location.reload(!0)):e.ctrlKey&&["g","G"].includes(e.key)?(e.preventDefault(),_f()):e.ctrlKey&&["s","S"].includes(e.key)?(e.preventDefault(),bS(!1,!1)):e.ctrlKey&&["j","J"].includes(e.key)?e.preventDefault():e.ctrlKey&&["o","O"].includes(e.key)?(e.preventDefault(),Tm()):e.ctrlKey&&["b","B"].includes(e.key)?featuresArray.includes("Double Beam")&&(e.preventDefault(),Sf()):e.altKey&&["KeyT"].includes(e.code)?(e.preventDefault(),xf()):e.altKey&&["KeyS"].includes(e.code)&&(e.preventDefault(),bf())}),document.addEventListener("wheel",Tf)};let Cf=document.getElementById("sub-menu"),Lf=document.getElementById("sub-part"),Af=(document.getElementById("file"),document.querySelector("#toggle-menu")),Pf=document.getElementById("sub-toolbar"),Bf=document.getElementById("print-menu"),Rf=document.getElementById("print-menu-trigger"),Ff=document.getElementById("import-menu"),Mf=document.getElementById("import-menu-trigger");const Df=document.getElementById("grid-design-trigger"),Of=document.getElementById("repeat-design-trigger");document.getElementById("toggle-toolbar");let $f=document.getElementById("toggle-part");var jf=null;let Wf=document.getElementById("menuScrollBar"),Hf=document.getElementById("menuRuler"),qf=document.getElementById("menuStatusBar");document.addEventListener("DOMContentLoaded",(function(){for(var e=document.getElementsByClassName("menu-click"),t=null,n=0;n<e.length;n++)e[n].addEventListener("click",i);function i(){var e=this.nextElementSibling;t!==e?(t&&(t.classList.remove("absolute"),t.classList.add("none")),Cf.classList.add("none"),Pf.classList.add("none"),Bf.classList.add("none"),Lf.classList.add("none"),e.classList.remove("none"),e.classList.add("absolute"),t=e):(e.classList.remove("absolute"),e.classList.add("none"),t=null)}document.addEventListener("click",(function(n){var i=n.target;Array.from(e).some((function(e){return e.contains(i)}))||!t||t.contains(i)||(t.classList.remove("absolute"),t.classList.add("none"),t=null)}))}));const Uf=()=>{let e=document.querySelectorAll(".allSubMenu"),t=document.querySelectorAll(".toggle-menu");e.forEach(e=>{e.classList.add("none")}),t.forEach(e=>{e.classList.add("none")})};function zf(){var e=this.nextElementSibling;jf!==e?(jf&&(jf.classList.remove("absolute"),jf.classList.add("none")),Cf.classList.add("none"),e.classList.remove("none"),e.classList.add("absolute"),jf=e):(e.classList.remove("absolute"),e.classList.add("none"),jf=null)}const Vf=document.getElementById("draft-in-part-model"),Yf=document.getElementById("draft-in-part-trigger");let Gf,Jf=0,Xf=-1,Kf=[];const Zf=()=>{Uf(),Yi("draft-in-part-model"),Qf(),Vf.style.display="block",Vf.style.animation="slide-down 0.3s ease"},Qf=()=>{Jf=0,Kf.length>0&&Kf.forEach(e=>{ny(e)})},ey=()=>{Yi(""),Vf.style.display="none"},ty=e=>{if(e.target.checked){let t=e.target.id;Xf=parseInt(t.split("-").at(-1))}},ny=e=>{let t=`\n    <div class="draft-part-container-row draft-part-heading-row">\n      <div></div>\n      <div>Part Name</div>\n      <div>Draft Plan</div>\n      <div>Warp Seq</div>\n     \n    </div>\n  \n    <div class="draft-part-container-row">\n    <input type="radio" class="draft-in-part-radio" id="draft-in-part-radio-${Jf+1}" name="selected-part">\n      <div>\n        <div><textarea rows="5" class="part-name">${e?e.partName:""}</textarea></div>\n        \n      </div>\n      <div>\n        <div><textarea rows="5" class="part-numeric">${e?e.partDraftPlan:""}</textarea></div>\n      <div class="draft-in-part-totalendsperdent-value draft-part-container-second-row">${e?`${e.partEnds}/${e.partDents}`:""}</div>\n      </div>\n      <div class="warp-seq-container" style="display:flex;flex-direction:row">\n        ${e&&Array.isArray(e.partWarpSeq)?e.partWarpSeq.map((t,n)=>`<div>\n          <div> <textarea rows="5" class="part-seq">${t}</textarea></div>\n          <div><div class="draft-in-part-totalwarpseq-value draft-part-container-second-row">${0==n?"Warp Sequence = "+e.partEnds:""}</div></div>\n          </div>`).join(""):'<div>\n        <div> <textarea rows="5" class="part-seq"></textarea></div>\n        <div><div class="draft-in-part-totalwarpseq-value draft-part-container-second-row"></div></div>\n        </div>'}\n\n       \n      </div>\n      <div class="add-warp-seq">+<div>\n    </div>`,n=document.createElement("div");n.id="draft-in-part-"+(Jf+1),n.className="draft-part-container",n.innerHTML=t,Gf.appendChild(n),ly(),Jf++},iy=e=>{let t=e.target.closest(".draft-part-container");Xf=parseInt(t.id.split("-").at(-1)),document.getElementById("draft-in-part-radio-"+Xf).checked=!0},ry=e=>{let t=e.target.closest(".draft-part-container"),n=e.target.classList.value;if("part-name"==n);else if("part-numeric"==n)((e,t)=>{let n=XC(e);const i=lC(String(n).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e))),r=String(n).split("\n").filter(e=>e.length>0).length;t.querySelector(".draft-in-part-totalendsperdent-value").innerText=`Total Ends/Dent -: ${i}/${r}`})(e.target.value,t);else if(n="part-seq"){let n=((e,t)=>{let n=t.querySelectorAll(".part-seq"),i=[];for(let e=0;e<n.length;e++){let t=n.item(e);t&&t.value&&i.push(t.value)}let r=[];for(let e=0;e<i.length;e++){let t=i[e].trim(),n=gC(t);if(-1==r.findIndex(e=>e==n)&&0!=r.length)return!1;r.push(n)}return r.length>0&&(t.querySelector(".draft-in-part-totalwarpseq-value").innerText="Warp Sequence = "+r[0]),!0})(e.target.value,t);e.target.style.border=n?"1px solid black":"1px solid red"}},ay=e=>{let t=e.target.closest(".draft-part-container"),n=parseInt(t.id.split("-").at(-1));oy(n),ly()},ly=()=>{document.querySelectorAll(".draft-in-part-radio").forEach(e=>{e.removeEventListener("change",ty),e.addEventListener("change",ty)});let e=Vf.getElementsByTagName("textarea");for(let t=0;t<e.length;t++)e.item(t).removeEventListener("focus",iy),e.item(t).addEventListener("focus",iy),e.item(t).removeEventListener("change",ry),e.item(t).addEventListener("change",ry);let t=Vf.getElementsByClassName("add-warp-seq");for(let e=0;e<t.length;e++)t.item(e).removeEventListener("click",ay),t.item(e).addEventListener("click",ay)},oy=(e,t)=>{const n=`\n  <div> <textarea rows="5" class="part-seq" value=${t?t.partWarpSeq:""}></textarea></div>\n  <div><div class="draft-in-part-totalwarpseq-value draft-part-container-second-row">${t?t.partWarpSeq:""}</div></div>\n  `,i=document.createElement("div");i.innerHTML=n,i.style.marginLeft="5px";const r=document.getElementById("draft-in-part-"+e),a=r.querySelector(".warp-seq-container");r.querySelector(".draft-part-heading-row").appendChild(document.createElement("div")),a.appendChild(i)},sy=()=>{let e=document.getElementById("draft-in-part-"+Xf);e&&(e.parentNode.removeChild(e),ly(),Jf--)},dy=e=>{let t=e.querySelector(".part-name").value,n=e.querySelector(".part-numeric").value,i=e.querySelector(".part-seq").value,r=e.querySelectorAll(".part-seq"),a=XC(n),l=[];for(let e=0;e<r.length;e++){let t=r.item(e);t.value&&l.push(t.value)}const o=lC(String(a).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e))),s=String(a).split("\n").filter(e=>e.length>0).length,d=gC(String(i).split("/")[0].trim());return Number(o)==Number(d)?(e.querySelector(".part-numeric").style.border="1px solid black",Kf.push({partName:t,partDraftPlan:n,partWarpSeq:l,partEnds:o,partDents:s}),!0):(e.querySelector(".part-numeric").style.border="1px solid red",!1)},cy=()=>{let e=Gf.querySelectorAll(".draft-part-container");Kf=[];for(let t=0;t<e.length;t++){let n=e.item(t);if(!dy(n))return Kf=[],!1}return!0},uy=e=>{Kf=e},py=()=>{cy()&&ey()},hy=document.getElementById("design-with-part-modal"),gy=document.getElementById("design-with-part-modal-trigger");let my,fy;const yy=["Part","Warp-Pattern","Dent","Ends","Repeat","Size"];let vy,by=[...yy],wy=[],Ey=[],Sy=[],xy=-1,Iy={},ky={};const _y=()=>{Uf(),hy.style.display="block",hy.style.animation="slide-down 0.3s ease",Hy()},Ty=e=>{wy=e},Ny=()=>{hy.style.display="none",Yi("")},Cy=(e,t)=>{let n=gC(t),i=parseInt(e/n),r=e%n,a="",l=XC(t).trim();for(let e=0;e<i;e++)a+=l+"\n";if(a=a.trim(),r>0){let e=l.split(/<br>|\s+/),t="";if(1==e.length){let n=GC(e[0]);for(let e=0;e<r;e++)t+=n+"\n";a+="\n"+t}else{for(let n=0;n<r;n++)t+=e[n]+" ";a+="\n"+t}}return a=y$(a.split(/<br>|\s+/).join("\n")).trim(),a},Ly=()=>{let e=Number(jp)+Number(Hp)+Number(Wp);return(()=>{let e=0;for(let t=0;t<Sy.length;t++){let n=Sy[t-1],i=document.getElementById("design-with-part-table-repeat-"+Sy[t]).value;n=null==Sy[t-1]?0:Sy[t-1]+1;let r=0;for(let e=n;e<=Sy[t];e++){let t=document.getElementById("design-with-part-table-dent-"+e).value;r+=Number(t)}let a=r*Number(i);e+=Number(parseFloat(a/(Number(zO.value)/Number(gh.value))).toFixed(2))}const t=document.getElementById("design-with-part-table-size-left-salvage"),n=document.getElementById("design-with-part-table-size-right-salvage");return e+=Number(t.value),e+=Number(n.value),e})()>e+2*e/100?(vy.style.display="block",vy.innerText="Design Width Not Matched With File Design Width",setTimeout(()=>{vy.style.display="none"},6e3),!1):((()=>{vy.style.display="none",wy=[];let e="",t="";for(let n=0;n<Sy.length;n++){let i=Sy[n-1],r=document.getElementById("design-with-part-table-repeat-"+Sy[n]).value,a=document.getElementById("design-with-part-table-size-"+Sy[n]).value;i=null==Sy[n-1]?0:Sy[n-1]+1;let l=0,o=[],s="",d="";for(let e=i;e<=Sy[n];e++){let t=document.getElementById("design-with-part-table-dent-"+e).value,i=document.getElementById("design-with-part-table-ends-"+e).value,r=document.getElementById("design-with-part-table-pattern-"+e).value,a=document.getElementById("design-with-part-table-part-"+e).value,c=Kf.find(e=>e.partName==a),u=document.getElementById("design-with-part-table-pattern-"+e).value,p=XC(c.partDraftPlan),h=p.split("\n").filter(e=>e),g=hC(p),m=parseInt(Number(i)/g),f=Number(i)%g,y="",v=0;for(let e=0;e<m;e++)y+=p+"\n";if(f>0)for(let e=0;e<h.length&&(y+=h[n]+"\n",v+=hC(h[n]),!(v>=f));e++);s+=E$(y),d+=Cy(Number(i),u)+"\n";let b={};Ey.forEach(t=>{let n=document.getElementById(`design-with-part-table-warp-${t}-${e}`).value;n&&(b[t]=Number(n))}),o.push({partName:c.partName,repeatedPart:c.partDraftPlan,pattern:r,dent:Number(t),ends:Number(i),usedYarns:b}),l+=Number(t)}e+="["+s+"]X"+String(r)+"\n",t+="["+d+"]X"+String(r)+"\n",wy.push({repeatedPart:"outerDraft",...0==wy.length&&{tableColumns:by.filter(e=>"Warp-Pattern"!=e)},outerRepeat:Number(r),size:a,withInnerRepeat:o,pattern:"204A"})}aE.value=e.trim(),bE(),Pv("warp"),Sv.value=t.trim(),jv(!1,!1)})(),!0)},Ay=()=>{Ly()&&Ny()},Py=()=>{let e=0,t=Number(jp)+Number(Hp)+Number(Wp);for(let t=0;t<Sy.length;t++){let n=Sy[t-1],i=document.getElementById("design-with-part-table-repeat-"+Sy[t]).value;n=Sy[t-1]?Sy[t-1]+1:0;let r=0;for(let e=n;e<=Sy[t];e++){let t=document.getElementById("design-with-part-table-dent-"+e).value;r+=Number(t)}let a=r*Number(i);e+=Number(parseFloat(a/(Number(zO.value)/Number(gh.value))).toFixed(2))}const n=document.getElementById("design-with-part-table-size-left-salvage"),i=document.getElementById("design-with-part-table-size-right-salvage");return e+=Number(n.value),e+=Number(i.value),e<t},By=e=>{let t=e.target.id;(e=>{Ey.forEach(t=>{document.getElementById(`design-with-part-table-warp-${t}-${e}`).value=""}),document.getElementById("design-with-part-table-repeat-"+e).value="",document.getElementById("design-with-part-table-dent-"+e).value="",document.getElementById("design-with-part-table-size-"+e).value="";let t=document.getElementById("design-with-part-table-ends-"+e),n=document.getElementById("design-with-part-table-part-"+e),i=Kf.find(e=>e.partName==n.value);document.getElementById("design-with-part-table-pattern-"+e).innerHTML=i.partWarpSeq.map(e=>`<option value="${e}">${e}</option>`),t.value=""})(parseInt(t.split("-").at(-1)))},Ry=e=>{let t=e.target.id,n=parseInt(t.split("-").at(-1));My(n),Sy.length>0&&Dy()},Fy=e=>{let t=e.target.id,n=parseInt(t.split("-").at(-1)),i=document.getElementById("design-with-part-table-part-"+n).value,r=Kf.find(e=>e.partName==i),a=document.getElementById("design-with-part-table-dent-"+n),l=(document.getElementById("design-with-part-table-part-"+(n+1)),[]);for(let e=0;e<Ey.length;e++)l.push(document.getElementById(`design-with-part-table-warp-${Ey[e]}-${n}`));if(t.includes("repeat")){e.target.value?Sy.includes(n)||(Sy.push(n),Sy.sort((e,t)=>e-t)):(Sy=Sy.filter(e=>e!=n),Sy.sort((e,t)=>e-t));Py()}else if(t.includes("ends")){a.value=r.partDents*Number(e.target.value)/r.partEnds;Py()}My(n),Sy.length>0&&Dy()},My=e=>{let t=document.getElementById("design-with-part-table-ends-"+e),n=document.getElementById("design-with-part-table-pattern-"+e),i="",r=0;String(XC(n.value)).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let n=0;n<t;n++)i+=e.slice(-1)+"\n",r+=1})});let a={};if(i=i.split("\n").filter(e=>e),Ey.forEach(e=>{a[e]=0}),i.forEach(e=>{if(dC(e)){let t=GC(e).trim(),n=isNaN(parseInt(e))?1:parseInt(e);a[t]?a[t]+=n:a[t]=n}}),Object.keys(a).forEach(e=>{a[e]=a[e]*parseInt(Number(t.value)/r)}),Number(t.value)%r!=0){let e=Number(t.value)%r;for(let t=0;t<i.length&&t!=e;t++)a[i[t]]+=1}Object.keys(a).forEach(t=>{0==a[t]?document.getElementById(`design-with-part-table-warp-${t}-${e}`).value="":document.getElementById(`design-with-part-table-warp-${t}-${e}`).value=a[t]})},Dy=()=>{let e=document.getElementsByClassName("design-with-part-table-row").length-4-1,t=0,n=0,i=0,r={};Ey.forEach(e=>{const t=document.getElementById(`design-with-part-table-warp-${e}-left-salvage`).value,n=document.getElementById(`design-with-part-table-warp-${e}-right-salvage`).value;r[e]=0,t&&(r[e]+=Number(t)),n&&(r[e]+=Number(n))});const a=document.getElementById("design-with-part-table-dent-left-salvage").value,l=document.getElementById("design-with-part-table-ends-left-salvage").value,o=document.getElementById("design-with-part-table-size-left-salvage").value,s=document.getElementById("design-with-part-table-dent-right-salvage").value,d=document.getElementById("design-with-part-table-ends-right-salvage").value,c=document.getElementById("design-with-part-table-size-right-salvage").value;for(let t=0;t<e;t++)document.getElementById("design-with-part-table-size-"+t).value="";for(let e=0;e<Sy.length;e++){let a=Sy[e-1],l=document.getElementById("design-with-part-table-repeat-"+Sy[e]).value,o=document.getElementById("design-with-part-table-size-"+Sy[e]);a=null!=Sy[e-1]?Sy[e-1]+1:0;let s=0,d=0,c={};Ey.forEach(e=>{c[e]=0});for(let t=a;t<=Sy[e];t++){if(!document.getElementById("design-with-part-table-row-"+t))continue;let e=document.getElementById("design-with-part-table-dent-"+t).value,n=document.getElementById("design-with-part-table-ends-"+t).value;s+=Number(e),d+=Number(n),Ey.forEach(e=>{let n=document.getElementById(`design-with-part-table-warp-${e}-${t}`).value;n&&(c[e]+=Number(n))})}let u=s*Number(l),p=d*Number(l),h={};Object.keys(c).forEach(e=>{h[e]=c[e]*l}),o.value=parseFloat(u/(Number(zO.value)/Number(gh.value))).toFixed(2).toString(),t+=Number(o.value),i+=p,n+=u,Object.keys(h).forEach(e=>{r[e]+=h[e]})}t+=Number(o),n+=Number(a),i+=Number(l),t+=Number(c),n+=Number(s),i+=Number(d);document.getElementById("design-with-part-table-size-total").value=t;const u=document.getElementById("design-with-part-table-dent-total"),p=document.getElementById("design-with-part-table-ends-total");if(u.value=n,p.value=i,Object.keys(r).forEach(e=>{document.getElementById(`design-with-part-table-warp-${e}-total`).value=String(r[e])}),Sy.length>0){let e=Array.from({length:Sy.at(-1)},(e,t)=>t+1),t=[];e.forEach(n=>{e.includes(n)||t.push(n)}),t.forEach(e=>{document.getElementById("design-with-part-table-repeat-"+e).value=""})}},Oy=e=>{let t=e.target.id;xy=parseInt(t.split("-").at(-1))},$y=e=>{let t=e.target.id;xy=parseInt(t.split("-").at(-1)),document.getElementById("design-with-part-table-radio-"+xy)&&(document.getElementById("design-with-part-table-radio-"+xy).checked=!0)},jy=()=>{const e=document.createElement("tr");e.className="design-with-part-table-row";let t=document.getElementsByClassName("design-with-part-table-row");e.id="design-with-part-table-row-"+(t.length-4);for(let n=0;n<by.length;n++){const i=document.createElement("td");"Part"==by[n]?(i.innerHTML=`<select id="design-with-part-table-part-${t.length-4}">\n      ${Kf.map(e=>`<option value="${e.partName}">${e.partName}</option>`)}\n    </select>`,e.appendChild(i)):"Dent"==by[n]?(i.innerHTML=`<input type="text" readOnly id="design-with-part-table-dent-${t.length-4}"/>`,e.appendChild(i)):"Ends"==by[n]?(i.innerHTML=`<input type="text" id="design-with-part-table-ends-${t.length-4}"/>`,e.appendChild(i)):"Repeat"==by[n]?(i.innerHTML=`<input type="text" id="design-with-part-table-repeat-${t.length-4}"/>`,e.appendChild(i)):"Size"==by[n]?(i.innerHTML=`<input type="text" readOnly id="design-with-part-table-size-${t.length-4}"/>`,e.appendChild(i)):"Warp-Pattern"==by[n]?(Kf[0]?i.innerHTML=`<select id="design-with-part-table-pattern-${t.length-4}">\n        ${Kf[0].partWarpSeq.map(e=>`<option value="${e}">${e}</option>`)}\n      </select>`:i.innerHTML=`<select id="design-with-part-table-pattern-${t.length-4}">\n      </select>`,e.appendChild(i)):(i.innerHTML=`<input readOnly id="design-with-part-table-warp-${by[n]}-${t.length-4}" type="text"/>`,i.className="design-with-part-table-warp",e.appendChild(i))}const n=document.createElement("td");n.style.border="none",n.style.width="10px";const i=document.createElement("div");i.style.paddingTop="5px",i.style.textAlign="center",i.innerHTML=`<input type="radio" id="design-with-part-table-radio-${t.length-4}" name="selected-part">`,i.addEventListener("change",Oy),n.appendChild(i),e.appendChild(n),my.appendChild(e),(()=>{let e=document.getElementsByClassName("design-with-part-table-row").length-4-1;for(let t=0;t<by.length;t++)if("Part"==by[t]){document.getElementById("design-with-part-table-part-"+e).addEventListener("change",By)}else if("Dent"==by[t]);else if("Ends"==by[t]){let t=document.getElementById("design-with-part-table-ends-"+e);t.removeEventListener("change",Fy),t.addEventListener("change",Fy)}else"Repeat"==by[t]?(document.getElementById("design-with-part-table-repeat-"+e).removeEventListener("change",Fy),document.getElementById("design-with-part-table-repeat-"+e).addEventListener("change",Fy)):"Size"==by[t]||"Warp-Pattern"==by[t]&&(document.getElementById("design-with-part-table-pattern-"+e).removeEventListener("change",Ry),document.getElementById("design-with-part-table-pattern-"+e).addEventListener("change",Ry));let t=hy.querySelectorAll("input"),n=hy.querySelectorAll("select");for(let e=0;e<t.length;e++){let n=t.item(e);n.removeEventListener("click",$y),n.addEventListener("click",$y)}for(let e=0;e<n.length;e++){let t=n.item(e);t.removeEventListener("click",$y),t.addEventListener("click",$y)}})()},Wy=e=>{let t=document.getElementById("design-with-part-table-row-"+e);t&&(t.parentNode.removeChild(t),Sy=Sy.filter(t=>t!=e),Sy.sort((e,t)=>e-t))},Hy=()=>{Yi("design-with-part-modal"),hy.querySelector("#design-with-part-width").innerHTML="Width = "+String(jp+Hp+Wp),Ey=[],Sy=[];for(let e=0;e<Kf.length;e++){let t=Kf[e].partWarpSeq;Array.isArray(t)&&t.forEach(e=>{String(e).replace("[","").replace("]","").split(" ").forEach(e=>{e.replace(/[^a-zA-Z]+/g,"")&&e.replace(/[^a-zA-Z]+/g,"")[0]&&Ey.push(e.replace(/[^a-zA-Z]+/g,"")[0])})})}let e=Ec.warpSeq;String(e).replace("[","").replace("]","").split(" ").forEach(e=>{e.replace(/[^a-zA-Z]+/g,"")&&e.replace(/[^a-zA-Z]+/g,"")[0]&&Ey.push(e.replace(/[^a-zA-Z]+/g,"")[0])});let t=Sc.warpSeq;String(t).replace("[","").replace("]","").split(" ").forEach(e=>{e.replace(/[^a-zA-Z]+/g,"")&&e.replace(/[^a-zA-Z]+/g,"")[0]&&Ey.push(e.replace(/[^a-zA-Z]+/g,"")[0])}),Ey=[...new Set([...Ey])],qy(Ey),(()=>{let e=0;wy.length>0&&(wy.forEach(t=>{Array.isArray(t.withInnerRepeat)&&t.withInnerRepeat.forEach((n,i)=>{let r=document.getElementById("design-with-part-table-row-"+e);r||(jy(),r=document.getElementById("design-with-part-table-row-"+e)),document.getElementById("design-with-part-table-part-"+e).value=n.partName;let a=Kf.find(e=>e.partName==n.partName);if(t.withInnerRepeat.length-1==i){const n=document.getElementById("design-with-part-table-repeat-"+e);document.getElementById("design-with-part-table-size-"+e).value=t.size,n.value=t.outerRepeat,Sy.push(Number(e))}Object.keys(n).forEach(t=>{if("dent"==t){document.getElementById("design-with-part-table-dent-"+e).value=n[t]}else if("ends"==t){document.getElementById("design-with-part-table-ends-"+e).value=n[t]}else if("pattern"==t){const i=document.getElementById("design-with-part-table-pattern-"+e);i.innerHTML=""+a.partWarpSeq.map(e=>`<option value="${e}">${e}</option>`).join(""),i.value=n[t]}else"usedYarns"==t&&Object.keys(n[t]).forEach(i=>{document.getElementById(`design-with-part-table-warp-${i}-${e}`).value=n[t][i]})}),e++})}),Dy())})()},qy=e=>{my.innerHTML="",by=[...yy];by=[...by.slice(0,4),...e,...by.slice(4)];let t=document.createElement("tr");t.className="design-with-part-table-row",by.forEach(e=>{let n=document.createElement("td");n.innerHTML=Rc(e,"warp"),t.appendChild(n)}),my.appendChild(t),(()=>{const e=document.createElement("tr");e.className="design-with-part-table-row",e.id="design-with-part-table-row-left-salvage";let t=tL(XC(Ec.draftPlan)),n=eL(XC(Ec.draftPlan)),i=parseFloat(n/(Number(zO.value)/Number(gh.value))).toFixed(2).toString(),r=PC(Ec.warpSeq);Iy={partName:"Left Salavage",repeatedPart:"",dent:n,size:i,ends:t,usedYarns:r};for(let n=0;n<by.length;n++){const a=document.createElement("td");"Part"==by[n]?(a.innerHTML="Left Selvedge",e.appendChild(a)):"Dent"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-dent-left-salvage" value=${eL(XC(Ec.draftPlan))}>`,e.appendChild(a)):"Ends"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-ends-left-salvage" value=${t} >`,e.appendChild(a)):"Repeat"==by[n]?(a.innerHTML='<input type="text" readOnly id="design-with-part-table-repeat-left-salvage" value=1 >',e.appendChild(a)):"Size"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-size-left-salvage" value=${i} >`,e.appendChild(a)):"Warp-Pattern"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-pattern-left-salvage" value=${Ec.warpSeq} >`,e.appendChild(a)):(a.innerHTML=`<input readOnly id="design-with-part-table-warp-${by[n]}-left-salvage" type="text" value=${r[by[n]]?r[by[n]]:""}>`,a.className="design-with-part-table-warp",e.appendChild(a))}my.appendChild(e)})(),(()=>{fy.innerHTML="";const e=document.createElement("tr");e.className="design-with-part-table-row",e.id="design-with-part-table-row-right-salvage";let t=tL(XC(Sc.draftPlan)),n=eL(XC(Sc.draftPlan)),i=parseFloat(n/(Number(zO.value)/Number(gh.value))).toFixed(2).toString(),r=PC(Sc.warpSeq);ky={partName:"Right Salavage",repeatedPart:"",dent:n,size:i,ends:t,usedYarns:r};for(let n=0;n<by.length;n++){const a=document.createElement("td");"Part"==by[n]?(a.innerHTML="Right Selvedge",e.appendChild(a)):"Dent"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-dent-right-salvage" value=${eL(XC(Sc.draftPlan))}>`,e.appendChild(a)):"Ends"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-ends-right-salvage" value=${t} >`,e.appendChild(a)):"Repeat"==by[n]?(a.innerHTML='<input type="text" readOnly id="design-with-part-table-repeat-right-salvage" value=1 >',e.appendChild(a)):"Size"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-size-right-salvage" value=${i} >`,e.appendChild(a)):"Warp-Pattern"==by[n]?(a.innerHTML=`<input type="text" readOnly id="design-with-part-table-pattern-right-salvage" value=${Sc.warpSeq} >`,e.appendChild(a)):(a.innerHTML=`<input readOnly id="design-with-part-table-warp-${by[n]}-right-salvage" type="text" value=${r[by[n]]?r[by[n]]:""}>`,a.className="design-with-part-table-warp",e.appendChild(a))}fy.appendChild(e)})(),(()=>{const e=document.createElement("tr");e.className="design-with-part-table-row",e.id="design-with-part-table-total-row";for(let t=0;t<by.length;t++){const n=document.createElement("td");"Part"==by[t]?(n.innerHTML="Total",e.appendChild(n)):"Dent"==by[t]?(n.innerHTML='<input type="text" readOnly id="design-with-part-table-dent-total" >',e.appendChild(n)):"Ends"==by[t]?(n.innerHTML='<input type="text" readOnly id="design-with-part-table-ends-total"  >',e.appendChild(n)):"Repeat"==by[t]?(n.innerHTML='<input type="text" readOnly id="design-with-part-table-repeat-total">',e.appendChild(n)):"Size"==by[t]?(n.innerHTML='<input type="text" readOnly id="design-with-part-table-size-total" value=0 >',e.appendChild(n)):(n.innerHTML=`<input readOnly id="design-with-part-table-warp-${by[t]}-total" type="text" value=0>`,n.className="design-with-part-table-warp",e.appendChild(n))}fy.appendChild(e)})(),0==wy.length&&jy()},Uy=e=>{jy()},zy=e=>{0!=xy&&(Wy(xy),Vy(),Dy())},Vy=()=>{let e=xy;for(;document.getElementById("design-with-part-table-row-"+(e+1));)e+=1;for(let t=xy;t<=e;t++){let e=document.getElementById("design-with-part-table-row-"+t),n=Sy.findIndex(e=>e==t);if(-1!=n&&(Sy[n]=t-1),e){e.id="design-with-part-table-row-"+(t-1);document.getElementById("design-with-part-table-part-"+t).id="design-with-part-table-part-"+(t-1);document.getElementById("design-with-part-table-dent-"+t).id="design-with-part-table-dent-"+(t-1);document.getElementById("design-with-part-table-pattern-"+t).id="design-with-part-table-pattern-"+(t-1);document.getElementById("design-with-part-table-ends-"+t).id="design-with-part-table-ends-"+(t-1);document.getElementById("design-with-part-table-repeat-"+t).id="design-with-part-table-repeat-"+(t-1);document.getElementById("design-with-part-table-size-"+t).id="design-with-part-table-size-"+(t-1),Ey.forEach(e=>{document.getElementById(`design-with-part-table-warp-${e}-${t}`).id=`design-with-part-table-warp-${e}-${t-1}`})}}},Yy="https://dev.maxweave.com/v1";let Gy=["rapier-manual-dobby",".csv",".wjl",".heb",".bin","ga731","ga731II","spactrum","pt7","db1-profile",".dat","redflag.dat","bnx-profile",".htt","xml","rifa.dat",".tdw",".rfj",".txt"];const Jy=document.getElementById("dropdown-item-print-preview");let Xy=Si;const Ky=document.getElementById("print-preview-model"),Zy=document.getElementById("print-preview-header-trigger");let Qy={isHeaderVisible:!0,isFRSRVisible:!0,isDetailsVisible:!0,isDraftVisible:!0,isSimulationVisible:!0,isPegplanVisible:!0,isWarpingSectionVisible:!1,isWarpWeftPatternVisible:!1,isNotesVisible:!1,isWarpWeftInfoVisible:!1,isDentVisible:!0,isEndsVisible:!0,isSalvageVisible:!0,isPatternVisible:!0,isPartVisible:!1,isTotalVisible:!0,isYarnNameVisible:!1,isFullReedSpaceVisible:!1,isTwoPickLetisEnabled:!0,pegplanViewType:yi.GRAPHICALYESWITHNUMERICYES,pegplanSorting:Bi,selectedLanguage:Si,isExtraWarpHighlighted:!1,extraWarpPrintStyle:Mi,isInvertDesign:!1,isUncompreesed:!1,isWeftSelector:!1,isWeftColor:!1,isCreaming:!1,isOuterRepeatVisible:!0,isInnerRepeatVisible:!0,isVerticalPattern:!1,isDencity:!1,isAvgEpiPpiVisible:!1,isShowSingleRepeat:!1,isBorderVisible:!1,removeShaftElement:[],unCompressDents:[]},ev=[{key:"designName",english:"Design Name",hindi:"",gujarati:""},{key:"shaft",english:"Shaft",hindi:"",gujarati:""},{key:"reedSpace",english:"Reed Space",hindi:" ",gujarati:""},{key:"reedPerTwoinch",english:"Reed/2 in",hindi:" /2 In",gujarati:"/2 In"},{key:"totalPicks",english:"Pick",hindi:"",gujarati:""},{key:"avgEpi",english:"Avg.EPI",hindi:" EPI",gujarati:" EPI"},{key:"avgPpi",english:"Avg.PPI",hindi:"  ",gujarati:" "},{key:"totalDent",english:"Total Dent",hindi:" ",gujarati:"  "},{key:"totalEnds",english:"Total Ends",hindi:" ",gujarati:" "}],tv=[{key:"Shaft",english:"Shaft",gujarati:" ",hindi:" "},{key:"Drawing",english:"Drawing",gujarati:" ",hindi:" "},{key:"Ends",english:"Ends",gujarati:"",hindi:" "},{key:"Dent",english:"Dent",gujarati:" ",hindi:""},{key:"Pattern",english:"Pattern",gujarati:" ",hindi:" "},{key:"Repeat",english:"Repeat",gujarati:" ",hindi:""},{key:"FRSR",english:"FRSR",gujarati:"  ",hindi:"  "},{key:"Total",english:"Total",gujarati:"  ",hindi:""}],nv=[{key:"Warp Pattern",english:"Warp Pattern",gujarati:"  ",hindi:" "},{key:"Ends - Yarn",english:"Ends - Yarn",gujarati:" - ",hindi:" -  "},{key:"Picks",english:"Picks",hindi:"",gujarati:""},{key:"Repeat",english:"Repeat",gujarati:" ",hindi:""},{key:"Ends",english:"Ends",gujarati:"",hindi:" "},{key:"Weft Pattern",english:"Weft Pattern",gujarati:"  ",hindi:" "}],iv=[{key:"Warp",english:"Warp",gujarati:"",hindi:" "},{key:"Weft",english:"Weft",gujarati:" ",hindi:" "},{key:"Count",english:"Count",gujarati:" ",hindi:" "},{key:"Yarn",english:"Yarn",gujarati:"",hindi:" "},{key:"Percentage",english:"Percentage",gujarati:" %",hindi:" %"},{key:"KGS",english:"KGS",gujarati:"",hindi:""},{key:"Total",english:"Total",gujarati:" ",hindi:""}];const rv=e=>{let t=tv.find(t=>t.key==e);return t?t[Xy]:e},av=e=>{let t=nv.find(t=>t.key==e);return t?t[Xy]:e},lv=e=>{let t=iv.find(t=>t.key==e);return t?t[Xy]:e},ov=()=>{let e=document.getElementById("print-design-draft-container"),t=document.getElementById("print-design-draft-container-header");e.innerHTML=Ku(),t.style.fontWeight="bold",t.innerText=rv("Drawing"),sv()},sv=()=>{document.querySelectorAll(".dentColumn").forEach(e=>{e.style.display=Qy.isDentVisible?"table-cell":"none"}),document.querySelectorAll(".endsColumn").forEach(e=>{e.style.display=Qy.isEndsVisible?"table-cell":"none"}),document.querySelectorAll(".salvageColumn").forEach(e=>{e.style.display=Qy.isFullReedSpaceVisible&&Qy.isSalvageVisible?"table-row":"none"}),document.querySelectorAll(".patternColumn").forEach(e=>{e.style.display=Qy.isPatternVisible?"table-cell":"none"}),document.querySelectorAll(".secondRepeatColumn").forEach(e=>{e.style.display=Qy.isOuterRepeatVisible?"table-cell":"none"}),document.querySelectorAll(".firstRepeatColumn").forEach(e=>{e.style.display=Qy.isInnerRepeatVisible?"table-cell":"none"}),document.querySelectorAll(".designTypeColumn").forEach(e=>{e.style.display=Qy.isPartVisible?"table-cell":"none"}),document.querySelectorAll(".totalRow").forEach(e=>{e.style.display=Qy.isTotalVisible?"table-row":"none"}),document.querySelectorAll(".frsrColumn").forEach(e=>{e.style.display=Qy.isFRSRVisible&&Qy.isFullReedSpaceVisible?"table-cell":"none"}),rp()},dv=e=>{console.log("check box value changed",e.target.checked);let t=e.target.id,n=e.target.checked;if("sidebar-checkbox-header"==t){Qy.isHeaderVisible=n;let e=document.getElementById("print-company-details");xk("isHeaderVisible",n),e.style.display=n?"flex":"none",Qy.isSimulationVisible&&yv()}else if("sidebar-checkbox-details"==t){Qy.isDetailsVisible=n;let e=document.getElementById("print-design-details");xk("isDetailsVisible",n),e.style.display=n?"flex":"none",Qy.isSimulationVisible&&yv()}else if("sidebar-checkbox-draft"==t){Qy.isDraftVisible=n,xk("isDraftVisible",n);let e=document.getElementById("print-design-draft"),t=document.getElementById("draft-title");e.style.display=n?"block":"none",t.style.display=n?"block":"none",document.getElementById("print-design-draft-page-break").style.display=Qy.isDraftVisible?"block":"none"}else if("sidebar-checkbox-simulation"==t){Qy.isSimulationVisible=n,xk("isSimulationVisible",n),document.getElementById("print-design-simulation").style.display=n?"block":"none",document.getElementById("print-design-simlation-page-break").style.display=n?"block":"none",fv(),n&&yv()}else if("sidebar-checkbox-pegplan"==t){Qy.isPegplanVisible=n;let e=document.getElementById("print-design-pegplan-container");xk("isPegplanVisible",n),e.style.display=n?"flex":"none"}else if("sidebar-checkbox-warping-section"==t)xk("isWarpingSectionVisible",n),Qy.isWarpingSectionVisible=n;else if("sidebar-checkbox-warp-weft-pattern"==t){Qy.isWarpWeftPatternVisible=n;let e=document.getElementById("warp-weft-pattern-container");document.getElementById("print-design-warp-weft-pattern-page-break").style.display=Qy.isWarpWeftPatternVisible?"block":"none",xk("isWarpWeftPatternVisible",n),e.style.display=n?"block":"none"}else if("sidebar-checkbox-warp-weft-info"==t){Qy.isWarpWeftInfoVisible=n;let e=document.getElementById("print-warp-weft-info");xk("isWarpWeftInfoVisible",n),e.style.display=n?"grid":"none",Qy.isSimulationVisible&&yv()}else if("sidebar-checkbox-notes"==t){Qy.isNotesVisible=n;let e=document.querySelector(".design-notes-container");xk("isNotesVisible",n),e.style.display=Qy.isNotesVisible?"block":"none"}else if("sidebar-checkbox-dent"==t)Qy.isDentVisible=n,xk("isDentVisible",n),sv();else if("sidebar-checkbox-ends"==t)Qy.isEndsVisible=n,xk("isEndsVisible",n),sv();else if("sidebar-checkbox-salvage"==t){Qy.isSalvageVisible=n,xk("isSalvageVisible",n),ov(),ap(),document.querySelectorAll(".salvageColumn").forEach(e=>{e.style.display=n?"table-row":"none"})}else if("sidebar-checkbox-pattern"==t)Qy.isPatternVisible=n,xk("isPatternVisible",n),sv();else if("sidebar-checkbox-pattern"==t)Qy.isPatternVisible=n,xk("isPatternVisible",n),sv();else if("sidebar-checkbox-extrawarp"==t)Qy.isExtraWarpHighlighted=n,xk("isExtraWarpHighlighted",n),ov();else if("sidebar-checkbox-outerrepeat"==t){Qy.isOuterRepeatVisible=n,xk("isOuterRepeatVisible",n),document.querySelectorAll(".secondRepeatColumn").forEach(e=>{e.style.display=n?"table-cell":"none"})}else"sidebar-checkbox-innerrepeat"==t?(Qy.isInnerRepeatVisible=n,xk("isInnerRepeatVisible",n),sv()):"sidebar-checkbox-yarnname"==t?(Qy.isYarnNameVisible=n,xk("isYarnNameVisible",n),ov()):"sidebar-checkbox-vertical-pattern"==t?(Qy.isVerticalPattern=n,xk("isVerticalPattern",n),ov()):"sidebar-checkbox-twopickletis"==t?(Qy.isTwoPickLetisEnabled=n,xk("isTwoPickLetisEnabled",n),cv()):"sidebar-checkbox-total"==t?(Qy.isTotalVisible=n,xk("isTotalVisible",n),ov()):"sidebar-show-single-repeat"==t?(Qy.isShowSingleRepeat=n,xk("isShowSingleRepeat",n),ov()):"sidebar-border-visible"==t?(Qy.isBorderVisible=n,xk("isBorderVisible",n),ov()):"sidebar-checkbox-frsr"==t?(Qy.isFullReedSpaceVisible=n,xk("isFullReedSpaceVisible",n),ov(),ap()):"sidebar-checkbox-frsrvisibility"==t?(Qy.isFRSRVisible=n,xk("isFRSRVisible",n),sv()):"sidebar-checkbox-avg-epi-ppi"==t?(Qy.isAvgEpiPpiVisible=n,xk("isAvgEpiPpiVisible",n),lp()):"sidebar-checkbox-weftselector"==t?(Qy.isWeftSelector=n,xk("isWeftSelector",n),cv()):"sidebar-checkbox-weftcolor"==t?(Qy.isWeftColor=n,xk("isWeftColor",n),cv()):"sidebar-checkbox-creaming"==t?(Qy.isCreaming=n,xk("isCreaming",n),cv()):"sidebar-checkbox-dencity"==t?(Qy.isDencity=n,xk("isDencity",n),cv()):"sidebar-checkbox-invertdesign"==t?(Qy.isInvertDesign=n,xk("isInvertDesign",n),cv()):"sidebar-checkbox-uncompressed"==t&&(Qy.isUncompreesed=n,xk("isUncompreesed",n),cv())},cv=()=>{let e=document.getElementById("print-design-pegplan-container"),t=WC();e.innerHTML=Qu(t),Qy.pegplanViewType==yi.WATERJETLETIS?(e=>{let t=FC();console.log("fidder color object is",t);const n=2*KO.cols();let i=Zu(e);console.log("value of col is",n);const r=i.length,a=Dn,l=On,o=document.createElement("canvas");o.width=4*Math.ceil(19*n),o.height=4*Math.ceil(19*r);const s=o.getContext("2d");s.scale(4,4);for(let e=0;e<n+1;e++)s.beginPath(),s.strokeStyle="black",s.moveTo(a+19*e,l),s.lineTo(a+19*e,l+19*r),s.stroke(),s.closePath();for(let e=0;e<r+1;e++)s.beginPath(),s.strokeStyle="black",s.moveTo(a,l+19*e),s.lineTo(a+19*n,l+19*e),s.stroke(),s.closePath();console.log("windoe device pixel ration is",window.devicePixelRatio),Qy.pegplanSorting==Ri&&(i.reverse(),i.forEach(e=>{let t=e.pegplan.split("\n");e.pegplan=t.reverse().join("\n")}));let d=[];i.forEach((e,t)=>{let i=String(e.pegplan),r=sC(i,n/2);String(r).split(" ").forEach((e,n)=>{if("0"==e)return;let i=t,r=n+1,a=19*(r-1),o=19*i;s.fillStyle=-1!=d.findIndex(e=>e.index==i)?"red":"black",s.fillRect(a+2,o+l+2,15,15)})}),s.translate(.5,.5);const c=document.createElement("canvas"),u=c.getContext("2d"),p=i.length;c.width=304,c.height=19*p*4,u.scale(4,4);for(let e=0;e<2;e++)u.beginPath(),u.strokeStyle="black",u.moveTo(a+76*e,l),u.lineTo(a+76*e,l+19*r),u.stroke(),u.closePath();for(let e=0;e<p+1;e++){if(u.beginPath(),u.strokeStyle="black",u.moveTo(a,l+19*e),e>0){u.textAlign="center";const t=String(i[e-1].no);u.fillText(t,a+38,l+19*e-19/3)}u.lineTo(a+76*n,l+19*e),u.stroke(),u.closePath()}const h=document.createElement("canvas");h.width=c.width+o.width,h.height=o.height;const g=h.getContext("2d");g.drawImage(c,0,0),g.drawImage(o,c.width,0),g.translate(.5,.5),h.style.transform=`scale(${parseFloat(1/4).toString()})`;const m=Math.ceil(h.height/6080);let f=document.querySelector(".design-pegplan");f.style.overflow="hidden";for(let e=0;e<m;e++){const t=document.createElement("div"),i=document.createElement("table");i.style.marginLeft="48px",i.style.width="auto";const r=document.createElement("tr");for(let e=0;e<n;e++){const t=document.createElement("th");t.style.width="12px",t.style.fontSize="14px",t.style.border="1px solid black",t.style.fontFamily="Rubik",t.style.padding=0,t.style.textAlign="center",t.innerHTML=e+1,r.appendChild(t)}i.appendChild(r);const o=document.createElement("canvas"),s=o.getContext("2d"),d=76,c=76;o.height=d,o.width=c*n;const u=2;for(let e=0;e<n;e++)s.beginPath(),s.strokeStyle="black",s.fillStyle=e%2==0?"black":"red",s.moveTo(a+e*c,l),s.lineTo(a+e*c,l+u*d),s.textAlign="center",s.font="bold 56px Rubik",s.fillText(Math.ceil((e+1)/2),a+e*c+c/2,d/4*3),s.stroke(),s.closePath();for(let e=0;e<u+1;e++)s.beginPath(),s.strokeStyle="black",s.moveTo(a,l+e*d),s.lineTo(a+n*c,l+e*d),s.stroke(),s.closePath();const p=s.getImageData(0,0,o.width,o.height),y=g.getImageData(0,1520*e*4,h.width,1==m?h.height:6080),v=document.createElement("canvas");v.width=y.width,v.height=y.height+76;const b=v.getContext("2d");v.style.transformOrigin="top left",b.putImageData(p,304,0),b.putImageData(y,0,76),v.style.transform=`scale(${parseFloat(1/4).toString()})`,t.appendChild(v),t.style.height=v.height/4+16+"px",t.style.width=v.width/4+16+"px",f.appendChild(t)}f.style.display="grid",f.style.gridTemplateColumns=n>20?"1fr":"1fr 1fr",f.style.width="auto"})(t):Qy.pegplanViewType!=yi.GRAPHICALNOWITHNUMERICNO&&ep(t)},uv=e=>{console.log("handlePegplanTypeChange");document.getElementById("print-design-pegplan-container");let t=e.target.value;xk("pegplanViewType",t),Qy.pegplanViewType=t,pv(t),cv()},pv=e=>{let t=document.getElementById("sidebar-checkbox-twopickletis"),n=document.getElementById("sidebar-checkbox-uncompressed"),i=document.getElementById("sidebar-checkbox-weftselector"),r=document.getElementById("sidebar-checkbox-creaming");e==yi.GRAPHICALNOWITHNUMERICNO?(Qy.isTwoPickLetisEnabled=!0,t.checked=!0,t.disabled=!0,n.disabled=!1):e==yi.WATERJETLETIS?(Qy.isTwoPickLetisEnabled=!0,Qy.isUncompreesed=!0,Qy.isCreaming=!1,Qy.isWeftSelector=!1,t.disabled=!0,n.checked=!0,n.disabled=!0,i.disabled=!0,r.disabled=!0):(t.disabled=!1,n.disabled=!1,i.disabled=!1,r.disabled=!1)},hv=e=>{let t=e.target.value;Qy.pegplanSorting=t,xk("pegplanSorting",t),cv()},gv=e=>{if(e.srcElement){console.log(e.srcElement.style),-1==Qy.removeShaftElement.findIndex(t=>t==Number(e.srcElement.innerText))?(Qy.removeShaftElement.push(Number(e.srcElement.innerText)),e.srcElement.style.backgroundColor="red"):(Qy.removeShaftElement=Qy.removeShaftElement.filter(t=>t!=Number(e.srcElement.innerText)),e.srcElement.style.backgroundColor="gainsboro"),xk("removeShaftElement",JSON.stringify(Qy.removeShaftElement)),cv()}},mv=e=>{if(e.srcElement){-1==Qy.unCompressDents.findIndex(t=>t==Number(e.srcElement.innerText))?(Qy.unCompressDents.push(Number(e.srcElement.innerText)),e.srcElement.style.backgroundColor="red"):(Qy.unCompressDents=Qy.unCompressDents.filter(t=>t!=Number(e.srcElement.innerText)),e.srcElement.style.backgroundColor="gainsboro"),ov()}},fv=()=>{document.getElementById("design-details-table-container").innerHTML=qu.map(e=>{let t=ev.find(t=>t.key==e.key),n=t?t[Xy]:e.label;return"reedPerTwoinch"==e.key&&(n=String(n).replace("2",gh.value)),`<div class="print-details-table-container"><div style="border-radius:6px;font-size:13px;font-weight:bold;">${n}</div><div style="border:none;width:auto;">:</div><div style="font-size:13px;border-radius:6px;" ${"totalEnds"==e.key?"id=designHeader-totalEnds":""}>${e.value}</div></div>`}).join("")},yv=()=>{if(!Qy.isSimulationVisible)return;let e=document.querySelector("#design-selection-input-part-1");console.log("first element is",e);e.querySelector("#start-x");const t=e.querySelector("#end-x"),n=(e.querySelector("#start-y"),e.querySelector("#end-y"));t.value=GO.cols(),n.value=KO.rows(),uf(!0),t.value=40,n.value=40,setTimeout(()=>{const e=document.getElementById("simulation-model-canvas");if(0==e.height||0==e.width)return;const t=e.getContext("2d"),n=document.getElementById("print-design-simulation-canvas"),i=n.getContext("2d");let r=document.getElementById("print-design-simulation");r.style.height=(()=>{let e=document.getElementById("print-company-details"),t=document.getElementById("print-design-details"),n=document.getElementById("print-warp-weft-info"),i=1520-e.clientHeight-n.clientHeight-t.clientHeight;return parseInt(i-140)})()+"px",n.height=r.offsetHeight,n.width=r.offsetWidth;const a=t.getImageData(0,0,e.width,e.height);let l=Math.ceil(n.height/a.height);for(let e=0;e<l;e++)i.putImageData(a,0,e*a.height);console.log("printSimulationCanvas is",n)},0)};const vv=e=>{console.log("Extra warp styl;e",e.target.value),Qy.extraWarpPrintStyle=e.target.value,xk("extraWarpPrintStyle",e.target.value),ov()},bv=e=>{Xy=e.target.value,xk("selectedLanguage",Xy),fv(),ov(),(()=>{let e=UC(),t=qC();document.getElementById("warp-weft-pattern-container").innerHTML=`<div class="warp-weft-table-container">\n  <div id="warp-pattern-data-table-container"  class="warp-table-container">\n    <div><pre>${av("Warp Pattern")}</pre></div>\n    ${tp(t,"warp")}\n    </div>\n  <div class="weft-table-container">\n    <div><pre>${av("Weft Pattern")}</pre></div>\n      ${tp(e,"weft")}\n    </div>\n</div>`})(),lp()},wv=async()=>{console.log("onPrintPreviewModelOpen==>"),op(yi.GRAPHICALNOWITHNUMERICNO,!1);document.querySelectorAll(".printpreview-sidebar-checkbox").forEach(e=>{e.removeEventListener("change",dv),e.addEventListener("change",dv)});document.querySelectorAll('input[name="printpreview-sidebar-extrawarpstyle-type"]').forEach(e=>{e.removeEventListener("change",vv),e.addEventListener("change",vv)}),document.getElementById("print-company-details").style.display=Qy.isHeaderVisible?"flex":"none",document.getElementById("print-design-details").style.display=Qy.isDetailsVisible?"flex":"none",document.getElementById("print-design-draft").style.display=Qy.isDraftVisible?"block":"none",document.getElementById("print-design-draft-page-break").style.display=Qy.isDraftVisible?"block":"none",document.getElementById("print-design-simulation").style.display=Qy.isSimulationVisible?"block":"none",document.getElementById("print-design-simlation-page-break").style.display=Qy.isSimulationVisible?"block":"none",document.getElementById("print-pegplan-section").style.display=Qy.isPegplanVisible?"block":"none",document.getElementById("warp-weft-pattern-container").style.display=Qy.isWarpWeftPatternVisible?"block":"none",document.getElementById("print-design-warp-weft-pattern-page-break").style.display=Qy.isWarpWeftPatternVisible?"block":"none",document.getElementById("print-warp-weft-info").style.display=Qy.isWarpWeftInfoVisible?"grid":"none",document.querySelector(".design-notes-container").style.display=Qy.isNotesVisible?"block":"none",sv(),fv(),yv();const e=document.getElementById("printpreview-selected-language");e.removeEventListener("change",bv),e.addEventListener("change",bv);const t=document.getElementById("printpreview-pegplan-view");t.removeEventListener("change",uv),t.addEventListener("change",uv);const n=document.getElementById("printpreview-pegplan-sorting");n.removeEventListener("change",hv),n.addEventListener("change",hv);document.querySelectorAll(".printpreview-remove-shaft-number").forEach(e=>{-1!=Qy.removeShaftElement.findIndex(t=>t==Number(e.innerHTML))&&(e.style.backgroundColor="red"),e.removeEventListener("click",gv),e.addEventListener("click",gv)});document.querySelectorAll(".printpreview-uncompress-dent").forEach(e=>{e.removeEventListener("click",mv),e.addEventListener("click",mv)}),t.value=Qy.pegplanViewType,Xy=Qy.selectedLanguage,e.value=Qy.selectedLanguage,bv({target:{value:Qy.selectedLanguage}}),uv({target:{value:Qy.pegplanViewType}}),await(()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;const t=localStorage.getItem("token");return Zo.post(ba+"/analytics",{userId:e,isPreview:!0},{headers:{token:t}})})(),document.getElementById("print-button").addEventListener("click",async()=>{let e=document.getElementById("print-item"),t=".";for(let e=0;e<160;e++)t+="";$(e).printThis({canvas:!0,beforePrint:()=>{document.title=DE.innerText+" Production Sheet"},pageTitle:"Design Name :- "+DE.innerText,afterPrint:async()=>{document.title="Maxweave";let e=document.getElementsByClassName("print-footer-maxweave");console.log("print footer items ",e);for(let t=0;t<e.length;t++)e.item(t).parentElement.removeChild(e.item(t));await Kd()}})})};let Ev="weft",Sv=document.getElementById("warpWeftEditnumber"),xv=document.getElementById("totalWarpWeft"),Iv=document.getElementById("totalWarpWeftLabel"),kv=document.getElementById("warpweft-modal-title");const _v=document.getElementById("edit-sequence-error-message"),Tv=document.getElementById("current-position-warpweft-seq"),Nv=document.getElementById("copy-warp-to-weft-element"),Cv=document.getElementById("copy-weft-to-warp-element"),Lv=document.getElementById("edit-sequance-compress");let Av=Sr;const Pv=e=>{Ev=e},Bv=(e,t)=>{let n="",i={},r=0;for(let e=0;e<=c$.getMaximumIndex();e++){let t=c$.findElementFromIndex(e);t?(r>0&&(n+=r.toString()+"\n"),n+=t.color_code+"\n",r=0):r++}if(e.rightsalvage&&(Qy.isFullReedSpaceVisible&&Qy.isSalvageVisible||t)){let t=e.rightsalvage.draft.pattern,n=PC(t);Object.keys(n).forEach(e=>{i[e]=n[e]})}if(e.leftsalvage&&(Qy.isFullReedSpaceVisible&&Qy.isSalvageVisible||t)){let t=e.leftsalvage.draft.pattern,n=PC(t);Object.keys(n).forEach(e=>{i[e]+=n[e]})}let a={};for(let e=0;e<n.length;e++)dC(n[e])&&(a[n[e]]?a[n[e]]=a[n[e]]+1:a[n[e]]=1);if(Object.keys(a).forEach(n=>{i[n]?i[n]=i[n]+a[n]*(Qy.isFullReedSpaceVisible||t?e.bodyRepeat:1):i[n]=a[n]*(Qy.isFullReedSpaceVisible||t?e.bodyRepeat:1)}),e.extrapart&&(Qy.isFullReedSpaceVisible||t)){let t=e.extrapart.tar,r=n.replaceAll("\n","").replaceAll(" ","");for(let e=0;e<t;e++){let t=r[e%r.length];i[t]+=1}}let l=Object.keys(i).sort(),o={};l.forEach(e=>{e&&(o[e]=i[e])}),i=o;let s="";return Object.keys(i).forEach(e=>{s+=`${i[e]}${e}\n`}),s=s.trim(),s},Rv=(e=!1)=>{let t="";if(Tv.value="","weft"==Ev){o_(n_.WEFT),Iv.innerText="Total Weft",kv.innerHTML="Edit Weft";let n=0,i=null,r=-1;if(console.log("weft----\x3e",d$),d$.compressSplitter.length>0&&(r=0,i=d$.compressSplitter[r]),Ys==Li||"20A"==d$.fixNumericText){for(let e=d$.size-1,a=0;e>=d$.getMinimumIndex();e--,a++){let l=d$.findElementFromIndex(e);l?(n>0&&(t+=n.toString()+"\n"),t+=l.color_code+"\n",n=0,i==a+1&&(i&&(t+="cs"),r++,i=d$.compressSplitter[r])):n++}let a=[],l=t.split("cs");for(let e=0;e<l.length;e++){let t=l[e],n=y$(y$(t));cC(n,"["),a.push(SC(y$(n),!1).replace(/[\s]+/g,"\n").trim())}if(e)return a.join("\n\n");Sv.value=a.join("\n\n"),Fv(Sv.value)}else{let t=zC();if(console.log("sasdas",d$.fixNumericText),DC(t,d$.fixNumericText)?Sv.value=d$.fixNumericText:Sv.value=y$(y$(t)),Sv.value=SC(Sv.value,!1).replace(/ +/g,"\n").trim(),Fv(Sv.value),e)return Sv.value}}else{o_(n_.WARP),Iv.innerText="Total Warp",kv.innerHTML="Edit Warp";let n=null,i=-1;c$.compressSplitter.length>0&&(i=0,n=c$.compressSplitter[i]);let r=0;if($d==Ni||"20A"==c$.fixNumericText){for(let e=0,a=0;e<=c$.getMaximumIndex();e++,a++){let l=c$.findElementFromIndex(e);l?(r>0&&(t+=r.toString()+"\n"),t+=l.color_code+"\n",r=0,n==a+1&&(n&&(t+="cs"),i++,n=c$.compressSplitter[i])):r++}let a=[],l=t.split("cs");for(let e=0;e<l.length;e++){let t=l[e],n=y$(t);cC(n,"["),a.push(SC(y$(n),!1).replace(/[\s]+/g,"\n").trim())}if(e)return a.join("\n\n");Sv.value=a.join("\n\n"),Fv(Sv.value)}else{let t=qC(!0),n=XC(y$(t)).trim(),i=XC(c$.fixNumericText).trim();if(Sv.value=n==i?c$.fixNumericText:y$(y$(t)),Sv.value=SC(Sv.value,!1).replace(/[\s]+/g,"\n").trim(),Fv(Sv.value),e)return Sv.value}}},Fv=e=>{xv.value=gC(e)},Mv=async()=>{if(eT(),ph.value==uh.value){if(await zl("Are you sure you want to copy warp to weft ?")){console.log("yes----\x3e");let e=qC();Pv("weft"),Sv.value=e,d$.setFixNumericText(Sv.value),jv(!1,!1)}}else nL("Warp width must be equal to weft height !!")},Dv=async()=>{if(eT(),ph.value==uh.value){if(await zl("Are you sure you want to copy weft to warp ?")){let e=UC();Pv("warp"),Sv.value=e,c$.setFixNumericText(Sv.value),jv(!1,!1)}}else nL("Weft Height must be equal to warp width !!")},Ov=e=>{let t=String(e.target.value),n={".":" ","{":"[","}":"]","(":"[",")":"]","-":""},i=Sv.selectionStart;t=t.split("").map(e=>((e,t)=>"-"==t||e[t]?e[t]:t)(n,e)).join(""),Sv.value=t.toUpperCase(),Sv.setSelectionRange(i,i),Sv.focus(),Fv(t)},$v=e=>{_v.style.display="block",_v.innerText=e,setTimeout(()=>{_v.style.display="none"},2e3)},jv=(e=!1,t=!1)=>{if((()=>{let e,t=Sv.value,n=/\b\d+\b(?![A-Za-z])(?<![*Xx]\d*)/g,i=!1;for(;null!==(e=n.exec(t));){let t=e.index+e[0].length;Sv.setSelectionRange(t,t),Sv.focus(),_v.style.display="block",_v.innerText=" Fix numeric where cursor is positioned",setTimeout(()=>{_v.style.display="none"},6e3),i=!0;break}return i})())return!1;if(cC(Sv.value,"[")!=cC(Sv.value,"]"))return $v("Check Brackets Properly"),!1;_v.style.display="none";let n=1,i=String(Sv.value).toUpperCase(),r=XC(i),a=i.split("\n\n"),l=[],o=0;for(let e=0;e<a.length;e++){o+=gC(a[e].trim()),l.push(o)}l.pop();let s=yN.scrollLeft,d=iT.scrollTop;if("weft"==Ev){if(String(r).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let e=0;e<t;e++)n++})}),!t&&KO.rows()!=n-1)return $v("Weft Heigth must be equal to no. of picks"),!1;d$.cells=[],d$.size<n-1&&(d$.size=n-1,l$.update_size(d$.size),s$.update_size(d$.size),h$.update_size(d$.size)),n=1,String(r).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let i=0;i<t;i++)d$.update_cell(d$.size-n,GC(e)),n++})}),e||d$.setFixNumericText(Sv.value),d$.compressSplitter=[...l],WT()}if("warp"==Ev){if(n=0,String(r).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let e=0;e<t;e++)n++})}),GO.cols()!=n)return void $v("Warp width must be equal to ends");c$.cells=[],c$.size<n&&(c$.size=n),n=0,String(r).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let i=0;i<t;i++)c$.update_cell(n,e.slice(-1)),n++})}),e||c$.setFixNumericText(Sv.value),c$.compressSplitter=[...l],Jw()}return"radio-color"==Yn&&YN(),"radio-interlacement"==Yn&&GN(),AN({target:{scrollLeft:s}}),$T({target:{scrollTop:d}}),!0},Wv=e=>{let t=Rv(!0);return e?t:XC(t)},Hv=()=>{jv(!0,!1)&&(Av=Av==Sr?xr:Sr,Av==Sr?(Lv.innerText="+",Sv.value=Wv(!0)):(Lv.innerText="-",Sv.value=Wv(!1)))},qv=()=>{jv(!1,!1)&&(Yi(""),document.getElementById("edit-sequance-modal").style.display="none")};function Uv(){const e=Sv.value,t=Sv.selectionStart;let n=e.substring(0,t);const i=cC(n,"["),r=cC(n,"]");if(i>r)for(let e=0;e<i-r;e++)n+="]X1";let a=XC(n).trim();Tv.value=gC(a)}const zv=document.getElementById("machine-file-pick"),Vv=document.getElementById("machine-file-repeat"),Yv=document.getElementById("machine-file-total-pick"),Gv=document.getElementById("machine-file-shaft"),Jv=document.getElementById("machine-file-fidder"),Xv=document.getElementById("machine-file-cramming"),Kv=new Image,Zv=()=>{Kv.src="assets/machine-file-filled.png";let e=(()=>{let e=[];WC();let t=HC(),n=String(t).split("\n").filter(e=>e),i=0,r=0,a="";for(let t=0;t<n.length;t++)if(0==i)if(n[t].includes("[")){a.length>0&&(e.push({pegplanContent:a,repeat:1}),a="",r=0);let l=0,o=t+1,s=0;for(i=1;!n[o].includes("]");)l+=1,o+=1,i+=1;r=o-t+1,s=n.slice(t,o+1).join("\n").split("X")[1];let d=n.slice(t,o+1).join("\n").split("X")[0].replace("[","").replace("]","");if(r*s>40){let t=0,n=Math.floor(r*s/40);for(let i=0;i<n;i++)e.push({pegplanContent:d,repeat:parseInt(s)}),t+=r;if(t!=r*s){let t=r*s%40;e.push({pegplanContent:d.split("\n").slice(0,t).join("\n"),repeat:1})}r=0,a=""}else e.push({pegplanContent:d,repeat:parseInt(s)}),r=0,a=""}else 40==r&&(e.push({pegplanContent:a,repeat:1}),a="",r=0),a+=n[t]+"\n",r+=1,t+1==n.length&&(e.push({pegplanContent:a,repeat:1}),a="",r=0);else i-=1;return e})();if(mi.start&&mi.end&&(Gv.value=`${mi.start} to ${mi.end}`),hi.start&&hi.end&&(Jv.value=`${hi.start} to ${hi.end}`),gi.start&&gi.end&&(Xv.value=""+gi.end),e.length>0){let t=document.querySelector(".file-generator-tabs");document.querySelector(".file-generator-contents").innerHTML='<canvas id="loop-canvas"></canvas>',t.innerHTML="",e.forEach((e,n)=>{t.innerHTML+=`<span><img src="assets/refresh_sign.png" height="16" width="16" />&nbsp;&nbsp;Loop${n+1}</span>`});let n=document.querySelectorAll(".file-generator-tabs span");n.forEach((t,i)=>{t.addEventListener("click",()=>{n.forEach(e=>{e.classList.remove("active")}),(e=>{let t=e.pegplanContent,n=String(t).split("\n").filter(e=>e);const i=document.getElementById("loop-canvas"),r=i.getContext("2d");r.clearRect(0,0,i.width,i.height);const a=n.length;zv.value=a,Vv.value=e.repeat,Yv.value=qh.value;const l=30,o=30;i.width=Math.ceil(800)+30,i.height=Math.ceil(20*a)+30;for(let e=0;e<41;e++)e>0&&(r.textAlign="center",r.fillStyle="black",r.font="14px Rubik",r.fillText(e,20+20*e,20)),r.beginPath(),r.strokeStyle="black",r.moveTo(l+20*e,o),r.lineTo(l+20*e,o+20*a),r.stroke(),r.closePath();for(let e=0;e<a+1;e++)e>0&&(r.textAlign="center",r.fillStyle="black",r.font="14px Rubik",r.fillText(e,10,25+20*e)),r.beginPath(),r.strokeStyle="black",r.moveTo(l,o+20*e),r.lineTo(830,o+20*e),r.stroke(),r.closePath();n.forEach((e,t)=>{let n=t;e.split(" ").filter(e=>e).forEach(e=>{let t=20*(e-1)+l,i=20*n+o;r.drawImage(Kv,t+3,i+2)})})})(e[i]),n[i].classList.add("active")})})}},Qv=document.getElementById("dropdown-item-print"),eb=document.getElementById("graphical-pegplan-modal"),tb=document.getElementById("graphical-pegplan-model-yes"),nb=document.getElementById("graphical-pegplan-model-no"),ib="default",rb="yes",ab="no";let lb=ib;const ob=eb.querySelector(".modal-desc"),sb=()=>{if(lb==ib)ob.innerHTML="Do You Want Graphical With Numeric Pegplan ?",lb=rb;else{let e=lb==rb?yi.GRAPHICALYESWITHNUMERICYES:yi.GRAPHICALNOWITHNUMERICYES;op(e),db()}},db=()=>{eb.style.display="none"},cb=()=>{if(lb==ib)ob.innerHTML="Do You Want Numeric With Graphical Pegplan ?",lb=ab;else{let e=lb==rb?yi.GRAPHICALYESWITHNUMERICNO:yi.GRAPHICALNOWITHNUMERICNO;op(e),db()}},ub=()=>{op(yi.GRAPHICALYESWITHNUMERICYES,!0)},pb=document.getElementById("pattern-editor-trigger"),hb=document.getElementById("pattern-editor-model"),gb=document.querySelector("#pattern-editor-model #modal-desc");let mb=100,fb=!1;const yb=(e,t,n)=>{let i={};for(let t=65;t<=90;t++){let n=t<=91,r=String.fromCharCode(t);n&&(e[r]?i[r]=e[r]:i[r]=0)}let r="";return Object.keys(i).forEach((e,a)=>{let l="",o="warp"==t?Ld[e]:$s[e],s=18;if(n.forEach(t=>{let n=t.seq.split(" ");1==n.length?(n[0].includes(e)?isNaN(parseInt(n[0]))?l+='<td class="postfixHeader">1</td>':l+=`<td class="postfixHeader">${parseInt(n[0])}</td>`:l+='<td class="postfixHeader"></td>',s--):n.forEach((t,n)=>{t.includes(e)?isNaN(parseInt(t))?l+='<td class="postfixHeader">1</td>':l+=`<td class="postfixHeader">${parseInt(t)}</td>`:l+='<td class="postfixHeader"></td>',s--})}),s>0)for(let e=0;e<s;e++)l+='<td class="postfixHeader"></td>';r+=`<tr><td class="warpWeftColumn">${e}</td>${fb?`<td class="yarnName" style="width:${mb}px">${Rc(e,t)}</td>`:""}<td class="colorColumn" style="background-color:${o};"></td><td class="totalColumn">${i[e]}</td><td class="percentageColumn">${((e,t)=>parseFloat(e[t]/(e=>{let t=0;for(let n in e)e.hasOwnProperty(n)&&"number"==typeof e[n]&&(t+=e[n]);return t})(e)*100).toFixed(2)+"%")(i,e)}</td>${l}</tr>`}),r},vb=e=>{const t=document.getElementById(`pattern-editor-${e}-canvas`),n=document.getElementById(`pattern-editor-small-${e}-canvas`),i=t.getContext("2d"),r=n.getContext("2d"),a="warp"==e?c$.size:d$.size,l="warp"==e?c$.cells:d$.cells;let o="warp"==e?Ld:$s;const s=qi,d=Dn,c=On;t.width=a*qi,t.height=30,i.fillStyle="white",i.fillRect(0,0,t.width,t.height),i.fillStyle="black",i.clearRect(0,0,t.width,t.height),i.beginPath(),l.forEach(t=>{let n="warp"==e?t.index:a-t.index-1;i.fillStyle=o[t.color_code],i.fillRect(n*s,0,s,30)}),i.closePath();for(let e=0;e<a+1;e++)i.beginPath(),i.strokeStyle="grey",i.moveTo(d+e*s,c),i.lineTo(d+e*s,c+30),i.lineWidth=.5,i.stroke(),i.closePath();for(let e=0;e<2;e++)i.beginPath(),i.strokeStyle="grey",i.moveTo(d,c+30*e),i.lineTo(d+a*s,c+30*e),i.lineWidth=.5,i.stroke(),i.closePath();const u=Math.floor(63.6*window.innerWidth/100),p=0==Math.floor(u/(3*a))?1:Math.floor(u/(3*a)),h=document.createElement("canvas"),g=h.getContext("2d");h.width=p*a,h.height=30,n.width=u,n.height=30,g.beginPath(),l.forEach(t=>{let n="warp"==e?t.index:a-t.index-1;g.fillStyle=o[t.color_code],g.fillRect(n*p,0,p,30)}),g.closePath(),r.clearRect(0,0,n.width,n.height);const m=r.createPattern(h,"repeat");r.rect(0,0,n.width,n.height),r.fillStyle=m,r.fill()},bb=(e,t,n)=>((e,t,n)=>{let i="",r=18;if(n.forEach(e=>{let t=e.seq.split(" ");1==t.length?(i+='<td class="postfixHeader">1</td>',r--):t.forEach((n,a)=>{a+1==t.length?i+=`<td class="postfixHeader">${e.repeat}</td>`:i+='<td class="postfixHeader"></td>',r--})}),r>0)for(let e=0;e<r;e++)i+='<td class="postfixHeader"></td>';return`<tr><td class="warpWeftColumn">${"warp"==t?"Warp":"Weft"}</td>${fb?`<td class="yarnName" style="width:${mb}px">\n        Yarn Name\n      </td>`:""}<td class="colorColumn">Color</td><td class="totalColumn">Total</td><td class="percentageColumn">%</td>${i}</tr>`})(0,t,n)+yb(e,t,n),wb=()=>{let e=uC(),t=AC(),n=qC().split(/\s+/g),i=UC().split(/\s+/g),r=[],a=[];if(Array.isArray(n)){let e=0;n.forEach((t,i)=>{if(0==e)if(t.includes("[")){let t=i;for(;!n[t].includes("]");)t++;e=t-i;let a=n.slice(i,t+1).join(" ").split("X");if(2==a.length){let e=a[0].replace("[","").replace("]",""),t=Number(a[1]);r.push({seq:e,repeat:t})}}else r.push({seq:t,repeat:1});else e-=1}),-1==r.findIndex(e=>1!=e.repeat)&&(r=[{seq:r.map(e=>e.seq).join(" "),repeat:1}])}if(Array.isArray(i)){let e=0;i.forEach((t,n)=>{if(0==e)if(t.includes("[")){let t=n;for(;!i[t].includes("]");)t++;e=t-n;let r=i.slice(n,t+1).join(" ").split("X");if(2==r.length){let e=r[0].replace("[","").replace("]",""),t=Number(r[1]);a.push({seq:e,repeat:t})}}else a.push({seq:t,repeat:1});else e-=1}),-1==a.findIndex(e=>1!=e.repeat)&&(a=[{seq:a.map(e=>e.seq).join(" "),repeat:1}])}Object.keys(Ad).forEach(e=>{let t=Rc(e,"warp");t.length>1&&(14*t.length>mb&&(mb=14*t.length),fb=!0)}),Object.keys(Ws).forEach(e=>{let t=Rc(e,"weft");t.length>1&&(4*t.length>mb&&(mb=4*t.length),fb=!0)});let l=`<div>\n  <div class="pattern-editor-table-container">\n  <table class="pattern-editor-table">${bb(e,"warp",r)}</table></div><div class="pattern-editor-canvas-container"><canvas id="pattern-editor-warp-canvas"></canvas></div><div><canvas id="pattern-editor-small-warp-canvas"></canvas></div></div><div><div class="pattern-editor-table-container"><table class="pattern-editor-table">${bb(t,"weft",a)}</table></div><div class="pattern-editor-canvas-container"><canvas id="pattern-editor-weft-canvas"></canvas></div><div><canvas id="pattern-editor-small-weft-canvas"></canvas></div></div>`;gb.innerHTML="",gb.innerHTML=l,vb("warp"),vb("weft")},Eb=document.getElementById("edit-denting-apply"),Sb=document.getElementById("edit-denting-ok"),xb=document.getElementById("edit-dent-modal"),Ib=document.getElementById("editEndsDent"),kb=document.getElementById("editDentNumeric"),_b=document.getElementById("edit-dent-error-message"),Tb=document.getElementById("editDentTotalNoOfWarp"),Nb=document.getElementById("editDentTotalNoOfDent"),Cb="radio-even",Lb="radio-manual";let Ab=Cb;const Pb=()=>{if(Ab==Cb){let e=Ib.value;console.log("even called",e),e&&ZO.apply_dent(Number(e))}else if(Ab==Lb){let e=ZO.numeric_text_to_cells(kb.value);if(console.log("isOk",e),!e)return Fb("Denting Numeric is not matched with ends"),!1}return Jw(),!0},Bb=()=>{Pb()&&Rb()},Rb=()=>{Yi(""),xb.style.display="none"},Fb=e=>{_b.innerText=e,_b.style.display="block",setTimeout(()=>{_b.style.display="none"},3e3)},Mb=e=>{let t=String(e.target.value).trim().split(" ");Nb.value=t.length;const n=t.map(Number).reduce((e,t)=>e+t,0);Tb.value=n},Db=document.getElementById("header-warp-editor-trigger"),Ob=document.getElementById("header-weft-editor-trigger"),$b=document.getElementById("header-edit-dent-trigger"),jb=document.getElementById("header-draft-editor-trigger"),Wb=document.getElementById("header-pegplan-editor-trigger"),Hb=(document.getElementById("header-design-notes-trigger"),document.getElementById("header-edit-design-trigger"),document.getElementById("new-file")),qb=document.getElementById("new-file-modal"),Ub=document.getElementById("edit-salvage-trigger"),zb=document.getElementById("draft-warp-seq"),Vb=document.getElementById("weave-generator-trigger"),Yb=document.getElementById("weave-generator-modal"),Gb=(document.querySelectorAll(".close-button"),document.querySelectorAll(".btn-cancel")),Jb=document.getElementById("warpcolor-sequence-trigger"),Xb=document.getElementById("weftcolor-sequence-trigger"),Kb=document.getElementById("edit-sequance-modal"),Zb=document.getElementById("edit-dent-modal"),Qb=document.getElementById("wsEditDraft-trigger"),ew=(document.getElementById("setting-details-trigger"),document.getElementById("setting-details-modal"),document.getElementById("account-modal-trigger"),document.getElementById("avatar-account-modal"),document.getElementById("setting-modal-trigger")),tw=document.getElementById("avatar-setting-modal"),nw=(document.getElementById("create-new-ticket-trigger"),document.getElementById("create-ticket-modal"),document.getElementById("edit-draft-num-modal")),iw=document.getElementById("wcEditPegplan-trigger"),rw=document.getElementById("pegplan-modal"),aw=(document.getElementById("loom-profile-model"),document.getElementById("generate-machine-file")),lw=document.getElementById("generate-machine-file-model");function ow(e,t,n,i,r){const a=t.querySelector(".close"),l=t.querySelector(".modal-title");l&&(l.innerText=r);const o=()=>{"edit-draft-num-modal"==t.id&&fE(),Yi(""),t.style.display="none"};document.addEventListener("keydown",e=>{"Escape"==e.key&&o()}),e.addEventListener("click",()=>{Un!=t.id&&(Uf(),["wsEditDraft-trigger","header-draft-editor-trigger"].includes(e.id)&&mE(),"new-file"==e.id&&Oh(),["wcEditPegplan-trigger","header-pegplan-editor-trigger"].includes(e.id)&&((()=>{let e=FT==Pi?KO.convert_new_index_to_numeric(!1,!0):KO.get_fix_numeric_text();String(e).trim().length||(e=KO.convert_new_index_to_numeric(!1,!0)),Hh.value=e,Kh(),RN(lr),o_(n_.NONE),Xh({target:{value:e}})})(),document.getElementById("warpCanvasMenu").style.display="none"),"weave-generator-trigger"==e.id&&(()=>{let e=document.querySelectorAll(".tabs h3"),t=document.querySelectorAll(".tab-content div");e.forEach((n,i)=>{n.addEventListener("click",()=>{t.forEach(e=>{e.classList.remove("active")}),e.forEach(e=>{e.classList.remove("active")}),t[i].classList.add("active"),e[i].classList.add("active")})})})(),"generate-machine-file"==e.id&&Zv(),"dropdown-item-print"==e.id&&(ob.innerHTML="Do You Want Graphical Pegplan?",lb=ib),["weftcolor-sequence-trigger","header-weft-editor-trigger"].includes(e.id)&&(Pv("weft"),Rv()),["warpcolor-sequence-trigger","header-warp-editor-trigger"].includes(e.id)&&(Pv("warp"),Rv()),["edit-dent-modal"].includes(e.id)&&(_b.style.display="none"),"pattern-editor-trigger"==e.id&&wb(),document.getElementById("weftSubContext")&&(document.getElementById("weftSubContext").style.display="none"),document.getElementById("weftcolor-context-menu")&&(document.getElementById("weftcolor-context-menu").style.display="none"),document.getElementById("warpcolor-context-menu")&&(document.getElementById("warpcolor-context-menu").style.display="none"),document.getElementById("mainContextMenu")&&(document.getElementById("mainContextMenu").style.display="none"),document.getElementById("warpCanvasMenu")&&(document.getElementById("warpCanvasMenu").style.display="none"),(e=>{let t=document.querySelectorAll(".modal");(e=>{e.forEach(e=>{e.style.width="100%",e.style.height="100%",e.style.left=0})})(t);for(let n=0;n<t.length;n++){let i=document.getElementById(Un),r=document.getElementById(e.id);"edit-sequance-modal"!=Un||"edit-draft-num-modal"!=e.id||"edit-sequance-modal"!=t[n].id||"warp"!=Ev?("edit-sequance-modal"!=Un||"pegplan-modal"!=e.id||"edit-sequance-modal"!=t[n].id||"weft"!=Ev)&&!("edit-draft-num-modal"==Un&&"edit-sequance-modal"==e.id&&"edit-draft-num-modal"==t[n].id&&"warp"==Ev||"pegplan-modal"==Un&&"edit-sequance-modal"==e.id&&"pegplan-modal"==t[n].id&&"weft"==Ev)?t[n].style.display="none":(i.style.left=0,i.style.width="50%",r.style.left="50%",r.style.width="50%"):(i.style.left=0,i.style.width="50%",r.style.left="50%",r.style.width="50%")}Yi("")})(t),t.style.display="block",t.style.animation="slide-down 0.3s ease",["wsEditDraft-trigger","header-draft-editor-trigger"].includes(e.id)&&vE(),["dropdown-item-print-preview","print-preview-header-trigger"].includes(e.id)&&wv(),Yi(t.id))}),e.id,e.id,e.id,e.id,e.id,a&&a.addEventListener("click",o),i&&i.forEach(e=>{e.addEventListener("click",o)})}const sw=document.getElementById("weft-canvas"),dw=sw.getContext("2d"),cw=document.getElementById("weftSubParent"),uw=document.getElementById("weft-scale-container"),pw=document.getElementById("edit-design-from-draft");let hw,gw,mw,fw,yw,vw=!0,bw=!0,ww=!1,Ew=!1,Sw=null,xw=[],Iw=[],kw=[],_w=[],Tw=[],Nw=!1,Cw=!1,Lw=!1,Aw=[],Pw=null,Bw=ki;const Rw=e=>{Bw=e;let t=document.getElementById(e);t&&(t.checked=!0)},Fw=e=>{const t=sw.getBoundingClientRect(),n=GO.cell_size(),i=GO.cols(),r=GO.rows(),a=(e.clientX-t.left)%(i*n),l=e.clientY-t.top,o=parseInt(a/n)+Hn.startColumn,s=r-parseInt(l/n)-1;if(!yw){let e=GO.check_if_index_exist_or_not(o%i,s);yw=e?gs:hs}yw==hs?(GO.add_cell_new(s,o%i,YO,KO,QO),Jw()):yw==gs&&(GO.remove_cell_new(o%i,YO),Jw())},Mw=e=>{if(!Mn)return void(e=>{GO.cols();const t=GO.rows(),n=GO.cell_size(),i=Dn,r=On;if(Array.isArray(e))for(let a=0;a<e.length;a++){dw.clearRect(e[a]*n,0,n,sw.height),dw.fillStyle="white",dw.fillRect(e[a]*n,0,n,sw.height);for(let l=0;l<t+1;l++)dw.beginPath(),dw.strokeStyle="grey",dw.moveTo(i+e[a]*n,r+l*n),dw.lineTo(i+e[a]*n+n,r+l*n),dw.lineWidth=(t-l)%jn==0?1.5:.5,dw.stroke(),dw.closePath();for(let l=0;l<2;l++)dw.beginPath(),dw.strokeStyle="grey",dw.moveTo(i+e[a]*n+l*n,r),dw.lineTo(i+e[a]*n+l*n,r+t*n),dw.lineWidth=(e[a]+l)%$n==0?1.5:.5,dw.stroke(),dw.closePath();const l=GO.get_cell_from_col(e[a]);0!=l&&(dw.fillStyle="black",dw.fillRect(e[a]*n,(t-l)*n,n,n))}zN(e)})(e);const t=GO.cols(),n=GO.rows(),i=GO.cell_size(),r=Dn,a=On,l=document.createElement("canvas");l.width=t*i,l.height=n*i;const o=l.getContext("2d"),s=dw.getImageData(0,sw.height-l.height,l.width,l.height);if(o.putImageData(s,0,0),Array.isArray(e))for(let t=0;t<e.length;t++){o.clearRect(e[t]*i,0,i,l.height),o.fillStyle="white",o.fillRect(e[t]*i,0,i,l.height);for(let l=0;l<n+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+e[t]*i,a+l*i),o.lineTo(r+e[t]*i+i,a+l*i),o.lineWidth=(n-l)%jn==0?1.5:.5,o.stroke(),o.closePath();for(let l=0;l<2;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+e[t]*i+l*i,a),o.lineTo(r+e[t]*i+l*i,a+n*i),o.lineWidth=(e[t]+l)%$n==0?1.5:.5,o.stroke(),o.closePath();const s=GO.get_cell_from_col(e[t]);0!=s&&(o.fillStyle="black",o.fillRect(e[t]*i,(n-s)*i,i,i))}sw.height=l.height,sw.width=l.width*zn;const d=dw.createPattern(l,"repeat");dw.rect(0,0,sw.width,sw.height),dw.fillStyle=d,dw.fill(),cw.style.height=sw.height+"px",zN(e)},Dw=e=>{if(vs==os)return void(yw=null);Ew=!1,yw=null;let t=GO.rows(),n=GO.cols();Tw.forEach(e=>{GO.add_cell_new(t-parseInt(e/n)-1,e%n,YO,KO,QO)}),Tw=[],Vi(!1),rE(),mw=null};const Ow=e=>{if(RN(or,e),Bw!=ki)if(vs==ds&&Ew){const l=sw.getBoundingClientRect(),o=GO.cell_size(),s=GO.cols(),d=(e.clientX-l.left)%(s*o),c=e.clientY-l.top,u=parseInt(mw.x/o),p=parseInt(mw.y/o),h=u+p*s;let g=parseInt(d/o),m=parseInt(c/o);const f=(t=mw.x,n=mw.y,i=d,r=c,(a=(Math.atan2(r-n,i-t)*(180/Math.PI)+360)%360)<0&&(a+=360),a=360-a,[cs.RIGHT,cs.TOP_RIGHT,cs.TOP,cs.TOP_LEFT,cs.LEFT,cs.BOTTOM_LEFT,cs.BOTTOM,cs.BOTTOM_RIGHT][Math.round(a/45)%8]);if(f==cs.RIGHT){m=p;let e=g+m*s;Tw=[];for(let t=h;t<=e;t++)Tw.push(t)}else if(f==cs.LEFT){m=p;let e=g+m*s;Tw=[];for(let t=h;t>=e;t--)Tw.push(t)}else if(f==cs.TOP);else if(f==cs.BOTTOM);else if(f==cs.TOP_RIGHT){let e=p,t=u;Tw=[];for(;e>=m&&t<=g;e--)Tw.push(t+e*s),t++}else if(f==cs.TOP_LEFT){let e=p,t=u;Tw=[];for(;e>=m&&t>=g;e--)Tw.push(t+e*s),t--}else if(f==cs.BOTTOM_LEFT){let e=p,t=u;Tw=[];for(;e<=m&&t>=g;e++)Tw.push(t+e*s),t--}else if(f==cs.BOTTOM_RIGHT){let e=p,t=u;Tw=[];for(;e<=m&&t<=g;e++)Tw.push(t+e*s),t++}rE()}else{var t,n,i,r,a;$i&&qn==Wn&&Fw(e)}},$w=e=>{if(vs==ss){if(e.ctrlKey&&"KeyE"==e.code){e.preventDefault();let t=Number(gw.select(".selection").attr("x")),n=Number(gw.select(".selection").attr("y")),i=[],r=GO.rows();for(let e=0;e<xw.length;e++){let a=(xw[e].y+n)/qi,l=(xw[e].x+t+cw.scrollLeft)/qi;a=r-a-1,GO.add_cell_new(a,l,YO,KO,QO),i.push(l)}Mw(i),Zw()}e.altKey&&jw(!Cw),e.shiftKey&&(Lw=!0),"Escape"==e.code&&Zw()}},jw=e=>{Cw=e,Cw?gw.select(".selection").style("cursor","grab"):gw.select(".selection").style("cursor","move")},Ww=e=>{"Shift"==e.key&&(Lw=!1)},Hw=e=>{if(vs!=ss);else if(!ww){ww=!0;d3.select("#weftSubParent").node();let t=gw.select("#weft-canvas-brush-svg").style("z-index","1").style("width",sw.width+"px").style("height",sw.height+"px").style("pointer-events","all");const n=new MouseEvent("mousedown",e);t.select("rect.overlay").node().dispatchEvent(n)}},qw=e=>{if(Bw!=ki){if(vs==ds&&!Ew){Ew=!0;const t=sw.getBoundingClientRect(),n=GO.cols(),i=GO.cell_size(),r=(e.clientX-t.left)%(n*i),a=e.clientY-t.top;mw={x:r,y:a}}if(vs==os){if(o_(n_.NONE),0==e.button&&e.ctrlKey&&!Xn){const t=GO.cell_size(),n=getComputedStyle(sw),i=sw.getBoundingClientRect(),r=pa(n.getPropertyValue("transform")).scaleX,a=GO.rows();if(a>=40)return void nL("Maxium 40 shaft allowed");const l=GO.cols(),o=(e.clientX-i.left)%(l*t),s=e.clientY-i.top,d=(parseInt(o/r/t),a-parseInt(s/r/t)-1);return e.shiftKey?GO.remove_row(d,YO,KO,QO):GO.add_row(d,YO,KO,QO),Vp.value=GO.rows(),Rh(),m$(),void PN()}if(0==e.button&&e.altKey&&!Xn){const t=GO.cell_size(),n=getComputedStyle(sw),i=sw.getBoundingClientRect(),r=pa(n.getPropertyValue("transform")).scaleX,a=(GO.rows(),GO.cols()),l=(e.clientX-i.left)%(a*t),o=(e.clientY,i.top,Hn.startColumn+parseInt(l/r/t));return e.shiftKey?(GO.remove_col(o,YO,KO,QO,ZO,p$),c$.remove_cell(o),o$.remove_cell(o)):(GO.add_col(o,YO,KO,QO,ZO,p$),c$.add_cell(o),o$.add_cell(o)),ch.value=GO.cols(),ph.value=GO.cols(),Rh(),m$(),void PN()}0==e.button&&qn==Wn&&(Vi(!0),Fw(e))}}},Uw=e=>{const t=EN.getBoundingClientRect(),n=1*YO.width(),i=qi,r=QO.rows(),a=QO.cols(),l=e.clientX-t.left,o=(e.clientY-t.top)%(r*i),s=r-parseInt(o/i)-1;let d=parseInt(l/n);d>=a&&(d=a-1),QO.add_cell(YO,GO,KO,s,d),iN(),rE()},zw=e=>{0==e.button&&Xn&&vs==os&&(Vi(!0),Uw(e))},Vw=e=>{if($i&&Xn&&vs==os&&Uw(e),!Xn){const t=1*YO.width(),n=qi,i=(QO.cols(),QO.rows()),r=EN.getBoundingClientRect(),a=e.clientX-r.left,l=e.clientY-r.top,o=parseInt(l/n),s=parseInt(a/t);let d=o;(o>i-1||s>i-o-1)&&(d=i-s),Sw={reachRow:d},iE()}},Yw=()=>{Vi(!1)},Gw=()=>{Xn||(Sw=null,iE())},Jw=()=>{const e=GO.cols(),t=Hn.startColumn,n=Hn.endColumn;let i=e*qi*(Mn?zn:1);vN.style.width=i+"px";const r=GO.get_visible_cells(t,Mn?n:Math.min(n,e-1),Mn),a=rL(r)?JSON.parse(r):[],l=Mn?n-t+1:Math.min(n-t+1,e),o=GO.rows(),s=GO.cell_size(),d=document.createElement("canvas");d.height=s*o,d.width=s*l;const c=d.getContext("2d");if(c.clearRect(0,0,d.width,d.height),c.fillStyle="white",c.fillRect(0,0,d.width,d.height),c.fillStyle="black",Array.isArray(a)&&a.length>0){if(a.forEach((e,t)=>{0!=e&&c.fillRect(t*s,(o-e)*s,s,s)}),Oi==si){for(let e=0;e<l+1;e++)c.beginPath(),c.strokeStyle="grey",c.moveTo(e*s,0),c.lineTo(e*s,o*s),c.lineWidth=(e+t)%$n==0?1.5:.5,c.stroke(),c.closePath();for(let e=0;e<o+1;e++)c.beginPath(),c.strokeStyle="grey",c.moveTo(0,e*s),c.lineTo(l*s,e*s),c.lineWidth=(o-e)%jn==0?1.5:.5,c.stroke(),c.closePath()}else if(Oi==di){c.lineWidth=.5;for(let e=0;e<l+1;e++)c.beginPath(),c.strokeStyle="grey",c.moveTo(e*s,0),c.lineTo(e*s,o*s),c.stroke(),c.closePath();for(let e=0;e<o+1;e++)c.beginPath(),c.strokeStyle="grey",c.moveTo(0,e*s),c.lineTo(l*s,e*s),c.stroke(),c.closePath()}else if(Oi==ci){c.lineWidth=1.5;for(let e=0;e<l+1;e++)(e+t)%$n==0&&(c.beginPath(),c.strokeStyle="grey",c.moveTo(e*s,0),c.lineTo(e*s,o*s),c.stroke(),c.closePath());for(let e=0;e<o+1;e++)(o-e)%jn==0&&(c.beginPath(),c.strokeStyle="grey",c.moveTo(0,e*s),c.lineTo(0+l*s,e*s),c.stroke(),c.closePath())}else{c.lineWidth=1.5;for(let e=0;e<l+1;e+=l)c.beginPath(),c.strokeStyle="grey",c.moveTo(e*s,0),c.lineTo(e*s,o*s),c.stroke(),c.closePath();for(let e=0;e<o+1;e+=o)(o-e)%jn==0&&(c.beginPath(),c.strokeStyle="grey",c.moveTo(0,e*s),c.lineTo(l*s,e*s),c.stroke(),c.closePath())}c.closePath(),cw.style.height=d.height+"px",sw.width=d.width,sw.height=d.height,dw.clearRect(0,0,sw.width,sw.height),dw.drawImage(d,0,0)}Td(),Hd(),qd(),MN()},Xw=()=>{Oh(or)},Kw=e=>{if(e.selection)if("handle"===e.mode){let[[t,n],[i,r]]=e.selection;if(Pw||(e=>{(e.sourceEvent.srcElement.classList.value.includes("--ne")||e.sourceEvent.srcElement.classList.value.includes("--se")||e.sourceEvent.srcElement.classList.value.includes("--sw")||e.sourceEvent.srcElement.classList.value.includes("--nw")||e.sourceEvent.srcElement.classList.value.includes("--s")||e.sourceEvent.srcElement.classList.value.includes("--n")||e.sourceEvent.srcElement.classList.value.includes("--w")||e.sourceEvent.srcElement.classList.value.includes("--e"))&&(e.sourceEvent.srcElement.classList.value.includes("--ne")?Pw=cs.TOP_RIGHT:e.sourceEvent.srcElement.classList.value.includes("--se")?Pw=cs.BOTTOM_RIGHT:e.sourceEvent.srcElement.classList.value.includes("--sw")?Pw=cs.BOTTOM_LEFT:e.sourceEvent.srcElement.classList.value.includes("--nw")?Pw=cs.TOP_LEFT:e.sourceEvent.srcElement.classList.value.includes("--s")?Pw=cs.BOTTOM:e.sourceEvent.srcElement.classList.value.includes("--n")?Pw=cs.TOP:e.sourceEvent.srcElement.classList.value.includes("--w")?Pw=cs.LEFT:e.sourceEvent.srcElement.classList.value.includes("--e")&&(Pw=cs.RIGHT))})(e),Iw.length>0)if(Lw){const[[e,a],[l,o]]=Iw;if([cs.TOP].includes(Pw))n-=n%qi,gw.select("#weft-canvas-brush-svg").call(hw.move,[[e,n],[l,o]]);else if([cs.BOTTOM].includes(Pw))r+=qi-r%qi,gw.select("#weft-canvas-brush-svg").call(hw.move,[[e,a],[l,r]]);else if([cs.RIGHT].includes(Pw))i+=qi-i%qi,gw.select("#weft-canvas-brush-svg").call(hw.move,[[e,a],[i,o]]);else if([cs.LEFT].includes(Pw))t-=t%qi,gw.select("#weft-canvas-brush-svg").call(hw.move,[[t,a],[l,o]]);else if([cs.TOP_RIGHT].includes(Pw)){Math.abs(l-i)>=Math.abs(a-n)?(i+=qi-i%qi,n=a+(l-i)):(n-=n%qi,i=l+(a-n)),gw.select("#weft-canvas-brush-svg").call(hw.move,[[e,n],[i,o]])}else if([cs.TOP_LEFT].includes(Pw)){Math.abs(e-t)>=Math.abs(a-n)?(t-=t%qi,n=a-(e-t)):(n-=n%qi,t=e-(a-n)),gw.select("#weft-canvas-brush-svg").call(hw.move,[[t,n],[l,o]])}else if([cs.BOTTOM_LEFT].includes(Pw)){Math.abs(e-t)>=Math.abs(o-r)?(t-=t%qi,r=o+(e-t)):(r+=qi-r%qi,t=e+(o-r)),gw.select("#weft-canvas-brush-svg").call(hw.move,[[t,a],[l,r]])}else if([cs.BOTTOM_RIGHT].includes(Pw)){Math.abs(l-i)>=Math.abs(o-r)?(i+=qi-i%qi,r=o-(l-i)):(r+=qi-r%qi,i=l-(o-r)),gw.select("#weft-canvas-brush-svg").call(hw.move,[[e,a],[i,r]])}else[cs.BOTTOM_LEFT,cs.BOTTOM_RIGHT,cs.TOP_LEFT,cs.TOP_RIGHT].includes(Pw)&&(t-=t%qi,n-=n%qi,i+=qi-i%qi,r+=qi-r%qi)}else t=Math.round(t/qi)*qi,n=Math.round(n/qi)*qi,i=Math.round(i/qi)*qi,r=Math.round(r/qi)*qi,gw.select("#weft-canvas-brush-svg").call(hw.move,[[t,n],[i,r]]);else{t-=t%qi,n-=n%qi,i+=qi-i%qi,r+=qi-r%qi;for(let e=0;e<Aw.length;e++)Aw[e].classList.add("crosshair-cursor");gw.select("#weft-canvas-brush-svg").call(hw.move,[[t,n],[i,r]])}}else if("drag"===e.mode){let[[t,n],[i,r]]=e.selection;t-=t%qi,n-=n%qi,i+=qi-i%qi,r+=qi-r%qi;let[[a,l],[o,s]]=Iw,d=o-a,c=s-l;if(gw.select("#weft-canvas-brush-svg").call(hw.move,[[t,n],[t+d,n+c]]),Cw){Nw=!0;Math.ceil(Iw[0][0]/1),Math.ceil(Iw[0][1]/1),Math.ceil(t/1),Math.ceil(n/1);gw.selectAll(".selected-square").remove(),xw.forEach(e=>{gw.select("#weft-canvas-brush-svg").append("rect").attr("class","selected-square").attr("x",e.x+t).attr("y",e.y+n).attr("width",qi).attr("height",qi).style("fill","yellow")}),rE()}else Nw&&gw.select("#weft-canvas-brush-svg").call(hw.move,kw)}},Zw=()=>{ww=!1,Nw=!1,jw(!1),gw.select("#weft-canvas-brush-svg").style("z-index","-1").call(hw.move,[[0,0],[0,0]]),Iw=[],_w=[],xw=[],gw.selectAll(".selected-square").remove(),rE()},Qw=e=>{let[[t,n],[i,r]]=e;const a=new Uint32Array(I$.memory.buffer,GO.cells(),GO.selected_weftgrid_length());let l=[];for(let e=0;e<a.length;e++){if(0==a[e])continue;let o=e*qi,s=(GO.rows()-a[e])*qi;t<=o&&o<i&&n<=s&&s<r&&l.push({x:Math.abs(o-t),y:Math.abs(s-n)})}xw=JSON.parse(JSON.stringify(l))},eE=()=>{gw=d3.select(sw.parentElement),hw=d3.brush().keyModifiers(!1).extent([[0,0],[sw.width,sw.height]]).on("start",e=>(e=>{if("handle"==e.mode){const t=sw.getBoundingClientRect();fw=[e.sourceEvent.clientX-t.left,e.sourceEvent.clientY-t.top],fw=[(e.selection[0][0]+e.selection[1][0])/2,(e.selection[0][1]+e.selection[1][1])/2]}})(e)).on("brush",e=>Kw(e)).on("end",e=>(e=>{if(!e.selection)return void Zw();let[[t,n],[i,r]]=e.selection;if(Pw=null,"handle"===e.mode){Qw([[t,n],[i,r]]),gw.select("#weft-canvas-brush-svg").call(hw.move,[[t,n],[i,r]]);for(let e=0;e<Aw.length;e++)Aw[e].classList.remove("crosshair-cursor");Iw=[[t,n],[i,r]],kw=[[t,n],[i,r]]}"drag"==e.mode&&(Cw||(Qw([[t,n],[i,r]]),Iw=[[t,n],[i,r]]),kw=[[t,n],[i,r]])})(e)).filter(e=>"contextmenu"!=e.type);const e=gw.select("#weft-canvas-brush-svg");e.call(hw),sw.removeEventListener("mousedown",Hw),sw.addEventListener("mousedown",Hw),e.on("contextmenu",e=>{Zw()}),Aw=cw.getElementsByTagName("rect")},tE=()=>{sw.addEventListener("mousedown",qw),sw.addEventListener("mouseup",Dw),sw.addEventListener("mousemove",Ow),sw.addEventListener("mouseleave",HN),EN.addEventListener("mousedown",zw),EN.addEventListener("mousemove",Vw),EN.addEventListener("mouseup",Yw),EN.addEventListener("mouseout",Gw),document.addEventListener("keydown",$w),document.addEventListener("keyup",Ww),(()=>{const e=document.getElementById("wsInsert-warp-trigger"),t=document.getElementById("wsInsert-shafts-trigger"),n=document.getElementById("wsInsert-warp-modal"),i=document.getElementById("wsInsert-shafts-modal"),r=(document.querySelectorAll(".close-button"),document.querySelectorAll(".btn-cancel"));ow(e,n,0,r,"Insert Warp"),ow(t,i,0,r,"Insert Shaft"),ow(pw,qb,0,r,"Edit File")})(),pw.addEventListener("click",Xw)},nE=()=>{let e=GO.convert_new_index_to_numeric(ZO),t=XC(e);return lC(String(t).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e)))/String(t).split("\n").filter(e=>e.length>0).length},iE=()=>{const e=QO.rows(),t=QO.cols(),n=Xn?uN.offsetHeight:fN.offsetHeight;bN.style.height=n+"px",bN.style.width=rT.width+4+"px",EN.height=""+n,EN.width=""+(rT.width+4),SN.fillStyle="#f0f0f0",SN.fillRect(0,0,EN.width,EN.height),SN.fillStyle="black";const i=qi,r=qi;if(Xn){for(let n=0;n<t+1;n++)SN.beginPath(),SN.strokeStyle="grey",SN.moveTo(0+n*i,0),SN.lineTo(0+n*i,0+e*i),SN.lineWidth=n%$n==0?1.5:.5,SN.stroke(),SN.closePath();for(let n=0;n<e+1;n++)SN.beginPath(),SN.strokeStyle="grey",SN.moveTo(0,0+n*r),SN.lineTo(0+t*r,0+n*r),SN.lineWidth=(e-n)%jn==0?1.5:.5,SN.stroke(),SN.closePath();for(let n=0;n<t;n++){new Uint32Array(I$.memory.buffer,QO.cells(n),QO.selected_col_cell_length(n)).forEach(t=>{SN.fillRect(n*i,(e-t)*r,i,r)})}}else{for(let n=0;n<e;n++)SN.beginPath(),SN.strokeStyle=(Sw&&Sw.reachRow)==n?"red":"black",SN.moveTo(0,n*r+r/2),SN.lineTo(t*i-n*i-i/2+4-1,n*r+r/2),SN.moveTo(t*i-n*i-i/2+4,n*r+r/2-.5),SN.lineTo(t*i-n*i-i/2+4,n*r+r/2+fN.offsetHeight),SN.lineWidth=(Sw&&Sw.reachRow)==n?1.5:.5,SN.stroke(),SN.closePath();for(let e=0;e<t;e++);}vw&&bw||(bN.style.display="none")},rE=()=>{const e=GO.cols(),t=GO.rows(),n=GO.cell_size(),i=Dn,r=On,a=document.createElement("canvas");a.width=e*n,a.height=t*n;const l=a.getContext("2d");if(l.fillStyle="white",l.fillRect(0,0,a.width,a.height),l.fillStyle="black",dw.clearRect(0,0,sw.width,sw.height),Oi==si){for(let a=0;a<e+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.lineWidth=a%$n==0?1.5:.5,l.stroke(),l.closePath();for(let a=0;a<t+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.lineWidth=(t-a)%jn==0?1.5:.5,l.stroke(),l.closePath()}else if(Oi==di){l.lineWidth=.5;for(let a=0;a<e+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.stroke(),l.closePath();for(let a=0;a<t+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.stroke(),l.closePath()}else if(Oi==ci){l.lineWidth=1.5;for(let a=0;a<e+1;a++)a%$n==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.stroke(),l.closePath());for(let a=0;a<t+1;a++)(t-a)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.stroke(),l.closePath())}else{l.lineWidth=1.5;for(let a=0;a<e+1;a+=e)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.stroke(),l.closePath();for(let a=0;a<t+1;a+=t)(t-a)%jn==0&&(l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.stroke(),l.closePath())}const o=new Uint32Array(I$.memory.buffer,GO.cells(),GO.selected_weftgrid_length());if(l.beginPath(),o.forEach((e,i)=>{0!=e&&l.fillRect(i*n,(t-e)*n,n,n)}),l.fillStyle="red",Tw.forEach(e=>{l.fillRect(e%GO.cols()*n,parseInt(e/GO.cols())*n,n,n)}),l.fillStyle="yellow",_w.forEach(e=>{l.fillRect(e.x,e.y,n,n)}),l.closePath(),Mn){sw.height=a.height,sw.width=a.width*zn;const e=dw.createPattern(a,"repeat");dw.rect(0,0,sw.width,sw.height),dw.fillStyle=e,dw.fill()}else sw.height=a.height,sw.width=a.width,dw.drawImage(a,0,0);cw.style.height=sw.height+"px",iE(),VN(),eE()},aE=document.getElementById("draft-edit-num"),lE=document.getElementById("edit-draft-error-message"),oE=document.getElementById("current-ends-number"),sE=document.getElementById("edit-draft-compress"),dE=document.getElementById("total-end-dent");document.getElementById("leftSalvageDraft"),document.getElementById("rightSalvageDraft");let cE=Sr;const uE=()=>aE.value;const pE=e=>{aE.value=e},hE=e=>{"Enter"==e.key&&e.ctrlKey&&wE()};function gE(){const e=aE.value,t=aE.selectionStart;let n=e.substring(0,t);const i=cC(n,"["),r=cC(n,"]");if(i>r)for(let e=0;e<i-r;e++)n+="]X1";let a=XC(n).trim();oE.value=tL(a)}const mE=()=>{let e=Bw==_i?GO.convert_new_index_to_numeric_with_skip_dent(ZO,!0):GO.get_fix_numeric_text();pE(e),aE.addEventListener("keydown",hE),yE({target:{value:e}}),o_(n_.NONE),RN(or),cE=Sr},fE=()=>{aE.removeEventListener("keydown",hE)},yE=e=>{let t=uE(),n={".":" ","{":"[","}":"]","(":"[",")":"]","*":"X","\r":"\n"};t=t.split("").map(e=>n[e]||e).join("");const i=aE.selectionStart,r=aE.selectionEnd;pE(t),aE.setSelectionRange(i,r);let a=XC(t);const l=lC(String(a).split("\n").filter(e=>e.length>0&&"#"!=e.trim()).map(e=>e.split(" ").filter(e=>e))),o=String(a).split("\n").filter(e=>e.length>0).length;dE.value=`${l}/${o}`},vE=()=>{},bE=(e=!1)=>{let t=uE();if(String(t).length>0){if(cC(t,"[")!=cC(t,"]"))return lE.style.display="block",lE.innerText="Check Brackets Properly",setTimeout(()=>{lE.style.display="none"},6e3),!1;lE.style.display="none";let n={".":" ","{":"[","}":"]","(":"[",")":"]"},i=uE();i=i.split("").map(e=>n[e]||e).join(""),i=i.replaceAll("\r\n","\n");let r=XC(i),a=[],l=[],o=[],s=!0,d=0,c=0,u=String(i).trim().split("\n\n"),p=[],h=0;for(let e=0;e<u.length&&e+1!=u.length;e++){let t=XC(u[e]);h+=tL(t),p.push(h)}let g=String(r).split("\n").filter(e=>e.length>0);g.forEach((e,t)=>{if(e){if("#"==e.trim()){if(0==t)return;return c++,void(t==g.length-1&&(o.pop(),o.push(c)))}c>0&&(o.pop(),o.push(c),c=0),e.trim().split(" ").forEach(e=>{"#"!=e.trim()&&(o.push(c),a.push(e.trim()),l.push(s?1:2))}),d++,s=!s}});let m=Math.max(...a);if(m>40)return lE.style.display="block",lE.innerText="Shaft must be lesser than 40",setTimeout(()=>{lE.style.display="none"},6e3),!1;if(lE.style.display="none",e&&m>24&&!confirm(`You are input ${m} Shaft, Are you Sure to use More then 24 Shaft?`))return!1;GO.new_edit_draft_numeric(a,YO,ZO,p$,KO,QO,l,d,i,o,p),c$.update_size(GO.cols()),o$.update_size(GO.cols()),ph.value=GO.cols(),ch.value=GO.cols(),Yi(""),Rh(!0),AN({target:{scrollLeft:0}}),WT(),iE(),PN()}return!0},wE=()=>{bE(!0)&&(nw.style.display="none",fE())},EE=()=>{cE=cE==Sr?xr:Sr,cE==Sr?(sE.innerText="+",pE(SE(!0))):(sE.innerText="-",pE(SE(!1)))},SE=e=>{let t={".":" ","{":"[","}":"]","(":"[",")":"]"},n=uE();return n=n.split("").map(e=>t[e]||e).join(""),n=n.replaceAll("\r\n","\n"),e?E$(E$(n)):XC(n)},xE=new Event("beforeExportProcessDone");let IE;const kE=e=>{IE=e};const _E=async()=>{Uf();let e=await window.showOpenFilePicker({types:[{description:"Maxweave File (.mwf)",accept:{"text/plain":[".mwf"]}}],excludeAcceptAllOption:!0,multiple:!1});IE=e[0];const t=await IE.getFile();if(t)try{const e=await function(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=i=>{try{const n=i.target.result,r=CryptoJS.AES.decrypt(n,TE).toString(CryptoJS.enc.Utf8),a=JSON.parse(r);a.name=e.name,t(a)}catch(e){n("Decryption failed: Invalid file or key")}},i.onerror=()=>n("File reading failed"),i.readAsText(e)})}(t);Jg(e)}catch(e){console.error(e)}},TE="maxweave@1015",NE=document.getElementById("file-save-offline-trigger"),CE=async(e,t=!1)=>{FE(e);let n=Bw==_i?GO.convert_new_index_to_numeric(ZO):GO.get_fix_numeric_text(),i=XC(n);const r=lC(String(i).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e)));let a=FT==Pi?KO.convert_new_index_to_numeric(!1,!1):KO.get_fix_numeric_text(),l=XC(a,!0);const o=String(l).split("\n").length;let s="",d="",c="",u="",p=0;if(Ys==Li||"20A"==d$.fixNumericText){for(let e=d$.size-1;e>=d$.getMinimumIndex();e--){let t=d$.findElementFromIndex(e);t?(p>0&&(s+=p.toString()+"\n"),s+=t.color_code+"\n",p=0):p++}p=0,c=y$(s.toUpperCase())}else c=d$.fixNumericText;if(p=0,"20A"==c$.fixNumericText||$d==Ni){for(let e=0;e<=c$.getMaximumIndex();e++){let t=c$.findElementFromIndex(e);t?(p>0&&(d+=p.toString()+"\n"),d+=t.color_code+"\n",p=0):p++}u=y$(d.toUpperCase())}else u=c$.fixNumericText;const h=new Uint32Array(I$.memory.buffer,ZO.click_cells(),ZO.click_dentgrid_length()).toString(),g=Array.from(new Uint32Array(I$.memory.buffer,GO.compress_split_array(),GO.compress_split_array_length())),m=Array.from(new Uint32Array(I$.memory.buffer,KO.compress_split_array(),KO.compress_split_array_length())),f=Array.from(new Uint32Array(I$.memory.buffer,KO.compress_file_loop_split_array(),KO.compress_file_loop_split_array_length())),y=c$.compressSplitter,v=d$.compressSplitter,b=new Uint32Array(I$.memory.buffer,p$.cells(),p$.selected_beamgrid_length()).toString();dh.value=KO.rows(),ch.value=GO.cols();let w={pegPlan:a,draftPlan:n,warpPattern:u,weftPattern:c,shaft:GO.rows().toString(),picks:o.toString(),ends:r.toString(),unit:hh.value,reed:zO.value,draftCompressSplitArray:g,pegplanCompressSplitArray:m,pegplanFileSplitArray:f,warpCompressSplitArray:y,weftCompressSplitArray:v,perinch:gh.value,leftSalvageWidth:jp,bodyWidth:Hp,rightSalvageWidth:Wp,leftSalvageWarpDent:Yp.value,bodyWarpDent:Gp.value,rightSalvageWarpDent:Jp.value,warpDencity:ah.value,weftDencity:lh.value,designHeight:dh.value,designWidth:ch.value,gridHeight:oh.value,gridWidth:sh.value,weftHeight:uh.value,warpWidth:ph.value,skipDent:h,doubleBeam:b,draftWithPart:{designWithPart:wy,draftParts:Kf},extraWarp:JSON.stringify(o$),creaming:JSON.stringify(l$),density:JSON.stringify(s$),leftSalvage:JSON.stringify(Ec),rightSalvage:JSON.stringify(Sc),weftSelectorMapping:JSON.stringify(Mg),densityMapping:JSON.stringify(fp),draftDesignModeType:Bw,pegPlanDesignModeType:FT,warpWeavingShrinkage:lu.warpWeavingShrinkage,warpFinishShrinkage:lu.warpFinishShrinkage,weftFinishShrinkage:lu.weftFinishShrinkage,weftWeavingShrinkage:lu.weftWeavingShrinkage,weftWastage:lu.weftWastage,warpWastage:lu.warpWastage,notes:Qd,remarks:ou.remarks,designerName:ou.designerName,designType:ou.designType,customerName:ou.customerName,contanctNo:ou.contanctNo,deliveryDate:ou.deliveryDate,checkedBy:ou.checkedBy};t&&kE(null),(async(e,t="data",n)=>{const i=JSON.stringify(e),r=CryptoJS.AES.encrypt(i,TE).toString();if(window.showSaveFilePicker)if(IE){const e=await IE.createWritable();await e.write(r),await e.close(),n||iL("File Offline Saved Successfully")}else{let e=await window.showSaveFilePicker({suggestedName:t+".mwf",types:[{description:"Maxweave File (.mwf)",accept:{"text/plain":[".mwf"]}}]});kE(e);const i=await IE.createWritable();await i.write(r),await i.close(),n||iL("File Offline Saved Successfully")}else{const e=new Blob([r],{type:"text/plain"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t+".mwf",n.click()}})(w,DE.innerText,LE),console.log("submitable dat is",w),LE?document.dispatchEvent(xE):Uf()};let LE=!1,AE=1;let PE,BE=!1,RE=!0;const FE=e=>{LE=e},ME=document.getElementById("save-maindesign-modal"),DE=document.getElementById("file-name-navbar"),OE=document.getElementById("save-maindesign-modal-trigger"),$E=document.getElementById("save-as-maindesign-modal-trigger"),jE=document.getElementById("close-file-trigger");let WE,HE,qE,UE,zE,VE="",YE="",GE=[],JE=null,XE=null,KE=[],ZE=[];const QE=e=>{const t=e.sort((e,t)=>e.itemType!==t.itemType?"UserFolder"===e.itemType?-1:1:e.item.name.toLowerCase().localeCompare(t.item.name.toLowerCase()));GE=t},eS=e=>{let t=String(e.currentTarget.id).split("_")[1],n=GE.find(e=>e.item._id==t);e.ctrlKey?-1==KE.findIndex(e=>e.item._id==t)?KE.push(n):KE=KE.filter(e=>e.item._id!=t):KE=[n],PE=n,tS(),WE.value=n.item.name},tS=()=>{for(let e=0;e<GE.length;e++){let t=GE[e].itemType,n=GE[e].item,i=document.getElementById(`${t}_${n._id}`),r=i.querySelector(".open-pegplan-data-content-file-name"),a=i.querySelector("input");r.style.display="block",a.style.display="none",i.classList.remove("maindesign-file-active")}for(let e=0;e<KE.length;e++){let t=KE[e].itemType,n=KE[e].item;document.getElementById(`${t}_${n._id}`).classList.add("maindesign-file-active")}},nS=async e=>{if("Enter"==e.key)if(PE.itemType==im){let t={mainDesignId:PE.item._id,name:e.target.value};try{let n=await es(t);GE.find(e=>e.id==PE.id).name=e.target.value,PE.item.name=e.target.value,(mm&&mm.id)==PE.item._id&&(DE.innerText=String(e.target.value)),Kg(n.data.DATA),Toastify({text:"File Saved Successfully",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast(),console.log("resData is",n);let i=document.getElementById(`${PE.itemType}_${PE.item._id}`),r=i.querySelector(".open-pegplan-data-content-file-name");r.innerHTML=e.target.value;let a=i.querySelector("input");r.style.display="block",a.style.display="none",openMainDesignFileName.value=e.target.value,isRenamInputActive=!1}catch(e){console.log("inside error",e)}}else if(PE.itemType==rm)try{await og(e.target.value,PE.item._id),Toastify({text:"Folder Rename Successfully",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast();let t=document.getElementById(`${PE.itemType}_${PE.item._id}`),n=t.querySelector(".open-pegplan-data-content-file-name");n.innerHTML=e.target.value;let i=t.querySelector("input");n.style.display="block",i.style.display="none",isRenamInputActive=!1,sS()}catch(e){console.log("inside error",e)}},iS=e=>{eT(),console.log("selectedMainDesignData====>",PE);let t=document.getElementById(`${PE.itemType}_${PE.item._id}`),n=t.querySelector(".open-pegplan-data-content-file-name"),i=t.querySelector("input");n&&(n.style.display="none"),i&&(i.value=PE.item.name,i.style.display="block",i.focus(),i.addEventListener("keydown",nS))},rS=e=>{},aS=e=>{"Enter"==e.key&&mS()},lS=()=>{JE=XE,sS()},oS=async e=>{const t=document.activeElement;if("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable){if("Delete"!=e.key||isRenamInputActive||PE&&(await zl("Are you sure you want to permanently delete this file?")?(async()=>{if(PE.itemType==rm){let e=await cg(PE.item._id);if(console.log("deleteSelectedItem called",e.data),e.data.DATA>0){if(!await zl(`Folder contains ${e.data.DATA} files Are you sure you want to delete it ?`))return;dg(PE).then(e=>{PE.itemType==im&&deleteFromRecentDesign(PE.item._id),sS(),PE=null}).catch(e=>console.log("delete design failed"))}}dg(PE).then(e=>{PE.itemType==im&&deleteFromRecentDesign(PE.item._id),sS(),PE=null}).catch(e=>console.log("delete design failed"))})():console.log("do not delete it")),e.ctrlKey&&"x"==String(e.key).toLowerCase())if(KE.length>0){KE.find(e=>e.item._id==mm&&mm.id)?showErrorMessage("Please Close opened design in order to copy it"):(ZE=[...KE],Toastify({text:`${KE.length} ${1==KE.length?"File":"Files"} Copied to clipboard`,className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast())}else ZE=[],Toastify({text:"Please Select files",className:"error",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast();if(e.ctrlKey&&"v"==String(e.key).toLowerCase()){let e=ZE.map(e=>e.item._id);await sg(e,JE),sS()}if(e.ctrlKey&&"a"==String(e.key).toLowerCase()){let e=GE.filter(e=>"MainDesign"==e.itemType);KE=[...e],tS()}"Backspace"==e.key&&console.log("eeee",e)}},sS=async()=>{if(zE.innerHTML='<div class="loader"></div>',JE){let e=await pg(JE);JE=e.data.DATA._id,XE=e.data.DATA.parentFolder&&e.data.DATA.parentFolder._id,QE(e.data.DATA.children)}else{let e=await hg();JE=e.data.DATA._id,XE=e.data.DATA.parentFolder&&e.data.DATA.parentFolder._id,QE(e.data.DATA.children)}let e=document.createElement("div");XE&&(e.innerHTML+='\n    <div class="open-pegplan-data-container-content" id="open-main-design-back-button">\n      <div class="open-pegplan-data-content-image">\n        <img src="back-folder.png" width="60">\n      </div>\n      <div class="open-pegplan-data-content-file-name">..</div>\n      <input style="display:none;"/>\n    </div>');for(let t=0;t<GE.length;t++){let n=GE[t].itemType,i=GE[t].item,r=i.name;e.innerHTML+=`\n        <div class="open-pegplan-data-container-content" id="${n}_${i._id}">\n          <div class="open-pegplan-data-content-image">\n            <img src="${n==im?"maxweavefev.png":"folder.png"}" width="${n==im?"100":"60"}">\n          </div>\n          <div class="open-pegplan-data-content-file-name">${r}</div>\n          <input style="display:none;"/>\n        </div>`}zE.innerHTML=e.innerHTML;const t=zE.querySelector("#open-main-design-back-button");t&&t.addEventListener("dblclick",lS);const n=document.getElementById("savemaindesign-renameDeleteMenu");for(let e=0;e<GE.length;e++){let t=GE[e].itemType,i=GE[e].item;const r=zE.querySelector("#"+CSS.escape(`${t}_${i._id}`));tT(r,n),r.addEventListener("contextmenu",eS),r.addEventListener("click",eS),r.addEventListener("dblclick",uS);const a=document.getElementById("savemaindesign-rename-trigger-element"),l=document.getElementById("savemaindesign-delete-trigger-element");a.addEventListener("click",iS),l.addEventListener("click",rS)}},dS=()=>{Uf(),Yi("save-maindesign-modal"),(async()=>{WE.value="",Uf(),document.addEventListener("keydown",oS),sS()})(),WE.addEventListener("keydown",aS),ME.style.display="block",ME.style.animation="slide-down 0.3s ease"},cS=()=>{zE.innerHTML="",ME.style.display="none",WE.removeEventListener("keydown",aS),Yi(""),AE=1,BE=!1,RE=!0},uS=e=>{PE.itemType==rm&&(JE=PE.item._id,sS())},pS=async()=>{AE=1,RE=!0;const e={name:UE.value.trim()};QE([]),zE.innerHTML="",await(async(e={})=>{if(!BE&&RE){BE=!0;try{const t=await ns(AE,25,e),{data:n,pagination:i}=t.data.DATA;let r=[];Array.isArray(n)&&n.forEach(e=>{r.push({item:(()=>{const t={...e,_id:e.id};return delete t.id,t})(),itemType:"MainDesign"})}),QE(1===AE?r:[...GE,...r]);let a=document.createElement("div");for(let e=0;e<GE.length;e++){let t=GE[e].itemType,n=GE[e].item,i=n.name;a.innerHTML+=`\n          <div class="open-pegplan-data-container-content" id="${t}_${n._id}">\n            <div class="open-pegplan-data-content-image">\n              <img src="${t==im?"maxweavefev.png":"folder.png"}" width="${t==im?"100":"60"}">\n            </div>\n            <div class="open-pegplan-data-content-file-name">${i}</div>\n            <input style="display:none;"/>\n          </div>`}zE.innerHTML+=a.innerHTML;const l=document.getElementById("savemaindesign-renameDeleteMenu");for(let e=0;e<GE.length;e++){let t=GE[e].itemType,n=GE[e].item;const i=zE.querySelector("#"+CSS.escape(`${t}_${n._id}`));tT(i,l),i.addEventListener("contextmenu",eS),i.addEventListener("click",eS);const r=document.getElementById("savemaindesign-rename-trigger-element"),a=document.getElementById("savemaindesign-delete-trigger-element");r.addEventListener("click",iS),a.addEventListener("click",rS)}RE=AE<i.totalPages,AE++}catch(e){console.log("Error fetching designs:",e)}finally{BE=!1}}})(e)},hS=async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=[];Object.keys(Ld).forEach(e=>{t.push({yarnType:Ad[e]?Ad[e].yarnType:"",yarnName:Ad[e]?Ad[e].yarnName:"",yarnLetter:e,yarnWarpOrWeft:"warp",colorCode:Ld[e],yarnUnit:Ad[e]&&Ad[e].yarnUnit?Ad[e].yarnUnit:"denier"})}),Object.keys($s).forEach(e=>{t.push({yarnType:Ws[e]?Ws[e].yarnType:"",yarnName:Ws[e]?Ws[e].yarnName:"",yarnLetter:e,yarnWarpOrWeft:"weft",colorCode:$s[e],yarnUnit:Ws[e]&&Ws[e].yarnUnit?Ws[e].yarnUnit:"denier"})}),Object.keys(js).forEach(e=>{t.push({yarnType:"",yarnName:"",yarnLetter:e,yarnWarpOrWeft:"function",colorCode:js[e],yarnUnit:""})});let n={colorPaletteId:"",user:e,name:WE.value+"-color-palette",yarnDetail:t,isFileConnected:!0};try{return(await gg(n)).data.DATA.id}catch(e){console.log("inside error",e)}},gS=async e=>{console.log("selected main design",PE);let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;VE=mm?mm.id:"";let n=Bw==_i?GO.convert_new_index_to_numeric(ZO):GO.get_fix_numeric_text(),i=XC(n);const r=lC(String(i).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e)));let a=FT==Pi?KO.convert_new_index_to_numeric(!1,!1):KO.get_fix_numeric_text(),l=XC(a,!0);const o=String(l).split("\n").length;let s="",d="",c="",u="",p=0;if(Ys==Li||"20A"==d$.fixNumericText){for(let e=d$.size-1;e>=d$.getMinimumIndex();e--){let t=d$.findElementFromIndex(e);t?(p>0&&(s+=p.toString()+"\n"),s+=t.color_code+"\n",p=0):p++}p=0,c=y$(s.toUpperCase())}else c=d$.fixNumericText;if(p=0,"20A"==c$.fixNumericText||$d==Ni){for(let e=0;e<=c$.getMaximumIndex();e++){let t=c$.findElementFromIndex(e);t?(p>0&&(d+=p.toString()+"\n"),d+=t.color_code+"\n",p=0):p++}u=y$(d.toUpperCase())}else u=c$.fixNumericText;let h=await hS();const g=new Uint32Array(I$.memory.buffer,ZO.click_cells(),ZO.click_dentgrid_length()).toString(),m=Array.from(new Uint32Array(I$.memory.buffer,GO.compress_split_array(),GO.compress_split_array_length())),f=Array.from(new Uint32Array(I$.memory.buffer,KO.compress_split_array(),KO.compress_split_array_length())),y=Array.from(new Uint32Array(I$.memory.buffer,KO.compress_file_loop_split_array(),KO.compress_file_loop_split_array_length())),v=c$.compressSplitter,b=d$.compressSplitter,w=new Uint32Array(I$.memory.buffer,p$.cells(),p$.selected_beamgrid_length()).toString();console.log("color palette id is",h),dh.value=KO.rows(),ch.value=GO.cols(),console.log("weft color grid isnta =====>",d$),console.log("warp color grid insrt",c$);let E={pegPlan:a,draftPlan:n,warpPattern:u,weftPattern:c,user:t,name:YE,shaft:GO.rows().toString(),mainDesignId:VE,picks:o.toString(),ends:r.toString(),unit:hh.value,reed:zO.value,draftCompressSplitArray:m,pegplanCompressSplitArray:f,pegplanFileSplitArray:y,warpCompressSplitArray:v,weftCompressSplitArray:b,perinch:gh.value,leftSalvageWidth:jp,bodyWidth:Hp,rightSalvageWidth:Wp,leftSalvageWarpDent:Yp.value,bodyWarpDent:Gp.value,rightSalvageWarpDent:Jp.value,warpDencity:ah.value,weftDencity:lh.value,designHeight:dh.value,designWidth:ch.value,gridHeight:oh.value,gridWidth:sh.value,weftHeight:uh.value,warpWidth:ph.value,skipDent:g,doubleBeam:w,draftWithPart:{designWithPart:wy,draftParts:Kf},extraWarp:JSON.stringify(o$),creaming:JSON.stringify(l$),density:JSON.stringify(s$),speed:JSON.stringify(h$),leftSalvage:JSON.stringify(Ec),rightSalvage:JSON.stringify(Sc),weftSelectorMapping:JSON.stringify(Mg),densityMapping:JSON.stringify(fp),speedMapping:JSON.stringify(yp),draftDesignModeType:Bw,pegPlanDesignModeType:FT,warpWeavingShrinkage:lu.warpWeavingShrinkage,warpFinishShrinkage:lu.warpFinishShrinkage,weftFinishShrinkage:lu.weftFinishShrinkage,weftWeavingShrinkage:lu.weftWeavingShrinkage,weftWastage:lu.weftWastage,warpWastage:lu.warpWastage,notes:Qd,remarks:ou.remarks,designerName:ou.designerName,designType:ou.designType,customerName:ou.customerName,contanctNo:ou.contanctNo,deliveryDate:ou.deliveryDate,checkedBy:ou.checkedBy,colorPaletteId:h};try{let e=await es(E),t=e.data.DATA.id;const n={folderId:JE,itemId:t,itemType:"MainDesign"};if(VE||(await(e=>{const t=localStorage.getItem("token");return axios.post(ba+"/folder/add-content",e,{headers:{token:t}})})(n),sS()),Kg(e.data.DATA),Sm(e.data.DATA),DE.innerText=YE,LE)return void document.dispatchEvent(xE);Toastify({text:"File Saved Successfully",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast(),console.log("resData is",e)}catch(e){console.log("inside error",e)}Uf(),Uf()},mS=async()=>{if(YE=WE.value.trim(),YE.length>0){let e=await((e,t)=>{const n=localStorage.getItem("token"),i=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.post(ba+"/main-design/check-main-design-name",{userId:i,currentFolderId:t,designName:e},{headers:{token:n}})})(YE,JE);console.log("resonse data====>",e.data);let t=Boolean(e.data.DATA);if(Sm(e.data.DATA),t&&!await zl("Do You Want To Replace it?"))return;gS(),cS()}},fS=async()=>{DE.innerText;await zl("Do You Want To Save It?")?dS():window.location.reload(!0)},yS=async()=>{console.log("create new folder called");try{await ug(JE),sS()}catch(e){console.log("err while creating new folder",e)}},vS=()=>{JE=null,UE.value="",sS()},bS=(e=!1,t=!1)=>{Uf(),pi==Vg?(async(e=!1,t=!1)=>{LE=e,t?dS():(YE=DE.innerText,"Untitled"!=YE?gS():dS())})(e,t):pi==zg?CE(e,t):(Yi(Ug.id),Ug.style.display="block",Ug.style.animation="slide-down 0.3s ease")},wS=e=>{let t=[],n=[];return e.forEach(e=>{"\n"===e?(t.push(n),n=[]):n.push(e)}),n.length>0&&t.push(n),t.map(e=>e.join("\n")).map(e=>e.trim()).join("\n\n")};function ES(e){const t=String(e).trim().split("\n"),n=t.length;for(let e=1;e<=n/2;e++){let i=!0;if(n%e==0){for(let r=0;r<e;r++){for(let a=1;a<Math.floor(n/e);a++)if(t[r]!==t[r+a*e]){i=!1;break}if(!i)break}if(i){return{pegplanContent:t.slice(0,e).join("\n"),repeat:Math.floor(n/e)}}}}return{pegplanContent:e,repeat:1}}const SS=e=>{let t=String(e).split("\n\n"),n=[];for(let e=0;e<t.length;e++){let i=t[e];n.push(ES(i))}return n};function xS(e){const t=e.match(/\[(.*?)\]X(\d+)/);return t?{content:t[1],repeat:parseInt(t[2],10)}:null}const IS=e=>{let t=[],n=String(e).split("\n"),i=0,r=0,a="";for(let e=0;e<n.length;e++)if(0==i)if(n[e].includes("[")&&n[e].includes("]")){let{content:i,repeat:l}=xS(n[e]);t.push({pegplanContent:i,repeat:l}),a="",r=0}else if(n[e].includes("[")){a.length>0&&(t.push({pegplanContent:a,repeat:1}),a="",r=0);let l=0,o=e+1,s=0;for(i=1;!n[o].includes("]");)l+=1,o+=1,i+=1;r=o-e+1,s=n.slice(e,o+1).join("\n").split("X")[1];let d=n.slice(e,o+1).join("\n").split("X")[0].replace("[","").replace("]","");if(r*s>1/0){let e=0,n=Math.floor(r*s/(1/0));for(let i=0;i<n;i++)t.push({pegplanContent:d,repeat:parseInt(s)}),e+=r;if(e!=r*s){let e=r*s%(1/0);t.push({pegplanContent:d.split("\n").slice(0,e).join("\n"),repeat:1})}r=0,a=""}else t.push({pegplanContent:d,repeat:parseInt(s)}),r=0,a=""}else r==1/0&&(t.push({pegplanContent:a,repeat:1}),a="",r=0),a+=n[e]+"\n",r+=1,e+1==n.length&&(t.push({pegplanContent:a,repeat:1}),a="",r=0);else i-=1;return t},kS=()=>{let e="";e=((e=!0)=>{let t=KO.get_pegplan_numeric_with_splitter(),n=String(t).split("\n").filter(e=>e),i=String(t).split("\n\n");if(1==i.length&&"\n"!=String(t).at(-1))return"";let r=[],a=0;i.forEach((e,t)=>{let n=e.split("\n").length;t<i.length-1&&r.push(a+n),a+=n});let l=[...n],o=FC();console.log("fidder color ",o);let s=[];if(n.forEach((e,t)=>{let n=d$.findElementFromIndex(d$.size-t-1),i=l$.findElementFromIndex(d$.size-t-1),r=s$.findElementFromIndex(s$.size-t-1);if(n){let t=e+" "+o[n.color_code];if(i&&(t+=" "+gi.start),r&&Number(fi.start)){let e=r.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}s.push(t)}else{let t=e+" "+hi.start;if(i&&(t+=" "+gi.start),r&&Number(fi.start)){let e=r.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}s.push(t)}}),l=[...s],r.reverse().forEach(e=>{l.splice(e,0,"\n")}),e){return wS(l)}return l.join("\n")})(!1);let t=[];return 0==e.trim().length?(e=((e=!0)=>{let t=KO.get_new_print_pegplan_data(!1);console.log("pegplan numeric text is",t);let n=String(t).split("\n").filter(e=>e),i=[...n],r=FC();console.log("fidder color ",r);let a=[];if(n.forEach((e,t)=>{let n=d$.findElementFromIndex(d$.size-t-1),i=l$.findElementFromIndex(d$.size-t-1),l=s$.findElementFromIndex(s$.size-t-1);if(n){let t=e+" "+r[n.color_code];if(i&&(t+=" "+gi.start),l&&Number(fi.start)){let e=l.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}a.push(t)}else{let t=e+" "+hi.start;if(i&&(t+=" "+gi.start),l&&Number(fi.start)){let e=l.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}a.push(t)}}),i=[...a],e){let e=E$(i.join("\n"));return String(e).trim()}return i.join("\n")})(!1),t=IS(E$(e))):t=SS(e),t},_S=async()=>{if((()=>{let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1})())return;const e=DE.innerText;let t="",n=kS();n=n.filter(e=>String(e.pegplanContent).trim()),t=v$(n,e+".wjl");const i=LI(t);console.log("bytearray is",i),NI(i,e+".wjl")};let TS={};const NS=e=>{let t="0".repeat(32);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=32&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t},CS=()=>{let e="";e=LS(!1);let t=[];return 0==e.trim().length?(e=((e=!0,t=0)=>{TS={},Object.keys(Mg).forEach(e=>{TS[e]=0});let n=KO.get_new_print_pegplan_data(!1);console.log("pegplan numeric text is",n,s$);let i=String(n).split("\n").filter(e=>e),r=[...i];if(hi.start&&hi.end&&fi.start&&fi.end){let e=RC();console.log("fidder color ",e);let n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=s$.findElementFromIndex(s$.size-r-1);if(a){let r=a.color_code,o=String(e[r]).split("/"),s=o[TS[r]%o.length];TS[r]=TS[r]+1;let d=i+" "+(Number(s)+(t?Number(mi.end):0));l&&(d+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(d)}else{let e=i+" "+hi.start;l&&(e+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(e)}}),r=[...n]}if(e){let e=E$(r.join("\n"));return String(e).trim()}return r.join("\n")})(!1),t=IS(E$(e))):t=SS(e),t},LS=(e=!0,t=0)=>{TS={},Object.keys(Mg).forEach(e=>{TS[e]=0});let n=KO.get_pegplan_numeric_with_splitter(),i=String(n).split("\n").filter(e=>e),r=String(n).split("\n\n");if(1==r.length&&"\n"!=String(n).at(-1))return"";let a=[],l=0;r.forEach((e,t)=>{let n=e.split("\n").length;t<r.length-1&&a.push(l+n),l+=n});let o=[...i];if(hi.start&&hi.end&&fi.start&&fi.end){let e=RC();console.log("fidder color ",e);let n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=s$.findElementFromIndex(s$.size-r-1);if(a){let r=a.color_code,o=String(e[r]).split("/"),s=o[TS[r]%o.length];TS[r]=TS[r]+1;let d=i+" "+(Number(s)+(t?Number(mi.end):0));l&&(d+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(d)}else{let e=i+" "+hi.start;l&&(e+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(e)}}),o=[...n],a.reverse().forEach(e=>{o.splice(e,0,"\n")})}if(e){return wS(o)}return o.join("\n")},AS=()=>{if(KO.cols()>28)return Toastify({text:"More than 28 shaft now allowed in .db1 file",style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),!0;let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1};function PS(e){return e.match(/.{1,8}/g).map(e=>e.split("").reverse().join("")).join("")}const BS=()=>{if(AS())return;let e=CS(),t="",n=KO.cols();if(n>16)return void nL("Shaft More than 16 are not supported in bnx file");t+=Number(n).toString(2).padStart(8,"0").split("").reverse().join("").padEnd(16,"0"),e.forEach(e=>{let n=e.pegplanContent,i=e.repeat,r=String(n).trim().split("\n");if(1==i)r.forEach(e=>{let n=NS(e);t+=n});else{let e="";e=function(e){if(e<0||e>65535)throw new Error("Integer must be between 0 and 65535.");return[255&e,e>>8&255].map(e=>Number(e).toString(2).padStart(8,"0")).join("")}(i)+Number("9").toString(2).padStart(8,"0")+"0".repeat(8),e=PS(e),t+=e,r.forEach(e=>{let n=NS(e);t+=n});let n="";n="0".repeat(16)+Number("10").toString(2).padStart(8,"0")+"0".repeat(8),n=PS(n),t+=n}});let i=(t.length-16)/32,r=Number(i).toString(2).padStart(16,"0").split("").reverse().join("");t=r+t;let a=DE.innerText;NI(CI(t),a+"-ix.bnx")},RS=()=>{if(AS())return;let e=KO.convert_new_index_to_numeric(!0,!1),t=String(e).split("\n"),n=t.filter(e=>e).length,i="",r=KO.cols();if(r>16)return void nL("Shaft More than 16 are not supported in bnx file");i+=Number(n).toString(2).padStart(16,"0").split("").reverse().join(""),i+=Number(r).toString(2).padStart(8,"0").split("").reverse().join("").padEnd(16,"0"),t.forEach((e,t)=>{let r=(e=>{let t="0".repeat(16);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=16&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t+"0".repeat(16)})(e),a=d$.cells.find(e=>e.index==n-t-1),l=s$.cells.find(e=>e.index==n-t-1);if(a){let e=a.color_code,t=Number(Mg[e]);t&&(r=TI(r,15+t,"1"))}if(l){let e=l.color_code,t=String(e).charCodeAt(0)-65+1;t<9&&t>0&&(r=TI(r,t+23,"1"))}i+=r});let a=DE.innerText;NI(CI(i),a+"-v.bnx")},FS=e=>(e=>{let t="0".repeat(40);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=40&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t})(String(e)),MS=()=>{if((()=>{if(KO.cols()>28)return Toastify({text:"More than 28 shaft now allowed in .db1 file",style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),!0;let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1})())return;let e=((e=!0,t=0)=>{let n=KO.get_new_print_pegplan_data(!1);console.log("pegplan numeric text is",n);let i=String(n).split("\n").filter(e=>e),r=[...i];if(hi.start&&hi.end&&gi.start&&gi.end){let e=gi.start,n=t||e;9!=e&&(n=e+32);let a=FC();console.log("fidder color ",a);let l=[];i.forEach((e,t)=>{let i=d$.findElementFromIndex(d$.size-t-1),r=l$.findElementFromIndex(d$.size-t-1);if(i){let t=e+" "+(Number(a[i.color_code])+32);r&&(t+=" "+n),l.push(t)}else{let t=e+" "+hi.start;r&&(t+=" "+n),l.push(t)}}),r=[...l]}if(e){let e=compressPlanString(r.join("\n"));return String(e).trim()}return r.join("\n")})(!1,32).split("\n"),t=e.length,n="";e.forEach((e,t)=>{let i=FS(e);n+=i}),n+="0".repeat(64),n+=Number(t).toString(2).padStart(16,"0");const i=DE.innerText,r=CI(n);let a=LI(Number(t).toString(2).padStart(16,"0"));r[r.length-2]=a[0],r[r.length-1]=a[1],NI(r,i+".db1"),console.log("export db1 file called")};const DS=async()=>{if(console.log("download button clicked"),(()=>{let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1})())return;const e=DE.innerText;let t=KO.cols();hi.start,hi.end,mi.start;const n=mi.end;gi.start,gi.end;if(t>n&&nL("This File Contains more shaft than "+n),t>20&&!await zl("This File Contains More than 20 shaft,only first 20 shafts will be considered,Do you want to export it?"))return;let i=KO.convert_new_index_to_numeric(!0,!1),r=String(i).split("\n"),a=r.filter(e=>e).length,l="";r.forEach((e,t)=>{let n=(e=>{let t="0".repeat(20);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=20&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t+"0".repeat(12)})(e),i=d$.cells.find(e=>e.index==a-t-1),r=s$.cells.find(e=>e.index==a-t-1),o=l$.cells.find(e=>e.index==a-t-1);if(i){let e=i.color_code,t=Number(Mg[e]);t&&(n=TI(n,23+t,"1"))}if(r){let e=r.color_code,t=String(e).charCodeAt(0)-65+1;t<=8&&t>0&&(n=function(e,t){const n={1:"000",2:"100",3:"010",4:"110",5:"001",6:"101",7:"011",8:"111"}[t];if(!n)throw new Error("Invalid numberValueOfCurrentColorCode");return e=e.substring(0,20)+n+e.substring(23)}(n,t))}o&&(n=TI(n,23,"1")),l+=n});NI(CI(l),e+".bin"),console.log("rifa bin download button clicked")};let OS={};function $S(e){const t=new ArrayBuffer(4),n=new DataView(t);n.setFloat32(0,e);return n.getUint32(0).toString(2).padStart(32,"0")}function jS(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}const WS=e=>{let t=jS(String($S(e)));return t.reverse(),t.join("")},HS=e=>{let t=(e=>{let t="0".repeat(16);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=16&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t})(e).split("").reverse().join(""),n=jS($S(parseInt(t,2)));return n.reverse(),n.join("")},qS=()=>{let e=KO.rows(),t=s$.cells.map(e=>e.color_code);if(t=[...new Set(t)],e>1e4)return nL("Pick must be lesser than 10000"),!0;let n=MC(UC());console.log("weft selector mappibg",Mg);for(let e=0;e<n.length;e++){let t=Mg[n[e]];if(!Number(t[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(n[e],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),n[e]}return Ey.length>8?(nL("No. of weft must be lesser than 8"),!0):t.length>8&&(nL("No. of Density must be lesser than 8"),!0)};let US={};function zS(e){const t=new ArrayBuffer(4),n=new DataView(t);n.setFloat32(0,e);return n.getUint32(0).toString(2).padStart(32,"0")}function VS(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}const YS=e=>{let t=VS(String(zS(e)));return t.reverse(),t.join("")},GS=(e,t=16)=>{const n=t;let i="0".repeat(n);const r=e.split(" ").map(Number);for(const e of r)e>=1&&e<=n&&(i=i.substr(0,e-1)+"1"+i.substr(e));return i},JS=e=>{let t=GS(e).split("").reverse().join(""),n=VS(zS(parseInt(t,2)));return n.reverse(),n.join("")},XS=()=>{let e="";e=((e=!0)=>{let t=KO.get_pegplan_numeric_with_splitter();US={},Object.keys(Mg).forEach(e=>{US[e]=0}),console.log("pegplan numeric text is",t);let n=String(t).split("\n").filter(e=>e),i=String(t).split("\n\n");if(1==i.length&&"\n"!=String(t).at(-1))return"";let r=[],a=0;i.forEach((e,t)=>{let n=e.split("\n").length;t<i.length-1&&r.push(a+n),a+=n});let l=[...n];if(hi.start&&hi.end&&fi.start&&fi.end){let e=BC();console.log("fidder color ",e);let t=[];n.forEach((n,i)=>{let r=d$.findElementFromIndex(d$.size-i-1),a=s$.findElementFromIndex(s$.size-i-1);if(r){let i=String(e[r.color_code]).split("/"),l=n+" "+i[US[r.color_code]%i.length];if(US[r.color_code]=US[r.color_code]+1,a){let e=a.color_code;l+=" "+(String(e).charCodeAt(0)+fi.start-65)}t.push(l)}else{let e=n+" "+hi.start;if(a){let t=a.color_code;e+=" "+(String(t).charCodeAt(0)+fi.start-65)}t.push(e)}}),l=[...t],r.reverse().forEach(e=>{l.splice(e,0,"\n")})}if(e){return wS(l)}return l.join("\n")})(!1);let t=[];return 0==e.trim().length?(e=((e=!0)=>{let t=KO.get_new_print_pegplan_data(!1);US={},Object.keys(Mg).forEach(e=>{US[e]=0}),console.log("pegplan numeric text is",t);let n=String(t).split("\n").filter(e=>e),i=[...n];if(hi.start&&hi.end&&fi.start&&fi.end){let e=BC();console.log("fidder color ",e);let t=[];n.forEach((n,i)=>{let r=d$.findElementFromIndex(d$.size-i-1),a=s$.findElementFromIndex(s$.size-i-1);if(r){let i=String(e[r.color_code]).split("/"),l=n+" "+i[US[r.color_code]%i.length];if(US[r.color_code]=US[r.color_code]+1,a){let e=a.color_code;l+=" "+(String(e).charCodeAt(0)+fi.start-65)}t.push(l)}else{let e=n+" "+hi.start;if(a){let t=a.color_code;e+=" "+(String(t).charCodeAt(0)+fi.start-65)}t.push(e)}}),i=[...t]}if(e){let e=E$(i.join("\n"));return String(e).trim()}return i.join("\n")})(!1),t=IS(E$(e))):t=SS(e),t},KS=()=>{if(ZS())return;let e=XS();e=e.filter(e=>String(e.pegplanContent).trim().length>0);let t=(e=>{let t=0;return Array.isArray(e)?(e.forEach(e=>{let n=String(e.pegplanContent).trim();t+=n.split("\n").length}),t+=2*e.length,t):KO.rows()})(e),n=KO.rows(),i="",r="",a="",l="",o="";e.forEach(e=>{i+=(e=>{let t="",n=String(e.pegplanContent),i=e.repeat;const r=hi.start,a=hi.end;return t+=YS(28),n.split("\n").filter(e=>e).forEach(e=>{let n=e.split(" ").find(e=>r<=Number(e)&&a>=Number(e));if(n){let e=Number(n)-Number(r)+1;t+=YS(32+e)}else t+=YS(33)}),t+=YS(29+32*Number(i)),t})(e),a+=(e=>{let t="",n=String(e.pegplanContent),i=e.repeat;const r=fi.start,a=fi.end;return t+=YS(28),n.split("\n").filter(e=>e).forEach(e=>{let n=e.split(" ").find(e=>r<=Number(e)&&a>=Number(e));if(n){let e=Number(n)-Number(r)+1;t+=YS(32+e)}else t+=YS(33)}),t+=YS(29+32*Number(i)),t})(e),l+=(e=>{let t="",n=String(e.pegplanContent);e.repeat;return t+=YS(0),n.split("\n").filter(e=>e).forEach(e=>{let n=e.split(" ").filter(e=>1<=Number(e)&&16>=Number(e)),i=JS(n.join(" "));t+=i}),t+=YS(0),t})(e),o+=(e=>{let t="",n=String(e.pegplanContent),i=e.repeat;return t+=YS(2),n.split("\n").filter(e=>e).forEach(e=>{let n=e.split(" ").filter(e=>17<=Number(e)&&20>=Number(e)),i=GS(n.join(" "),20);i=da("1010"+i.slice(8));let r=parseInt(i,2),a=YS(r);t+=a}),t+=YS(3+4*i),t})(e)});let s=2e4-i.length/32,d=2e4-a.length/32,c=2e4-l.length/32,u=2e4-o.length/32;i+="0".repeat(32*s),a+="0".repeat(32*d),l+="0".repeat(32*c),o+="0".repeat(32*u),r+="1011000010101101000000010000000000000000000000000000000000000000",r+=i,r+=a,r+=l,r+=o,r+="0".repeat(64e4),r+=YS(Math.ceil(n/15)>250?250:Math.ceil(n/15)),r+=YS(t),r+="0".repeat(319904);NI(LI(r),DE.innerText+"-redflag.dat")},ZS=()=>{let e=KO.rows(),t=s$.cells.map(e=>e.color_code);if(t=[...new Set(t)],e>1e4)return nL("Pick must be lesser than 10000"),!0;let n=MC(UC());console.log("weft selector mappibg",Mg);for(let e=0;e<n.length;e++){let t=Mg[n[e]];if(!Number(t&&t[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(n[e],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),n[e]}return Ey.length>16?(nL("No. of weft must be lesser than 16"),!0):t.length>16&&(nL("No. of Density must be lesser than 16"),!0)};function QS(e){e<0&&(e=65536+e);let t=e.toString(16).toUpperCase();return t=t.padStart(4,"0"),t}async function ex(e,t,n){const i=new Blob([e],{type:"text/plain"}),r=document.createElement("a");r.download=`${t}.${n}`,r.href=URL.createObjectURL(i),document.body.appendChild(r),r.click(),document.body.removeChild(r);let a=nk.value;await Zd({isExport:!0,fileType:a})}const tx=e=>{let t=[],n=[];return e.forEach(e=>{"\n"===e?(t.push(n),n=[]):n.push(e)}),n.length>0&&t.push(n),t.map(e=>e.join("\n")).map(e=>e.trim()).join("\n\n")};const nx=()=>{let e="";e=((e=!0,t=0)=>{let n=KO.get_pegplan_numeric_with_splitter();console.log("pegplan numeric text is",n);let i=String(n).split("\n").filter(e=>e),r=String(n).split("\n\n");if(1==r.length&&"\n"!=String(n).at(-1))return"";let a=[],l=0;r.forEach((e,t)=>{let n=e.split("\n").length;t<r.length-1&&a.push(l+n),l+=n});let o=[...i],s=l$.cells.length>0;if(hi.start&&hi.end&&gi.start&&gi.end){let e=FC(),n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=l$.findElementFromIndex(d$.size-r-1);if(a){let o=i+" "+(Number(e[a.color_code])+(t?Number(shaftObject.end):0));if(l&&(o+=" "+(t||gi.start)),!s){let e=s$.findElementFromIndex(d$.size-r-1).color_code;o+=" "+(String(e).charCodeAt(0)-65+21)}n.push(o)}else{let e=i+" "+hi.start;if(l&&(e+=" "+(t||gi.start)),!s){let t=s$.findElementFromIndex(d$.size-r-1).color_code;e+=" "+(String(t).charCodeAt(0)-65+21)}n.push(e)}}),o=[...n]}if(a.reverse().forEach(e=>{o.splice(e,0,"\n")}),e){return tx(o)}return o.join("\n")})(!1);let t=[];return 0==e.trim().length?(e=((e=!0,t=0)=>{let n=KO.get_pegplan_numeric_with_splitter();console.log("pegplan numeric text is",n);let i=String(n).split("\n").filter(e=>e),r=String(n).split("\n\n"),a=[],l=0;r.forEach((e,t)=>{let n=e.split("\n").length;t<r.length-1&&a.push(l+n),l+=n});let o=[...i],s=l$.cells.length>0;if(hi.start&&hi.end&&gi.start&&gi.end){let e=FC(),n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=l$.findElementFromIndex(d$.size-r-1);if(a){let o=i+" "+(Number(e[a.color_code])+(t?Number(shaftObject.end):0));if(l&&(o+=" "+(t||gi.start)),!s){let e=s$.findElementFromIndex(d$.size-r-1).color_code;o+=" "+(String(e).charCodeAt(0)-65+21)}n.push(o)}else{let e=i+" "+hi.start;if(l&&(e+=" "+(t||gi.start)),!s){let t=s$.findElementFromIndex(d$.size-r-1).color_code;e+=" "+(String(t).charCodeAt(0)-65+21)}n.push(e)}}),o=[...n]}if(a.reverse().forEach(e=>{o.splice(e,0,"\n")}),e){return tx(o)}return o.join("\n")})(!1),t=IS(E$(e))):t=SS(e),t=t.filter(e=>String(e.pegplanContent).trim().length>0),t},ix=()=>{if((()=>{let e=KO.cols(),t=l$.cells.length>0?8:4;if(e>16)return Toastify({text:"Shaft must be less than 16",style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),!0;let n=FC();if([...new Set(Object.values(n))].length>t)return Toastify({text:"No. of weft must be less than "+(t+1),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),!0;let i=MC(UC());for(let e=0;e<i.length;e++){let t=Mg[i[e]];if(!Number(t[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(i[e],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),i[e]}return!1})())return;let e=l$.cells.length>0,t=nx(),n=KO.rows(),i=KO.cols(),r="",a=QS(n)+"\n",l="",o="",s=`$$$$\n${QS(parseInt("1".repeat(i),2))}\n****`;const d=e?24:20;l+=a,o+=a,t.forEach((n,i)=>{let r=n.pegplanContent.trim().split("\n").length;l+=`(${i+1})[`,o+=`(${t.length+i+1})[`,l+=QS(r)+" ",o+=QS(r)+" ",n.pegplanContent.split("\n").filter(e=>e).forEach((t,n)=>{let i=t.split(" ").filter(e=>1<=Number(e)&&16>=Number(e)).join(" "),r=parseInt(da(((e,t=16)=>{const n=t;let i="0".repeat(n);const r=e.split(" ").map(Number);for(const e of r)e>=1&&e<=n&&(i=i.substr(0,e-1)+"1"+i.substr(e));return i})(i)),2);l+="0"+QS(r);let a=t.split(" ").find(e=>17<=Number(e)&&d>=Number(e));if(e){let e=t.split(" ").find(e=>25<=Number(e)&&32>=Number(e));o+=e?"1":"0"}if(a)if(e)o+=(Number(a)-17+1).toString();else{let e=(s=Number(a)-17+1)>=1&&s<=8?["01","02","04","08","10","20","40","80"][s-1]:"Invalid input",n=t.split(" ").find(e=>21<=Number(e)&&29>=Number(e));Number(n)>21?o+=((e,t)=>{const n=["1","2","4","8"];return`${t}${n[e-1]}`})(Number(a)-17+1,Number(n)-21):o+=e}else o+="01";var s}),l+="]",l+=QS(n.repeat),l+="\n",o+="]",o+=QS(n.repeat),o+="\n"}),r+=l,r+=e?"%%%%\n":"----\n",r+=o,r+=s,ex(r,DE.innerText,e?"hht":"htt")};let rx={};const ax=()=>{let e="";e=ox(!1);let t=[];return 0==e.trim().length?(e=lx(!1),t=IS(E$(e))):t=SS(e),t},lx=(e=!0)=>{rx={},Object.keys(Mg).forEach(e=>{rx[e]=0});let t=KO.get_new_print_pegplan_data(!1);console.log("pegplan numeric text is",t);let n=String(t).split("\n").filter(e=>e),i=[...n],r=RC();console.log("fidder color ",r);let a=[];if(n.forEach((e,t)=>{let n=d$.findElementFromIndex(d$.size-t-1),i=s$.findElementFromIndex(s$.size-t-1);if(n){let t=n.color_code,l=String(r[t]).split("/"),o=l[rx[t]%l.length];rx[t]=rx[t]+1;let s=e+" "+o;if(i&&Number(fi.start)){let e=i.color_code;s+=" "+(String(e).charCodeAt(0)+fi.start-65)}a.push(s)}else{let t=e+" "+fidderObject.start;if(i&&Number(fi.start)){let e=i.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}a.push(t)}}),i=[...a],e){let e=E$(i.join("\n"));return String(e).trim()}return i.join("\n")},ox=(e=!0)=>{rx={},Object.keys(Mg).forEach(e=>{rx[e]=0});let t=KO.get_pegplan_numeric_with_splitter(!1);console.log("pegplan numeric text is",t);let n=String(t).split("\n").filter(e=>e),i=String(t).split("\n\n");if(1==i.length&&"\n"!=String(t).at(-1))return"";let r=[],a=0;i.forEach((e,t)=>{let n=e.split("\n").length;t<i.length-1&&r.push(a+n),a+=n});let l=[...n],o=RC();console.log("fidder color ",o);let s=[];if(n.forEach((e,t)=>{let n=d$.findElementFromIndex(d$.size-t-1),i=s$.findElementFromIndex(s$.size-t-1);if(n){let t=n.color_code,r=String(o[t]).split("/"),a=r[rx[t]%r.length];rx[t]=rx[t]+1;let l=e+" "+a;if(i&&Number(fi.start)){let e=i.color_code;l+=" "+(String(e).charCodeAt(0)+fi.start-65)}s.push(l)}else{let t=e+" "+fidderObject.start;if(i&&Number(fi.start)){let e=i.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}s.push(t)}}),l=[...s],r.reverse().forEach(e=>{l.splice(e,0,"\n")}),e){return wS(l)}return l.join("\n")};const sx=(e,t,n)=>{let i=!n,r=String(e).split(" ").map(Number);if("fidder"==t){let e=25,t=32,a=r.find(n=>n>=e&&n<=t);if(a){if(n)return 256*(Number(a)-e);if(i)return Number(a)-e}}if("density"==t){let e=33,t=40,a=r.find(n=>n>=e&&n<=t);if(a){if(n)return 4096*(Number(a)-e);if(i)return 16*(Number(a)-e)}}},dx=(e,t,n)=>{let i=e.split(" ").map(Number),r=0,a=0;for(let e=t;e<=n;e++)i.includes(e)&&(r+=Math.pow(2,a)),a++;return r};let cx=0;const ux=()=>{if(KO.cols()>24)return Toastify({text:"Shaft must be less than 24",style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),!0;let e=MC(UC());if(e.length>8)return Toastify({text:"No. of weft must be less than 9",style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),!0;for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1},px=()=>{if(ux())return;cx=0;let e=KO.rows(),t=lx(!1),n=ax(),i=DE.innerText,r="",a="",l=`name,${i}\n`,o="",s=`Total number of multiarm weft,${e},\n`,d=(e=>{let t="";for(let n=0;n<32;n++)t+=`dobby name[${n}],${e[n]?String(e).charCodeAt(n):0}\n`;return t})(i);(function(e){const t=e.trim().split("\n"),n=[];for(let e=0;e<t.length;e+=2){const i=t[e]+"\n"+(t[e+1]||"");n.push(i)}return n})(t).forEach((e,t)=>{o+=(e=>{let t,n,i,r,a="",l="0",[o,s]=String(e).split("\n");return o&&(t=`_1[${cx}],`+dx(o,1,16).toString()+"\n",cx++,n=`_1[${cx}],`+(dx(o,17,24)+sx(o,"fidder",!0)+sx(o,"density",!0)).toString()+"\n",cx++),s&&(i=`_1[${cx}],`+(256*dx(s,1,8)).toString()+"\n",cx++,r=`_1[${cx}],`+(dx(s,9,16)+256*dx(s,17,24)).toString()+"\n",cx++,l=`_1[${cx}],`+(sx(s,"fidder",!1)+sx(s,"density",!1)).toString()+"\n",cx++),a=t+n+i+r+l,a})(e)}),r+="#Version:0.1 ID:10 Mode:1 DO NOT edit this line!\n",r+=l,r+=s,r+=d,r+=o,n.forEach(e=>{let t=e.pegplanContent.trim().split("\n").length;a+=`${t},${e.repeat}\n`}),a=a.trim(),ex(r,i,"csv"),ex(a,i,"osv")};function hx(e){let t=e.toString(16).toUpperCase();return t=t.padStart(4,"0"),t}const gx=e=>e>=1&&e<=8?["01","02","04","08","10","20","40","80"][e-1]:"Invalid input",mx=()=>{if(ux())return;let e=ax(),t=KO.rows(),n=(KO.cols(),""),i=DE.innerText,r=hx(t)+"\n",a="",l="",o="",s="";e.forEach((t,n)=>{let i=t.pegplanContent.trim().split("\n").length;a+=`(${n+1})[`,l+=`(${e.length+n+1})[`,o+=`(${2*e.length+n+1})[`,s+=`(${3*e.length+n+1})[`,a+=hx(i)+" ",l+=hx(i)+" ",o+=hx(i)+" ",s+=hx(i)+" ",t.pegplanContent.split("\n").filter(e=>e).forEach((e,t)=>{let n=e.split(" ").filter(e=>1<=Number(e)&&24>=Number(e)).join(" "),i=e.split(" ").find(e=>25<=Number(e)&&32>=Number(e)),r=gx(Number(i)-25+1);l+=r;let d=e.split(" ").find(e=>33<=Number(e)&&40>=Number(e)),c=gx(Number(d)-33+1);o+=c;let u=parseInt(da(((e,t=16)=>{const n=t;let i="0".repeat(n);const r=e.split(" ").map(Number);for(const e of r)e>=1&&e<=n&&(i=i.substr(0,e-1)+"1"+i.substr(e));return i})(n)),2);a+="00"+hx(u),s+="0000 "}),l+="]",l+=hx(t.repeat),l+="\n",a+="]",a+=hx(t.repeat),a+="\n",o+="]",o+=hx(t.repeat),o+="\n",s=s.trim(),s+="]",s+=hx(t.repeat),s+="\n"}),n+=r,n+=a,n+="%%%%\n",n+=r,n+=l,n+="$$$$\n",n+=r,n+=o,n+="####\n",n+=r,n+=s,n+="@@@@",n=n.replace(/\n/g,"\r\n"),ex(n,i,"hht")},fx=(e,t)=>{let n=Number(e),i=Number(t),r="";for(let e=n;e<=i;e++)r+=e+" ";return r.trim()};function yx(e){const t=new ArrayBuffer(4),n=new DataView(t);n.setUint32(0,e);let i="";for(let e=0;e<4;e++)i+=da(n.getUint8(e).toString(2).padStart(8,"0"));return da(i.trim())}const vx=e=>{let t=((e,t=16)=>{const n=t;let i="0".repeat(n);const r=e.split(" ").map(Number);for(const e of r)e>=1&&e<=n&&(i=i.substr(0,e-1)+"1"+i.substr(e));return i})(e,40),n=t.match(/.{1,8}/g).map(e=>e.split("").reverse().join("")).join("");return n+="0".repeat(24),n};const bx=()=>{let e="";e=((e=!0)=>{let t=KO.get_pegplan_numeric_with_splitter(),n=String(t).split("\n").filter(e=>e),i=String(t).split("\n\n");if(1==i.length&&"\n"!=String(t).at(-1))return"";let r=[],a=0;i.forEach((e,t)=>{let n=e.split("\n").length;t<i.length-1&&r.push(a+n),a+=n});let l=[...n],o=FC();console.log("fidder color ",o);let s=[];if(n.forEach((e,t)=>{let n=d$.findElementFromIndex(d$.size-t-1),i=l$.findElementFromIndex(d$.size-t-1),r=s$.findElementFromIndex(s$.size-t-1);if(n){let t=e+" "+o[n.color_code];if(i&&(t+=" "+fx(gi.start,gi.end)),r&&Number(fi.start)){let e=r.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}s.push(t)}else{let t=e+" "+hi.start;if(i&&(t+=" "+fx(gi.start,gi.end)),r&&Number(fi.start)){let e=r.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}s.push(t)}}),l=[...s],r.reverse().forEach(e=>{l.splice(e,0,"\n")}),e){return wS(l)}return l.join("\n")})(!1);let t=[];return 0==e.trim().length?(e=((e=!0)=>{let t=KO.get_pegplan_numeric_with_splitter(),n=String(t).split("\n").filter(e=>e),i=String(t).split("\n\n"),r=[],a=0;i.forEach((e,t)=>{let n=e.split("\n").length;t<i.length-1&&r.push(a+n),a+=n});let l=[...n],o=fi.start;if(hi.start&&hi.end){let e=FC();console.log("fidder color ",e);let t=[];n.forEach((n,i)=>{let r=d$.findElementFromIndex(d$.size-i-1),a=l$.findElementFromIndex(d$.size-i-1),l=s$.findElementFromIndex(s$.size-i-1);if(r){let i=n+" "+Number(e[r.color_code]);if(a&&(i+=" "+fx(gi.start,gi.end)),l&&o){let e=l.color_code;i+=" "+(String(e).charCodeAt(0)-65+o)}t.push(i)}else{let e=n+" "+hi.start;a&&(e+=" "+fx(gi.start,gi.end)),t.push(e)}}),l=[...t]}if(r.reverse().forEach(e=>{l.splice(e,0,"\n")}),e){return wS(l)}return l.join("\n")})(!1),t=IS(E$(e))):t=SS(e),t},wx=()=>{if((()=>{let e=MC(UC());for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return!1})())return;let e=bx();e=e.filter(e=>String(e.pegplanContent).trim().length>0),console.log("object with repat",e);let t=KO.rows(),n="",i="",r=0,a="",l="";a+="00001000000000000000000000000000";let o=0;e.forEach((t,n)=>{let a=AI(t.pegplanContent);if(r+=a,i+=yx(a),i+=yx(t.repeat),0==n)i+=yx(32+16*e.length),o=32+16*e.length;else{let t=8*AI(e[n-1].pegplanContent)+o;i+=yx(t),o=t}i+=yx(8*a),t.pegplanContent.trim().split("\n").forEach(e=>{l+=vx(e)})}),r=8*r+16*e.length+4,n+="0101101001011010000000000000000000000000000000000000001000000000",n+=yx(e.length),n+=yx(t),n+=yx(r),n+=yx(16*e.length),n+="00001000000000000000000000000000",n+=i,n+="01010101101010100000000000000000",n+=l,n+=function(e){const t=e.padEnd(16*Math.ceil(e.length/16),"0");let n=0;for(let e=0;e<t.length;e+=16){let i=t.slice(e,e+16);n^=parseInt(i,2)}let i=n.toString(2).padStart(16,"0"),r=i.slice(0,8);return i.slice(8,16)+r+"0".repeat(16)}(i+"01010101101010100000000000000000"+l),n+="10100101101001010000000000000000";NI(LI(n),DE.innerText+".heb")},Ex=document.getElementById("xml-file-model");let Sx,xx,Ix,kx,_x,Tx,Nx,Cx,Lx,Ax={},Px={},Bx=!0,Rx=!0,Fx=!0;const Mx=[{machineId:261,machineName:"Delta",id:"Delta261"},{machineId:258,machineName:"Gamma",id:"Gamma258"},{machineId:5,machineName:"GamMax with Interactive display",id:"GamMax5"},{machineId:262,machineName:"GamMax with Keyboard display",id:"GamMax262"},{machineId:22,machineName:"GTMax-i with Interactive display",id:"GTMaxI22"},{machineId:275,machineName:"GTMax-i with Keyboard display",id:"GTMaxI275"},{machineId:270,machineName:"GTMax with Keyboard display",id:"GTMax270"},{machineId:259,machineName:"Omni",id:"Omni259"},{machineId:10,machineName:"OmniPlus800 with Interactive display",id:"OmniPlus10"},{machineId:101,machineName:"OMNIplus Summum",id:"OMNIplus101"},{machineId:0,machineName:"OmniPlus with Interactive display",id:"OMNIplus0"},{machineId:263,machineName:"OmniPlus800 with Keyboard display",id:"OMNIplus263"},{machineId:256,machineName:"OmniPlus with Keyboard display",id:"OMNIplus256"},{machineId:267,machineName:"OmniPlusX",id:"OMNIplus267"},{machineId:272,machineName:"OmniPlusX2",id:"OMNIplus272"},{machineId:110,machineName:"OptiMax-i with BlueBox platform",id:"OMNIplus110"},{machineId:21,machineName:"OptiMax-i with Interactive display",id:"OMNIplus21"},{machineId:11,machineName:"Optimax with Interactive display",id:"OMNIplus11"},{machineId:266,machineName:"Optimax with Keyboard display",id:"OMNIplus266"}],Dx=()=>{Yi(""),Ex.style.display="none"},Ox=e=>{let t=gi.start,n=gi.end,i=e.map(e=>({...e,pegplanContent:Hx(e.pegplanContent,t,n)}));return`<pattern type="CrammingMotion">\n  <patternList>0,${i.map((e,t)=>t+1).join(",")}</patternList>\n    ${i.map((e,t)=>((e,t)=>{let n=String(e).trim().split("\n"),i=[];return n.forEach(e=>{i.push("1in"+e)}),`<patternData PatternNr="${t}">\n  <nrOfLines>${n.length}</nrOfLines>\n  <data>${i.join(",")} </data>\n</patternData>`})(e.pegplanContent,t+1)).join("\n")}\n    <patternData PatternNr="0">\n    <nrOfLines>${i.length}</nrOfLines>\n    <data>\n      ${i.map((e,t)=>`${e.repeat}sp${t+1}`).join(",")}\n    </data>\n  </patternData>\n</pattern>`},$x=e=>{let t=hi.start,n=hi.end,i=e.map(e=>({...e,pegplanContent:qx(e.pegplanContent,t,n)}));return`<pattern type="Color">\n  <patternList>0,${i.map((e,t)=>t+1).join(",")}</patternList>\n  ${i.map((e,t)=>((e,t)=>{let n=String(e).trim().split("\n"),i=[],r=hi.start;return console.log("weft sle",Px),n.forEach(e=>{let t=Number(e.trim()-r+1),n=Px[t];n=n||t,i.push("1in"+n)}),`<patternData PatternNr="${t}">\n  <nrOfLines>${n.length}</nrOfLines>\n  <data>${i.join(",")} </data>\n</patternData>`})(e.pegplanContent,t+1)).join("\n")}\n  <patternData PatternNr="0">\n  <nrOfLines>${i.length}</nrOfLines>\n  <data>\n    ${i.map((e,t)=>`${e.repeat}sp${t+1}`).join(",")}\n  </data>\n</patternData>\n  <attribs>\n    <repeatUnit>Pick</repeatUnit>\n    <maxNrClrs>3</maxNrClrs>\n  </attribs>\n</pattern>`},jx=e=>{let t=fi.start,n=fi.end,i=e.map(e=>({...e,pegplanContent:qx(e.pegplanContent,t,n)}));return`<pattern type="PickDensity">\n  <patternList>0,${i.map((e,t)=>t+1).join(",")}</patternList>\n    ${i.map((e,t)=>((e,t)=>{let n=String(e).trim().split("\n"),i=[],r=fi.start;return n.forEach(e=>{i.push("1in"+Number(e.trim()-r+1))}),`<patternData PatternNr="${t}">\n  <nrOfLines>${n.length}</nrOfLines>\n  <data>${i.join(",")} </data>\n</patternData>`})(e.pegplanContent,t+1)).join("\n")}\n    <patternData PatternNr="0">\n    <nrOfLines>${i.length}</nrOfLines>\n    <data>\n      ${i.map((e,t)=>`${e.repeat}sp${t+1}`).join(",")}\n    </data>\n  </patternData>\n  <attribs>\n      <repeatUnit>Pick</repeatUnit>\n      <source>Internal</source>\n  </attribs>\n</pattern>`},Wx=e=>{let t=e.map(e=>({...e,pegplanContent:qx(e.pegplanContent,41,48)}));return`<pattern type="Speed">\n  <patternList>0,${t.map((e,t)=>t+1).join(",")}</patternList>\n    ${t.map((e,t)=>((e,t)=>{let n=String(e).trim().split("\n"),i=[];return n.forEach(e=>{i.push("1in"+Number(e.trim()-41+1))}),`<patternData PatternNr="${t}">\n  <nrOfLines>${n.length}</nrOfLines>\n  <data>${i.join(",")} </data>\n</patternData>`})(e.pegplanContent,t+1)).join("\n")}\n    <patternData PatternNr="0">\n    <nrOfLines>${t.length}</nrOfLines>\n    <data>\n      ${t.map((e,t)=>`${e.repeat}sp${t+1}`).join(",")}\n    </data>\n  </patternData>\n  <attribs>\n      <repeatUnit>Pick</repeatUnit>\n      <source>Internal</source>\n  </attribs>\n</pattern>`},Hx=(e,t,n)=>String(e).trim().split("\n").map(e=>String(e).split(" ").filter(e=>t<=Number(e)&&Number(e)<=n).join(" ")).map(e=>e.trim()?"2":"1").join("\n").trim(),qx=(e,t,n)=>String(e).trim().split("\n").map(e=>String(e).split(" ").filter(e=>t<=Number(e)&&Number(e)<=n).join(" ")).join("\n").trim(),Ux=(e,t,n)=>{let i=mi.start,r=mi.end,a=KO.cols(),l=n.map(e=>({...e,pegplanContent:qx(e.pegplanContent,i,r)}));return`<pattern type="Dobby">\n  <patternList>0,${l.map((e,t)=>t+1).join(",")}</patternList>\n  ${l.map((n,i)=>((e,t,n,i)=>{let r=String(e).trim().split("\n"),a=[];return r.forEach(e=>{let t=i[String(e)],r=n.findIndex(e=>t==e);a.push(r+1)}),`<patternData PatternNr="${t}">\n  <nrOfLines>${r.length}</nrOfLines>\n  <data>${a.map(e=>"1in"+e).join(",")} </data>\n</patternData>`})(n.pegplanContent,i+1,t,e)).join("\n")}\n  <patternData PatternNr="0">\n    <nrOfLines>${l.length}</nrOfLines>\n    <data>\n      ${l.map((e,t)=>`${e.repeat}sp${t+1}`).join(",")}\n    </data>\n  </patternData>\n  <attribs>\n    <repeatUnit>Pick</repeatUnit>\n    <maxNrHarness>${a}</maxNrHarness>\n  </attribs>\n</pattern>`},zx=()=>{let e="";e=((e=!0)=>{let t=KO.get_pegplan_numeric_with_splitter();Ax={},Object.keys(Mg).forEach(e=>{Ax[e]=0});let n=String(t).split("\n").filter(e=>e),i=String(t).split("\n\n");if(1==i.length&&"\n"!=String(t).at(-1))return"";let r=[],a=0;i.forEach((e,t)=>{let n=e.split("\n").length;t<i.length-1&&r.push(a+n),a+=n});let l=[...n],o=BC(),s=[];if(n.forEach((e,t)=>{let n=d$.findElementFromIndex(d$.size-t-1),i=l$.findElementFromIndex(d$.size-t-1),r=s$.findElementFromIndex(s$.size-t-1),a=h$.findElementFromIndex(h$.size-t-1);if(n){let t=String(o[n.color_code]).split("/"),l=e+" "+t[Ax[n.color_code]%t.length];if(Ax[n.color_code]=Ax[n.color_code]+1,i&&(l+=" "+gi.start),r&&Number(fi.start)){let e=r.color_code;l+=" "+(String(e).charCodeAt(0)+fi.start-65)}if(a){let e=a.color_code;l+=" "+(String(e).charCodeAt(0)+41-65)}s.push(l)}else{let t=e+" "+hi.start;if(i&&(t+=" "+gi.start),r&&Number(fi.start)){let e=r.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}if(a){let e=a.color_code;t+=" "+(String(e).charCodeAt(0)+41-65)}s.push(t)}}),l=[...s],r.reverse().forEach(e=>{l.splice(e,0,"\n")}),e){return wS(l)}return l.join("\n")})(!1);let t=[];return 0==e.trim().length?(e=((e=!0)=>{let t=KO.get_new_print_pegplan_data(!1);Ax={},Object.keys(Mg).forEach(e=>{Ax[e]=0});let n=String(t).split("\n").filter(e=>e),i=[...n],r=BC();console.log("fidder color ",r);let a=[];if(n.forEach((e,t)=>{let n=d$.findElementFromIndex(d$.size-t-1),i=l$.findElementFromIndex(d$.size-t-1),l=s$.findElementFromIndex(s$.size-t-1),o=h$.findElementFromIndex(h$.size-t-1);if(n){let t=String(r[n.color_code]).split("/"),s=e+" "+t[Ax[n.color_code]%t.length];if(Ax[n.color_code]=Ax[n.color_code]+1,i&&(s+=" "+gi.start),l&&Number(fi.start)){let e=l.color_code;s+=" "+(String(e).charCodeAt(0)+fi.start-65)}if(o){let e=o.color_code;s+=" "+(String(e).charCodeAt(0)+41-65)}a.push(s)}else{let t=e+" "+hi.start;if(i&&(t+=" "+gi.start),l&&Number(fi.start)){let e=l.color_code;t+=" "+(String(e).charCodeAt(0)+fi.start-65)}if(o){let e=o.color_code;t+=" "+(String(e).charCodeAt(0)+41-65)}a.push(t)}}),i=[...a],e){let e=E$(i.join("\n"));return String(e).trim()}return i.join("\n")})(!1),t=(e=>{let t=[],n=String(e).split("\n"),i=0,r=0,a="";for(let e=0;e<n.length;e++)if(0==i)if(n[e].includes("[")){a.length>0&&(t.push({pegplanContent:a,repeat:1}),a="",r=0);let l=0,o=e+1,s=0;for(i=1;!n[o].includes("]");)l+=1,o+=1,i+=1;r=o-e+1,s=n.slice(e,o+1).join("\n").split("X")[1];let d=n.slice(e,o+1).join("\n").split("X")[0].replace("[","").replace("]","");if(r*s>1/0){let e=0,n=Math.floor(r*s/(1/0));for(let i=0;i<n;i++)t.push({pegplanContent:d,repeat:parseInt(s)}),e+=r;if(e!=r*s){let e=r*s%(1/0);t.push({pegplanContent:d.split("\n").slice(0,e).join("\n"),repeat:1})}r=0,a=""}else t.push({pegplanContent:d,repeat:parseInt(s)}),r=0,a=""}else r==1/0&&(t.push({pegplanContent:a,repeat:1}),a="",r=0),a+=n[e]+"\n",r+=1,e+1==n.length&&(t.push({pegplanContent:a,repeat:1}),a="",r=0);else i-=1;return t})(E$(e))):t=SS(e),t=t.filter(e=>e.pegplanContent.trim()),t},Vx=()=>{let e=[...fp];e[0]=parseFloat(lh.value).toFixed(2),vp(e);let t=MC(UC());console.log("weft selector mappibg",Mg);for(let e=0;e<t.length;e++){let n=Mg[t[e]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(t[e],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),t[e]}Yi("xml-file-model"),Ex.style.display="block",Ex.style.animation="slide-down 0.3s ease",Tx.checked=Bx,Nx.checked=Rx,Cx.checked=Fx},Yx=async()=>{if((()=>{let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return!1})())return;let e=DE.innerText,t=_x.value,n=Mx.find(e=>e.machineId==Ix.value),i=n?n.machineName:Mx[0].machineName,r=kx.value,a=zx(),l=[],o=KO.convert_new_index_to_numeric(!0,!1),s={};l=String(o).trim().split("\n").map(e=>{let t=(e=>{const t=e.split(" ").map(Number),n=Math.max(...t);let i="";for(let e=1;e<=n;e++)i+=t.includes(e)?"1":"0";const r=i.split("").reverse().join("");return parseInt(r,2)})(e);return s[e]=t,t}),l=[...new Set(l)];let d=s$.cells.map(e=>e.color_code);d=[...new Set(d)],d=d.map(e=>String(e).charCodeAt(0)-65).sort();let c=h$.cells.map(e=>e.color_code);c=[...new Set(c)],c=c.map(e=>String(e).charCodeAt(0)-65).sort(),console.log("dencity object iss===>",fp);let u=Boolean(l$.cells.length);Fx=Fx?u:Fx,console.log("speedobjecct",yp);let p=yp.filter(e=>String(e).trim().length>0).length>0;Bx=Bx?p:Bx;let h=2;Fx&&h++,Rx&&h++,Bx&&h++;let g=["Dobby","Color"];Rx&&g.push("PickDensity"),Fx&&g.push("CrammingMotion"),Bx&&g.push("Speed");let m=["0","1"];Rx&&m.push(m.length.toString()),Fx&&m.push(m.length.toString()),Bx&&m.push(m.length.toString());let f=[];Object.values(Mg).forEach(e=>{f=[...f,...String(e).split("/")]}),f.forEach((e,t)=>{Px[e]=t+1});const y=`<?xml version="1.0" encoding="ISO-8859-1"?>\n  <machine id="${t}" machine_name="${i}" machine_type="${r}">\n    <style>\n      <design name="${e}">\n        <config>\n        <jacquard>FALSE</jacquard>\n        <superPattern>FALSE</superPattern>\n        <patternCount>${h}</patternCount>\n        <patternList>${g.join(",")}</patternList>\n        <selections>\n            <selection>${m.join(",")}</selection>\n        </selections>\n        </config>\n        <patterns>\n        ${Rx?jx(a):""}\n        ${Bx?Wx(a):""}\n          ${$x(a)}\n         ${Ux(s,l,a)}\n          ${u?Ox(a):""}\n        </patterns>\n        <indexTables>\n        ${Rx?`<table type="PickDensity">\n        <nrOfLines>${d.length}</nrOfLines>\n        <data>${d.map(e=>Number(fp[e]).toFixed(1)).join(",")}</data>\n        <idxClr>${d.map(e=>"65535").join(",")}</idxClr>\n        <attribs>\n          <indexUnit>Picks/Inch</indexUnit>\n        </attribs>\n        </table>`:""}\n\n\n        ${Bx?`<table type="Speed">\n        <nrOfLines>${c.length}</nrOfLines>\n        <data>${c.map(e=>parseInt(yp[e])).join(",")}</data>\n        <idxClr>${c.map(e=>"65535").join(",")}</idxClr>\n        <attribs>\n          <indexUnit>Rpm</indexUnit>\n        </attribs>\n        </table>`:""}\n          <table type="Color">\n            <nrOfLines>${Object.values(Mg).map(e=>String(e).split("/").join(",")).join(",").split(",").length}</nrOfLines>\n            <data>${Object.values(Mg).map(e=>String(e).split("/").join(",")).join(",")}</data>\n            <idxClr>${Object.values(Mg).map(e=>String(e).split("/").map(e=>"65535").join(",")).join(",")}</idxClr>\n            <attribs>\n              <indexUnit>None</indexUnit>\n              <multipleInsertion>FALSE</multipleInsertion>\n            </attribs>\n          </table>\n          <table type="Dobby">\n            <nrOfLines>${l.length}</nrOfLines>\n            <data>\n              ${l.join(",")}\n            </data>\n            <attribs>\n              <indexUnit>None</indexUnit>\n            </attribs>\n          </table>\n          ${u?'<table type="CrammingMotion">\n            <nrOfLines>2</nrOfLines>\n            <data>0,1</data>\n            <attribs>\n              <indexUnit>None</indexUnit>\n            </attribs>\n          </table>':""}\n        </indexTables>\n      </design>\n    </style>\n  </machine>`,v=new Blob([y],{type:"application/xml"}),b=document.createElement("a");b.download=e+".des",b.href=URL.createObjectURL(v),b.click(),URL.revokeObjectURL(b.href),Dx();let w=nk.value;await Zd({isExport:!0,fileType:w})},Gx=()=>{Ex.innerHTML=`<div class="modal-content">\n    <div class="close">\n      <span class="close-button">&times;</span>\n    </div>\n    <div class="modal-title">\n    Machine Configuration\n    </div>\n    <div class="modal-desc">\n      <div>\n      <div class="xml-model-input-container">\n      <label for="xml-machine-name">Name</label>\n      <select id="xml-machine-name" name="xml-machine-name">\n        \n        ${Mx.map(e=>`<option id=${e.id} value=${e.machineId}>${e.machineName}</option>`)}\n        \n      </select>\n      </div>\n      <div class="xml-model-input-container">\n      <label for="xml-machine-type">Type</label>\n      <select id="xml-machine-type" name="xml-machine-type">\n        <option value="Rapier">Rapier</option>\n        <option value="Airjet">Airjet</option>\n      </select>\n      </div>\n      <div class="xml-model-input-container">\n        <label for="xml-machine-id">ID</label>\n        <input id="xml-machine-id" name="xml-machine-id" disabled/>\n      </div>\n\n      <div style="margin-top:15px">\n        <div>\n        <input type="checkbox" id="xml-model-creaming"  class="menu-checkbox" >\n        <label for="xml-model-creaming">\n        Creaming\n        </label>\n        </div>\n        <div>\n        <input type="checkbox" id="xml-model-speed" class="menu-checkbox" >\n        <label for="xml-model-speed">\n        Speed\n        </label>\n        </div>\n        <div>\n        <input type="checkbox" id="xml-model-density" class="menu-checkbox">\n        <label for="xml-model-density">\n        Density\n        </label>\n        </div>\n      </div>\n      <div class="btn-group">\n        <button class="btn-submit" type="button" id="xml-file-download-button">Download</button>\n        <button class="btn-submit" type="button" id="xml-file-cancel-button">Cancel</button>\n      </div>\n      </div>\n    </div>\n  </div>`,Sx=Ex.querySelector("#xml-file-download-button"),xx=Ex.querySelector("#xml-file-cancel-button"),Ix=Ex.querySelector("#xml-machine-name"),kx=Ex.querySelector("#xml-machine-type"),Tx=Ex.querySelector("#xml-model-speed"),Nx=Ex.querySelector("#xml-model-density"),Cx=Ex.querySelector("#xml-model-creaming"),Ix.addEventListener("change",e=>{let t=e.target.value;_x.value=t}),Tx.addEventListener("change",e=>{Bx=e.target.checked}),Nx.addEventListener("change",e=>{Rx=e.target.checked}),Cx.addEventListener("change",e=>{Fx=e.target.checked}),_x=Ex.querySelector("#xml-machine-id"),Lx=Ex.querySelector(".close-button"),Sx.addEventListener("click",Yx),xx.addEventListener("click",Dx),Lx.addEventListener("click",Dx),_x.value=Mx[0].machineId,Ix.value=Mx[0].machineId};const Jx=async()=>{if((()=>{let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1})())return;const e=DE.innerText;let t=KO.cols();hi.start,hi.end,mi.start;const n=mi.end;gi.start,gi.end;if(t>n&&nL("This File Contains more shaft than "+n),t>20&&!await zl("This File Contains More than 20 shaft,only first 20 shafts will be considered,Do you want to export it?"))return;let i=KO.convert_new_index_to_numeric(!0,!1),r=String(i).split("\n"),a=r.filter(e=>e).length,l="";r.forEach((e,t)=>{let n=(e=>{let t="0".repeat(24);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=24&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t+"0".repeat(16)})(e),i=d$.cells.find(e=>e.index==a-t-1),r=s$.cells.find(e=>e.index==a-t-1),o=l$.cells.find(e=>e.index==a-t-1);if(i){let e=i.color_code,t=Number(Mg[e]);t&&(n=TI(n,23+t,"1"))}if(r){let e=r.color_code,t=String(e).charCodeAt(0)-65+1;t<=8&&t>0&&(n=function(e,t){const n={1:"000",2:"100",3:"010",4:"110",5:"001",6:"101",7:"011",8:"111"}[t];if(!n)throw new Error("Invalid numberValueOfCurrentColorCode");return e=e.substring(0,32)+n+e.substring(35)}(n,t))}o&&(n=TI(n,35,"1")),l+=n});NI(CI(l),e+".bin"),console.log("rifa bin download button clicked")};let Xx={};function Kx(e){const t=new ArrayBuffer(4),n=new DataView(t);n.setFloat32(0,e);return n.getUint32(0).toString(2).padStart(32,"0")}function Zx(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}const Qx=e=>{let t=Zx(String(Kx(e)));return t.reverse(),t.join("")},eI=e=>{let t=(e=>{let t="0".repeat(16);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=16&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t})(e).split("").reverse().join(""),n=Zx(Kx(parseInt(t,2)));return n.reverse(),n.join("")},tI=()=>{if((()=>{let e=KO.rows(),t=s$.cells.map(e=>e.color_code);if(t=[...new Set(t)],e>1e4)return nL("Pick must be lesser than 10000"),!0;let n=MC(UC());console.log("weft selector mappibg",Mg);for(let e=0;e<n.length;e++){let t=Mg[n[e]];if(!Number(t&&t[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(n[e],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),n[e]}return Ey.length>8?(nL("No. of weft must be lesser than 8"),!0):t.length>8&&(nL("No. of Density must be lesser than 8"),!0)})())return;Xx={};let e=KO.get_new_print_pegplan_data(!1);console.log("pegplan numeric text is",e);let t=String(e).split("\n").filter(e=>e),n="";n+="10011000001110100000000000000000";let i=Mg,r=d$.size,a=KO.rows(),l=GO.rows(),o=Qx(a),s=Qx(l),d="",c="",u="";Object.keys(i).forEach(e=>{Xx[e]=0});for(let e=0;e<4999;e++){let n=d$.findElementFromIndex(r-e-1),a=s$.findElementFromIndex(r-e-1);if(n){let e=n.color_code,t=String(i[e]).split("/"),r=t[Xx[e]%t.length];Xx[e]=Xx[e]+1,d+=Qx(r)}else d+="0".repeat(32);if(a){let e=a.color_code,t=String(e).charCodeAt(0)-64;u+=Qx(t)}else u+="0".repeat(32);t[e]?c+=eI(t[e]):c+="0".repeat(32)}n+=o,n+=c,n+=s,n+=d,n+="0".repeat(32),n+=u;NI(LI(n),DE.innerText+"-old.dat")};function nI(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}function iI(e){const t=new ArrayBuffer(4),n=new DataView(t);n.setFloat32(0,e);return n.getUint32(0).toString(2).padStart(32,"0")}const rI=e=>{let t=(e=>{let t="0".repeat(16);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=16&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t})(e).split("").reverse().join(""),n=nI(iI(parseInt(t,2)));return n.reverse(),n.join("")},aI=e=>{let t=nI(String(iI(e)));return t.reverse(),t.join("")};let lI={};const oI=()=>{if(console.log("tdw export called"),(()=>{let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return!1})())return;let e=Mg;Object.keys(e).forEach(e=>{lI[e]=0});let t=KO.rows(),n=GO.rows(),i="",r="",a=aI(t),l=aI(n),o=KO.get_new_print_pegplan_data(!1),s=String(o).split("\n").filter(e=>e);for(let n=0;n<t;n++){let i=d$.findElementFromIndex(t-n-1),a=s$.findElementFromIndex(t-n-1),l=h$.findElementFromIndex(t-n-1),o=a.color_code.charCodeAt(0)-64,d=(l.color_code.charCodeAt(0)-64).toString(2).padStart(4,"0")+o.toString(2).padStart(4,"0");if(s[n]){r+=rI(s[n]);let t=i.color_code,a=String(e[t]).split("/"),l=a[lI[t]%a.length];lI[t]=lI[t]+1,d+=TI("0".repeat(8),8-Number(l),"1"),r+=aI(parseInt(d,2))}else r+="0".repeat(32)}i+="00100110010011100000000000000000",i+=a,i+=l,i+=r;NI(LI(i),DE.innerText+".tdw")};function sI(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}const dI=()=>{let e="";e=((e=!0,t=0)=>{uI={},Object.keys(Mg).forEach(e=>{uI[e]=0});let n=KO.get_pegplan_numeric_with_splitter(),i=String(n).split("\n").filter(e=>e),r=String(n).split("\n\n");if(1==r.length&&"\n"!=String(n).at(-1))return"";let a=[],l=0;r.forEach((e,t)=>{let n=e.split("\n").length;t<r.length-1&&a.push(l+n),l+=n});let o=[...i];if(hi.start&&hi.end&&fi.start&&fi.end){let e=RC();console.log("fidder color ",e);let n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=s$.findElementFromIndex(s$.size-r-1);if(a){let r=a.color_code,o=String(e[r]).split("/"),s=o[uI[r]%o.length];uI[r]=uI[r]+1;let d=i+" "+(Number(s)+(t?Number(shaftObject.end):0));l&&(d+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(d)}else{let e=i+" "+hi.start;l&&(e+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(e)}}),o=[...n],a.reverse().forEach(e=>{o.splice(e,0,"\n")})}if(e){return wS(o)}return o.join("\n")})(!1);let t=[];return 0==e.trim().length?(e=((e=!0,t=0)=>{let n=KO.get_new_print_pegplan_data(!1);uI={},Object.keys(Mg).forEach(e=>{uI[e]=0}),console.log("pegplan numeric text is",n,s$),console.log("fidddd---",hi,fi);let i=String(n).split("\n").filter(e=>e),r=[...i];if(hi.start&&hi.end&&fi.start&&fi.end){let e=RC();console.log("fidder color ",e);let n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=s$.findElementFromIndex(s$.size-r-1);if(a){let r=a.color_code,o=String(e[r]).split("/"),s=o[uI[r]%o.length];uI[r]=uI[r]+1;let d=i+" "+(Number(s)+(t?Number(shaftObject.end):0));l&&(d+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(d)}else{let e=i+" "+hi.start;l&&(e+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(e)}}),r=[...n]}if(e){let e=E$(r.join("\n"));return String(e).trim()}return r.join("\n")})(!1),t=IS(E$(e))):t=SS(e),t=t.filter(e=>String(e.pegplanContent).trim().length>0),t},cI=e=>{let t=sI(Number(e).toString(2).padStart(16,"0"));return t.reverse(),t.join("")};let uI={};const pI=()=>{if(console.log("rfj export called"),(()=>{let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return!1})())return;let e=dI(),t="",n=cI(e.length),i="",r="";e.forEach((e,t)=>{let n=String(e.pegplanContent).trim().split("\n"),a=String(e.repeat);i+=cI(n.length),i+=cI(a),n.forEach(e=>{let t=(e=>{let t="0".repeat(32);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=32&&(t=t.substr(0,e-1)+"1"+t.substr(e));let i=t.slice(0,16);return i=sI(i).map(e=>e.split("").reverse().join("")).join(""),i+t.slice(16,24).split("").reverse().join("")+t.slice(24,32).split("").reverse().join("")})(e);r+=t}),r+="0".repeat(32)}),t+="01010010010001100100110101001010",t+=n,t+=i,t+="0".repeat(32),t+=r;NI(LI(t),DE.innerText+".rfj")};const hI=()=>{let e="",t=KO.convert_new_index_to_numeric(!0,!1);String(t).trim().split("\n").forEach(t=>{(function(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t})((e=>{let t="0".repeat(24);const n=e.split(" ").map(Number);for(const e of n)e>=1&&e<=24&&(t=t.substr(0,e-1)+"1"+t.substr(e));return t})(t)).forEach(t=>{e+=String(t).split("").reverse().join("")})});NI(LI(e),DE.innerText+".mwpdat")};const gI=async()=>{if((()=>{if(KO.cols()>20)return Toastify({text:"More than 20 shaft now allowed in .mwpdat file",style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),!0;let e=MC(UC());for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1})())return;hI(),(()=>{console.log("weft selector file download");let e="",t=function(e){const t=e.split("\n");let n=[],i=1;for(let e=1;e<t.length;e++)t[e]===t[e-1]&&i<99?i++:(n.push(`${i}${t[e-1]}`),i=1);return t.length>0&&n.push(`${i}${t[t.length-1]}`),n.join("\n")}(zC());String(t).trim().split("\n").forEach(t=>{let n=parseInt(t),i=GC(t);console.log("weftselector mapping",Mg);let r=Mg[i][0];e+=`${Number(r).toString(2).padStart(8,"0")}${Number(n).toString(2).padStart(8,"0")}`});NI(LI(e),DE.innerText+".mwfdat")})();let e=nk.value;await Zd({isExport:!0,fileType:e})},mI=document.getElementById("multiple-confirm-dialog"),fI=document.getElementById("multiple-confirm-dialog-message"),yI=document.getElementById("multiple-confirm-dialog-buttons");let vI={};const bI=()=>{let e="";e=((e=!0,t=0)=>{vI={},Object.keys(Mg).forEach(e=>{vI[e]=0});let n=KO.get_pegplan_numeric_with_splitter(),i=String(n).split("\n").filter(e=>e),r=String(n).split("\n\n");if(1==r.length&&"\n"!=String(n).at(-1))return"";let a=[],l=0;r.forEach((e,t)=>{let n=e.split("\n").length;t<r.length-1&&a.push(l+n),l+=n});let o=[...i];if(hi.start&&hi.end&&fi.start&&fi.end){let e=RC();console.log("fidder color ",e);let n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=s$.findElementFromIndex(s$.size-r-1),o=h$.findElementFromIndex(h$.size-r-1);if(a){let r=a.color_code,s=String(e[r]).split("/"),d=s[vI[r]%s.length];vI[r]=vI[r]+1;let c=i+" "+(Number(d)+(t?Number(mi.end):0));l&&(c+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),o&&(c+=" "+(String(o.color_code).charCodeAt(0)-65+37)),n.push(c)}else{let e=i+" "+hi.start;l&&(e+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(e)}}),o=[...n],a.reverse().forEach(e=>{o.splice(e,0,"\n")})}if(e){return wS(o)}return o.join("\n")})(!1);let t=[];return 0==e.trim().length?(e=((e=!0,t=0)=>{let n=KO.get_new_print_pegplan_data(!1);vI={},Object.keys(Mg).forEach(e=>{vI[e]=0}),console.log("pegplan numeric text is",n,s$),console.log("fidddd---",hi,fi);let i=String(n).split("\n").filter(e=>e),r=[...i];if(hi.start&&hi.end&&fi.start&&fi.end){let e=RC();console.log("fidder color ",e);let n=[];i.forEach((i,r)=>{let a=d$.findElementFromIndex(d$.size-r-1),l=s$.findElementFromIndex(s$.size-r-1),o=h$.findElementFromIndex(h$.size-r-1);if(a){let r=a.color_code,s=String(e[r]).split("/"),d=s[vI[r]%s.length];vI[r]=vI[r]+1;let c=i+" "+(Number(d)+(t?Number(mi.end):0));l&&(c+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),o&&(c+=" "+(String(o.color_code).charCodeAt(0)-65+37)),n.push(c)}else{let e=i+" "+hi.start;l&&(e+=" "+(String(l.color_code).charCodeAt(0)-65+fi.start)),n.push(e)}}),r=[...n]}if(e){let e=E$(r.join("\n"));return String(e).trim()}return r.join("\n")})(!1),t=IS(E$(e))):t=SS(e),t=t.filter(e=>String(e.pegplanContent).trim().length>0),t},wI=()=>{let e=bI(),t="",n=0,i="";e.forEach(e=>{n+=e.pegplanContent.trim().split("\n").length,i+=`100,${e.repeat},0,0,0\n`,e.pegplanContent.trim().split("\n").forEach(e=>{let t=String(e).split(" ").filter(e=>e<=16).join(" "),n=String(e).split(" ").filter(e=>e>=hi.start&&e<=hi.end).join(" "),r=String(e).split(" ").filter(e=>e>=fi.start&&e<=fi.end).join(" "),a=String(e).split(" ").filter(e=>e>=37&&e<=44).join(" "),l=Number(n)-hi.start+1,o=Number(r)-fi.start+1,s=Number(a)-37+1,d=((e,t=16)=>{const n=t;let i="0".repeat(n);const r=e.split(" ").map(Number);for(const e of r)e>=1&&e<=n&&(i=i.substr(0,e-1)+"1"+i.substr(e));return i.split("").reverse().join("")})(t,20),c=parseInt(d,2);i+=`${l},1,${o},${s},${c}\n`}),i+="101,0,0,0,0\n"}),n+=2*e.length;let r=KO.rows();t+=n+"\n",t+="2\n",t+=r+"\n",t+=i.trim()+"\n";let a=DE.innerText;const l=new Blob([t],{type:"text/plain"}),o=document.createElement("a");o.download=a+" Dobby.txt",o.href=URL.createObjectURL(l),o.click(),URL.revokeObjectURL(o.href)},EI=()=>{let e=(()=>{let e=RC();vI={},Object.keys(Mg).forEach(e=>{vI[e]=0});let t=[];for(let n=0;n<KO.rows();n++){let i=d$.findElementFromIndex(d$.size-n-1);if(i){let n=i.color_code,r=String(e[n]).split("/"),a=r[vI[n]%r.length];vI[n]=vI[n]+1;let l=Number(a);t.push(l)}else{let e=hi.start;t.push(e)}}let n=E$(t.join("\n")).trim();return IS(E$(n))})(),t=0,n="",i="";e.forEach(e=>{t+=e.pegplanContent.trim().split("\n").length,i+=`100,${e.repeat},0,0,0\n`,e.pegplanContent.trim().split("\n").forEach(e=>{let t=Number(e)-hi.start+1;i+=t+",1,1,1,0\n"}),i+="101,0,0,0,0\n"}),t+=2*e.length;let r=KO.rows();n+=t+"\n",n+="0\n",n+=r+"\n",n+=i.trim()+"\n";let a=DE.innerText;const l=new Blob([n],{type:"text/plain"}),o=document.createElement("a");o.download=a+" Color.txt",o.href=URL.createObjectURL(l),o.click(),URL.revokeObjectURL(o.href)},SI=()=>{let e=(()=>{let e=[];vI={},Object.keys(Mg).forEach(e=>{vI[e]=0});let t=RC();for(let n=0;n<s$.size;n++){let i=d$.findElementFromIndex(d$.size-n-1),r=s$.findElementFromIndex(s$.size-n-1),a="",l=h$.findElementFromIndex(h$.size-n-1);if(i){let n=i.color_code,o=String(t[n]).split("/"),s=o[vI[n]%o.length];vI[n]=vI[n]+1,a+=""+Number(s),r&&(a+=" "+(String(r.color_code).charCodeAt(0)-65+fi.start)),l&&(a+=" "+(String(l.color_code).charCodeAt(0)-65+37)),e.push(a)}}let n=E$(e.join("\n")).trim();return IS(E$(n))})(),t="",n=0,i="";e.forEach(e=>{n+=e.pegplanContent.trim().split("\n").length,i+=`100,${e.repeat},0,0,0\n`,e.pegplanContent.trim().split("\n").forEach(e=>{let t=String(e).split(" ").filter(e=>e>=hi.start&&e<=hi.end).join(" "),n=String(e).split(" ").filter(e=>e>=fi.start&&e<=fi.end).join(" "),r=String(e).split(" ").filter(e=>e>=37&&e<=44).join(" "),a=Number(t)-hi.start+1,l=Number(n)-fi.start+1,o=Number(r)-37+1;i+=`${a},1,${l},${o},0\n`}),i+="101,0,0,0,0\n"}),n+=2*e.length;let r=KO.rows();t+=n+"\n",t+="1\n",t+=r+"\n",t+=i.trim()+"\n";let a=DE.innerText;const l=new Blob([t],{type:"text/plain"}),o=document.createElement("a");o.download=a+" Controllable Density.txt",o.href=URL.createObjectURL(l),o.click(),URL.revokeObjectURL(o.href)},xI=async()=>{let e=await((e,t=["OK"])=>(fI.innerHTML=e,yI.innerHTML="",new Promise(e=>{const n=t=>{mI.close(),e(t.target.dataset.value)};t.forEach(e=>{const t=document.createElement("button");t.className="btn-submit",t.innerHTML=e,t.dataset.value=e,t.addEventListener("click",n),yI.appendChild(t)});const i=t.length,r=15*(i-1),a=Math.min(600,Math.max(200,100*i+r));mI.style.width=a+"px",mI.showModal()})))("Select File Type-:",["Dobby","Fidder","Density"]);console.log("answer",e),"Dobby"==e?wI():"Fidder"==e?EI():"Density"==e&&SI()},II=document.getElementById("download-file-trigger"),kI=()=>{bS(!0,!1)},_I=async()=>{let e=nk.value;if(console.log("availabeFileToDownload",Gy,e),!Gy.includes(e))return void nL("Something Went Wrong, Please Refresh Page > Select Loom Profile > Download");let t=await(()=>{const e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=localStorage.getItem("token");return axios.get(`${ba}/active-plan/get-active-plan/${e}`,{headers:{token:t}})})();t.data&&t.data.DATA&&t.data.DATA.noOfDownloads>0?".bin"==e?DS():"pt7"==e?RI():".wjl"==e?_S():"db1-profile"==e?MS():"redflag.dat"==e?KS():"bnx-profile"==e?await zl("Please Select File Type","Bnx V","Bnx IX")?RS():BS():".dat"==e?await zl("Please Select File Type","Type 1","Type 2")?(()=>{if(qS())return;OS={},Object.keys(Mg).forEach(e=>{OS[e]=0});let e=KO.get_new_print_pegplan_data(!1);console.log("pegplan numeric text is",e);let t=String(e).split("\n").filter(e=>e),n="";n+="01001000111011100000000000000000";let i=Mg,r=d$.size,a="",l="",o="";for(let e=0;e<1e4;e++){let n=d$.findElementFromIndex(r-e-1),s=s$.findElementFromIndex(r-e-1);if(n){let e=n.color_code,t=String(i[e]).split("/"),r=t[OS[e]%t.length];OS[e]=OS[e]+1,a+=WS(r)}else a+="0".repeat(32);if(s){let e=s.color_code,t=String(e).charCodeAt(0)-64;o+=WS(t)}else o+="0".repeat(32);t[e]?l+=HS(t[e]):l+="0".repeat(32)}n+=a,n+=l,n+=o,n+="00000000000000000000000001000000000000000000000000000000"+"0".repeat(8);NI(LI(n),DE.innerText+"-type1.dat")})():(()=>{if(qS())return;OS={},Object.keys(Mg).forEach(e=>{OS[e]=0});let e=KO.get_new_print_pegplan_data(!1);console.log("pegplan numeric text is",e);let t=String(e).split("\n").filter(e=>e),n="";n+="1110100011111101000000000000000000000000000000001000000000111111";let i=Mg,r=d$.size,a="",l="",o="",s="";for(let e=0;e<1e4;e++){let n=d$.findElementFromIndex(r-e-1),d=s$.findElementFromIndex(r-e-1);if(n){let e=n.color_code,t=String(i[e]).split("/"),r=t[OS[e]%t.length];OS[e]=OS[e]+1,a+=WS(r)}else a+="0".repeat(32);if(d){let e=d.color_code,t=String(e).charCodeAt(0)-64;s+=Number(t).toString(2).padStart(4,"0")}else s+="0".repeat(4);if((e+1)%4==0){let e=parseInt(s,2);o+=WS(e),s=""}t[e]?l+=HS(t[e]):l+="0".repeat(32)}n+=a,n+="0".repeat(16e4),n+=o,n+=l,n+="0".repeat(1199968);NI(LI(n),DE.innerText+"-type2.dat")})():".htt"==e?ix():".csv"==e?await zl("Please Select File Type","CSV","HHT")?px():mx():".heb"==e?wx():"xml"==e?Vx():"ga731"==e?Jx():"ga731II"==e?gI():"rifa.dat"==e?tI():".tdw"==e?oI():".rfj"==e?pI():".txt"==e?xI():Toastify({text:"Please Select Loom Profile",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast():Toastify({text:"You've no downloads left please upgrade the plan",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()},TI=(e,t,n)=>{let i=e.split("");return i[t]=n,i=i.join(""),i};async function NI(e,t){let n=new Blob([new Uint8Array(e)],{type:"application/octet-stream"}),i=document.createElement("a");i.href=URL.createObjectURL(n),i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i);let r=nk.value;await Zd({isExport:!0,fileType:r})}function CI(e){let t=String(e);if(t.length%8!=0)throw new Error("The length of the bit string must be a multiple of 8.");const n=t.length/8,i=new Uint8Array(n);for(let e=0;e<n;e++){const n=t.slice(8*e,8*(e+1)).split("").reverse().join("");i[e]=parseInt(n,2)}return i}const LI=e=>{let t=String(e);if(t.length%8!=0)throw new Error("The length of the bit string must be a multiple of 8.");const n=t.length/8,i=new Uint8Array(n);for(let e=0;e<n;e++){const n=t.slice(8*e,8*(e+1));i[e]=parseInt(n,2)}return i},AI=e=>String(e).trim().split("\n").length;document.getElementById("download-file-trigger");function PI(e){return Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}const BI=(e,t)=>{for(let n=t;n<=t+11;n++)if(e.includes(n.toString()))return n;return!1},RI=()=>{if((()=>{let e=MC(UC());console.log("weft selector mappibg",Mg);for(let t=0;t<e.length;t++){let n=Mg[e[t]];if(!Number(n&&n[0]))return Toastify({text:"Please Select Weft Selector For Yarn - "+Rc(e[t],"weft"),style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast(),e[t]}return e.forEach(e=>{if(!Mg[e])return!0}),!1})())return;let e=KO.cols(),t="\n        4a 41 54 37 30 30 2d 4d 43 41 52 44 2d 44 41 54 41 \n        20 66 69 6c 65 5f 69 6e 66 6f 20 2d 2d 2d 2d 2d 2d \n        2d 2d 2d 2d 2d 0d 0a 74 64 6d 5f 66 69 6c 65 6e 61 6d \n        65 20 22 43 6f 6d 62 69 6e 61 74 69 6f 6e 2d 31 22 \n        0d 0a 74 64 6d 5f 67 72 6f 75 70 6e 61 6d 65 20 22 \n        22 0d 0a 23 65 6e 64 5f 6f 66 5f 64 61 74 61 0d 0a \n        4a 41 54 37 30 30 2d 4d 43 41 52 44 2d 44 41 54 41 \n        20 70 61 74 74 65 72 6e 5f 66 70 20 2d 2d 2d 2d 2d \n        2d 2d 2d 2d 2d 2d 0d 0a 70 61 74 74 65 72 6e 5f 6e \n        61 6d 65 20 22 22 0d 0a 56 65 72 73 69 6f 6e 20 20 \n        20 20 20 20 31 30 0d 0a 6d 61 63 68 69 6e 65 74 79 \n        70 65 20 22 4a 41 54 37 31 30 22 0d 0a 73 68 65 64 \n        20 22 64 6f 62 62 79 22 0d 0a 66 61 62 72 69 63 74 \n        79 70 65 20 22 64 6f 62 62 79 22 0d 0a 70 69 6c 65 \n        20 22 6d 65 63 68 61 6e 69 63 61 6c 22 0d 0a 74 61 \n        6b 65 75 70 20 22 63 68 61 6e 67 65 61 62 6c 65 22 \n        0d 0a 61 69 72 74 75 63 6b 65 72 20 22 6e 6f 22 0d \n        0a 73 65 6c 76 61 67 65 20 22 77 69 74 68 6f 75 74 \n        22 0d 0a 73 65 6c 65 63 74 65 64 5f 69 64 20 20 30 \n        0d 0a 23 70 61 74 74 65 72 6e 5f 69 64 20 30 0d 0a \n        44 65 6e 73 69 74 79 55 6e 69 74 20 30 0d 0a 53 79 \n        6e 63 4d 6f 64 65 20 30 0d 0a 53 65 6c 76 61 67 65 \n        53 79 6e 63 4d 6f 64 65 20 31 30 30 30 0d 0a 55 73 \n        65 57 61 6b 75 20 36 35 35 33 35 0d 0a 53 65 6c 76 \n        61 67 65 41 73 79 6e 63 4e 75 6d 20 34 0d 0a 44 65 \n        6e 73 69 74 79 52 61 74 65 20 31 30 30 30 0d 0a 44 \n        65 6e 73 69 74 79 52 61 74 65 50 69 6c 65 20 31 30 \n        30 30 0d 0a 44 65 6e 73 69 74 79 52 61 74 65 42 6f \n        72 64 65 72 20 31 30 30 30 0d 0a 44 65 6e 73 69 74 \n        79 52 61 74 65 47 72 6f 75 6e 64 20 31 30 30 30 0d \n        0a 6c 69 6e 65 73 20 31 32 0d 0a 23 53 74 65 70 20 \n        43 6f 6c 6f 72 20 52 65 70 2e 20 44 65 6e 73 20 43 \n        66 63 20 42 6f 72 20 4f 72 69 20 50 69 6c 20 50 2d \n        4c 65 6e 20 41 76 65 20 53 68 65 20 54 2d 53 20 53 \n        65 6c 2e 20 54 75 63 6b 49 6e 20 53 74 72 4f 6e 20 \n        53 74 72 4f 66 66 0d 0a",n=DE.innerText,i='"'+n+'"',r=PI((new TextEncoder).encode(i));t=t.replace(/\s+/g,""),t=t.replace("22436f6d62696e6174696f6e2d3122",r);let a="UseWaku "+(Math.pow(2,e)-1).toString();a="\r\n"+a+"\r\n";let l=PI((new TextEncoder).encode(a));t=t.replace("0d0a55736557616b752036353533350d0a",l);let[o,s,d]=(()=>{let e=KO.convert_new_index_to_numeric(!0,!1),t="",n=KO.rows();console.log("weft color ",d$.cells),String(e).split("\n").forEach((e,i)=>{let r=String(e),a=s$.cells.find(e=>e.index==n-i-1),l=l$.cells.find(e=>e.index==n-i-1),o=d$.cells.find(e=>e.index==n-i-1);if(a){r+=" "+(String(a.color_code).charCodeAt(0)-65+31)}l&&(r+=" 30"),o&&(r+=" "+o.color_code),t+=r+"\n"}),t=E$(t.trim());let i=pC(t),r="",a=1;for(let e=0;e<i.length;e++){let t=i[e].repeatedPart.split("\n"),n=i[e].outerRepeat;t.forEach((e,i)=>{let l="";l+=String(a).padStart(4,0),l+=" ";const o=e.trim().split(" ").at(-1);l+=Mg[o],l+=" ",1==n?l+="0":0==i?l+=n:i+1==t.length?l+="1000":l+="0",l+=" ";let s=BI(e,31);if(s){let e=10*Number(fp[s%31]);isNaN(e)&&(e="0"),l+=e+" "}else l+="0 ";l+="0 ",l+="0 ",l+="0 ",l+="0 ",l+="0 ",l+="0 ",l+="0 ",e.includes(30)?l+="1 ":l+="0 ",l+="0 ",l+="0 ",l+="0 ",l+="0 ",r+=l+"\r\n",a++})}return[r,a,i]})(),c="lines "+(s-1).toString();c="\r\n"+c+"\r\n";let u=PI((new TextEncoder).encode(c));t=t.replace("0d0a6c696e65732031320d0a",u);let p=o+("waku_lines "+(s-1)+"\r\n")+(e=>{let t=KO.cols(),n="",i=1;if(Array.isArray(e))for(let r=0;r<e.length;r++){String(e[r].repeatedPart).split("\n").forEach(e=>{let r="",a="",l=0;for(let n=0;n<t;n++)e.split(" ").includes(String(n+1))&&(a+="0",l+=Math.pow(2,n));r+=`${i.toString().padStart(4,0)} ${l}\r\n`,n+=r,i++})}return n})(d)+"#end_of_data\r\n";t+=PI((new TextEncoder).encode(p)),NI(function(e){let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}(t),n+".pt7")},FI=e=>{if(!(e instanceof Uint8Array)||4!==e.length)throw new Error("Input must be a Uint8Array of length 4.");return new DataView(e.buffer).getInt32(0,!0)},MI=document.getElementById("upload-db1-file-trigger"),DI=document.getElementById("upload-db1-file-input"),OI=()=>{yk(!0),nk.value="db1-profile",mk({target:{value:nk.value}},nk.value,!0)},$I=e=>{const t=gi.start,n=new Uint8Array(e);let i=(e=>{if(e instanceof Uint8Array){let t=e[0],n=e[1],i=Number(t).toString(2).padStart(8,"0")+Number(n).toString(2).padStart(8,"0");return parseInt(i,2)}})(n.slice(-2)),r="",a="",l=[],o=9!=t?31+t:31;for(let e=0;e<i;e++){let t=n.slice(5*e,5*(e+1)),s="",d="";for(let e=0;e<t.length;e++){if(e<4&&(s+=t[e].toString(2).padStart(8,"0").split("").reverse().join("")),4==e){let n=t[e].toString(2).padStart(8,"0").split("").reverse().findIndex(e=>Number(e));r+=String.fromCharCode(n+65)+"\n"}d+=t[e].toString(2).padStart(8,"0").split("").reverse().join("")}Number(d.at(o))&&l.push(new aL("A",i-e-1)),s=s.slice(0,28).split("").map((e,t)=>Number(e)?""+(t+1):"").filter(e=>e).join(" "),a+=s+"\n"}Pv("weft"),Sv.value=r,jv(!1,!0),Hh.value=a.trim(),l$.cells=l,Qh(),jv(!1,!0)},jI=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){const t=e.target.result;$I(t)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},WI=document.getElementById("upload-heb-file-trigger"),HI=document.getElementById("upload-heb-file-input"),qI=()=>{yk(!0),nk.value=".heb",mk({target:{value:nk.value}},nk.value,!0)},UI=e=>{if(!e instanceof Uint8Array)return{peglanString:"",isCreaming:!1,weftColor:"A"};let t=hi.start,n=hi.end,i=mi.start,r=mi.end,a=gi.start,l=gi.end,o=fi.start,s=fi.end,d="";e.forEach(e=>{const t=e.toString(2).padStart(8,"0").split("").reverse().join("");return d+=t,t});let c=d.split("").map((e,t)=>Number(e)?t+1:0).filter(e=>e).join(" ")+"\n",u=c.split(" ").filter(e=>Number(e)>=i&&Number(e)<=r).join(" ")+"\n",p=c.split(" ").find(e=>Number(e)>=a&&Number(e)<=l),h=c.split(" ").find(e=>Number(e)>=t&&Number(e)<=n),g=c.split(" ").find(e=>Number(e)>=o&&Number(e)<=s);return h=h?String.fromCharCode(Number(h)-t+65)+"\n":"A\n",g=g?String.fromCharCode(Number(g)-o+65):"A",{peglanString:u,isCreaming:Boolean(p),weftColor:h,densityColor:g}},zI=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{console.log("bugger are",e);const t=new Uint8Array(e);let n=FI(t.slice(8,12)),i=FI(t.slice(12,16)),r=[],a=[],l=[],o=32+16*n,s=0;for(let e=0;e<n;e++){let n=t.slice(28+16*e,28+16*(e+1)),i=FI(n.slice(0,4)),d=FI(n.slice(4,8)),c="",u="";for(let e=0;e<i;e++){let n=t.slice(o,o+5);const{peglanString:r,isCreaming:p,weftColor:h,densityColor:g}=UI(n);if(c+=r,u+=h,o+=8,p)for(let t=0;t<d;t++)a.push(s+e+t*i);if(g)for(let t=0;t<d;t++)l.push(new aL(g,s+e+t*i))}s+=i*d,r.push({pegplanContent:c.trim(),repeat:d,weftSeq:u})}let d="",c="";r.forEach(e=>{d+=`[${e.pegplanContent}]X${e.repeat}\n\n\n`,c+=`[${y$(e.weftSeq)}]X${e.repeat}\n`});let u=a.map(e=>new aL("A",i-e-1)),p=l.map(e=>new aL(e.color_code,i-e.index-1));Hh.value=d.trim(),KO.change_no_of_cols(mi.end),Qh(),Pv("weft"),Sv.value=c,jv(!1,!0),l$.cells=u,s$.cells=p,cd(),ud(),Jw()})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},VI=document.getElementById("upload-wjl-file-trigger"),YI=document.getElementById("upload-wjl-file-input"),GI=()=>{yk(!0),nk.value=".wjl",mk({target:{value:nk.value}},nk.value,!0)},JI=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{console.log("buffer",e);let t=mi.end,n=hi.start,i=hi.end,r=gi.start;const a=new Uint8Array(e);a.slice(0,8);let l=a[8],o=(a.slice(12,20),Array.apply(null,Array(l)).map((function(e,t){return{loop:"Loop"+(t+1),noOfPick:0,pegplanForCurrentLoop:"",repeat:0}}))),s=20;for(let e=0;e<l;e++){let t=a.slice(s,s+4);o[e].noOfPick=FI(t),s+=4}for(let e=0;e<l;e++){let t=a.slice(s,s+4);o[e].repeat=FI(t),s+=4}let d="",c=0,u=[],p="";if(Array.isArray(o)){o.forEach(e=>{let l="",o="";for(let d=0;d<e.noOfPick;d++){let d=a.slice(s,s+40).reverse().map((e,t)=>"1"==String.fromCharCode(e)?t+1:0).filter(e=>e),p=d.filter(e=>e<=t).join(" "),h=d.filter(e=>e>t);h.length>0?h.forEach(t=>{if(t>=n&&t<=i&&(o+=String.fromCharCode(t-n+65)+"\n",c+=1),t==r)for(let t=0;t<e.repeat;t++)u.push(new aL("A",c+t*e.noOfPick))}):(o+="A\n",c+=1),l+=p+"\n",s+=40}c+=e.noOfPick*(e.repeat-1),e.pegplanForCurrentLoop=l.trim(),p+=`[${o}]X${e.repeat}\n`,d+=`[${l.trim()}]X${e.repeat}\n\n\n`}),d=d.trim(),Hh.value=d,KO.change_no_of_cols(t),Qh();let e=l$.size;l$.cells=u.map(t=>({...t,index:e-t.index})),Pv("weft"),Sv.value=p,jv(!1,!0),cd(),Jw()}else nL("File is not valid")})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},XI=document.getElementById("select-loom-profile"),KI=document.getElementById("loom-profile-modal-default"),ZI=document.getElementById("loom-profile-modal-apply"),QI=document.getElementById("loom-profile-modal-submit"),ek=document.getElementById("no-of-hook"),tk=document.getElementById("loom-profile-model"),nk=document.getElementById("loom-type"),ik=document.getElementById("loom-profile-table");let rk=[],ak="";const lk=()=>{(async()=>{ck();let e=dk(!0);await Ea(e),pk(),Toastify({text:"Default profile set Successfully",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()})(),fk()},ok=e=>isNaN(e)?0:e,sk=()=>{const e=document.getElementById("fidder-num"),t=document.getElementById("shaft-num"),n=document.getElementById("cramming-num"),i=document.getElementById("density-num");if(e){const t=document.getElementById("fidder-start"),n=document.getElementById("fidder-end");e.value=ok(Number(n.value)-Number(t.value)+1)}if(t){const e=document.getElementById("shaft-start"),n=document.getElementById("shaft-end");t.value=ok(Number(n.value)-Number(e.value)+1)}if(n){const e=document.getElementById("cramming-start"),t=document.getElementById("cramming-end");n.value=ok(Number(t.value)-Number(e.value)+1)}if(i){const e=document.getElementById("density-start"),t=document.getElementById("density-end");i.value=ok(Number(t.value)-Number(e.value)+1)}},dk=(e=!1)=>({profileName:nk.value,fidderStart:hi.start,fidderEnd:hi.end,crammingStart:gi.start,crammingEnd:gi.end,shaftStart:mi.start,shaftEnd:mi.end,densityStart:fi.start,densityEnd:fi.end,isDefault:e,isImport:ak.length>0}),ck=()=>{hi.start=0,hi.end=0,gi.start=0,gi.end=0,mi.start=0,mi.end=0,fi.start=0,fi.end=0;const e=document.getElementById("fidder-start"),t=document.getElementById("fidder-end"),n=document.getElementById("cramming-start"),i=document.getElementById("cramming-end"),r=document.getElementById("shaft-start"),a=document.getElementById("shaft-end"),l=document.getElementById("density-start"),o=document.getElementById("density-end");e&&t&&(hi.start=Number(e.value),hi.end=Number(t.value)),n&&i&&(gi.start=Number(n.value),gi.end=Number(i.value)),r&&a&&(mi.start=Number(r.value),mi.end=Number(a.value)),l&&o&&(fi.start=Number(l.value),fi.end=Number(o.value))},uk=async()=>{ck();let e=dk();await Ea(e),pk()},pk=()=>{["rapier-manual-dobby","none"].includes(nk.value)?(aw.classList.add("list-disable"),Er(!1)):(aw.classList.remove("list-disable"),Er(!0))},hk=()=>{uk(),".wjl"==ak&&YI.click(),"db1-profile"==ak&&DI.click(),".heb"==ak&&HI.click(),fk()},gk=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t)},mk=(e,t="",n=!1)=>{t&&(ak=t);let i=Di.find(t=>t.loomTypeValue==e.target.value),r=rk.find(t=>t.profileName==e.target.value&&t.isImport==n),a=[".dat","redflag.dat",".tdw",".rfj","rifa.dat",".htt",".csv","xml","ga731","ga731II",".txt"].includes(e.target.value);a&&(r=null);let l=["airjet-dobby",".bin","ga731","ga731II"].includes(e.target.value),o=["airjet-dobby",".bin","ga731","ga731II","rapier-manual-dobby",".wjl","action-cad","spactrum","db1-profile","bnx-profile",".csv",".dat","redflag.dat",".htt",".heb","xml",".tdw",".txt",".rfj","rifa.dat"].includes(e.target.value);if(ik.innerHTML="",i){let e=i.visibleRow;if(ek.value=i.noOfHook,e.length>0){let t="";e.forEach(e=>{t+=` <tr><td><input ${l?"readonly":""} type="number" min="0" id="${e.toLowerCase()}-start" /></td>\n            <td><input ${l?"readonly":""} type="number" min="0" id="${e.toLowerCase()}-end" /></td>\n            <td><input ${l?"readonly":""} type="number" min="0" id="${e.toLowerCase()}-num" readonly/></td>\n            <td>\n           ${e}\n            </td></tr>`});let n=`<tr>\n            <th>Start</th>\n            <th>End</th>\n            <th>Num</th>\n            <th>Description</th></tr>${t}\n          `;ik.innerHTML=n,o&&(r?(gk("shaft-start",r.shaftStart),gk("shaft-end",r.shaftEnd),gk("cramming-end",r.crammingEnd),gk("cramming-start",r.crammingStart),gk("fidder-start",r.fidderStart),gk("fidder-end",r.fidderEnd),gk("density-start",r.densityStart),gk("density-end",r.densityEnd),sk()):Object.keys(i.tableData).forEach(e=>{document.getElementById(e).value=i.tableData[e]})),ik.style.display=a?"none":"table",l||e.forEach(e=>{document.getElementById(e.toLowerCase()+"-start").addEventListener("change",sk),document.getElementById(e.toLowerCase()+"-end").addEventListener("change",sk)})}}},fk=()=>{Yi(""),tk.style.display="none",ak=""},yk=(e=!1)=>{Uf(),(async(e=!1)=>{let t=await Sa();if(t.data.DATA){let n=t.data.DATA.loomProfileData;if(Array.isArray(n)){rk=n;let t=rk.find(e=>e.isDefault&&0==e.isImport);if(!e&&t&&(nk.value=t.profileName,mk({target:{value:t.profileName}},"")),e){let e=rk.find(e=>e.profileName==String(nk.value).trim()&&e.isImport);e&&mk({target:{value:e.profileName}},"",!0)}}}console.log("response data====>",t.data)})(e),Yi("loom-profile-model"),tk.style.display="block",tk.style.animation="slide-down 0.3s ease"},vk={CURRENT_LOOM_PROFILE:"currentLoomProfile",VISIBILITY_OBJECT:"visibilityObject",RECENT_FILE:"recentFiles",PRINT_SETTINGS:"printSettings",DEVICE_NAME:"deviceName",LOCAL_YARN_NAMES:"localYarnNames"},bk=()=>{let e=localStorage.getItem(vk.DEVICE_NAME);return e||""},wk=e=>{localStorage.setItem(vk.DEVICE_NAME,e)},Ek=(e,t)=>{let n=localStorage.getItem("visibilityObject");if(n){let i=JSON.parse(n);i[e]=t,localStorage.setItem("visibilityObject",JSON.stringify(i))}else{let n={[e]:t};localStorage.setItem("visibilityObject",JSON.stringify(n))}},Sk=()=>{let e=localStorage.getItem("printSettings");return e?JSON.parse(e):{}},xk=(e,t)=>{let n=localStorage.getItem("printSettings");if(n){let i=JSON.parse(n);i[e]=t,localStorage.setItem("printSettings",JSON.stringify(i))}else{let n={[e]:t};localStorage.setItem("printSettings",JSON.stringify(n))}},Ik=()=>{let e=localStorage.getItem(vk.VISIBILITY_OBJECT);if(e){let n=JSON.parse(e);n&&("isDraftPlanVisible"in n&&(t=n.isDraftPlanVisible,vw=t),"isPegplanVisible"in n&&(e=>{bw=e})(n.isPegplanVisible),"isDentClickCanvasVisible"in n&&(e=>{Hi=e})(n.isDentClickCanvasVisible),"isReedVisibible"in n&&(e=>{lg=e})(n.isReedVisibible),"isFunctionCanvasVisible"in n&&Zi(n.isFunctionCanvasVisible),"isExtraWarpCanvasVisible"in n&&Qi(n.isExtraWarpCanvasVisible),"isSpeedCanvasVisible"in n&&(e=>{ii=e})(n.isSpeedCanvasVisible),"isDensityCanvasVisible"in n&&er(n.isDensityCanvasVisible),"isBeamVisible"in n&&Gi(n.isBeamVisible),"isColorPalletVisible"in n&&(e=>{ri=e})(n.isColorPalletVisible),"isRulerCanvasVisible"in n&&(e=>{Wi=e})(n.isRulerCanvasVisible),"isScrollBarVisible"in n&&nr(n.isScrollBarVisible),"isWeftColorVisible"in n&&Xi(n.isWeftColorVisible),"isWarpColorVisible"in n&&Ji(n.isWarpColorVisible),"isDirectDrawingEnabled"in n&&(e=>{li=e})(n.isDirectDrawingEnabled))}var t},kk=document.getElementById("color-modal"),_k=document.getElementById("copy-warp-prop-to-weft-element"),Tk=document.getElementById("copy-weft-prop-to-warp-element"),Nk=document.getElementById("warp-color-row"),Ck=document.getElementById("weft-color-row"),Lk=document.getElementById("warp-color-row-container"),Ak=document.getElementById("weft-color-row-container"),Pk=document.getElementById("function-color-row"),Bk=document.getElementById("function-color-row-container"),Rk=document.getElementById("model-color-label"),Fk=document.getElementById("except-color-part"),Mk=document.getElementById("selected-warp-color"),Dk=document.getElementById("selected-weft-color"),Ok=document.getElementById("selected-function-color"),$k=document.getElementById("model-apply"),jk=document.getElementById("model-ok"),Wk=document.getElementById("model-color"),Hk=document.getElementById("yarn-name"),qk=document.getElementById("yarn-type"),Uk=document.getElementById("localYarnNames"),zk=document.getElementById("yarn-count-unit"),Vk=document.getElementById("model-letter-box"),Yk=document.getElementById("weft-color-row-left-arrow"),Gk=document.getElementById("weft-color-row-right-arrow"),Jk=document.getElementById("function-color-row-left-arrow"),Xk=document.getElementById("function-color-row-right-arrow"),Kk=document.getElementById("warp-color-row-left-arrow"),Zk=document.getElementById("warp-color-row-right-arrow"),Qk=document.getElementById("model-warp-weft-selection");var e_=0;let t_="denier";const n_={WARP:"Warp",WEFT:"Weft",FUNCTION:"Function",NONE:"None"};let i_=n_.NONE;var r_=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];const a_=[{unitValue:"denier",isDivision:!1,multiplyNumber:1,displayName:"Denier(D)"},{unitValue:"cotton",isDivision:!0,multiplyNumber:5315,displayName:"Cotton(Ne)"},{unitValue:"metric",isDivision:!0,multiplyNumber:9e3,displayName:"Metric(Nm)"},{unitValue:"worsted",isDivision:!0,multiplyNumber:7972,displayName:"Worsted(Nw)"},{unitValue:"tex",isDivision:!1,multiplyNumber:1/9,displayName:"Tex(T)"},{unitValue:"decitex",isDivision:!1,multiplyNumber:1/.9,displayName:"Decitex(Dt)"},{unitValue:"woolen",isDivision:!0,multiplyNumber:2790,displayName:"Woolen(Wo)"}],l_=e=>"denier"==e?"D":"cotton"==e?"Ne":"metric"==e?"Nm":"worsted"==e?"Nw":"tex"==e?"T":"decitex"==e?"Dt":"woolen"==e?"Wo":"",o_=e=>{i_=e,e==n_.WARP?(Ak.style.display="none",Bk.style.display="none",Lk.style.display="flex"):e==n_.WEFT?(Lk.style.display="none",Bk.style.display="none",Ak.style.display="flex"):e==n_.FUNCTION?(Lk.style.display="none",Ak.style.display="none",Bk.style.display="flex"):(Lk.style.display="none",Ak.style.display="none",Bk.style.display="none")};function s_(e,t,n){const i=a_.find(e=>e.unitValue===t),r=a_.find(e=>e.unitValue===n);if(!i||!r)return"Invalid unit(s) selected";let a,l;return a=i.isDivision?i.multiplyNumber/e:e/i.multiplyNumber,l=r.isDivision?r.multiplyNumber/a:a*r.multiplyNumber,Number(l).toFixed(3)}const d_=e=>{const t=e.id.slice(0,4),n=e.getBoundingClientRect(),i=Array.from(e.children).filter(e=>{const t=e.getBoundingClientRect();return t.left>=n.left&&t.right<=n.right});if("warp"==t){let e=String.fromCharCode(String(i.at(-1).children[0].id.slice(-1)).charCodeAt()+1);document.getElementById("warp-color-"+e)&&document.getElementById("warp-color-"+e).scrollIntoView({behavior:"smooth"})}else if("weft"==t){let e=String.fromCharCode(String(i.at(-1).children[0].id.slice(-1)).charCodeAt()+1);document.getElementById("weft-color-"+e)&&document.getElementById("weft-color-"+e).scrollIntoView({behavior:"smooth"})}else{let e=String.fromCharCode(String(i.at(-1).children[0].id.slice(-1)).charCodeAt()+1);document.getElementById("function-color-"+e)&&document.getElementById("function-color-"+e).scrollIntoView({behavior:"smooth"})}},c_=e=>{const t=e.id.slice(0,4),n=e.getBoundingClientRect(),i=Array.from(e.children).filter(e=>{const t=e.getBoundingClientRect();return t.left>=n.left&&t.right<=n.right});if("warp"==t){let e=String.fromCharCode(String(i[0].children[0].id.slice(-1)).charCodeAt()-3);document.getElementById("warp-color-"+e)?document.getElementById("warp-color-"+e).scrollIntoView({behavior:"smooth"}):document.getElementById("warp-color-A").scrollIntoView({behavior:"smooth"})}else if("weft"==t){let e=String.fromCharCode(String(i[0].children[0].id.slice(-1)).charCodeAt()-2);document.getElementById("weft-color-"+e)?document.getElementById("weft-color-"+e).scrollIntoView({behavior:"smooth"}):document.getElementById("weft-color-A").scrollIntoView({behavior:"smooth"})}else{let e=String.fromCharCode(String(i[0].children[0].id.slice(-1)).charCodeAt()-2);document.getElementById("function-color-"+e)?document.getElementById("function-color-"+e).scrollIntoView({behavior:"smooth"}):document.getElementById("function-color-A").scrollIntoView({behavior:"smooth"})}},u_=e=>{Object.keys(e).forEach(t=>{$s[""+t]=e[""+t],document.getElementById("weft-color-"+t).style.backgroundColor=e[""+t]}),Dk.style.backgroundColor=$s[Ms]},p_=e=>{Object.keys(e).forEach(t=>{Ld[""+t]=e[""+t],document.getElementById("warp-color-"+t).style.backgroundColor=e[""+t]}),Mk.style.backgroundColor=Ld[Cd]},h_=()=>{let e=localStorage.getItem(vk.LOCAL_YARN_NAMES);if(rL(e)){let t=JSON.parse(e);return Array.isArray(t)?t:[]}return[]},g_=()=>{kk.style.display="none"},m_=()=>{(e=>{let t=h_();t=[...new Set([String(e).trim(),...t])],localStorage.setItem(vk.LOCAL_YARN_NAMES,JSON.stringify(t))})(Hk.value),"weft"==Qk.value?($s[""+Vk.value]=Wk.value,Dk.style.backgroundColor=Wk.value,document.getElementById("weft-color-"+Vk.value).style.backgroundColor=$s[""+Vk.value],Ws[Vk.value]={...Ws[Vk.value],yarnType:qk.value,yarnName:Hk.value,yarnUnit:zk.value},gd()):"warp"==Qk.value?(Ld[""+Vk.value]=Wk.value,Mk.style.backgroundColor=Wk.value,document.getElementById("warp-color-"+Vk.value).style.backgroundColor=Ld[""+Vk.value],Ad[Vk.value]={...Ad[Vk.value],yarnType:qk.value,yarnName:Hk.value,yarnUnit:zk.value},Ud()):(js[""+Vk.value]=Wk.value,Ok.style.backgroundColor=Wk.value,document.getElementById("function-color-"+Vk.value).style.backgroundColor=js[""+Vk.value],ud(),drawVisibleSpeedCanvas()),("radio-color"==Yn||"radio-interlacement"==Yn)&&MN()},f_=async()=>{console.log("handleCopyWarpPropToWeft called"),eT(),await zl("Are you sure you want to copy warp property to weft ?")&&(u_({...Ld}),Us({}),Us({...Ad}))},y_=async()=>{eT(),await zl("Are you sure you want to copy weft property to warp?")&&(p_({...$s}),jd({}),jd({...Ws}))},v_=()=>{m_(),g_()},b_=()=>{for(let e=65;e<=90;e++){let t=document.getElementById("weft-color-"+String.fromCharCode(e)),n=document.getElementById("warp-color-"+String.fromCharCode(e)),i=document.getElementById("function-color-"+String.fromCharCode(e));t&&(t.style.backgroundColor=$s[""+String.fromCharCode(e)]),n&&(n.style.backgroundColor=Ld[""+String.fromCharCode(e)]),i&&(i.style.backgroundColor=js[""+String.fromCharCode(e)])}Mk.style.backgroundColor=Ld[Cd],Ok.style.backgroundColor=js[Ds],Dk.style.backgroundColor=$s[Ms],gd(),Ud(),dd(),"radio-color"==Yn?YN():"radio-interlacement"==Yn&&GN()},w_=e=>{let t=s_(qk.value,t_,e.target.value);qk.value=t,t_=e.target.value};function E_(e,t,n){const i=kk.querySelector(".close-button"),r=kk.querySelector("#btn-cancel");e.addEventListener("contextmenu",e=>{e.preventDefault(),(e=>{console.log("openColorModel called",Ws),console.log("warp info object ----",Ad),console.log("Warp color objet",Ld),console.log("Weft color object",$s),kk.style.display="block",kk.style.animation="slide-down 0.3s ease",kk.querySelector(".modal-title").textContent=e,zk.innerHTML=a_.map(e=>`<option value=${e.unitValue}>${e.displayName}</option>`).join("\n"),t_||(t_="denier");let t=h_();if(Array.isArray(t)){let e="";t.forEach(t=>{e+=`<option value=${t}>${t}</option>`}),Uk.innerHTML=e}})(t)}),zk.addEventListener("change",w_),e.addEventListener("mousedown",t=>{var n;Vk.value=e.id.slice(-1),Qk.value=e.id.slice(0,4),"warp"==e.id.slice(0,4)?(Mk.innerText=e.id.slice(-1)+" ||",n=e.id.slice(-1),Cd=n,Mk.style.backgroundColor=Ld[e.id.slice(-1)],Wk.value=sa(Ld[e.id.slice(-1)]),Hk.value=Ad[e.id.slice(-1)]?Ad[e.id.slice(-1)].yarnName:"",qk.value=Ad[e.id.slice(-1)]?Ad[e.id.slice(-1)].yarnType:"",zk.value=Ad[e.id.slice(-1)]?Ad[e.id.slice(-1)].yarnUnit:"denier",t_=zk.value,Fk.style.display="block",Rk.style.display="none"):"weft"==e.id.slice(0,4)?(Dk.innerText=e.id.slice(-1)+" =",(e=>{Ms=e})(e.id.slice(-1)),Dk.style.backgroundColor=$s[e.id.slice(-1)],Wk.value=sa($s[e.id.slice(-1)]),Hk.value=Ws[e.id.slice(-1)]?Ws[e.id.slice(-1)].yarnName:"",qk.value=Ws[e.id.slice(-1)]?Ws[e.id.slice(-1)].yarnType:"",zk.value=Ws[e.id.slice(-1)]?Ws[e.id.slice(-1)].yarnUnit:"denier",t_=zk.value,Fk.style.display="block",Rk.style.display="none"):((e=>{Os=e})(e.id.slice(-1)),Ok.style.backgroundColor=js[e.id.slice(-1)],Wk.value=sa(js[e.id.slice(-1)]),Fk.style.display="none",Rk.style.display="inline")}),i.addEventListener("click",g_),n&&r&&r.addEventListener("click",g_)}const S_=document.getElementById("weftSubContext"),x_=(document.getElementById("subParent"),document.getElementById("mainContextMenu")),I_=document.getElementById("design-menu"),k_=document.getElementById("design-mode"),__=document.getElementById("sub-context-design-mode"),T_=document.getElementById("draftplan-design-mode"),N_=document.getElementById("sub-context-draft-design-mode"),C_=document.getElementById("warpcolor-design-mode"),L_=document.getElementById("sub-context-warp-color-design-mode"),A_=document.getElementById("weftcolor-design-mode"),P_=document.getElementById("sub-context-weft-color-design-mode"),B_=document.getElementById("pegplan-design-mode"),R_=document.getElementById("sub-context-pegplan-design-mode"),F_=document.getElementById("subcontext-trigger-draft-import"),M_=document.getElementById("subcontext-menu-draft-import"),D_=document.getElementById("subcontext-trigger-pegplan-import"),O_=document.getElementById("subcontext-menu-pegplan-import"),$_=document.getElementById("sub-context-design"),j_=document.getElementById("insert-menu"),W_=document.getElementById("sub-context-insert"),H_=document.getElementById("wsInsert-menu"),q_=document.getElementById("sub-context-wsInsert"),U_=document.getElementById("insert-trigger"),z_=document.getElementById("sub-context-wcInsert"),V_=document.getElementById("warpCanvasMenu");let Y_=[];const G_=document.getElementById("colorPaletteContextMenuWarp"),J_=document.getElementById("colorPaletteContextMenuWeft"),X_=document.getElementById("colorPaletteContextMenuFunction");function K_(e,t){e.addEventListener("click",()=>{t.classList.toggle("none")}),window.addEventListener("click",n=>{n.target===e||t.contains(n.target)||t.classList.add("none")})}const Z_=e=>{if(P_.classList.toggle("none"),Rs.style.display="none",Gs(e),e==Ci){let e=UC(),t=d$.fixNumericText;XC(t).trim()!=XC(e)&&d$.setFixNumericText(e)}},Q_=()=>{K_(I_,$_),K_(k_,__),K_(T_,N_),K_(C_,L_),K_(A_,P_),K_(B_,R_),K_(F_,M_),K_(D_,O_),tT(sw,S_),tT(rT,V_),K_(j_,W_),tT(oN,x_),K_(H_,q_),K_(U_,z_),tT(Mk,G_),tT(Dk,J_),tT(Ok,X_),document.querySelector('input[name="radio-design-view"]')&&document.querySelectorAll('input[name="radio-design-view"]').forEach((e,t)=>{0==t&&(e.checked=!0),e.addEventListener("change",(function(e){var t=e.target.value;Yn=t,x_.style.display="none",$_.classList.toggle("none"),MN()}))}),document.querySelector('input[name="radio-design-mode"]')&&document.querySelectorAll('input[name="radio-design-mode"]').forEach((e,t)=>{e.addEventListener("change",(function(e){var t=e.target.value;__.classList.toggle("none"),x_.style.display="none",CN(t),t==Ei?(YO.turn_on_drawing_on_command(),$N(!0)):$N(!1)}))}),document.querySelector('input[name="draft-radio-design-mode"]')&&document.querySelectorAll('input[name="draft-radio-design-mode"]').forEach((e,t)=>{e.addEventListener("change",(function(e){var t=e.target.value;if(N_.classList.toggle("none"),S_.style.display="none",Rw(t),t==ki){let e=GO.convert_new_index_to_numeric(ZO),t=GO.get_fix_numeric_text();XC(t).trim()!=XC(e).trim()&&GO.change_fix_numeric_text(e)}}))}),document.querySelector('input[name="warp-color-radio-design-mode"]')&&document.querySelectorAll('input[name="warp-color-radio-design-mode"]').forEach((e,t)=>{e.addEventListener("change",(function(e){var t=e.target.value;if(L_.classList.toggle("none"),Fd.style.display="none",Wd(t),t==Ti){let e=qC(),t=c$.fixNumericText;XC(t).trim()!=XC(e)&&c$.setFixNumericText(e)}}))}),document.querySelector('input[name="weft-color-radio-design-mode"]')&&document.querySelectorAll('input[name="weft-color-radio-design-mode"]').forEach((e,t)=>{e.addEventListener("change",(function(e){var t=e.target.value;Z_(t)}))}),document.querySelector('input[name="pegplan-radio-design-mode"]')&&document.querySelectorAll('input[name="pegplan-radio-design-mode"]').forEach((e,t)=>{e.addEventListener("change",(function(e){var t=e.target.value;(e=>{if(R_.classList.toggle("none"),V_.style.display="none",jT(e),e==Ai){let e=KO.convert_new_index_to_numeric(!1,!1),t=KO.get_fix_numeric_text();XC(t).trim()!=XC(e).trim()&&KO.change_fix_numeric_text(e)}})(t),t==Ai&&Z_(Ci),t==Pi&&Z_(Li)}))})},eT=()=>{Y_.forEach(e=>{e.style.display="none"})};function tT(e,t){Y_.push(t);document.body;const n=t;let i=!1;n.style.position="absolute",n.style.zIndex="9999",window.addEventListener("keyup",e=>{"Escape"===e.key&&(n.style.display="none")}),e.addEventListener("contextmenu",(function(t){if(Y_.forEach(e=>{e.style.display="none"}),t.ctrlKey)return;t.preventDefault(),Uf();const r=t.clientX,a=t.clientY,l=window.innerWidth,o=n.offsetWidth,s=n.offsetHeight,d=r<l/2?r:r-o,c=Math.min(a,window.innerHeight-s);n.style.display="block",n.style.left=d+"px",n.style.top=c+"px";let u=(e=>{const t=e.getBoundingClientRect();return{isTopOverflow:t.top<0,isBottomOverFlow:t.bottom+50>(window.innerHeight||document.documentElement.clientHeight),isLeftOverFlow:t.left<0,isRightOverFlow:t.right>(window.innerWidth||document.documentElement.clientWidth)}})(n);u.isTopOverflow,u.isBottomOverFlow&&(n.style.top=String(c-parseInt(getComputedStyle(n).height))+"px"),u.isLeftOverFlow,u.isRightOverFlow&&(n.style.left=String(d-parseInt(getComputedStyle(n).width))+"px"),i=!0,window.addEventListener("click",(function(t){i&&!n.contains(t.target)&&t.target!==e&&(n.style.display="none",i=!1)}))}))}const nT=document.getElementById("pegplan-column"),iT=document.getElementById("vertical-scroll-container"),rT=document.getElementById("warp-canvas"),aT=rT.getContext("2d"),lT=(document.getElementById("weftSubParent"),document.getElementById("subParent")),oT=document.getElementById("warp-scale-container"),sT=document.getElementById("edit-design-from-pegplan"),dT=document.getElementById("pegplan-column"),cT=document.getElementById("header-edit-design-trigger"),uT=(document.getElementById("main-dent-container"),document.getElementById("main-canvas")),pT="#warp-canvas-brush-svg",hT=document.getElementById("warp-canvas-brush-svg");let gT,mT,fT,yT,vT,bT,wT=!1,ET=!1,ST=[],xT=[],IT=[],kT=[],_T=[],TT=!1,NT=!1,CT=!1,LT=[],AT=0,PT=0,BT=-1,RT=us,FT=Ai;const MT=e=>{PT=e},DT=()=>{document.getElementById("warpCanvasMenu").style.display="none"},OT=()=>{const e=(Mn?Vn:1)*YO.rows()*(Gn?YO.height():qi);var t=lT.clientHeight>0?e>lT.clientHeight:e>nT.clientHeight;if(AT=nT.clientHeight-rT.height,t){let e=0;lT.style.paddingTop="0px",nT.style.paddingTop="0px",xs.style.paddingTop="0px",Is.style.paddingTop="0px",ks.style.paddingTop="0px",Fs.style.paddingTop="0px",hT.style.top="0px",iT.scrollTo(0,iT.scrollHeight-iT.clientHeight+e),$T({target:{scrollTop:iT.scrollHeight-iT.clientHeight+e}})}else lT.style.paddingTop=lT.clientHeight-uT.height+"px",nT.style.paddingTop=nT.clientHeight-rT.height+"px",hT.style.top=AT+"px",xs.style.paddingTop=xs.clientHeight-_s.height+"px",Is.style.paddingTop=Is.clientHeight-Ns.height+"px",ks.style.paddingTop=ks.clientHeight-Ls.height+"px",Fs.style.paddingTop=Fs.clientHeight-Ps.height+"px",$T({target:{scrollTop:0}}),lT.style.paddingTop=lT.clientHeight-uT.height+"px",nT.style.paddingTop=nT.clientHeight-rT.height+"px",hT.style.top=AT+"px",xs.style.paddingTop=xs.clientHeight-_s.height+"px",Is.style.paddingTop=Is.clientHeight-Ns.height+"px",Fs.style.paddingTop=Fs.clientHeight-Ps.height+"px"},$T=e=>{let t=e.target.scrollTop,n=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi;t=parseInt(iT.scrollTop/n)*n;const i=(Mn?Vn:1)*YO.rows()*n;Hn.startRow=_N>i?1:parseInt(i-parseInt(_N/n)*n-t)/n+1,Hn.endRow=Hn.startRow+parseInt(_N/n)-1,iT.scrollTo({top:t,left:iT.scrollLeft}),PT=t,WT()},jT=e=>{FT=e;let t=document.getElementById(e);t&&(t.checked=!0)};const WT=()=>{const e=Hn.startRow,t=Hn.endRow,n=KO.rows();let i=n*qi*(Mn?Vn:1);xN.style.height=i+"px";const r=1*YO.width(),a=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,l=KO.get_visible_cells(e,t,Mn,a),o=rL(l)?JSON.parse(l):[],s=KO.cols(),d=Mn?t-e+1:Math.min(t-e+1,n),c=document.createElement("canvas");if(c.width=Math.ceil(s*r),c.height=Math.ceil(d*a),0==c.height||0==c.width)return;const u=c.getContext("2d");if(u.clearRect(0,0,c.width,c.height),u.fillStyle="white",u.fillRect(0,0,c.width,c.height),u.fillStyle="black",o.forEach((e,t)=>{e.forEach(e=>{u.fillRect(t*r,(d-e)*a,r,a)})}),Oi==si){for(let e=0;e<s+1;e++)u.beginPath(),u.strokeStyle="grey",u.moveTo(e*r,0),u.lineTo(e*r,d*a),u.lineWidth=e%$n==0?1.5:.5,u.stroke(),u.closePath();for(let t=0;t<d+1;t++)u.beginPath(),u.strokeStyle="grey",u.moveTo(0,t*a),u.lineTo(s*r,t*a),u.lineWidth=(d-t+e-1)%jn==0?1.5:.5,u.stroke(),u.closePath()}else if(Oi==di){u.lineWidth=.5;for(let e=0;e<s+1;e++)u.beginPath(),u.strokeStyle="grey",u.moveTo(e*r,0),u.lineTo(e*r,d*a),u.stroke(),u.closePath();for(let e=0;e<d+1;e++)u.beginPath(),u.strokeStyle="grey",u.moveTo(0,e*a),u.lineTo(0+s*r,e*a),u.stroke(),u.closePath()}else if(Oi==ci){u.lineWidth=1.5;for(let e=0;e<s+1;e++)e%$n==0&&(u.beginPath(),u.strokeStyle="grey",u.moveTo(e*r,0),u.lineTo(e*r,d*a),u.stroke(),u.closePath());for(let t=0;t<d+1;t++)(d-t+e-1)%jn==0&&(u.beginPath(),u.strokeStyle="grey",u.moveTo(0,t*a),u.lineTo(s*r,t*a),u.stroke(),u.closePath())}else{u.lineWidth=1.5;for(let e=0;e<s+1;e+=s)e%$n==0&&(u.beginPath(),u.strokeStyle="grey",u.moveTo(e*r,0),u.lineTo(e*r,d*a),u.stroke(),u.closePath());for(let e=0;e<d+1;e+=d)(d-e)%jn==0&&(u.beginPath(),u.strokeStyle="grey",u.moveTo(0,e*a),u.lineTo(s*r,e*a),u.stroke(),u.closePath())}u.closePath(),aT.clearRect(0,0,rT.width,rT.height),rT.width=c.width,rT.height=c.height,aT.drawImage(c,0,0),MN(),hd(),cd(),ud(),sd()},HT=e=>{const t=Hn.startRow,n=Hn.endRow,i=KO.rows(),r=rT.getBoundingClientRect(),a=1*YO.width(),l=Gn?1*YO.height():qi,o=Mn?n-t+1:Math.min(n-t+1,i),s=(KO.cols(),e.clientX-r.left),d=(e.clientY-r.top)%(o*l),c=(t-1+o-parseInt(d/l)-1)%i,u=parseInt(s/a);if(!bT){let e=KO.check_if_index_exist_or_not(c,u);bT=e?gs:hs}if(bT==hs)Xn?(KO.add_cell_tieupmode(c,u,YO,GO,QO),iN(),VN()):(KO.add_cell_new(c,u,YO,GO,QO),WT());else if(bT==gs)if(Xn)KO.remove_cell_tieupmode(c,u,YO,GO,QO),iN(),VN();else{KO.remove_cell_new(c,u,YO,GO,QO);WT()}},qT=e=>{if(vs==ss){if(e.ctrlKey&&"KeyE"==e.code){e.preventDefault();let t=KO.rows(),n=[];for(let e=0;e<ST.length;e++){let i=Number(mT.select(".selection").attr("x")),r=Number(mT.select(".selection").attr("y")),a=(ST[e].y+r)/qi;a=t-a-1;let l=(ST[e].x+i)/qi;KO.add_cell_new(a,l,YO,GO,QO),n.push(l)}GT(n),QT()}if(e.altKey&&tN(!NT),e.shiftKey&&(CT=!0),"Escape"==e.code&&QT(),"F8"==e.code){e.preventDefault();let t=[];for(let e=0;e<ST.length;e++)t.push(parseInt(ST[e].y/qi));[...new Set(t)].forEach(e=>{l$.update_function_cell(e,Ds)}),pd()}if("F9"==e.code){e.preventDefault();let t=[];for(let e=0;e<ST.length;e++)t.push(parseInt(ST[e].y/qi));[...new Set(t)].forEach(e=>{s$.update_function_cell(e,Os)}),dd()}}},UT=e=>{"Shift"==e.key&&(CT=!1)},zT=e=>{if(vs!=ss);else if(!wT){wT=!0;d3.select("#pegplan-column").node();let t=mT.select(pT).style("z-index","1").style("width",rT.width+"px").style("height",rT.height+"px").style("pointer-events","all");const n=new MouseEvent("mousedown",e);t.select("rect.overlay").node().dispatchEvent(n)}},VT=e=>{if(FT!=Ai){if(vs==ds&&!ET){ET=!0;const t=rT.getBoundingClientRect(),n=KO.cols(),i=KO.cell_size(),r=(e.clientX-t.left)%(n*i),a=e.clientY-t.top;fT={x:r,y:a},function(e){const t=rT.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=aT.getImageData(n,i,1,1).data,a=r[0],l=r[1],o=r[2];RT=0===a&&0===l&&0===o?ps:us}(e)}if(vs==os){if(0==e.button&&e.ctrlKey&&!Xn){const t=rT.getBoundingClientRect(),n=KO.rows(),i=Hn.startRow,r=Hn.endRow,a=1*YO.width(),l=Gn?1*YO.height():qi,o=Mn?r-i+1:Math.min(r-i+1,n);KO.cols();let s=iT.scrollTop;const d=e.clientX-t.left,c=(e.clientY-t.top)%(o*l),u=(i-1+o-parseInt(c/l)-1)%n;parseInt(d/a);return e.shiftKey?(KO.remove_row(u,YO,GO,QO),d$.remove_cell(u),l$.remove_cell(u),s$.remove_cell(u),s+=(Vn+1)*l):(KO.add_row(u,YO,GO,QO),d$.add_cell(u),l$.add_cell(u),s$.add_cell(u),s+=(Vn-1)*l),uh.value=KO.rows(),Rh(),m$(),PN(),void iT.scrollTo(0,s)}if(0==e.button&&e.altKey&&!Xn){const t=rT.getBoundingClientRect(),n=1*YO.width(),i=Gn?1*YO.height():qi,r=KO.rows();if(KO.cols()>=40)return void nL("Maxium 40 shaft allowed");const a=e.clientX-t.left,l=(e.clientY-t.top)%(r*i),o=(parseInt(l/i),parseInt(a/n));e.shiftKey?KO.remove_col(o,YO,GO,QO):KO.add_col(o,YO,GO,QO);let s=iT.scrollTop;return Vp.value=KO.cols(),Rh(),m$(),PN(),void iT.scrollTo(0,s)}o_(n_.NONE),0==e.button&&(Vi(!0),HT(e))}}},YT=e=>{if(vs==os)return void(bT=null);ET=!1;const t=KO.rows(),n=KO.cols();RT==us&&_T.forEach(e=>{KO.add_cell_new(t-parseInt(e/n)-1,e%n,YO,GO,QO)}),RT==ps&&_T.forEach(e=>{KO.remove_cell_new(t-parseInt(e/n)-1,e%n,YO,GO,QO)}),_T=[],vT=-1,BT=-1,bT=null,Vi(!1),iN(),fT=null};const GT=e=>{if(!Mn)return void(e=>{KO.cols();const t=KO.rows(),n=1*YO.width(),i=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,r=Dn,a=On;if(Array.isArray(e))for(let l=0;l<e.length;l++){aT.clearRect(e[l]*n,0,n,rT.height),aT.fillStyle="white",aT.fillRect(e[l]*n,0,n,rT.height);const o=new Uint32Array(I$.memory.buffer,KO.new_cells(e[l]),KO.selected_col_new_cell_length(e[l]));aT.fillStyle="black",o.forEach(r=>{aT.fillRect(e[l]*n,(t-r)*i,n,i)});for(let o=0;o<t+1;o++)aT.beginPath(),aT.strokeStyle="grey",aT.moveTo(r+e[l]*n,a+o*i),aT.lineTo(r+e[l]*n+n,a+o*i),aT.lineWidth=(t-o)%jn==0?1.5:.5,aT.stroke(),aT.closePath();for(let o=0;o<2;o++)aT.beginPath(),aT.strokeStyle="grey",aT.moveTo(r+e[l]*n+o*n,a),aT.lineTo(r+e[l]*n+o*n,a+t*i),aT.lineWidth=(e[l]+o)%$n==0?1.5:.5,aT.stroke(),aT.closePath()}})(e);const t=KO.cols(),n=KO.rows(),i=1*YO.width(),r=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,a=Dn,l=On,o=document.createElement("canvas"),s=o.getContext("2d");o.width=Math.ceil(t*i),o.height=Math.ceil(n*r);const d=aT.getImageData(0,uT.height-o.height,o.width,o.height);if(s.putImageData(d,0,0),Array.isArray(e))for(let t=0;t<e.length;t++){s.clearRect(e[t]*i,0,i,o.height),s.fillStyle="white",s.fillRect(e[t]*i,0,i,o.height);for(let o=0;o<n+1;o++)s.beginPath(),s.strokeStyle="grey",s.moveTo(a+e[t]*i,l+o*r),s.lineTo(a+e[t]*i+i,l+o*r),s.lineWidth=(n-o)%jn==0?1.5:.5,s.stroke(),s.closePath();for(let o=0;o<2;o++)s.beginPath(),s.strokeStyle="grey",s.moveTo(a+e[t]*i+o*i,l),s.lineTo(a+e[t]*i+o*i,l+n*r),s.lineWidth=(e[t]+o)%$n==0?1.5:.5,s.stroke(),s.closePath();const d=new Uint32Array(I$.memory.buffer,KO.new_cells(e[t]),KO.selected_col_new_cell_length(e[t]));s.fillStyle="black",d.forEach(a=>{s.fillRect(e[t]*i,(n-a)*r,i,r)})}rT.width=o.width,rT.height=o.height*Vn;const c=aT.createPattern(o,"repeat");aT.rect(0,0,rT.width,rT.height),aT.fillStyle=c,aT.fill()},JT=e=>{if(RN(lr,e),FT!=Ai){if(vs==ds&&ET){const t=rT.getBoundingClientRect(),n=KO.cell_size(),i=KO.cols(),r=(e.clientX-t.left)%(i*n),a=e.clientY-t.top,l=parseInt(fT.x/n),o=parseInt(fT.y/n);vT=l+o*i;let s=parseInt(r/n),d=parseInt(a/n);return BT=s+d*i,void iN()}$i&&0==e.button&&HT(e)}},XT=()=>{Oh(lr)},KT=()=>{rT.addEventListener("mousedown",VT),rT.addEventListener("mouseup",YT),rT.addEventListener("mousemove",JT),rT.addEventListener("mouseleave",HN),iT.addEventListener("scroll",$T),document.addEventListener("keydown",qT),document.addEventListener("keyup",UT),(()=>{const e=document.getElementById("wcInsert-weft-trigger"),t=document.getElementById("wcInsert-shaft-trigger"),n=document.getElementById("wcInsert-weft-modal"),i=document.getElementById("wcInsert-shafts-modal"),r=(document.querySelectorAll(".close-button"),document.querySelectorAll(".btn-cancel"));ow(e,n,0,r,"Insert Weft"),ow(t,i,0,r,"Insert Shaft"),ow(sT,qb,0,r,"Edit File"),ow(cT,qb,0,r,"Edit File")})(),sT.addEventListener("click",XT),cT.addEventListener("click",XT)},ZT=e=>{if(e.selection)if("handle"===e.mode){let[[t,n],[i,r]]=e.selection;if(yT||(e=>{(e.sourceEvent.srcElement.classList.value.includes("--ne")||e.sourceEvent.srcElement.classList.value.includes("--se")||e.sourceEvent.srcElement.classList.value.includes("--sw")||e.sourceEvent.srcElement.classList.value.includes("--nw")||e.sourceEvent.srcElement.classList.value.includes("--s")||e.sourceEvent.srcElement.classList.value.includes("--n")||e.sourceEvent.srcElement.classList.value.includes("--w")||e.sourceEvent.srcElement.classList.value.includes("--e"))&&(e.sourceEvent.srcElement.classList.value.includes("--ne")?yT=cs.TOP_RIGHT:e.sourceEvent.srcElement.classList.value.includes("--se")?yT=cs.BOTTOM_RIGHT:e.sourceEvent.srcElement.classList.value.includes("--sw")?yT=cs.BOTTOM_LEFT:e.sourceEvent.srcElement.classList.value.includes("--nw")?yT=cs.TOP_LEFT:e.sourceEvent.srcElement.classList.value.includes("--s")?yT=cs.BOTTOM:e.sourceEvent.srcElement.classList.value.includes("--n")?yT=cs.TOP:e.sourceEvent.srcElement.classList.value.includes("--w")?yT=cs.LEFT:e.sourceEvent.srcElement.classList.value.includes("--e")&&(yT=cs.RIGHT))})(e),xT.length>0)if(CT){const[[e,a],[l,o]]=xT;if([cs.TOP].includes(yT))n-=n%qi,mT.select(pT).call(gT.move,[[e,n],[l,o]]);else if([cs.BOTTOM].includes(yT))r+=qi-r%qi,mT.select(pT).call(gT.move,[[e,a],[l,r]]);else if([cs.RIGHT].includes(yT))i+=qi-i%qi,mT.select(pT).call(gT.move,[[e,a],[i,o]]);else if([cs.LEFT].includes(yT))t-=t%qi,mT.select(pT).call(gT.move,[[t,a],[l,o]]);else if([cs.TOP_RIGHT].includes(yT)){Math.abs(l-i)>=Math.abs(a-n)?(i+=qi-i%qi,n=a+(l-i)):(n-=n%qi,i=l+(a-n)),mT.select(pT).call(gT.move,[[e,n],[i,o]])}else if([cs.TOP_LEFT].includes(yT)){Math.abs(e-t)>=Math.abs(a-n)?(t-=t%qi,n=a-(e-t)):(n-=n%qi,t=e-(a-n)),mT.select(pT).call(gT.move,[[t,n],[l,o]])}else if([cs.BOTTOM_LEFT].includes(yT)){Math.abs(e-t)>=Math.abs(o-r)?(t-=t%qi,r=o+(e-t)):(r+=qi-r%qi,t=e+(o-r)),mT.select(pT).call(gT.move,[[t,a],[l,r]])}else if([cs.BOTTOM_RIGHT].includes(yT)){Math.abs(l-i)>=Math.abs(o-r)?(i+=qi-i%qi,r=o-(l-i)):(r+=qi-r%qi,i=l-(o-r)),mT.select(pT).call(gT.move,[[e,a],[i,r]])}else[cs.BOTTOM_LEFT,cs.BOTTOM_RIGHT,cs.TOP_LEFT,cs.TOP_RIGHT].includes(yT)&&(t-=t%qi,n-=n%qi,i+=qi-i%qi,r+=qi-r%qi)}else t=Math.round(t/qi)*qi,n=Math.round(n/qi)*qi,i=Math.round(i/qi)*qi,r=Math.round(r/qi)*qi,mT.select(pT).call(gT.move,[[t,n],[i,r]]);else{t-=t%qi,n-=n%qi,i+=qi-i%qi,r+=qi-r%qi;for(let e=0;e<LT.length;e++)LT[e].classList.add("crosshair-cursor");mT.select(pT).call(gT.move,[[t,n],[i,r]])}}else if("drag"===e.mode){let[[t,n],[i,r]]=e.selection;t-=t%qi,n-=n%qi,i+=qi-i%qi,r+=qi-r%qi;let[[a,l],[o,s]]=xT,d=o-a,c=s-l;if(mT.select(pT).call(gT.move,[[t,n],[t+d,n+c]]),NT){TT=!0;Math.ceil(xT[0][0]/1),Math.ceil(xT[0][1]/1),Math.ceil(t/1),Math.ceil(n/1);mT.selectAll(".selected-square").remove(),ST.forEach(e=>{mT.select(pT).append("rect").attr("class","selected-square").attr("x",e.x+t).attr("y",e.y+n).attr("width",qi).attr("height",qi).style("fill","yellow")}),iN()}else TT&&mT.select(pT).call(gT.move,IT)}},QT=()=>{wT=!1,TT=!1,tN(!1),mT.select(pT).style("z-index","-1").call(gT.move,[[0,0],[0,0]]),xT=[],kT=[],ST=[],mT.selectAll(".selected-square").remove(),iN()},eN=e=>{let[[t,n],[i,r]]=e,a=KO.rows(),l=[];for(let e=t;e<=i;e+=qi){let o=parseInt(e/qi);new Uint32Array(I$.memory.buffer,KO.new_cells(o),KO.selected_col_new_cell_length(o)).forEach(e=>{let s=o*qi,d=(a-e)*qi;t<=s&&s<i&&n<=d&&d<r&&l.push({x:Math.abs(s-t),y:Math.abs(d-n)})})}ST=JSON.parse(JSON.stringify(l))},tN=e=>{NT=e,NT?mT.select(".selection").style("cursor","grab"):mT.select(".selection").style("cursor","move")},nN=()=>{mT=d3.select(rT.parentElement),gT=d3.brush().keyModifiers(!1).extent([[0,0],[rT.width,rT.height]]).on("start",e=>{console.log("handle brush started called")}).on("brush",e=>ZT(e)).on("end",e=>(e=>{if(!e.selection)return void QT();let[[t,n],[i,r]]=e.selection;if("handle"===e.mode){eN([[t,n],[i,r]]),mT.select(pT).call(gT.move,[[t,n],[i,r]]);for(let e=0;e<LT.length;e++)LT[e].classList.remove("crosshair-cursor");xT=[[t,n],[i,r]],IT=[[t,n],[i,r]]}"drag"==e.mode&&(NT||(eN([[t,n],[i,r]]),xT=[[t,n],[i,r]]),IT=[[t,n],[i,r]])})(e)).filter(e=>"contextmenu"!=e.type);const e=mT.select(pT);e.call(gT),rT.removeEventListener("mousedown",zT),rT.addEventListener("mousedown",zT),e.on("contextmenu",e=>{QT()}),LT=dT.getElementsByTagName("rect")},iN=()=>{const e=KO.cols(),t=KO.rows(),n=1*YO.width(),i=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,r=Dn,a=On,l=document.createElement("canvas");if(l.width=Math.ceil(e*n),l.height=Math.ceil(t*i),0==l.height||0==l.width)return;const o=l.getContext("2d");if(o.clearRect(0,0,l.width,l.height),o.fillStyle="white",o.fillRect(0,0,l.width,l.height),o.fillStyle="black",aT.clearRect(0,0,rT.width,rT.height),Oi==si){for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.lineWidth=l%$n==0?1.5:.5,o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.lineWidth=(t-l)%jn==0?1.5:.5,o.stroke(),o.closePath()}else if(Oi==di){o.lineWidth=.5;for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.stroke(),o.closePath()}else if(Oi==ci){o.lineWidth=1.5;for(let l=0;l<e+1;l++)l%$n==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.stroke(),o.closePath());for(let l=0;l<t+1;l++)(t-l)%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.stroke(),o.closePath())}else{o.lineWidth=1.5;for(let l=0;l<e+1;l+=e)l%$n==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.stroke(),o.closePath());for(let l=0;l<t+1;l+=t)(t-l)%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.stroke(),o.closePath())}for(let r=0;r<e;r++){new Uint32Array(I$.memory.buffer,KO.new_cells(r),KO.selected_col_new_cell_length(r)).forEach(e=>{o.fillRect(r*n,(t-e)*i,n,i)})}if(o.fillStyle="red",-1!=vT&&-1!=BT&&(((e,t,n,i)=>{_T=[];const r=KO.cols();let a={};let l=(o=n-e,s=i-t,Math.atan(s/(0==o?.01:o))+(o<0?Math.PI:0));var o,s,d,c,u,p,h;d=e,c=t,u=n,p=i,h=l,Math.abs(d-u)>Math.abs(c-p)?(a.x=Math.sign(Math.cos(h)),a.y=Math.tan(h)*Math.sign(Math.cos(h)),a.long=Math.abs(d-u)):(a.x=Math.tan(Math.PI/2-h)*Math.sign(Math.cos(Math.PI/2-h)),a.y=Math.sign(Math.cos(Math.PI/2-h)),a.long=Math.abs(c-p));for(let n=0;n<a.long;n++){let i={x:Math.round(e+a.x*n),y:Math.round(t+a.y*n)};_T.push(i.y*r+i.x)}})(vT%e,parseInt(vT/e),BT%e,parseInt(BT/e)),_T.forEach(e=>{o.fillRect(e%KO.cols()*n,parseInt(e/KO.cols())*i,n,i)})),o.fillStyle="yellow",kT.forEach(e=>{o.fillRect(e.x,e.y,n,i)}),o.closePath(),Mn){rT.width=l.width,rT.height=l.height*Vn;const e=aT.createPattern(l,"repeat");aT.rect(0,0,rT.width,rT.height),aT.fillStyle=e,aT.fill()}else rT.width=l.width,rT.height=l.height,aT.drawImage(l,0,0);iE(),VN(),nN(),Number(Nr.value),Number(Jr.value)},rN=document.getElementById("active-part"),aN=document.getElementById("active-warp-weft-color"),lN=document.getElementById("active-warp-weft-text"),oN=document.getElementById("main-canvas"),sN=oN.getContext("2d"),dN=document.getElementById("subParent"),cN=document.getElementById("main-content-column-container"),uN=document.getElementById("weftSubParent"),pN=document.getElementById("edit-design-from-maindesign"),hN=document.getElementById("nav-bar-container"),gN=document.getElementById("color-penal-container"),mN=document.getElementById("sidebar-container"),fN=document.getElementById("first-row-container"),yN=(document.getElementById("main-dent-container"),document.getElementById("horizontal-scroll-container")),vN=document.getElementById("horizontal-scroll-child"),bN=document.getElementById("mapping-canvas-container"),wN=document.getElementById("calculate-draft-pegplan"),EN=document.getElementById("mapping-canvas"),SN=EN.getContext("2d"),xN=document.getElementById("vertical-scroll-child");let IN,kN=0,_N=0,TN=null,NN=vi;const CN=e=>{NN=e},LN=e=>{TN=e},AN=e=>{let t=e.target.scrollLeft;t=parseInt(t/qi)*qi;(Mn?zn:1)*YO.cols()*YO.width()-qi-parseInt(kN/qi)*qi==t&&TN<t&&(t+=qi),Hn.startColumn=parseInt(t/qi),Hn.endColumn=parseInt(t/qi)+parseInt(kN/qi)-1,yN.scrollTo(t,0),TN=t,Jw()},PN=()=>{let e=zs.offsetWidth,t=document.documentElement.clientWidth,n=ti?iT.offsetWidth:0,i=ti?parseInt(getComputedStyle(iT).marginLeft):0,r=nT.offsetWidth,a=parseInt(getComputedStyle(dN).marginLeft),l=parseInt(getComputedStyle(nT).marginLeft),o=mN.offsetWidth,s=uw.offsetWidth,d=Pd.offsetHeight,c=Od.offsetHeight;kN=t-(e+n+i+r+a+l+o+s+30);let u=document.querySelector(":root");u.style.setProperty("--middle-part-width",parseInt(kN/qi)*qi+"px"),Od.style.width=parseInt(kN/qi)*qi-2+"px";let p=fN.offsetHeight,h=document.documentElement.clientHeight,g=ti?yN.offsetHeight:0,m=ti?parseInt(getComputedStyle(yN).marginTop):0,f=Pd.clientHeight;f=0==f?10:f;let y=parseInt(getComputedStyle(dN).marginTop),v=parseInt(getComputedStyle(Pd).marginTop),b=hN.offsetHeight,w=gN.offsetHeight,E=oT.offsetHeight;_N=h-(p+g+m+f+y+v+w+b+E+d+c+(Kn?10:40));parseInt(getComputedStyle(fN).marginTop),parseInt(getComputedStyle(Vs).marginTop);let S=Gn?YO.height():qi;u.style.setProperty("--middle-part-height",parseInt(_N/S)*S+"px");if(0==fN.offsetHeight){let e=50;zs.style.marginTop=e+"px",nT.style.marginTop=e+"px",iT.style.marginTop=e+"px",cN.style.marginTop=e+"px",dN.style.marginTop="0px",fN.style.marginTop="0px",bN.style.marginTop="0px"}else fN.style.marginTop="50px",bN.style.marginTop="50px",dN.style.marginTop="2px",nT.style.marginTop=fN.offsetHeight+parseInt(getComputedStyle(fN).marginTop)+2-bN.offsetHeight-(bN.offsetHeight>0?parseInt(getComputedStyle(bN).marginTop):0)+"px",iT.style.marginTop=fN.offsetHeight+parseInt(getComputedStyle(fN).marginTop)+2+"px",cN.style.marginTop="0px",zs.style.marginTop=parseInt(getComputedStyle(fN).marginTop)+2+fN.offsetHeight+"px";OT()};const BN=(e,t)=>{let n="",i="";for(let t=0;t<4-String(e).length;t++)n+="&nbsp;";for(let e=0;e<4-String(t).length;e++)i+="&nbsp;";lN.parentElement.style.width="fit-content",lN.innerHTML=`${i}${t}<span>||</span>${n}${e}=`},RN=(e,t)=>{if(rN.innerText!=e&&(rN.innerText=e),t){const e=Hn.startRow,n=Hn.endRow,i=Hn.startColumn;Hn.endColumn;if(rN.innerText==sr){const r=oN.getBoundingClientRect(),a=1*YO.width(),l=Gn?1*YO.height():qi,o=YO.rows(),s=Mn?n-e+1:Math.min(n-e+1,o),d=YO.cols(),c=(t.clientX-r.left)%(d*a),u=(t.clientY-r.top)%(s*l),p=(e-1+s-parseInt(u/l)-1)%o+1,h=(i+parseInt(c/a))%d+1;BN(p,h);const g=function(e){const t=oN.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,r=sN.getImageData(n,i,1,1).data;return[r[0],r[1],r[2]]}(t);if(0==g[0]&&0==g[1]&&0==g[2]){let e=c$.cells.find(e=>e.index==h-1);if(e){let t=Ld[e.color_code];aN.style.backgroundColor=t,aN.innerText=e.color_code+" ||"}}else{let e=d$.cells.find(e=>e.index==s-p);if(e){let t=$s[e.color_code];aN.style.backgroundColor=t,aN.innerText=e.color_code+" ="}}}else if(rN.innerText==or){const e=sw.getBoundingClientRect(),n=GO.cell_size(),r=GO.cols(),a=GO.rows(),l=(t.clientX-e.left)%(r*n),o=t.clientY-e.top,s=a-parseInt(o/n),d=(i+parseInt(l/n))%r+1;BN(s,d)}else if(rN.innerText==lr){const i=rT.getBoundingClientRect(),r=1*YO.width(),a=KO.rows(),l=Gn?1*YO.height():qi,o=Mn?n-e+1:Math.min(n-e+1,a),s=(KO.cols(),t.clientX-i.left),d=(t.clientY-i.top)%(o*l),c=(e-1+o-parseInt(d/l)-1)%a+1,u=parseInt(s/r)+1;BN(c,u)}else if(rN.innerText==cr){const e=Bd.getBoundingClientRect(),n=qi,r=c$.size,a=(parseInt((t.clientX-e.left)%(c$.size*n)/n),(t.clientX-e.left)%(r*n)),l=(t.clientY,e.top,(i+parseInt(a/n))%r+1);let o=c$.cells.find(e=>e.index==l-1),s=Ld[o.color_code];aN.style.backgroundColor=s,aN.innerText=o.color_code+" ||",BN(1,l)}else if(rN.innerText==dr){const e=Ps.getBoundingClientRect(),n=qi,i=d$.size,r=Hn.startRow,a=Mn?Hn.endRow:Math.min(i,Hn.endRow),l=Mn?a-r+1:Math.min(a-r+1,i),o=Gn?1*YO.height():qi,s=d$.size,d=(t.clientY-e.top)%(s*o),c=(parseInt(d/o),i-1-(l-1-parseInt((t.clientY-e.top)/n)+(r-1))%i);let u=d$.cells.find(e=>e.index==c);if(u){let e=$s[u.color_code];aN.style.backgroundColor=e,aN.innerText=u.color_code+" ="}BN(i-c,1)}}},FN=e=>{if(NN==vi)return;const t=oN.getBoundingClientRect(),n=1*YO.width(),i=Gn?1*YO.height():qi,r=Hn.startColumn,a=Hn.endRow,l=Hn.startRow,o=YO.rows(),s=YO.cols(),d=Mn?a-l+1:Math.min(a-l+1,o),c=(e.clientX-t.left)%(s*n),u=(e.clientY-t.top)%(o*i),p=(l-1+d-parseInt(u/i)-1)%o+1,h=(parseInt(c/n)+r)%s;if("radio-weave"==Yn)if(NN==bi){YO.click_modify_draft_peg_plan(p,h,GO,KO,QO)?(Jw(),WT(),iE()):(Vi(!1),nL("Maximum number of shafts reached"))}else if(NN==wi){YO.click_modify_peg_plan(p,h,GO,KO,QO)&&(WT(),iE())}else if(NN==Ei){if(!IN){let e=YO.check_if_index_exist_or_not(p,h);IN=e?gs:hs}let e=IN==hs;YO.temp_draw_data(p,h,e),(()=>{const e=YO.cols(),t=YO.rows(),n=Hn.startColumn,i=Hn.endColumn,r=Hn.startRow,a=Hn.endRow,l=Mn?i-n+1:Math.min(i-n+1,e),o=Mn?a-r+1:Math.min(a-r+1,t),s=YO.get_visible_temp_cells(r,a,n,Mn?i:Math.min(i,e-1),Mn),d=rL(s)?JSON.parse(s):[],c=YO.width(),u=Gn?Number(parseFloat(YO.height()).toFixed(2)):qi,p=document.createElement("canvas");p.height=u*o,p.width=c*l;const h=p.getContext("2d");if(h.clearRect(0,0,p.width,p.height),h.fillStyle="white",h.fillRect(0,0,p.width,p.height),h.fillStyle="black",Array.isArray(d)&&d.length>0){if("radio-weave"==Yn)d.forEach((e,t)=>{e.forEach(e=>{h.fillRect(t*c,(o-e)*u,c,u)})});else if("radio-color"==Yn)d.forEach((i,a)=>{let l=Array.from({length:o},(e,t)=>t+1),s=c$.cells.find(t=>t.index==(a+n)%e);i.forEach((e,t)=>{s&&(h.fillStyle=Ld[s.color_code],h.fillRect(a*c,(o-e)*u,c,u)),l=l.filter(t=>t!=e)}),l.forEach(e=>{let n=d$.cells.find(n=>{let i=(e+r-1)%t;return n.index==t-(0==i?t:i)});n&&(h.fillStyle=$s[n.color_code],h.fillRect(a*c,(o-e)*u,c,u))})});else if("radio-interlacement"==Yn){let i=1,a=1;d.forEach((l,s)=>{let d=c$.cells.find(t=>t.index==(s+n)%e),p=Array.from({length:o},(e,t)=>t+1);l.forEach((e,n)=>{let l=d$.cells.find(n=>{let i=(e+r-1)%t;return n.index==t-(0==i?t:i)}),g=s*c,m=(o-e)*u;d&&(h.fillStyle=Ld[d.color_code],h.fillRect(g+i+a,m,c-2*(i+a),u)),l&&(h.fillStyle=$s[l.color_code],h.fillRect(g,m+i+a,i,u-2*(i+a)),h.fillRect(g+c-i,m+i+a,i,u-2*(i+a)),h.fillStyle="black",h.fillRect(g+i,m,a,u),h.fillRect(g+c-(i+a),m,a,u),h.fillRect(g,m+i,i,a),h.fillRect(g+c-i,m+i,i,a),h.fillRect(g,m+u-(i+a),i,a),h.fillRect(g+c-i,m+u-(i+a),i,a)),p=p.filter(t=>t!=e)}),p.forEach(l=>{let d=d$.cells.find(e=>{let n=(l+r-1)%t;return e.index==t-(0==n?t:n)}),p=c$.cells.find(t=>t.index==(s+n)%e);d&&(h.fillStyle=$s[d.color_code],h.fillRect(s*c,(o-l)*u+(i+a),c,u-2*(i+a))),p&&(h.fillStyle=Ld[p.color_code],h.fillRect(s*c+i+a,(o-l)*u,c-2*(i+a),i+a),h.fillRect(s*c+i+a,(o-l)*u+u-i,c-2*(i+a),i+a),h.fillStyle="black",h.fillRect(s*c,(o-l)*u+i,c,a),h.fillRect(s*c,(o-l)*u+u-(i+a),c,a),h.fillRect(s*c+i,(o-l)*u,a,i),h.fillRect(s*c+c-(i+a),(o-l)*u,a,i),h.fillRect(s*c+i,(o-l)*u+u-(i+a),a,i+a),h.fillRect(s*c+c-(i+a),(o-l)*u+u-(i+a),a,i+a))})})}if("radio-interlacement"!=Yn)if(Oi==si){for(let e=0;e<l+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.lineWidth=(e+n)%$n==0?1.5:.5,h.stroke(),h.closePath();for(let e=0;e<o+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.lineWidth=(o-e+r-1)%jn==0?1.5:.5,h.stroke(),h.closePath()}else if(Oi==di){h.lineWidth=.5;for(let e=0;e<l+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.stroke(),h.closePath();for(let e=0;e<o+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.stroke(),h.closePath()}else if(Oi==ci){h.lineWidth=1.5;for(let e=0;e<l+1;e++)(e+n)%$n==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.stroke(),h.closePath());for(let e=0;e<o+1;e++)(o-e+r-1)%jn==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.stroke(),h.closePath())}else{h.lineWidth=1.5;for(let e=0;e<l+1;e+=l)e%$n==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.stroke(),h.closePath());for(let e=0;e<o+1;e+=o)e%jn==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.stroke(),h.closePath())}h.closePath(),oN.width=p.width,oN.height=p.height,sN.drawImage(p,0,0)}})()}},MN=()=>{if("radio-interlacement"==Yn)return void(()=>{const e=YO.cols(),t=YO.rows(),n=Hn.startColumn,i=Hn.endColumn,r=Hn.startRow,a=Hn.endRow,l=Mn?i-n+1:Math.min(i-n+1,e),o=Mn?a-r+1:Math.min(a-r+1,t),s=YO.get_visible_cells(r,a,n,Mn?i:Math.min(i,e-1),Mn),d=rL(s)?JSON.parse(s):[],c=YO.width(),u=Gn?Number(parseFloat(YO.height()).toFixed(2)):qi,p=document.createElement("canvas");p.height=u*o,p.width=c*l;const h=p.getContext("2d");h.clearRect(0,0,p.width,p.height),h.fillStyle="white",h.fillRect(0,0,p.width,p.height),h.fillStyle="black";d.forEach((i,a)=>{let l=c$.cells.find(t=>t.index==(a+n)%e),s=Array.from({length:o},(e,t)=>t+1);i.forEach((e,n)=>{let i=d$.cells.find(n=>{let i=(e+r-1)%t;return n.index==t-(0==i?t:i)}),d=a*c,p=(o-e)*u;l&&(h.fillStyle=Ld[l.color_code],h.fillRect(d+1+1,p,c-4,u)),i&&(h.fillStyle=$s[i.color_code],h.fillRect(d,p+1+1,1,u-4),h.fillRect(d+c-1,p+1+1,1,u-4),h.fillStyle="black",h.fillRect(d+1,p,1,u),h.fillRect(d+c-2,p,1,u),h.fillRect(d,p+1,1,1),h.fillRect(d+c-1,p+1,1,1),h.fillRect(d,p+u-2,1,1),h.fillRect(d+c-1,p+u-2,1,1)),s=s.filter(t=>t!=e)}),s.forEach(i=>{let l=d$.cells.find(e=>{let n=(i+r-1)%t;return e.index==t-(0==n?t:n)}),s=c$.cells.find(t=>t.index==(a+n)%e);l&&(h.fillStyle=$s[l.color_code],h.fillRect(a*c,(o-i)*u+2,c,u-4)),s&&(h.fillStyle=Ld[s.color_code],h.fillRect(a*c+1+1,(o-i)*u,c-4,2),h.fillRect(a*c+1+1,(o-i)*u+u-1,c-4,2),h.fillStyle="black",h.fillRect(a*c,(o-i)*u+1,c,1),h.fillRect(a*c,(o-i)*u+u-2,c,1),h.fillRect(a*c+1,(o-i)*u,1,1),h.fillRect(a*c+c-2,(o-i)*u,1,1),h.fillRect(a*c+1,(o-i)*u+u-2,1,2),h.fillRect(a*c+c-2,(o-i)*u+u-2,1,2))})}),h.closePath(),oN.width=p.width,oN.height=p.height,sN.drawImage(p,0,0)})();const e=YO.cols(),t=YO.rows(),n=Hn.startColumn,i=Hn.endColumn,r=Hn.startRow,a=Hn.endRow,l=Mn?i-n+1:Math.min(i-n+1,e),o=Mn?a-r+1:Math.min(a-r+1,t),s=YO.get_visible_cells(r,a,n,Mn?i:Math.min(i,e-1),Mn),d=rL(s)?JSON.parse(s):[],c=YO.width(),u=Gn?Number(parseFloat(YO.height()).toFixed(2)):qi,p=document.createElement("canvas");p.height=u*o,p.width=c*l;const h=p.getContext("2d");if(h.clearRect(0,0,p.width,p.height),h.fillStyle="white",h.fillRect(0,0,p.width,p.height),h.fillStyle="black",Array.isArray(d)&&d.length>0){if("radio-weave"==Yn?d.forEach((e,t)=>{e.forEach(e=>{h.fillRect(t*c,(o-e)*u,c,u)})}):"radio-color"==Yn&&d.forEach((i,a)=>{let l=Array.from({length:o},(e,t)=>t+1),s=c$.cells.find(t=>t.index==(a+n)%e);i.forEach((e,t)=>{s&&(h.fillStyle=Ld[s.color_code],h.fillRect(a*c,(o-e)*u,c,u)),l=l.filter(t=>t!=e)}),l.forEach(e=>{let n=d$.cells.find(n=>{let i=(e+r-1)%t;return n.index==t-(0==i?t:i)});n&&(h.fillStyle=$s[n.color_code],h.fillRect(a*c,(o-e)*u,c,u))})}),"radio-interlacement"!=Yn)if(Oi==si){for(let e=0;e<l+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.lineWidth=(e+n)%$n==0?1.5:.5,h.stroke(),h.closePath();for(let e=0;e<o+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.lineWidth=(o-e+r-1)%jn==0?1.5:.5,h.stroke(),h.closePath()}else if(Oi==di){h.lineWidth=.5;for(let e=0;e<l+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.stroke(),h.closePath();for(let e=0;e<o+1;e++)h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.stroke(),h.closePath()}else if(Oi==ci){h.lineWidth=1.5;for(let e=0;e<l+1;e++)(e+n)%$n==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.stroke(),h.closePath());for(let e=0;e<o+1;e++)(o-e+r-1)%jn==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.stroke(),h.closePath())}else{h.lineWidth=1.5;for(let e=0;e<l+1;e+=l)e%$n==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(e*c,0),h.lineTo(e*c,o*u),h.stroke(),h.closePath());for(let e=0;e<o+1;e+=o)e%jn==0&&(h.beginPath(),h.strokeStyle="grey",h.moveTo(0,e*u),h.lineTo(l*c,e*u),h.stroke(),h.closePath())}h.closePath(),oN.width=p.width,oN.height=p.height,sN.drawImage(p,0,0)}},DN=e=>{o_(n_.NONE),0==e.button&&(Vi(!0),FN(e))},ON=e=>{Vi(!1),IN=null},$N=e=>{wN.style.display=e?"list-item":"none"},jN=e=>{document.getElementById("mainContextMenu").style.display="none";let t=YO.check_no_of_shaft_needed_for_temp_cells();t>GO.rows()?confirm("Want To InCrease Shafts value to "+t)?(YO.calculate_draft_peg_plan_from_temp_data(GO,KO,QO),Jw(),WT(),iE(),PN()):MN():(YO.calculate_draft_peg_plan_from_temp_data(GO,KO,QO),Jw(),WT(),iE(),PN())},WN=e=>{$i&&NN==Ei&&FN(e),RN(sr,e)},HN=()=>{RN(ar)},qN=()=>{Oh(sr)},UN=()=>{BN(23,18),oN.addEventListener("mousedown",DN),oN.addEventListener("mouseup",ON),oN.addEventListener("mousemove",WN),oN.addEventListener("mouseleave",HN),yN.addEventListener("scroll",AN),(()=>{const e=document.getElementById("mcInsert-warp-trigger"),t=document.getElementById("mcInsert-weft-trigger"),n=document.getElementById("mcInsert-warp-modal"),i=document.getElementById("mcInsert-weft-modal"),r=(document.querySelectorAll(".close-button"),document.querySelectorAll(".btn-cancel"));ow(e,n,0,r,"Insert Warp"),ow(t,i,0,r,"Insert Weft"),ow(pN,qb,0,r,"Edit File")})(),wN.addEventListener("click",jN),pN.addEventListener("click",qN)},zN=e=>{if("radio-color"==Yn)return void YN();if("radio-interlacement"==Yn)return void GN();if(!Mn)return void(e=>{YO.cols();const t=YO.rows(),n=1*YO.width(),i=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,r=Dn,a=On;if(Array.isArray(e))for(let l=0;l<e.length;l++){sN.clearRect(e[l]*n,0,n,oN.height),sN.fillStyle="white",sN.fillRect(e[l]*n,0,n,oN.height);const o=new Uint32Array(I$.memory.buffer,YO.get_col_new_cell(e[l]),YO.get_col_new_cell_length(e[l]));sN.fillStyle="black",o.forEach(r=>{sN.fillRect(e[l]*n,(t-r)*i,n,i)});for(let o=0;o<t+1;o++)sN.beginPath(),sN.strokeStyle="grey",sN.moveTo(r+e[l]*n,a+o*i),sN.lineTo(r+e[l]*n+n,a+o*i),sN.lineWidth=(t-o)%jn==0?1.5:.5,sN.stroke(),sN.closePath();for(let o=0;o<2;o++)sN.beginPath(),sN.strokeStyle="grey",sN.moveTo(r+e[l]*n+o*n,a),sN.lineTo(r+e[l]*n+o*n,a+t*i),sN.lineWidth=(e[l]+o)%$n==0?1.5:.5,sN.stroke(),sN.closePath()}vN.style.width=oN.width+"px",xN.style.height=oN.height+"px"})(e);const t=YO.cols(),n=YO.rows(),i=1*YO.width(),r=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,a=Dn,l=On,o=document.createElement("canvas"),s=o.getContext("2d");o.width=Math.ceil(t*i),o.height=Math.ceil(n*r);const d=sN.getImageData(0,oN.height-o.height,o.width,o.height);if(s.putImageData(d,0,0),Array.isArray(e))for(let t=0;t<e.length;t++){s.clearRect(e[t]*i,0,i,o.height),s.fillStyle="white",s.fillRect(e[t]*i,0,i,o.height);for(let o=0;o<n+1;o++)s.beginPath(),s.strokeStyle="grey",s.moveTo(a+e[t]*i,l+o*r),s.lineTo(a+e[t]*i+i,l+o*r),s.lineWidth=(n-o)%jn==0?1.5:.5,s.stroke(),s.closePath();for(let o=0;o<2;o++)s.beginPath(),s.strokeStyle="grey",s.moveTo(a+e[t]*i+o*i,l),s.lineTo(a+e[t]*i+o*i,l+n*r),s.lineWidth=(e[t]+o)%$n==0?1.5:.5,s.stroke(),s.closePath();const d=new Uint32Array(I$.memory.buffer,YO.get_col_new_cell(e[t]),YO.get_col_new_cell_length(e[t]));s.fillStyle="black",d.forEach(a=>{s.fillRect(e[t]*i,(n-a)*r,i,r)})}if(Mn){oN.width=o.width*zn,oN.height=o.height*Vn;const e=sN.createPattern(o,"repeat");sN.rect(0,0,oN.width,oN.height),sN.fillStyle=e,sN.fill()}else oN.width=o.width,oN.height=o.height,sN.drawImage(o,0,0);vN.style.width=oN.width+"px",xN.style.height=oN.height+"px"},VN=()=>{if("radio-color"==Yn)return void YN();if("radio-interlacement"==Yn)return void GN();const e=YO.cols(),t=YO.rows(),n=1*YO.width(),i=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,r=Dn,a=On,l=document.createElement("canvas");if(l.width=Math.ceil(e*n),l.height=Math.ceil(t*i),0==l.height||0==l.width)return;const o=l.getContext("2d");if(o.clearRect(0,0,l.width,l.height),o.fillStyle="white",o.fillRect(0,0,l.width,l.height),o.fillStyle="black",sN.clearRect(0,0,oN.width,oN.height),Oi==si){for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.lineWidth=l%$n==0?1.5:.5,o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.lineWidth=(t-l)%jn==0?1.5:.5,o.stroke(),o.closePath()}else if(Oi==di){o.lineWidth=.5;for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.stroke(),o.closePath()}else if(Oi==ci){o.lineWidth=1.5;for(let l=0;l<e+1;l++)l%$n==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.stroke(),o.closePath());for(let l=0;l<t+1;l++)(t-l)%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.stroke(),o.closePath())}else{o.lineWidth=1.5;for(let l=0;l<e+1;l+=e)l%$n==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r+l*n,a),o.lineTo(r+l*n,a+t*i),o.stroke(),o.closePath());for(let l=0;l<t+1;l+=t)l%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(r,a+l*i),o.lineTo(r+e*n,a+l*i),o.stroke(),o.closePath())}for(let r=0;r<e;r++){new Uint32Array(I$.memory.buffer,YO.get_col_new_cell(r),YO.get_col_new_cell_length(r)).forEach(e=>{o.fillRect(r*n,(t-e)*i,n,i)})}if(o.closePath(),Mn){oN.width=l.width*zn,oN.height=l.height*Vn;const e=sN.createPattern(l,"repeat");sN.rect(0,0,oN.width,oN.height),sN.fillStyle=e,sN.fill()}else oN.width=l.width,oN.height=l.height,sN.drawImage(l,0,0);vN.style.width=oN.width+"px",xN.style.height=oN.height+"px"},YN=()=>{const e=YO.cols(),t=YO.rows(),n=1*YO.width(),i=Dn,r=On,a=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,l=document.createElement("canvas"),o=l.getContext("2d");l.width=Math.ceil(e*n),l.height=Math.ceil(t*a),o.clearRect(0,0,l.width,l.height),o.fillStyle="white",o.fillRect(0,0,l.width,l.height),o.fillStyle="black";let s=[];for(let n=0;n<e*t;n++)s.push(n);l$.cells,o$.cells;for(let i=0;i<e;i++){let e=new Uint32Array(I$.memory.buffer,YO.get_col_new_cell(i),YO.get_col_new_cell_length(i)),r=Array.from({length:t},(e,t)=>t+1);e.forEach(e=>{let l=c$.cells.find(e=>e.index==i);l&&(o.fillStyle=Ld[l.color_code],o.fillRect(i*n,(t-e)*a,n,a)),r=r.filter(t=>t!=e)}),r.forEach(e=>{let r=d$.cells.find(n=>n.index==t-e);r&&(o.fillStyle=$s[r.color_code],o.fillRect(i*n,(t-e)*a,n,a))})}if(Oi==si){for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(i+l*n,r),o.lineTo(i+l*n,r+t*a),o.lineWidth=l%$n==0?1.5:.5,o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(i,r+l*a),o.lineTo(i+e*n,r+l*a),o.lineWidth=(t-l)%jn==0?1.5:.5,o.stroke(),o.closePath()}else if(Oi==di){o.lineWidth=.5;for(let l=0;l<e+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(i+l*n,r),o.lineTo(i+l*n,r+t*a),o.stroke(),o.closePath();for(let l=0;l<t+1;l++)o.beginPath(),o.strokeStyle="grey",o.moveTo(i,r+l*a),o.lineTo(i+e*n,r+l*a),o.stroke(),o.closePath()}else if(Oi==ci){o.lineWidth=1.5;for(let l=0;l<e+1;l++)l%$n==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(i+l*n,r),o.lineTo(i+l*n,r+t*a),o.stroke(),o.closePath());for(let l=0;l<t+1;l++)l%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(i,r+l*a),o.lineTo(i+e*n,r+l*a),o.stroke(),o.closePath())}else{o.lineWidth=1.5;for(let l=0;l<e+1;l+=e)l%$n==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(i+l*n,r),o.lineTo(i+l*n,r+t*a),o.stroke(),o.closePath());for(let l=0;l<t+1;l+=t)(t-l)%jn==0&&(o.beginPath(),o.strokeStyle="grey",o.moveTo(i,r+l*a),o.lineTo(i+e*n,r+l*a),o.stroke(),o.closePath())}if(Mn){oN.width=l.width*zn,oN.height=l.height*Vn;const e=sN.createPattern(l,"repeat");sN.rect(0,0,oN.width,oN.height),sN.fillStyle=e,sN.fill()}else oN.width=l.width,oN.height=l.height,sN.drawImage(l,0,0);vN.style.width=oN.width+"px",xN.style.height=oN.height+"px"},GN=()=>{const e=YO.cols(),t=YO.rows(),n=1*YO.width(),i=Gn?Number(parseFloat(1*YO.height()).toFixed(2)):qi,r=document.createElement("canvas"),a=r.getContext("2d");r.width=Math.ceil(e*n),r.height=Math.ceil(t*i),a.clearRect(0,0,r.width,r.height),a.fillStyle="white",a.fillRect(0,0,r.width,r.height),a.fillStyle="black";for(let r=0;r<e;r++){let e=new Uint32Array(I$.memory.buffer,YO.get_col_new_cell(r),YO.get_col_new_cell_length(r)),l=Array.from({length:t},(e,t)=>t+1);e.forEach(e=>{let o=c$.cells.find(e=>e.index==r),s=d$.cells.find(n=>n.index==t-e);o&&(a.fillStyle=Ld[o.color_code],a.fillRect(r*n+1+1,(t-e)*i,n-4,i)),s&&(a.fillStyle=$s[s.color_code],a.fillRect(r*n,(t-e)*i+1+1,1,i-4),a.fillRect(r*n+n-1,(t-e)*i+1+1,1,i-4),a.fillStyle="black",a.fillRect(r*n+1,(t-e)*i,1,i),a.fillRect(r*n+n-2,(t-e)*i,1,i),a.fillRect(r*n,(t-e)*i+1,1,1),a.fillRect(r*n+n-1,(t-e)*i+1,1,1),a.fillRect(r*n,(t-e)*i+i-2,1,1),a.fillRect(r*n+n-1,(t-e)*i+i-2,1,1)),l=l.filter(t=>t!=e)}),l.forEach(e=>{let l=d$.cells.find(n=>n.index==t-e),o=c$.cells.find(e=>e.index==r%c$.size);l&&(a.fillStyle=$s[l.color_code],a.fillRect(r*n,(t-e)*i+2,n,i-4)),o&&(a.fillStyle=Ld[o.color_code],a.fillRect(r*n+1+1,(t-e)*i,n-4,2),a.fillRect(r*n+1+1,(t-e)*i+i-1,n-4,2),a.fillStyle="black",a.fillRect(r*n,(t-e)*i+1,n,1),a.fillRect(r*n,(t-e)*i+i-2,n,1),a.fillRect(r*n+1,(t-e)*i,1,1),a.fillRect(r*n+n-2,(t-e)*i,1,1),a.fillRect(r*n+1,(t-e)*i+i-2,1,2),a.fillRect(r*n+n-2,(t-e)*i+i-2,1,2))})}if(Mn){oN.width=r.width*zn,oN.height=r.height*Vn;const e=sN.createPattern(r,"repeat");sN.rect(0,0,oN.width,oN.height),sN.fillStyle=e,sN.fill()}else oN.width=r.width,oN.height=r.height,sN.drawImage(r,0,0);vN.style.width=oN.width+"px",xN.style.height=oN.height+"px"},JN=document.getElementById("first-beam-canvas-container"),XN=document.getElementById("first-beam-canvas"),KN=XN.getContext("2d"),ZN=()=>{rC()},QN=()=>p$.is_different_beam_used(),eC=e=>{const t=XN.getBoundingClientRect(),n=p$.cell_size(),i=p$.cols(),r=p$.rows(),a=(e.clientX-t.left)%(i*n),l=e.clientY-t.top,o=Hn.startColumn+parseInt(a/n),s=r-parseInt(l/n)-1;p$.click_on_cell_new(s,o%i,YO,KO),aC()},tC=e=>{Vi(!1)},nC=e=>{RN(mr),$i&&eC(e)},iC=e=>{Vi(!0),eC(e)},rC=()=>{const e=p$.cols(),t=p$.rows(),n=p$.cell_size(),i=Dn,r=On,a=document.createElement("canvas");a.width=e*n,a.height=t*n;const l=a.getContext("2d");l.fillStyle="white",l.fillRect(0,0,a.width,a.height),l.fillStyle="black",KN.clearRect(0,0,XN.width,XN.height),l.lineWidth=.5;for(let a=0;a<e+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i+a*n,r),l.lineTo(i+a*n,r+t*n),l.stroke(),l.closePath();for(let a=0;a<t+1;a++)l.beginPath(),l.strokeStyle="grey",l.moveTo(i,r+a*n),l.lineTo(i+e*n,r+a*n),l.stroke(),l.closePath();const o=new Uint32Array(I$.memory.buffer,p$.cells(),p$.selected_beamgrid_length());if(l.beginPath(),o.forEach((e,i)=>{l.fillRect(i*n,(t-e)*n,n,n)}),l.closePath(),Mn){XN.height=a.height,XN.width=a.width*zn;const e=KN.createPattern(a,"repeat");KN.rect(0,0,XN.width,XN.height),KN.fillStyle=e,KN.fill()}else XN.height=a.height,XN.width=a.width,KN.drawImage(a,0,0);JN.style.height=XN.height+1+"px"},aC=()=>{const e=p$.cols(),t=Hn.startColumn,n=Hn.endColumn,i=Mn?n-t+1:Math.min(n-t+1,e),r=p$.rows(),a=p$.cell_size(),l=document.createElement("canvas");l.width=i*a,l.height=r*a;const o=l.getContext("2d");o.fillStyle="white",o.fillRect(0,0,l.width,l.height),o.fillStyle="black";const s=p$.get_visible_cells(t,Mn?n:Math.min(n,e-1),Mn),d=rL(s)?JSON.parse(s):[];for(let e=0;e<i+1;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(e*a,0),o.lineTo(e*a,r*a),o.lineWidth=(e+t)%$n==0?1.5:.5,o.stroke(),o.closePath();for(let e=0;e<r+1;e++)o.beginPath(),o.strokeStyle="grey",o.moveTo(0,e*a),o.lineTo(i*a,e*a),o.stroke(),o.closePath();d.forEach((e,t)=>{o.fillRect(t*a,(r-e)*a,a,a)}),JN.style.height=l.height+1+"px",XN.height=l.height,XN.width=l.width,KN.drawImage(l,0,0)};function lC(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].length;return t}function oC(e,t){let n=e.filter(e=>e.Part==t),i=0;for(let e=0;e<n.length;e++)i+=n[e].draft.withInnerRepeat.length;return i}const sC=(e,t)=>{let n=String(e).includes("\n")?"\n":"<br>",i=e.split(n),r=String(i[0]).trim().split(","),a=String(i[1]).trim().split(","),l="";for(let e=1;e<=t;e++)r.includes(String(e))?l+=e+" ":l+="0 ",a.includes(String(e))?l+=t+e+" ":l+="0 ";return l=l.trim(),l},dC=e=>/[a-zA-Z]/.test(e);function cC(e,t){let n=0;for(let i=0;i<e.length;i++)e.charAt(i)===t&&n++;return n}const uC=()=>{let e={},t="",n=0;for(let e=0;e<=c$.getMaximumIndex();e++){let i=c$.findElementFromIndex(e);i?(n>0&&(t+=n.toString()+"\n"),t+=i.color_code+"\n",n=0):n++}String(t).split("\n").forEach(t=>{if(dC(t)){let n=GC(t).trim(),i=isNaN(parseInt(t))?1:parseInt(t);e[n]?e[n]+=i:e[n]=i}});const i=Object.keys(e);i.sort();const r={};for(const t of i)r[t]=e[t];return r},pC=(e,t=!1)=>{let n=String(e).split("\n").filter(e=>e.length>0).join("\n"),i=[],r="";for(let e=0;e<n.length;e++){let a=0,l=e;if("["==n[e]){if(r.length>0){let e={repeatedPart:r.trim(),...t&&{innerRepeat:1},...!t&&{outerRepeat:1}};i.push(e),r=""}for(a++,l=e+1;0!=a;)if("["==n[l]?(a++,2==a&&(r+=n[l])):"]"==n[l]?(2==a&&(r+=n[l]),a--):r+=n[l],l++,0==a&&r.length>0){let e=0,a=l+1;for(;!("\n"==n[a]&&0!=e||(e++,a++,a>n.length)););let o={repeatedPart:r.trim(),...t&&{innerRepeat:Number(n.slice(l+1,l+e+1))},...!t&&{outerRepeat:Number(n.slice(l+1,l+e+1))}};i.push(o),r="",l+=e}}else if(e-1>=0&&r.trim().length>0&&"\n"!=n[e]&&CC(n,e)){let a={repeatedPart:r.trim(),...t&&{innerRepeat:1},...!t&&{outerRepeat:1}};i.push(a),r=n[e]}else r+=n[e];e=l}if(r.length>0){let e={repeatedPart:r.trim(),...t&&{innerRepeat:1},...!t&&{outerRepeat:1}};i.push(e)}return i=i.filter(e=>e.repeatedPart.length>0),i},hC=e=>String(e).trim().split(/<br>|\s+/).filter(e=>"#"!=e).length;const gC=e=>{let t=XC(e),n=0;return String(t).split("\n").forEach((e,t)=>{e.split(" ").forEach((e,t)=>{e.trim().length>0&&(n+=e.length>1?parseInt(e):1)})}),n},mC=e=>{let t=String(e).split("X");if(1==t.length)return{repeat:1,currentPart:e};let n=t.slice(0,-1).join("X").slice(1,-1);return{repeat:parseInt(t.at(-1)),currentPart:n}};const fC=e=>{let t={},n=mC(e);if(function(e){let t=0,n=0;for(let i of e)if("["===i)n++,t=Math.max(t,n);else if("]"===i&&(n--,n<0))throw new Error("Invalid string: mismatched brackets.");if(0!==n)throw new Error("Invalid string: mismatched brackets.");return t}(e)<2)t={innerParts:[{currentPart:n.currentPart,innerRepeat:n.repeat}],outerRepeat:1};else{let e=vC(n.currentPart),i=[];e.forEach(e=>{let t=mC(e);i.push({currentPart:t.currentPart,innerRepeat:t.repeat})}),t={innerParts:i,outerRepeat:n.repeat}}return t},yC=e=>{let t=[],n=vC(e);return Array.isArray(n)&&n.forEach(e=>{t.push(fC(e))}),t},vC=e=>{let t=[],n=0,i=0,r="";for(let a=0;a<e.length;a++)if(i>0&&i--,"["==e[a]){for(r+=e[a],n++,a++;0!=n;)if("["==e[a]?(r+=e[a],n++,a++):"]"==e[a]?(r+=e[a],n--,a++):(r+=e[a],a++),0==n){for(;"\n"!=e[a];)if(r+=e[a],a++,a==e.length-1){r+=e[a];break}t.push(r),r=""}}else r+=e[a],"["!=e[a+1]&&a+1!=e.length||(t.push(r),r="");return t},bC=(e,t,n)=>{let i="",r="",a=t;for(let r=a;r<t+n;r++)i+=e[r]+"\n";a+=n;for(let t=a;t<a+n;t++)r+=e[t]+"\n";return i.trim()==r.trim()},wC=(e,t)=>{let n=[];if("#"==String(e&&e.repeatedPart).trim())return[e];if(!t)return n;let i=_C(t,hC(XC(e.repeatedPart))),r=(e=>{let t=[1],n=[],i=[];if(Array.isArray(e)){if(e.length<2)return t;let r=1;for(;r!=parseInt(e.length/2);){let t=kC(e,r);i.push(t);for(let e=0;e<t.length;e++)if(t[e]==t[e+1]){n.push(r);break}r++}let a=[];for(let t=0;t<n.length;t++)e.length%n[t]==0&&a.push(n[t]);if(a.length>0)return a}return t})(i),a=[];for(let t=0;t<r.length;t++){let n=[];for(let a=0;a<e.outerRepeat;a++){let l=a,o=1;for(;bC(i,l,r[t]);)o++,l+=r[t];if(a==l)n.push({repeatedPart:e.repeatedPart,outerRepeat:o});else{let i="";for(let n=0;n<r[t];n++)i+=e.repeatedPart+"\n";i=i.trim(),n.push({repeatedPart:i,outerRepeat:o}),a=l+r[t]-1}}a.push({repeatationTocheck:r[t],tempOutputObject:n})}let l=a.map(e=>JSON.stringify(e.tempOutputObject).length);return n=[...a[(e=>{if(0===e.length)return-1;let t=0;for(let n=1;n<e.length;n++)e[n]<e[t]&&(t=n);return t})(l)].tempOutputObject],n},EC=e=>{let t=String(e),n=LC(t.trimEnd());n=n.filter(e=>e.repeatedPart.length>0);let i=String(qC(!0)).split("\n"),r=0,a=[];for(let e=0;e<n.length;e++){let t=hC(XC(n[e].repeatedPart))*n[e].outerRepeat,l=wC(n[e],i.slice(r,r+t).join("\n"));r+=t,a=[...a,...l]}n=a;let l=0,o=QN();const s=new Uint32Array(I$.memory.buffer,p$.get_different_beam_cell_indexes(),p$.get_different_beam_cell_length());return n.forEach(e=>{e.withInnerRepeat=pC(e.repeatedPart,!0);let t=0;if(Array.isArray(e.withInnerRepeat)){let n=e.withInnerRepeat;if(n.forEach(e=>{t+=hC(e.repeatedPart.split(" ").filter(e=>!dC(e)).join(" "))*e.innerRepeat}),t*=e.outerRepeat,o){let n=i.slice(l,l+t),r=s.filter(e=>e>=l&&e<l+t).map(e=>e-l),a=[],o=[];a=((e,t)=>{let n=[];for(let i=0;i<e.length;i++)t.includes(i)||n.push(e[i]);return n})(n,r),r.forEach(e=>{o.push(n[e])}),e.pattern=a.join("\n"),o.length>0?e.topbeam=o.join("\n"):e.topbeam=""}else e.pattern=i.slice(l,l+t).join("\n");let r=e.pattern.split("\n"),a=0;n.forEach(e=>{let t=XC(e.repeatedPart),n=hC(t)*e.innerRepeat,i=eL(t);e.ends=n,e.dent=i*e.innerRepeat;let l=r.slice(a,a+n).join("\n");e.pattern=jC(l,e.ends,e.dent,e.repeatedPart),a+=n;let o=pC(E$(e.repeatedPart));1==o.length&&(e.repeatedPart=o[0].repeatedPart,e.innerRepeat=o[0].outerRepeat*e.innerRepeat)});let d=[];for(let e=0;e<n.length;e++){let t=n[e].ends/n[e].dent;if(Qy.unCompressDents.includes(t)){let i=e,r={repeatedPart:"",innerRepeat:0,ends:0,dent:0,pattern:""};for(;n[i].ends/n[i].dent==t;){for(let e=0;e<n[i].innerRepeat;e++)r.repeatedPart+=n[i].repeatedPart.trim()+"\n";if(r.innerRepeat=1,r.dent+=n[i].dent,r.ends+=n[i].ends,r.pattern+=n[i].pattern.trim()+"\n",i++,i==n.length)break}if(r.repeatedPart.length>0){r.pattern=XC(r.pattern);let e="";String(r.pattern).split("\n").filter(e=>e.length>0).forEach(t=>{t.split(" ").forEach(t=>{let n=isNaN(parseInt(t))?1:parseInt(t);for(let i=0;i<n;i++)e+=GC(t)+"\n"})}),r.pattern=jC(e.trim(),r.ends,r.dent,r.repeatedPart),d.push(r)}e=i-1}else d.push(n[e])}e.withInnerRepeat=[...d],e.ends=gC(e.pattern.trim()),e.dent=eL(XC(e.repeatedPart))*e.outerRepeat,l+=t}}),n=n.filter(e=>e.repeatedPart),n};const SC=(e,t=!1)=>{let n=String(e),i="";for(let e=0;e<n.length;e++)"X"!=n[e]&&dC(n[e])&&!/[0-9]/.test(n[e-1])?i+="1"+n[e]:i+=n[e];return t&&(i=i.replace(/(\d)([A-Za-z])/g,"$1-$2")),i=Qy.isVerticalPattern&&t?i.replace(/[\s\n]+/g,"<br>"):i,i};function xC(e){if(String(e).includes("[")||String(e).includes("]")||String(e).includes("X")||String(e).includes("*"))return e;e=e.replace(/\s+/g,"");let t=[],n=1;for(let i=0;i<e.length;i++)e[i]===e[i+1]?n++:(t.push(n+e[i]),n=1);return t.join(" ")}function IC(e,t){let n=1/0,i=-1/0;for(const e in t)if(t.hasOwnProperty(e)){const r=t[e];r<n&&(n=r),r>i&&(i=r)}if(e<n||e>i)throw new Error("Value out of range");return i==n?10:(e-n)/(i-n)*10}const kC=(e,t)=>{let n=[],i="",r=0;for(let a=0;a<e.length;a++)i+=e[a]+"\n",r++,r==t&&(n.push(i.trim()),i="",r=0);return i.length>0&&n.push(i.trim()),n},_C=(e,t)=>{let n=[],i="",r=0,a=/^[a-zA-Z]+$/;for(let l=0;l<e.length;l++)i+=e[l],a.test(e[l])&&(r+=1),r==t&&(n.push(i.trim()),i="",r=0);return n},TC=(e,t)=>{let n=String(e),i=LC(n.trimEnd());i=i.filter(e=>e.repeatedPart.length>0);let r=XC(t),a="";String(r).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let n=0;n<t;n++)a+=GC(e)+"\n"})}),a=a.trim();let l=a.split("\n"),o=0;return i.forEach(e=>{e.withInnerRepeat=pC(e.repeatedPart,!0);let t=0;if(Array.isArray(e.withInnerRepeat)){e.withInnerRepeat.forEach(e=>{t+=hC(e.repeatedPart.split(" ").filter(e=>!dC(e)).join(" "))*e.innerRepeat}),t*=e.outerRepeat,e.pattern=l.slice(o,o+t).join("\n"),e.ends=gC(e.pattern.trim()),e.dent=eL(XC(e.repeatedPart))*e.outerRepeat,o+=t}}),i=i.filter(e=>e.repeatedPart),i};function NC(e,t){var n=e.split("\n"),i=-1;for(let e=0;e<n.length;e++)if((i+=n[e].length+1)>=t)return e}const CC=(e,t)=>{let n=String(e),i=n.split("\n"),r=NC(n,t),a=t-1;for(;0!=a&&0==n[a].trim().length;)a--;if(0==a)return!1;let l=NC(n,a);return tL(i[r])!=tL(i[l])},LC=e=>{let t=String(e),n=[],i="";for(let e=0;e<t.length;e++){let r=0,a=e;if("["==t[e]){if(i.length>0){let e={repeatedPart:i.trim(),...!1,outerRepeat:1};n.push(e),i=""}for(r++,a=e+1;0!=r;)if("["==t[a]?(r++,2==r&&(i+=t[a])):"]"==t[a]?(2==r&&(i+=t[a]),r--):i+=t[a],a++,0==r&&i.length>0){let e=1;for(;!["[","]"," ","\n"].includes(t[a+e])&&t[a+e];)e++;let r=t.slice(a+1,a+e),l={repeatedPart:i.trim(),...!1,outerRepeat:Number(r)};n.push(l),i="",a=a+e-1}}else if(e-1>=0&&i.trim().length>0&&"\n"!=t[e]&&CC(t,e)){let r={repeatedPart:i.trim(),...!1,outerRepeat:1};n.push(r),i=t[e]}else i+=t[e];e=a}if(i.length>0){let e={repeatedPart:i.trim(),...!1,outerRepeat:1};n.push(e)}return n},AC=()=>{let e={},t="",n=0;for(let e=d$.size-1;e>=d$.getMinimumIndex();e--){let i=d$.findElementFromIndex(e);i?(n>0&&(t+=n.toString()+"\n"),t+=i.color_code+"\n",n=0):n++}String(t).split("\n").forEach(t=>{if(dC(t)){let n=GC(t).trim(),i=isNaN(parseInt(t))?1:parseInt(t);e[n]?e[n]+=i:e[n]=i}});const i=Object.keys(e);i.sort();const r={};for(const t of i)r[t]=e[t];return r},PC=e=>{let t={},n="";return String(XC(e)).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let i=0;i<t;i++)n+=e.slice(-1)+"\n"})}),String(n).split("\n").forEach(e=>{if(dC(e)){let n=GC(e).trim(),i=isNaN(parseInt(e))?1:parseInt(e);t[n]?t[n]+=i:t[n]=i}}),t},BC=()=>{if(Object.keys(Mg).length>0){let e={};return Object.keys(Mg).forEach(t=>{let n=String(Mg[t]).split("/").map(e=>Number(hi.start)+Number(e)-1).join("/");e[t]=n}),e}},RC=()=>{if(Object.keys(Mg).length>0){let e={};return Object.keys(Mg).forEach(t=>{e[t]=String(Mg[t]).split("/").map(e=>Number(e)+Number(hi.start)-1).join("/")}),e}},FC=()=>{if(Object.keys(Mg).length>0){let e={};return Object.keys(Mg).forEach(t=>{e[t]=Number(hi.start)+Number(String(Mg[t])[0])-1}),e}{let e={},t="",n=0;for(let e=d$.size-1;e>=d$.getMinimumIndex();e--){let i=d$.findElementFromIndex(e);i?(n>0&&(t+=n.toString()+"\n"),t+=i.color_code+"\n",n=0):n++}String(t).split("\n").forEach(t=>{if(dC(t)){let n=GC(t).trim(),i=isNaN(parseInt(t))?1:parseInt(t);e[n]?e[n]+=i:e[n]=i}});let i={};const r=Object.entries(e).sort((e,t)=>t[1]-e[1]),a=Object.fromEntries(r);return Object.keys(a).forEach(e=>{i[e]=Object.values(i).at(-1)?Object.values(i).at(-1)+1:hi.start}),i}};const MC=e=>{let t=String(e),n=[];for(let e=0;e<t.length;e++)t[e].replace(/[^a-zA-Z]+/g,"")&&t[e].replace(/[^a-zA-Z]+/g,"")[0]&&n.push(t[e].replace(/[^a-zA-Z]+/g,"")[0]);return n=[...new Set([...n])],n=n.filter(e=>"X"!=e).sort(),n},DC=(e,t)=>{let n="",i="",r=1,a=XC(e);String(a).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let i=0;i<t;i++)n+=GC(e)+"\n",r++})}),r=1;let l=XC(t);return String(l).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let n=0;n<t;n++)i+=GC(e)+"\n",r++})}),n.trim()==i.trim()},OC=e=>{if(Array.isArray(e)&&e.length>0){if(1==e.length)return String(e[0]).trim();let t=e[0].trim();if(1==MC(t).length)return"";for(let n=1;n<e.length;n++){if(e[n].trim()!=t)return"";if(n+1==e.length){let n=w$(t);return`[${String(n).replace(/\n/g," ")}]X${e.length}`}}return""}return""};function $C(e,t){if(0==String(e).trim().length)return[];const n=e.trim().split("\n");let i=[];for(let e=0;e<n.length;e+=t)i.push(n.slice(e,e+t).join("\n"));return i}const jC=(e,t,n,i)=>{if(t%n!=0){let n="",r=e.trim().split("\n"),a=function(e){const t=e.trim().split("\n").map(e=>e.trim());let n=[],i=[],r=t[0].split(" ").length;for(let e of t){let t=e.split(" ").length;t===r?i.push(e):(n.push(i.join("\n")),i=[e],r=t)}return i.length&&n.push(i.join("\n")),n}(String(i).trim()),l=0,o=[];for(let e=0;e<a.length;e++){let t=tL(a[e]),n=r.slice(l,l+t);o.push(n.join("\n")),l+=t}let s=$C(e,l);if(OC(s).trim().length>0){let e=t/l;return o.forEach((e,t)=>{let i=(e=>{const t=lC(String(e).split("\n").filter(e=>e.length>0&&"#"!=e.trim()).map(e=>e.split(" ").filter(e=>e))),n=String(e).split("\n").filter(e=>e.length>0).length;return t%t==0?t/n:0})(a[t]);if(i){let t=$C(e,i);OC(t)&&t[0]?n+=`[${String(t[0]).replace(/\n/g," ")}]X${t.length}\n`:n+=y$(e)+"\n"}else n+=y$(e)+"\n"}),`[${n.trim()}]X${e}`}return y$(String(e).replace(/\n/g," "))}let r=t/n,a=function(e){let t=e.map(e=>e.replaceAll("\n"," "));if(Array.isArray(t)&&1==t.length)return t[0];let n=[],i=0;for(;i<t.length;){let e=!1;for(let r=1;r<=(t.length-i)/2;r++){let a=t.slice(i,i+r).join("\n"),l=1;for(;t.slice(i+l*r,i+(l+1)*r).join("\n")===a;)l++;if(l>1){n.push(`[${xC(a)}]X${l}`),i+=l*r,e=!0;break}}e||(n.push(y$(String(t[i]).split(" ").join("\n"))),i++)}return n.join("\n")}($C(e,r)),l="",o=0,s=[],d=0,c="";for(;e[o];)c+=e[o],e[o].trim().length>0&&d++,d==r&&(s.push(c),c="",d=0),o++;c.trim().length>0&&s.push(c),s=s.filter(e=>e.trim().length>0);let u=OC(s);if(u.length>0)l=u;else{let t=y$(e);l=y$(t)}return 1==MC(l).length?w$(l):a};const WC=()=>{let e=document.getElementById("loom-type"),t=Boolean("rapier-manual-dobby"==e.value),n=[],i=KO.get_new_print_pegplan_data(Qy.isInvertDesign),r=String(i).trim().split("\n");if(Qy.pegplanViewType==yi.WATERJETLETIS)for(let e=0;e<r.length;e+=2)n.push({no:String(e+1)+(r[e+1]?"-"+String(e+2):""),pegplan:r.slice(e,e+2).map(e=>e.replace(/\s+/g,",")).join("\n")});else if(Qy.isTwoPickLetisEnabled)for(let e=0;e<r.length;e+=2)n.push({no:String(Math.ceil(n.length+1)),pegplan:r.slice(e,e+2).map(e=>e.replace(/\s+/g,",")).join("\n")});else for(let e=0;e<r.length;e+=1)n.push({no:String(n.length+1),pegplan:r[e].replace(/\s+/g,",")});if(t&&hi.start&&hi.end&&gi.start&&gi.end&&Qy.pegplanViewType!=yi.WATERJETLETIS){let e=FC();n.forEach((t,n)=>{let i=t.pegplan.split("\n"),r=[];i.forEach((t,i)=>{let a=d$.findElementFromIndex(d$.size-(n*(Qy.isTwoPickLetisEnabled?2:1)+i)-1),l=l$.findElementFromIndex(d$.size-(n*(Qy.isTwoPickLetisEnabled?2:1)+i)-1);if(a){let n=t+""+(Qy.isWeftSelector?","+e[a.color_code]:"");l&&Qy.isCreaming&&(n+=","+gi.start),r.push(n)}else{let e=t+""+(Qy.isWeftSelector?","+hi.start:"");l&&Qy.isCreaming&&(e+=","+gi.start),r.push(e)}}),t.pegplan=r.join("\n")})}if(Qy.isUncompreesed)return n;let a=[],l=0;for(;l<n.length;){let e=Number(n[l].no),t=Number(n[l].no),i=!1;for(;l<n.length&&n[l+1]&&n[l].pegplan==n[l+1].pegplan;)i=!0,e++,l++;i?(a.push({no:`${t}-${e}`,pegplan:n[l].pegplan}),l++):(a.push({no:""+t,pegplan:n[l].pegplan}),l++)}return a},HC=()=>{let e=document.getElementById("loom-type"),t=Boolean("rapier-manual-dobby"==e.value),n=KO.get_new_print_pegplan_data(!1),i=String(n).split("\n").filter(e=>e),r=[...i];if(t&&hi.start&&hi.end&&gi.start&&gi.end){let e=FC(),t=[];i.forEach((n,i)=>{let r=d$.findElementFromIndex(d$.size-i-1),a=l$.findElementFromIndex(d$.size-i-1);if(r){let i=n+" "+e[r.color_code];a&&(i+=" "+gi.start),t.push(i)}else{let e=n+" "+hi.start;a&&(e+=" "+gi.start),t.push(e)}}),r=[...t]}return E$(r.join("\n"))},qC=(e=!1)=>{let t="",n=0;for(let e=0;e<=c$.getMaximumIndex();e++){let i=c$.findElementFromIndex(e);i?(n>0&&(t+=n.toString()+"\n"),t+=i.color_code+"\n",n=0):n++}if(e)return t;let i=y$(t);return SC(y$(i),!1).replace(/[\s]+/g,"\n")};const UC=(e=!1)=>{let t="",n=0;for(let e=d$.size-1;e>=d$.getMinimumIndex();e--){let i=d$.findElementFromIndex(e);i?(n>0&&(t+=n.toString()+"\n"),t+=i.color_code+"\n",n=0):n++}return e?SC(y$(t),!1).replace(/[\s]+/g,"\n"):SC(y$(y$(t)),!1).replace(/[\s]+/g,"\n")},zC=()=>{let e="",t=0;for(let n=d$.size-1;n>=d$.getMinimumIndex();n--){let i=d$.findElementFromIndex(n);i?(t>0&&(e+=t.toString()+"\n"),e+=i.color_code+"\n",t=0):t++}return e.trim()},VC=e=>String(e).split("\n").map(e=>e.split(" ").map(e=>e.padStart(2," ")).join(" ")).join("\n");const YC=()=>{let e=[],t=GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1),n=Math.floor(GO.cols()/Number(ch.value)),i=Ec.draftPlan,r=Sc.draftPlan;{let t=fC(i),n=t&&t.innerParts&&t.innerParts[0]&&t.innerParts[0].currentPart?t.innerParts[0].currentPart:null,r=t&&t.innerParts&&t.innerParts[0]&&t.innerParts[0].innerRepeat?t.innerParts[0].innerRepeat:0;e.push({draft:{outerRepeat:t.outerRepeat,pattern:String(yc.value),dent:Number(Xp.value),ends:Number(Nr.value),withInnerRepeat:[{repeatedPart:n||i,innerRepeat:r||1,pattern:String(yc.value),dent:Number(Xp.value),ends:Number(Nr.value)}]},dent:Xp.value,tar:Nr.value,pattern:"Pattern",Part:"Left Selvedge"})}let a=EC(t);if(Array.isArray(a)){let t=ZO.total_dent_value();a.forEach(i=>{e.push({draft:i,dent:String((Qy.isFullReedSpaceVisible?n:1)*t),tar:GO.cols(),pattern:"Pattern",topbeam:"TopBeam",Part:"Body"})})}{let t=fC(r),n=t&&t.innerParts&&t.innerParts[0]&&t.innerParts[0].currentPart?t.innerParts[0].currentPart:null,i=t&&t.innerParts&&t.innerParts[0]&&t.innerParts[0].innerRepeat?t.innerParts[0].innerRepeat:0;e.push({draft:{outerRepeat:1,pattern:String(vc.value),dent:Number(Zp.value),ends:Number(Jr.value),withInnerRepeat:[{repeatedPart:n||r,innerRepeat:i||1,pattern:String(vc.value),dent:Number(Zp.value),ends:Number(Jr.value)}]},dent:Zp.value,tar:Jr.value,pattern:"Pattern",Part:"Right Selvedge"})}return e},GC=e=>e.replace(/\d/g,"");function JC(e){return e.replace(/\D/g,"")}const XC=(e,t=!1)=>{let n="",i=1,r=0,a=0;if(cC(e,"[")!=cC(e,"]"))return n;for(let t=0;t<e.length;t++)if(r=0,a=0,"["===e[t]){if(r=1,!String(e).substring(t+1).includes("]"))break;{let l=t+1,o="";for(;a!=r;){if(l>e.length)return"";"["==e[l]?r++:"]"==e[l]&&a++,l++}l-=1,o=String(e).substring(t+1,l)+"\n",o.includes("[")&&o.includes("]")&&(o=XC(o)),l+=2;let s="";for(;"\n"!=String(e)[l]&&String(e)[l];)s+=String(e)[l],l++;i=Number(s);n+=o.repeat(i),t=l}}else n+=e[t];return t?n:n.replace(/(^[ \t]*\n)/gm,"")};const KC=e=>{let t=String(e),n="",i=0;for(;i<t.length;){if(dC(t[i])){n+=Ad[t[i]]&&Ad[t[i]].yarnName?Ad[t[i]].yarnName:t[i]}else n+=t[i];i++}return n},ZC=e=>{let t=String(e),n="",i=0;for(;i<t.length;){if(dC(t[i])){n+=Ad[t[i]]?Ad[t[i]].yarnName:t[i]}else n+=t[i];i++}return n},QC=e=>{let t=String(e),n="",i=0;for(;i<t.length;){if(dC(t[i])){n+=Ws[t[i]]?Ws[t[i]].yarnName:t[i]}else n+=t[i];i++}return n},eL=e=>String(e).split("\n").filter(e=>e.length>0).length,tL=e=>lC(String(e).split("\n").filter(e=>e.length>0&&"#"!=e.trim()).map(e=>e.split(" ").filter(e=>e))),nL=e=>{Toastify({text:e,gravity:"top",backgroundColor:"linear-gradient(to right, #ff4040, #ff7373)"}).showToast()},iL=e=>{Toastify({text:e,className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()},rL=e=>{try{JSON.parse(e);return!0}catch(e){return!1}};class aL{constructor(e,t){this.color_code=e,this.index=t}}var lL=class{constructor(e,t=!1,n=!1,i=!1,r=!1,a=!1){this.size=e,this.isWeftColor=t,this.isFunctionCanvas=n,this.isWarpColor=i,this.isWarpCreamingCanvas=r,this.isDencityCanvas=a,this.numericParts=[],this.compressSplitter=[],this.whileMoveColor="A",this.cells=n||r?[]:Array.apply(null,Array(e)).map((function(e,t){return new aL("A",t)})),this.fixNumericText="20A"}setFixNumericText(e){let t=SC(e,!1).trim();this.fixNumericText=t}setNumericParts(e){this.numericParts=String(e).trim().split("\n\n")}getVisibleCells(e,t,n=!1){if(this.isWarpColor){if(n){let n=this.size,i=[],r=this.cells.sort((e,t)=>e.index-t.index).map(e=>e.color_code);for(let a=e;a<=t;a++)i.push(r[a%n]);return i}return this.cells.filter(n=>e<=n.index&&t>=n.index).sort((e,t)=>e.index-t.index).map(e=>e.color_code)}if(this.isWarpCreamingCanvas){if(n){let n=this.size,i=[];for(let r=e;r<=t;r++){let e=parseInt(r/n),t=this.cells.find(e=>e.index==r%n);t&&i.push({...t,index:t.index+n*e})}return i}return this.cells.filter(n=>e<=n.index&&t>=n.index).sort((e,t)=>e.index-t.index)}if(this.isWeftColor){if(n){let n=this.size;const i=n-t%n,r=i+(t-e+1);let a=[],l=this.cells.sort((e,t)=>e.index-t.index).map(e=>e.color_code);for(let e=i;e<=r;e++)a.push(l[e%n]);return a}return this.cells.filter(n=>e<=this.size-n.index&&t>=this.size-n.index).sort((e,t)=>e.index-t.index).map(e=>e.color_code)}if(this.isFunctionCanvas||this.isDencityCanvas){if(n){let n=this.size;const i=n-(t%n==0?n:t%n),r=i+(t-e+1);let a=[];for(let e=i;e<=r;e++){let t=parseInt(e/n),i=this.cells.find(t=>t.index==e%n);i&&a.push({...i,index:i.index+n*t})}return a}return this.cells.filter(n=>e<=this.size-n.index&&t>=this.size-n.index)}return[]}get_index_from_color_code(e){return this.cells.filter(t=>e.includes(t.color_code)).map(e=>this.size-e.index-1)}set_all_value_from_string(e,t=!1){try{let n=JSON.parse(e);if(n)if(this.size=n.size,this.isWeftColor=n.isWeftColor,this.isFunctionCanvas=n.isFunctionCanvas,this.isWarpColor=n.isWarpColor,this.isWarpCreamingCanvas=n.isWarpCreamingCanvas,this.isDencityCanvas=t,t){let e=n.cells,t=[];for(let n=0;n<this.size;n++){let i=e.find(e=>e.index==n);i?t.push(new aL(i.color_code,n)):t.push(new aL("A",n))}this.cells=t}else this.cells=n.cells}catch(e){}}remove_cell(e){if(this.isWarpColor||this.isWarpCreamingCanvas){let t=[];for(let n=0;n<this.cells.length;n++){let i=this.cells[n];i.index!=e&&(i.index>e?t.push({...i,index:i.index-1}):t.push(i))}this.cells=t,this.size=this.size-1}if(this.isWeftColor||this.isFunctionCanvas||this.isDencityCanvas){let t=[];for(let n=0;n<this.cells.length;n++){let i=this.cells[n];i.index!=this.size-e-1&&(i.index>this.size-e-1?t.push({...i,index:i.index-1}):t.push(i))}this.cells=t,this.size=this.size-1}}add_cell(e){if(console.log("add_index",e,this),this.isWarpColor&&(this.cells=this.cells.map(t=>({...t,index:t.index>=e?t.index+1:t.index})),this.cells.push(new aL("A",e))),this.isWarpCreamingCanvas&&(this.cells=this.cells.map(t=>({...t,index:t.index>=e?t.index+1:t.index}))),this.isDencityCanvas){let t=this.size-e;this.cells=this.cells.map(e=>e.index>=t?{...e,index:e.index+1}:e),this.cells.splice(t,0,new aL("A",t))}this.isFunctionCanvas&&(this.cells=this.cells.map(t=>({...t,index:this.size-t.index-1<=e?t.index+1:t.index}))),this.isWeftColor&&(this.cells=this.cells.map(t=>({...t,index:this.size-t.index<=e?t.index+1:t.index})),this.cells.push(new aL("A",this.size-e))),this.size=this.size+1}update_size(e){let t=this.size;if(this.size=e,this.isFunctionCanvas&&(this.cells=this.cells.map(n=>({...n,index:e+n.index-t})),this.cells=this.cells.filter(e=>e.index>=0)),this.isWeftColor||this.isDencityCanvas){this.cells=this.cells.map(n=>({...n,index:e+n.index-t}));let i=[];for(var n=0;n<e;n++)i.push(new aL("A",n));this.cells.forEach(e=>{let t=i.findIndex(t=>t.index==e.index);-1!=t&&(i[t].color_code=e.color_code)}),this.cells=i}if(this.isWarpColor){if(t>e)this.cells=this.cells.filter(t=>t.index<e);else if(t<e)for(let n=t;n<e;n++)this.cells.push(new aL("A",n))}else if(!this.isFunctionCanvas&&!this.isWarpCreamingCanvas){let t=[];for(n=0;n<e;n++)t.push(new aL("A",n));this.cells.forEach(e=>{let n=t.findIndex(t=>t.index==e.index);-1!=n&&(t[n].color_code=e.color_code)}),this.cells=t}}update_cell_for_warp_weft(e,t){let n=this.cells.findIndex(t=>t.index==e);t&&(-1==n?this.cells.push(new aL(t,e)):this.cells[n].color_code==t?(this.cells[n].color_code="A",this.whileMoveColor="A"):(this.cells[n].color_code=t,this.whileMoveColor=t))}update_cell_for_warp_weft_on_move(e){let t=this.cells.findIndex(t=>t.index==e);this.cells[t].color_code=this.whileMoveColor}update_cell(e,t){let n=this.cells.findIndex(t=>t.index==e);t&&(-1==n?this.cells.push(new aL(t,e)):this.cells[n].color_code=t)}get_all_element_index_with_color_code(e){return this.cells.filter(t=>t.color_code==e).map(e=>e.index)}update_function_cell(e,t){let n=this.cells.findIndex(t=>t.index==e);t&&(-1==n?this.cells.push(new aL(t,e)):this.cells.splice(n,1))}add_function_cell(e,t){let n=this.cells.findIndex(t=>t.index==e);t&&(-1==n?this.cells.push(new aL(t,e)):this.cells[n].color_code=t)}remove_function_cell(e){let t=this.cells.findIndex(t=>t.index==e);-1!=t&&this.cells.splice(t,1)}findElementFromIndex(e){return this.cells.find(t=>t.index==e)}check_if_element_exist(e){if(this.isFunctionCanvas)return Boolean(this.cells.find(t=>t.index==e))}addCreamingOnMultipleIndex(e){if(Array.isArray(e)&&this.isFunctionCanvas)for(let t=0;t<e.length;t++)!this.cells.find(n=>n.index==e[t])&&e[t]<this.size&&e[t]>=0&&this.cells.push(new aL("A",e[t]))}addExtraWarpOnMultipleIndex(e){if(Array.isArray(e)&&this.isWarpCreamingCanvas)for(let t=0;t<e.length;t++)!this.cells.find(n=>n.index==e[t])&&e[t]<this.size&&e[t]>=0&&this.cells.push(new aL("A",e[t]))}removeCreamingOnMultipleIndex(e){if(Array.isArray(e)&&this.isFunctionCanvas)for(let t=0;t<e.length;t++)this.cells=this.cells.filter(n=>n.index!=e[t])}removeExtraWarpOnMultipleIndex(e){if(Array.isArray(e)&&this.isWarpCreamingCanvas)for(let t=0;t<e.length;t++)this.cells=this.cells.filter(n=>n.index!=e[t])}setDefaultDensityCells(){this.isDencityCanvas&&(this.cells=Array.apply(null,Array(this.size)).map((function(e,t){return new aL("A",t)})))}setDensityCellsAtMultipleIndexes(e,t){if(this.isDencityCanvas)for(let n=0;n<e.length;n++){let i=this.cells.find(t=>t.index==e[n]);i&&e[n]<this.size&&e[n]>=0&&(i.color_code=t)}console.log("dencity cells",this.cells),console.log("aa")}getMinimumIndex(){return Math.min(...this.cells.map(e=>e.index))}getMaximumIndex(){return Math.max(...this.cells.map(e=>e.index))}};const oL=document.getElementById("account-modal-trigger"),sL=document.getElementById("avatar-account-modal"),dL=document.getElementById("company-info-companyname"),cL=document.getElementById("company-info-companygst"),uL=document.getElementById("company-info-companyaddress"),pL=document.getElementById("company-info-state"),hL=document.getElementById("company-info-city"),gL=document.getElementById("company-info-postalcode"),mL=document.getElementById("company-info-subscriberid"),fL=document.getElementById("company-info-partnername"),yL=document.getElementById("company-info-partnermobileno"),vL=document.getElementById("profile-info-email"),bL=document.getElementById("profile-info-username"),wL=document.getElementById("profile-info-mobileno"),EL=document.getElementById("profile-info-licenseno"),SL=document.querySelector(".subscription-info-form");function xL(e){const{endDate:t}=e,n=e.planId.featuresList,i=e.planId.planName;let r=n.map(e=>`<li style="margin-bottom: 5px;">${e}</li>`).join(""),a="";(function(e){const t=moment();return moment(e,"YYYY-MM-DD").diff(t,"days")<=10})(t)&&(a='<button id="renewButton" style="padding: 8px 12px; background-color: #28a745; color: white; border: none; cursor: pointer; margin-top: 10px;">\n          Renew\n      </button>'),SL.innerHTML=`\n    <div>\n      <div style="border: 1px solid #ccc; padding: 15px; border-radius: 5px;width:350px;">\n          <h3 style="margin-bottom: 10px;">${i}</h3>\n          <ul style="list-style-type: none; padding: 0; margin: 0;">\n              ${r}\n          </ul>\n          <p style="margin-top: 10px; font-weight: bold;">Expires on: ${moment(t).format("MMMM Do, YYYY")}</p>\n          ${a}\n      </div>\n      </div>\n  `;const l=document.getElementById("renewButton");l&&l.addEventListener("click",(function(){alert("Renewing Plan: "+i)}))}const IL=()=>{(()=>{let e=JSON.parse(localStorage.getItem("company"));dL.value=e.companyName,cL.value=e.gstNo,uL.value=e.address,pL.value=e.city,hL.value=e.city,gL.value=e.pinCode,mL.value=e.companySubscriptionId,yL.value=e.referenceBy.phoneNo,fL.value=`${e.referenceBy.firstName} ${e.referenceBy.lastName}`;let t=JSON.parse(localStorage.getItem("user"));vL.value=t.email,bL.value=`${t.firstName} ${t.lastName}`,EL.value=t.subscriberCode,wL.value=t.mobileNo;let n=localStorage.getItem("activePlan"),i=JSON.parse(n);i?xL(i):SL.innerHTML="<div>No Plans Found.Please refresh and try again.</div>"})(),Uf(),sL.style.display="block",sL.style.animation="slide-down 0.3s ease"},kL=()=>{sL.style.display="none",Yi("")},_L=document.getElementById("fabric-calculation"),TL=document.getElementById("fabric-calculation-model");let NL=0;const CL=document.getElementById("yarn-cost-per-m"),LL=document.getElementById("sizing-rate"),AL=document.getElementById("sizing-cost-per-m"),PL=document.getElementById("wastage-rate"),BL=document.getElementById("wastage-cost-per-m"),RL=document.getElementById("freight-cost-per-m"),FL=document.getElementById("weaving-rate"),ML=document.getElementById("weaving-cost-per-m"),DL=document.getElementById("gray-cost-per-m"),OL=document.getElementById("processing-cost-per-m"),$L=document.getElementById("shrinckage-rate"),jL=document.getElementById("shrinckage-cost-per-m"),WL=document.getElementById("value-loss-rate"),HL=document.getElementById("value-loss-cost-per-m"),qL=document.getElementById("duty-rate"),UL=document.getElementById("duty-cost-per-m"),zL=document.getElementById("first-extra-rate"),VL=document.getElementById("first-extra-cost-per-m"),YL=document.getElementById("finish-cost-per-m"),GL=document.getElementById("profit-rate"),JL=document.getElementById("profit-cost-per-m"),XL=document.getElementById("second-extra-rate"),KL=document.getElementById("second-extra-cost-per-m"),ZL=document.getElementById("selling-cost-per-m"),QL=TL.querySelector("#model-apply"),eA=TL.querySelector("#model-ok"),tA=()=>{},nA=()=>{rA()},iA=()=>{NL=Number(lh.value),document.getElementById("ppi-text-element").innerText="PPI = "+NL,Uf(),NL>0&&(TL.style.display="block",TL.style.animation="slide-down 0.3s ease")},rA=()=>{TL.style.display="none"},aA=e=>{NL=Number(lh.value);e.target.value;"yarn-cost-per-m"==e.target.id?(AL.value=parseFloat(Number(LL.value)*Number(CL.value)/100).toFixed(2),BL.value=parseFloat(Number(PL.value)*Number(CL.value)/100).toFixed(2)):"sizing-rate"==e.target.id?AL.value=parseFloat(Number(CL.value)*Number(LL.value)/100).toFixed(2):"sizing-cost-per-m"==e.target.id?LL.value=parseFloat(100*Number(AL.value)/Number(CL.value)).toFixed(2):"wastage-rate"==e.target.id?BL.value=parseFloat(Number(CL.value)*Number(PL.value)/100).toFixed(2):"wastage-cost-per-m"==e.target.id?PL.value=parseFloat(100*Number(BL.value)/Number(CL.value)).toFixed(2):"freight-cost-per-m"==e.target.id?DL.value=Number(CL.value)+Number(AL.value)+Number(BL.value)+Number(ML.value)+Number(RL.value):"weaving-rate"==e.target.id?ML.value=parseFloat(NL*Number(FL.value)).toFixed(2):"weaving-cost-per-m"==e.target.id?FL.value=parseFloat(Number(ML.value)/NL).toFixed(2):"shrinckage-rate"==e.target.id?jL.value=parseFloat(Number($L.value)*Number(DL.value)/100).toFixed(2):"shrinckage-cost-per-m"==e.target.id?$L.value=parseFloat(100*Number(jL.value)/Number(DL.value)).toFixed(2):"value-loss-rate"==e.target.id?HL.value=parseFloat(Number(WL.value)*Number(DL.value)/100).toFixed(2):"value-loss-cost-per-m"==e.target.id?WL.value=parseFloat(100*Number(HL.value)/Number(DL.value)).toFixed(2):"duty-rate"==e.target.id?UL.value=parseFloat(Number(qL.value)*Number(DL.value)/100).toFixed(2):"duty-cost-per-m"==e.target.id?qL.value=parseFloat(100*Number(UL.value)/Number(DL.value)).toFixed(2):"first-extra-rate"==e.target.id?VL.value=parseFloat(Number(zL.value)*Number(DL.value)/100).toFixed(2):"first-extra-cost-per-m"==e.target.id?zL.value=parseFloat(100*Number(VL.value)/Number(DL.value)).toFixed(2):"profit-rate"==e.target.id?JL.value=parseFloat(Number(GL.value)*Number(YL.value)/100).toFixed(2):"profit-cost-per-m"==e.target.id?GL.value=parseFloat(100*Number(JL.value)/Number(YL.value)).toFixed(2):"second-extra-rate"==e.target.id?KL.value=parseFloat(Number(XL.value)*Number(YL.value)/100).toFixed(2):"second-extra-cost-per-m"==e.target.id&&(XL.value=parseFloat(100*Number(KL.value)/Number(YL.value)).toFixed(2)),DL.value=Number(CL.value)+Number(AL.value)+Number(BL.value)+Number(RL.value)+Number(ML.value),YL.value=Number(DL.value)+Number(OL.value)+Number(jL.value)+Number(HL.value)+Number(UL.value)+Number(VL.value),ZL.value=Number(YL.value)+Number(JL.value)+Number(KL.value)},lA=(document.getElementById("cbdesigner-name"),document.querySelector(".designer-name"),document.getElementById("cbparty-name"),document.querySelector(".party-name"),document.getElementById("cborder-no"),document.querySelector(".order-no"),document.getElementById("cbdate"),document.querySelector(".date"),document.getElementById("cbdesign-name"),document.querySelector(".design-name"),document.getElementById("cbtotal-dent")),oA=document.querySelector(".total-dent"),sA=(document.getElementById("cbweave-name"),document.querySelector(".weave-name"),document.getElementById("cbdraft-pattern"),document.querySelector(".draft-pattern"),document.getElementById("cbavg-EPI")),dA=document.querySelector(".avg-EPI"),cA=document.getElementById("cbavg-PPI"),uA=document.querySelector(".avg-PPI"),pA=(document.getElementById("cbgsm"),document.querySelector(".gsm"),document.getElementById("cbreed")),hA=document.querySelector(".reed"),gA=document.getElementById("cbreed-space"),mA=document.querySelector(".reed-space"),fA=document.getElementById("cbshaft"),yA=document.querySelector(".shaft"),vA=document.getElementById("cbtotal-ends"),bA=document.querySelector(".total-ends"),wA=document.getElementById("cbtotal-picks"),EA=document.querySelector(".total-picks");document.getElementById("cbepi"),document.querySelector(".epi"),document.getElementById("cbppi"),document.querySelector(".ppi"),document.getElementById("cbno-of-warp"),document.querySelector(".no-of-warp"),document.getElementById("cbno-of-weft"),document.querySelector(".no-of-weft"),document.getElementById("cbglm"),document.querySelector(".glm"),document.getElementById("cbblend"),document.querySelector(".blend"),document.getElementById("edit-draft-num-grid-model"),document.getElementById("edit-draft-num-grid-model-trigger");function SA(e){e.ctrlKey&&e.preventDefault()}function xA(e){e.ctrlKey&&["+","-"].includes(e.key)&&e.preventDefault()}function IA(e){e.target.classList.contains("fa-expand")?(e.target.classList.remove("fa-expand"),e.target.classList.add("fa-compress")):e.target.classList.contains("fa-compress")&&(e.target.classList.remove("fa-compress"),e.target.classList.add("fa-expand"));var t=document.documentElement;document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}const kA=e=>{e.returnValue=!0},_A=document.getElementById("invert-design-trigger"),TA=()=>{KO.convert_new_index_to_numeric(!1,!1);let e=KO.get_new_print_pegplan_data(!0);e=String(e).trim().split("\n").map(e=>0==e.trim().length?"0":e).join("\n"),"0"==e&&(e="[0]X20"),Hh.value=e,Qh()},NA=document.getElementById("save-color-palette-modal"),CA=document.getElementsByClassName("save-color-palette-trigger");let LA,AA,PA,BA="";const RA=()=>{Uf(),OA(),NA.style.display="block",NA.style.animation="slide-down 0.3s ease"},FA=()=>{PA.innerHTML="",NA.style.display="none",Yi("")},MA=()=>{(async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=xg.find(e=>e.name.trim()==LA.value.trim());BA=t?t.id:"";let n=[];Object.keys(Ld).forEach(e=>{n.push({yarnType:Ad[e]?Ad[e].yarnType:"",yarnName:Ad[e]?Ad[e].yarnName:"",yarnLetter:e,yarnWarpOrWeft:"warp",colorCode:Ld[e]})}),Object.keys($s).forEach(e=>{n.push({yarnType:Ws[e]?Ws[e].yarnType:"",yarnName:Ws[e]?Ws[e].yarnName:"",yarnLetter:e,yarnWarpOrWeft:"weft",colorCode:$s[e]})}),Object.keys(js).forEach(e=>{n.push({yarnType:"",yarnName:"",yarnLetter:e,yarnWarpOrWeft:"function",colorCode:js[e]})});let i={colorPaletteId:BA,user:e,name:LA.value,yarnDetail:n};try{await gg(i)}catch(e){console.log("inside error")}})(),FA()},DA=e=>{let t=String(e.target.value);if(t.length>0){let e=xg.filter(e=>String(e.name).toLowerCase().includes(t.toLowerCase()));for(let e=0;e<xg.length;e++){document.getElementById(xg[e].id).style.display="none"}for(let t=0;t<e.length;t++){document.getElementById(e[t].id).style.display="block"}}else for(let e=0;e<xg.length;e++){document.getElementById(xg[e].id).style.display="block"}},OA=async()=>{try{let t=await mg();e=t.data.DATA,xg=e,PA.innerHTML="";for(let e=0;e<xg.length;e++)PA.innerHTML+=`<div id="${xg[e].id}">${xg[e].name}</div>`;for(let e=0;e<xg.length;e++)document.getElementById(xg[e].id).addEventListener("click",()=>{var t;t=xg[e],LA.value=t.name})}catch(e){console.log("err is",e)}var e};const $A=document.getElementById("save-draft-modal"),jA=document.getElementById("save-draft-modal-trigger");let WA,HA,qA,UA="",zA=[];const VA=e=>{for(let e=0;e<zA.length;e++){document.getElementById(zA[e].id).classList.remove("save-draft-file-active")}e.currentTarget.classList.add("save-draft-file-active")},YA=e=>{zA=e},GA=()=>{document.getElementById("weftSubContext")&&(document.getElementById("weftSubContext").style.display="none"),(async()=>{try{let e=await Qo();YA(e.data.DATA),qA.innerHTML="";for(let e=0;e<zA.length;e++)qA.innerHTML+=`<div class="open-pegplan-data-container-content" id="${zA[e].id}">\n      <div class="open-pegplan-data-content-image">\n        <img src="maxweavefev.png" width="100">\n       </div>\n    \n        <div class="open-pegplan-data-content-file-name">${zA[e].name}</div>\n    </div>`;for(let e=0;e<zA.length;e++){document.getElementById(zA[e].id).addEventListener("click",VA)}for(let e=0;e<zA.length;e++)document.getElementById(zA[e].id).addEventListener("click",()=>{var t;t=zA[e],WA.value=t.name})}catch(e){console.log("err is",e)}})(),$A.style.display="block",$A.style.animation="slide-down 0.3s ease"},JA=()=>{$A.style.display="none",Yi("")},XA=e=>{let t=String(e.target.value);if(t.length>0){let e=zA.filter(e=>String(e.name).toLowerCase().includes(t.toLowerCase()));for(let e=0;e<zA.length;e++){document.getElementById(zA[e].id).style.display="none"}for(let t=0;t<e.length;t++){document.getElementById(e[t].id).style.display="block"}}else for(let e=0;e<zA.length;e++){document.getElementById(zA[e].id).style.display="block"}},KA=async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=GO.convert_new_index_to_numeric(ZO),n=zA.find(e=>e.name.trim()==WA.value.trim());UA=n?n.id:"";let i=XC(t);const r=lC(String(i).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e)));let a={draftPlan:t,user:e,name:WA.value,shaft:GO.rows(),draftPlanId:UA,ends:r.toString()};try{await(e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/draft-plan/create",e,{headers:{token:t}})})(a)}catch(e){console.log("inside error",e)}},ZA=()=>{KA(),JA()},QA=document.getElementById("open-draft-modal"),eP=document.getElementById("open-draft-modal-trigger");let tP,nP,iP,rP,aP,lP,oP;const sP=e=>{for(let e=0;e<zA.length;e++){document.getElementById(zA[e].id).classList.remove("draft-file-active")}let t=zA.find(t=>t.id==e.currentTarget.id);e.currentTarget.classList.add("draft-file-active"),lP=t,dP(lP)},dP=e=>{aP.innerHTML="",oP.value=e.name;let t=XC(e.draftPlan),n=[];String(t).split("\n").filter(e=>e.length>0).forEach(e=>{if(e){e.trim().split(" ").forEach(e=>{n.push(e.trim())})}}),JO.change_only_draft_data(n);const i=document.createElement("canvas"),r=i.getContext("2d"),a=JO.cols(),l=JO.rows(),o=JO.cell_size(),s=Dn,d=On;i.width=a*o,i.height=l*o,r.fillStyle="white",r.fillRect(0,0,i.width,i.height),r.fillStyle="black";for(let e=0;e<a+1;e++)r.beginPath(),r.strokeStyle="grey",r.moveTo(s+e*o,d),r.lineTo(s+e*o,d+l*o),r.lineWidth=e%$n==0?1.5:.5,r.stroke(),r.closePath();for(let e=0;e<l+1;e++)r.beginPath(),r.strokeStyle="grey",r.moveTo(s,d+e*o),r.lineTo(s+a*o,d+e*o),r.lineWidth=(l-e)%jn==0?1.5:.5,r.stroke(),r.closePath();const c=new Uint32Array(I$.memory.buffer,JO.cells(),JO.selected_weftgrid_length());r.beginPath(),c.forEach(e=>{r.fillRect(e%JO.cols()*o,parseInt(e/JO.cols())*o,o,o)}),r.closePath(),aP.appendChild(i)},cP=async()=>{try{let e=await Qo();YA(e.data.DATA);let t=[],n=[];t=[...new Set([...zA.map(e=>e.shaft)])],n=[...new Set([...zA.map(e=>e.ends)])],nP.innerHTML='<option value="">All</option>',iP.innerHTML='<option value="">All</option>';for(let e=0;e<t.length;e++){let n=document.createElement("option");n.value=t[e],n.innerHTML=t[e],iP.appendChild(n)}for(let e=0;e<n.length;e++){let t=document.createElement("option");t.value=n[e],t.innerHTML=n[e],nP.appendChild(t)}rP.innerHTML="";for(let e=0;e<zA.length;e++)rP.innerHTML+=`<div id="${zA[e].id}">\n      \n        <img src="maxweave.png" width="100" height="100">\n      \n      <div id="open-draft-name-container">${zA[e].name}</div>\n      \n    </div>`;for(let e=0;e<zA.length;e++){document.getElementById(zA[e].id).addEventListener("click",sP)}}catch(e){console.log("err is",e)}},uP=()=>{document.addEventListener("keydown",gP),document.getElementById("weftSubContext")&&(document.getElementById("weftSubContext").style.display="none"),Uf(),cP(),QA.style.display="block",QA.style.animation="slide-down 0.3s ease"},pP=()=>{rP.innerHTML="",QA.style.display="none",lP=null,document.removeEventListener("keydown",gP),Yi("")},hP=()=>{aE.value=lP.draftPlan,bE(),pP()},gP=async e=>{lP&&"Delete"==e.key&&(await zl("Are you sure you want to permanently delete this file?")?(console.log("delete design",lP),(e=>{const t=localStorage.getItem("token");return Zo.get(`${ba}/draft-plan/delete-draft-plan/${e}`,{headers:{token:t}})})(lP.id).then(e=>{console.log("delete Draft Plan succuss fully",e.data),cP(),oP.value="",lP=null,dP(null)}).catch(e=>console.log("delete design failed"))):console.log("do not delete it"))},mP=e=>{let t=String(tP.value),n=String(nP.value),i=String(iP.value);console.log("handle search called",t,n,i);let r=zA.filter(e=>(0==t.length||String(e.name).toLowerCase().includes(t.toLowerCase()))&&(0==i.length||String(e.shaft).toLowerCase().includes(i.toLowerCase()))&&(0==n.length||String(e.ends).toLowerCase().includes(n.toLowerCase())));for(let e=0;e<zA.length;e++){document.getElementById(zA[e].id).style.display="none"}for(let e=0;e<r.length;e++){document.getElementById(r[e].id).style.display="block"}};const fP=document.getElementById("save-pegplan-modal"),yP=document.getElementById("save-pegplan-modal-trigger");let vP,bP,wP,EP="",SP=[];const xP=e=>{for(let e=0;e<SP.length;e++){document.getElementById(SP[e].id).classList.remove("save-peg-plan-file-active")}e.currentTarget.classList.add("save-peg-plan-file-active")},IP=e=>{SP=e},kP=()=>{(async()=>{document.getElementById("warpCanvasMenu")&&(document.getElementById("warpCanvasMenu").style.display="none");try{let e=await is();IP(e.data.DATA),wP.innerHTML="";for(let e=0;e<SP.length;e++)wP.innerHTML+=`<div class="open-pegplan-data-container-content" id="${SP[e].id}">\n      <div class="open-pegplan-data-content-image">\n        <img src="maxweavefev.png" width="100">\n       </div>\n        <div class="open-pegplan-data-content-file-name">${SP[e].name}</div>\n      </div>`;for(let e=0;e<SP.length;e++){document.getElementById(SP[e].id).addEventListener("click",xP)}for(let e=0;e<SP.length;e++)document.getElementById(SP[e].id).addEventListener("click",()=>{var t;t=SP[e],vP.value=t.name})}catch(e){console.log("err is",e)}})(),fP.style.display="block",fP.style.animation="slide-down 0.3s ease"},_P=()=>{fP.style.display="none",Yi("")},TP=e=>{let t=String(e.target.value);if(t.length>0){let e=SP.filter(e=>String(e.name).toLowerCase().includes(t.toLowerCase()));for(let e=0;e<SP.length;e++){document.getElementById(SP[e].id).style.display="none"}for(let t=0;t<e.length;t++){document.getElementById(e[t].id).style.display="block"}}else for(let e=0;e<SP.length;e++){document.getElementById(SP[e].id).style.display="block"}},NP=async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=KO.convert_new_index_to_numeric(!1,!1),n=SP.find(e=>e.name.trim()==vP.value.trim());EP=n?n.id:"";let i=XC(t,!0);const r=String(i).split("\n").filter(e=>e.length>0).length;let a={pegPlan:t,user:e,name:vP.value,shaft:GO.rows(),pegPlanId:EP,picks:r.toString()};try{await(e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/peg-plan/create",e,{headers:{token:t}})})(a)}catch(e){console.log("inside error",e)}},CP=()=>{NP(),_P()},LP=document.getElementById("open-pegplan-modal"),AP=document.getElementById("open-pegplan-modal-trigger");let PP,BP,RP,FP,MP,DP,OP;const $P=e=>{for(let e=0;e<SP.length;e++){document.getElementById(SP[e].id).classList.remove("pegplan-file-active")}e.currentTarget.classList.add("pegplan-file-active");let t=SP.find(t=>t.id==e.currentTarget.id);DP=t,jP(DP)},jP=e=>{DP=e,MP.innerHTML="",OP.value=e.name;let t=XC(e.pegPlan.trimEnd(),!0),n=[],i=0,r=0;String(t).split("\n").filter(e=>e).forEach(e=>{i++,Math.max(...e.split(" "))>r&&(r=Math.max(...e.split(" ")))}),String(t).split("\n").forEach((e,t)=>{e.split(" ").forEach(e=>{e.length>0&&n.push((i-t-1)*r+(e-1))})}),console.log("warpGridInstance rows is",i),XO.change_only_pegplan(n,r,i);const a=qi,l=qi,o=Dn,s=On,d=document.createElement("canvas");MP.appendChild(d),d.width=Math.ceil(r*a),d.height=Math.ceil(i*l);const c=d.getContext("2d");c.clearRect(0,0,d.width,d.height),c.fillStyle="white",c.fillRect(0,0,d.width,d.height),c.fillStyle="black";for(let e=0;e<r+1;e++)c.beginPath(),c.strokeStyle="grey",c.moveTo(o+e*a,s),c.lineTo(o+e*a,s+i*l),c.lineWidth=e%$n==0?1.5:.5,c.stroke(),c.closePath();for(let e=0;e<i+1;e++)c.beginPath(),c.strokeStyle="grey",c.moveTo(o,s+e*l),c.lineTo(o+r*a,s+e*l),c.lineWidth=(i-e)%jn==0?1.5:.5,c.stroke(),c.closePath();new Uint32Array(I$.memory.buffer,XO.cells(),XO.selected_warpgrid_length()).forEach(e=>{c.fillRect(e%XO.cols()*a,parseInt(e/XO.cols())*l,a,l)}),c.closePath()},WP=async()=>{try{let e=await is();IP(e.data.DATA);let t=[],n=[];t=[...new Set([...SP.map(e=>e.shaft)])],n=[...new Set([...SP.map(e=>e.picks)])],BP.innerHTML='<option value="">All</option>',RP.innerHTML='<option value="">All</option>';for(let e=0;e<t.length;e++){let n=document.createElement("option");n.value=t[e],n.innerHTML=t[e],RP.appendChild(n)}for(let e=0;e<n.length;e++){let t=document.createElement("option");t.value=n[e],t.innerHTML=n[e],BP.appendChild(t)}FP.innerHTML="";for(let e=0;e<SP.length;e++)FP.innerHTML+=`<div class="open-pegplan-data-container-content" id="${SP[e].id}">\n          <div class="open-pegplan-data-content-image">\n            <img src="maxweave.png" width="100">\n          </div>\n          <div class="open-pegplan-data-content-file-name" >${SP[e].name}</div>\n      </div>`;for(let e=0;e<SP.length;e++){const t=document.getElementById(SP[e].id);t.style.cursor="pointer",t.addEventListener("click",$P)}}catch(e){console.log("err is",e)}},HP=()=>{document.getElementById("weftSubContext")&&(document.getElementById("weftSubContext").style.display="none"),document.addEventListener("keydown",zP),console.log("open modal clicked"),Uf(),WP(),LP.style.display="block",LP.style.animation="slide-down 0.3s ease"},qP=()=>{FP.innerHTML="",LP.style.display="none",DP=null,document.removeEventListener("keydown",zP),Yi("")},UP=()=>{console.log("seleced",DP),Hh.value=DP.pegPlan,Qh(),qP()},zP=async e=>{DP&&"Delete"==e.key&&(await zl("Are you sure you want to permanently delete this file?")?(console.log("delete pegplan",DP),(e=>{const t=localStorage.getItem("token");return Zo.get(`${ba}/peg-plan/delete-peg-plan/${e}`,{headers:{token:t}})})(DP.id).then(e=>{console.log("delete Pegplan succuss fully",e.data),WP(),OP.value="",DP=null,jP(null)}).catch(e=>console.log("delete design failed"))):console.log("do not delete it"))},VP=e=>{let t=String(PP.value),n=String(BP.value),i=String(RP.value),r=SP.filter(e=>(0==t.length||String(e.name).toLowerCase().includes(t.toLowerCase()))&&(0==i.length||String(e.shaft).toLowerCase().includes(i.toLowerCase()))&&(0==n.length||String(e.picks).toLowerCase().includes(n.toLowerCase())));for(let e=0;e<SP.length;e++){document.getElementById(SP[e].id).style.display="none"}for(let e=0;e<r.length;e++){document.getElementById(r[e].id).style.display="block"}},YP=()=>{const e=localStorage.getItem("token");let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/main-design/get-weave-design/${t}`,{headers:{token:e}})};const GP=document.getElementById("save-weavedesign-modal"),JP=document.getElementById("save-weavedesign-modal-trigger");let XP,KP,ZP,QP="",eB=[];const tB=e=>{for(let e=0;e<eB.length;e++){document.getElementById(eB[e].id).classList.remove("save-weave-design-file-active")}e.currentTarget.classList.add("save-weave-design-file-active")},nB=e=>{eB=e},iB=()=>{Uf(),(async()=>{try{let e=await YP();nB(e.data.DATA),ZP.innerHTML="";for(let e=0;e<eB.length;e++)ZP.innerHTML+=`<div class="open-pegplan-data-container-content" id="${eB[e].id}">\n      <div class="open-pegplan-data-content-image">\n        <img src="maxweavefev.png" width="100">\n       </div>\n        <div class="open-pegplan-data-content-file-name">${eB[e].name}</div>\n      </div>`;for(let e=0;e<eB.length;e++){document.getElementById(eB[e].id).addEventListener("click",tB)}for(let e=0;e<eB.length;e++)document.getElementById(eB[e].id).addEventListener("click",()=>{var t;t=eB[e],XP.value=t.name})}catch(e){console.log("err is",e)}})(),GP.style.display="block",GP.style.animation="slide-down 0.3s ease"},rB=()=>{GP.style.display="none",Yi("")},aB=e=>{let t=String(e.target.value);if(t.length>0){let e=eB.filter(e=>String(e.name).toLowerCase().includes(t.toLowerCase()));for(let e=0;e<eB.length;e++){document.getElementById(eB[e].id).style.display="none"}for(let t=0;t<e.length;t++){document.getElementById(e[t].id).style.display="block"}}else for(let e=0;e<eB.length;e++){document.getElementById(eB[e].id).style.display="block"}},lB=async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=eB.find(e=>e.name.trim()==XP.value.trim());QP=t?t.id:"";let n=GO.convert_new_index_to_numeric(ZO),i=XC(n);const r=lC(String(i).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e)));let a=KO.convert_new_index_to_numeric(!1,!1),l=XC(a,!0);const o=String(l).split("\n").filter(e=>e.length>0).length;let s=await(async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=[];Object.keys(Ld).forEach(e=>{t.push({yarnType:Ad[e]?Ad[e].yarnType:"",yarnName:Ad[e]?Ad[e].yarnName:"",yarnLetter:e,yarnWarpOrWeft:"warp",colorCode:Ld[e]})}),Object.keys($s).forEach(e=>{t.push({yarnType:Ws[e]?Ws[e].yarnType:"",yarnName:Ws[e]?Ws[e].yarnName:"",yarnLetter:e,yarnWarpOrWeft:"weft",colorCode:$s[e]})}),Object.keys(js).forEach(e=>{t.push({yarnType:"",yarnName:"",yarnLetter:e,yarnWarpOrWeft:"function",colorCode:js[e]})});let n={colorPaletteId:"",user:e,name:XP.value+"-color-palette",yarnDetail:t,isFileConnected:!0};try{return(await gg(n)).data.DATA.id}catch(e){console.log("inside error")}})(),d={pegPlan:a,draftPlan:n,warpPattern:"",weftPattern:"",user:e,name:XP.value,shaft:GO.rows().toString(),isOnlyWeave:!0,mainDesignId:QP,picks:o.toString(),ends:r.toString(),fabricType:"",unit:"",quality:"",reed:"",perinch:"",leftSalvageWidth:"",bodyWidth:"",rightSalvageWidth:"",leftSalvageWarpDent:"",bodyWarpDent:"",rightSalvageWarpDent:"",warpDencity:"",weftDencity:"",designHeight:"",designWidth:"",gridHeight:"",gridWidth:"",weftHeight:"",warpWidth:"",skipDent:"",doubleBeam:"",extraWarp:"",creaming:"",density:"",leftSalvage:"",rightSalvage:"",notes:"",colorPaletteId:s};try{await es(d)}catch(e){console.log("inside error",e)}},oB=()=>{lB(),rB()},sB=document.getElementById("open-weavedesign-modal"),dB=document.getElementById("open-weavedesign-modal-trigger");let cB,uB,pB,hB,gB,mB,fB,yB;const vB=e=>{for(let e=0;e<eB.length;e++){document.getElementById(eB[e].id).classList.remove("weave-file-active")}e.currentTarget.classList.add("weave-file-active");let t=eB.find(t=>t.id==e.currentTarget.id);fB=t,bB(fB)},bB=e=>{e.colorPaletteId&&Ig(e.colorPaletteId),fB=e,mB.innerHTML="",yB.value=e.name},wB=async()=>{try{let e=await YP();nB(e.data.DATA);let t=[],n=[],i=[];t=[...new Set([...eB.map(e=>e.shaft)])],n=[...new Set([...eB.map(e=>e.picks)])],i=[...new Set([...eB.map(e=>e.ends)])],uB.innerHTML='<option value="">All</option>',hB.innerHTML='<option value="">All</option>',pB.innerHTML='<option value="">All</option>';for(let e=0;e<t.length;e++){let n=document.createElement("option");n.value=t[e],n.innerHTML=t[e],hB.appendChild(n)}for(let e=0;e<n.length;e++){let t=document.createElement("option");t.value=n[e],t.innerHTML=n[e],uB.appendChild(t)}for(let e=0;e<i.length;e++){let t=document.createElement("option");t.value=i[e],t.innerHTML=i[e],pB.appendChild(t)}gB.innerHTML="";for(let e=0;e<eB.length;e++)gB.innerHTML+=`<div id="${eB[e].id}" class="open-pegplan-data-container-content">\n      <div class="open-pegplan-data-content-image">\n        <img src="maxweave.png" width="100">\n      </div>\n      <div class="open-pegplan-data-content-file-name">${eB[e].name}</div>\n    </div>`;for(let e=0;e<eB.length;e++){document.getElementById(eB[e].id).addEventListener("click",vB)}}catch(e){console.log("err is",e)}},EB=()=>{document.getElementById("mainContextMenu")&&(document.getElementById("mainContextMenu").style.display="none"),document.addEventListener("keydown",IB),Uf(),wB(),sB.style.display="block",sB.style.animation="slide-down 0.3s ease"},SB=()=>{gB.innerHTML="",sB.style.display="none",fB=null,document.removeEventListener("keydown",IB),Yi("")},xB=async()=>{let e=await ts(fB.id);fB=e.data.DATA,aE.value=fB.draftPlan,bE(),Hh.value=fB.pegPlan,Qh(),SB()},IB=async e=>{fB&&"Delete"==e.key&&(await zl("Are you sure you want to permanently delete this file?")?(console.log("delete design",fB),(e=>{const t=localStorage.getItem("token");return Zo.get(`${ba}/main-design/delete-weave-design/${e}`,{headers:{token:t}})})(fB.id).then(e=>{console.log("delete design succuss fully",e.data),wB(),yB.value="",fB=null}).catch(e=>{console.log("err",e),console.log("delete design failed")})):console.log("do not delete it"))},kB=e=>{let t=String(cB.value),n=String(uB.value),i=String(hB.value),r=String(pB.value),a=eB.filter(e=>(0==t.length||String(e.name).toLowerCase().includes(t.toLowerCase()))&&(0==i.length||String(e.shaft).toLowerCase().includes(i.toLowerCase()))&&(0==n.length||String(e.picks).toLowerCase().includes(n.toLowerCase()))&&(0==r.length||String(e.ends).toLowerCase().includes(r.toLowerCase())));for(let e=0;e<eB.length;e++){document.getElementById(eB[e].id).style.display="none"}for(let e=0;e<a.length;e++){document.getElementById(a[e].id).style.display="block"}};document.getElementById("sideBar");document.querySelector(".close-drawer"),document.querySelector(".overlay");document.getElementById("pencil"),document.getElementById("expend"),document.getElementById("square"),document.getElementById("can"),document.getElementById("insert"),document.getElementById("fx"),document.getElementsByClassName("toggle-content"),document.getElementsByClassName("fa-xmark"),document.getElementsByClassName(".menu-panel");const _B=()=>{const e=document.getElementById("company-logo-upload"),t=document.getElementById("company-logo-drag");function n(e){e.stopPropagation(),e.preventDefault(),t.className="dragover"===e.type?"hover":"modal-body file-upload"}function i(e){const t=e.target.files||e.dataTransfer.files;n(e);for(let e,n=0;e=t[n];n++)r(e),((e,t,n)=>{const i=localStorage.getItem("token");let r=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;const a=new FormData;return a.append("user",r),a.append("companyPicture",e),Zo.post(ba+"/setting/upload-company-picture",a,{headers:{"Content-Type":"multipart/form-data",token:i},onUploadProgress:({event:e})=>{console.log("progress",e),e.lengthComputable&&(console.log("Progress event fired:",e),t(e),n(e))}})})(e,a,l).then(e=>{console.log("Upload successful:",e.data)}).catch(e=>{console.error("Upload failed:",e)})}function r(e){var t;t=`<strong>${encodeURI(e.name)}</strong>`,document.getElementById("company-logo-image-messages").innerHTML=t;const n=e.name;/\.(gif|jpg|png|jpeg)$/i.test(n)?(document.getElementById("company-logo-image-start").classList.add("hidden"),document.getElementById("company-logo-image-response").classList.remove("hidden"),document.getElementById("company-logo-image-notimage").classList.add("hidden"),document.getElementById("company-logo-image").classList.remove("hidden"),document.getElementById("company-logo-image").src=URL.createObjectURL(e)):(document.getElementById("company-logo-image").classList.add("hidden"),document.getElementById("company-logo-image-notimage").classList.remove("hidden"),document.getElementById("company-logo-image-start").classList.remove("hidden"),document.getElementById("company-logo-image-response").classList.add("hidden"),document.getElementById("company-logo-upload-form").reset())}function a(e){const t=document.getElementById("company-logo-image-progress");e.lengthComputable&&(t.max=100,console.log("Progress max value set:",e.total))}function l(e){const t=document.getElementById("company-logo-image-progress");if(console.log("Progress event:",e),console.log("Loaded:",e.loaded,"Total:",e.total),e.lengthComputable){const n=e.loaded/e.total*100;console.log("Progress percentage:",n),t.value=n,t.innerHTML=Math.round(n)+"%"}else console.error("Progress event length is not computable")}e.addEventListener("change",i,!1),window.XMLHttpRequest&&(t.addEventListener("dragover",n,!1),t.addEventListener("dragleave",n,!1),t.addEventListener("drop",i,!1))},TB=()=>{const e=document.getElementById("user-profile-upload"),t=document.getElementById("user-profile-drag");function n(e){e.stopPropagation(),e.preventDefault(),t.className="dragover"===e.type?"hover":"modal-body file-upload"}function i(e){const t=e.target.files||e.dataTransfer.files;n(e);for(let e,n=0;e=t[n];n++)r(e),((e,t,n)=>{const i=localStorage.getItem("token");let r=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;const a=new FormData;return a.append("user",r),a.append("profilePicture",e),Zo.post(ba+"/setting/upload-profile-picture",a,{headers:{"Content-Type":"multipart/form-data",token:i},onUploadProgress:({event:e})=>{console.log("progress",e),e.lengthComputable&&(console.log("Progress event fired:",e),t(e),n(e))}})})(e,a,l).then(e=>{console.log("Upload successful:",e.data)}).catch(e=>{console.error("Upload failed:",e)})}function r(e){var t;t=`<strong>${encodeURI(e.name)}</strong>`,document.getElementById("user-profile-messages").innerHTML=t;const n=e.name;/\.(gif|jpg|png|jpeg)$/i.test(n)?(document.getElementById("user-profile-start").classList.add("hidden"),document.getElementById("user-profile-response").classList.remove("hidden"),document.getElementById("user-profile-notimage").classList.add("hidden"),document.getElementById("user-profile-image").classList.remove("hidden"),document.getElementById("user-profile-image").src=URL.createObjectURL(e)):(document.getElementById("user-profile-image").classList.add("hidden"),document.getElementById("user-profile-image-notimage").classList.remove("hidden"),document.getElementById("user-profile-image-start").classList.remove("hidden"),document.getElementById("user-profile-image-response").classList.add("hidden"),document.getElementById("user-profile-upload-form").reset())}function a(e){const t=document.getElementById("user-profile-image-progress");e.lengthComputable&&(t.max=100,console.log("Progress max value set:",e.total))}function l(e){const t=document.getElementById("user-profile-image-progress");if(console.log("Progress event:",e),console.log("Loaded:",e.loaded,"Total:",e.total),e.lengthComputable){const n=e.loaded/e.total*100;console.log("Progress percentage:",n),t.value=n,t.innerHTML=Math.round(n)+"%"}else console.error("Progress event length is not computable")}e.addEventListener("change",i,!1),window.XMLHttpRequest&&(t.addEventListener("dragover",n,!1),t.addEventListener("dragleave",n,!1),t.addEventListener("drop",i,!1))};const NB=document.getElementById("keyboard-shortcut-model"),CB=document.getElementById("keyboard-shortcut-trigger"),LB=()=>{Uf(),NB.style.display="block",NB.style.animation="slide-down 0.3s ease"},AB=()=>{NB.style.display="none"},PB=()=>{NB.innerHTML=`<div class="modal-content">\n    <div class="close">\n      <span class="close-button">&times;</span>\n    </div>\n    <div class="modal-title">\n    Keyboard Shortcut\n    </div>\n    <div class="modal-desc">\n    <table>\n    <tr><td>Command</td><td>KeyStroke</td><td>Description</td></tr>\n    ${ff.map(e=>`<tr><td class="shortCutTablePartHeading">${e.part}</td></tr>${e.keyData.map(e=>`<tr><td>${e.command}</td><td>${e.keyName}</td><td>${e.Description}</td></tr>`).join("")}`).join("")}\n      </table>\n    </div>\n  </div>`;NB.querySelector(".close-button").addEventListener("click",AB),CB.addEventListener("click",LB)},BB=document.getElementById("single-page-print-model");document.getElementById("single-page-print-model-trigger");let RB={pegplanType:yi.GRAPHICALNOWITHNUMERICNO,isTwoPickLetisEnabled:!0,isWeftSelector:!1,isCreaming:!1,isUncompreesed:!1};let FB=[{label:"Design Name",value:"ABC",key:"designName"},{label:"Fabric Quality",value:"ABC",key:"fabricQuality"},{label:"Shaft",value:"ABC",key:"shaft"},{label:"Total Dent",value:"ABC",key:"totalDent"},{label:"EPI",value:"ABC",key:"epi"},{label:"Avg.EPI",value:"ABC",key:"avgEpi"},{label:"Warp",value:"ABC",key:"warp"},{label:"Reed/2 in",value:"ABC",key:"reedPerTwoinch"},{label:"Reed Space",value:"ABC",key:"reedSpace"},{label:"Total Ends",value:"ABC",key:"totalEnds"},{label:"Total Picks",value:"ABC",key:"totalPicks"},{label:"PPI",value:"ABC",key:"ppi"},{label:"Avg PPI",value:"ABC",key:"avgPpi"},{label:"Weft",value:"ABC",key:"weft"},{label:"Party Name",value:"ABC",key:"partyName"},{label:"Designer Name",value:"ABC",key:"designerName"},{label:"Order No",value:"ABC",key:"orderNumber"},{label:"GSM",value:"ABC",key:"gsm"},{label:"GLM",value:"ABC",key:"glm"}];function MB(e,t){e=String(e).replace(/\*/g,"X");let n=yC(e);const i=document.createElement("table"),r=document.createElement("tr"),a=document.createElement("th");a.innerHTML=`<pre>${"weft"==t?"Picks Yarn":"Ends Yarn"}</pre>`,a.style.textAlign="center",a.style.whiteSpace="pre",r.appendChild(a);const l=document.createElement("th");l.innerHTML="<pre>R1</pre>",l.style.textAlign="center",r.appendChild(l);const o=document.createElement("th");o.innerHTML="<pre>R2</pre>",o.style.textAlign="center",r.appendChild(o),i.appendChild(r),console.log("seqStringWithRepeat",n),n.forEach((e,n)=>{let r=e.outerRepeat;e.innerParts.forEach((n,a)=>{let l=String(n.currentPart).trim(),o=n.innerRepeat,s=String(l).split(" ");s.forEach((n,l)=>{const d=document.createElement("tr");d.setAttribute("valign","top");const c=document.createElement("td");c.classList.add("pegplan-no");let u=Fc(n).replaceAll("\n","<br>"),p=isNaN(parseInt(u))?"1"+u:u;var h;if(c.innerHTML=(h="warp"==t?Ld:$s,p.split(/<br\s*\/?>/).map(e=>e.trim()).map(e=>{const t=e.split(" - ")[1],n=h[t]||"#FFFFFF";return`<span style="display: block;background-color: ${n}; color: ${ca(n)}; \n                  padding: 1px;">\n                  ${e}\n              </span>`}).join("")),c.style.textAlign="center",d.appendChild(c),0==l){const e=document.createElement("td");e.style.paddingLeft="8px",e.innerHTML=`<pre>x ${o}</pre>`,e.rowSpan=s.length,e.style.textAlign="left",e.style.verticalAlign="middle",d.appendChild(e)}if(0==l&&0==a){let t=0;for(let n=0;n<e.innerParts.length;n++){t+=String(e.innerParts[n].currentPart).trim().split(" ").length}const n=document.createElement("td");n.style.paddingLeft="8px",n.rowSpan=t,n.innerHTML=`<pre>x ${r}</pre>`,n.style.textAlign="left",n.style.verticalAlign="middle",d.appendChild(n)}["leftSalvage","rightSalvage"].includes(e.part)&&(d.style.backgroundColor="#d9d9d9"),i.appendChild(d)})})});const s=document.createElement("tr"),d=document.createElement("td"),c=document.createElement("pre");let u=GO.cols();return c.innerText="warp"==t?u+" Ends":d$.size+" Picks",d.appendChild(c),d.colSpan=3,s.appendChild(d),i.appendChild(s),`<div margin-top:10px;"><table class="singlepage_print_warp_weft_pattern_table">${i.innerHTML}</table></div>`}const DB=e=>{let t=String(e).replaceAll(","," "),n=RB.pegplanType,i=KO.cols(),r="";if(n==yi.GRAPHICALNOWITHNUMERICNO)r=`<td>${t}</td>`;else if(n==yi.GRAPHICALYESWITHNUMERICNO){let e=String(t).split(" ");r+='<td style="display:flex;padding:0px;">';for(let t=1;t<=i;t++)r+=`<span style="display:flex;height:16px;width:16px;border:1px solid black;padding:1px;">${e.includes(String(t))?'<span style="height:100%;width:100%;background-color:black;"></span>':""}</span>`;r+="</td>"}else if(n==yi.GRAPHICALNOWITHNUMERICYES){let e=String(t).split(" ");r+='<td style="display:flex;padding:0px;">';for(let t=1;t<=i;t++)r+=`<span style="display:flex;height:16px;width:16px;border:1px solid black;padding:1px;">${e.includes(String(t))?`<span style="height:100%;width:100%;text-align:center;">${t}</span>`:""}</span>`;r+="</td>"}else if(n==yi.GRAPHICALYESWITHNUMERICYES){let e=String(t).split(" ");r+='<td style="display:flex;padding:0px;">';for(let t=1;t<=i;t++)r+=`<span style="display:flex;height:16px;width:16px;border:1px solid black;padding:1px;">${e.includes(String(t))?`<span style="height:100%;width:100%;text-align:center;background-color:black;color:white;font-size:13px;padding-top:1px;">${t}</span>`:""}</span>`;r+="</td>"}return r},OB=()=>{if(RB.isTwoPickLetisEnabled){let e=(()=>{let e=document.getElementById("loom-type"),t=Boolean("rapier-manual-dobby"==e.value),n=[],i=KO.get_new_print_pegplan_data(!1),r=String(i).trim().split("\n");if(RB.pegplanType==yi.WATERJETLETIS)for(let e=0;e<r.length;e+=2)n.push({no:String(e+1)+(r[e+1]?"-"+String(e+2):""),pegplan:r.slice(e,e+2).map(e=>e.replace(/\s+/g,",")).join("\n")});else if(RB.isTwoPickLetisEnabled)for(let e=0;e<r.length;e+=2)n.push({no:String(Math.ceil(n.length+1)),pegplan:r.slice(e,e+2).map(e=>e.replace(/\s+/g,",")).join("\n")});else for(let e=0;e<r.length;e+=1)n.push({no:String(n.length+1),pegplan:r[e].replace(/\s+/g,",")});if(t&&hi.start&&hi.end&&gi.start&&gi.end&&RB.pegplanType!=yi.WATERJETLETIS){let e=FC();console.log("fidder color ",e),n.forEach((t,n)=>{let i=t.pegplan.split("\n"),r=[];i.forEach((t,i)=>{let a=d$.findElementFromIndex(d$.size-(n*(RB.isTwoPickLetisEnabled?2:1)+i)-1),l=l$.findElementFromIndex(d$.size-(n*(RB.isTwoPickLetisEnabled?2:1)+i)-1);if(a){let n=t+""+(RB.isWeftSelector?","+e[a.color_code]:"");l&&RB.isCreaming&&(n+=","+gi.start),r.push(n)}else{let e=t+""+(RB.isWeftSelector?","+hi.start:"");l&&RB.isCreaming&&(e+=","+gi.start),r.push(e)}}),t.pegplan=r.join("\n")})}if(RB.isUncompreesed)return n;let a=[],l=0;for(;l<n.length;){let e=Number(n[l].no),t=Number(n[l].no),i=!1;for(;l<n.length&&n[l+1]&&n[l].pegplan==n[l+1].pegplan;)i=!0,e++,l++;i?(a.push({no:`${t}-${e}`,pegplan:n[l].pegplan}),l++):(a.push({no:""+t,pegplan:n[l].pegplan}),l++)}return a})(),t='<table border="1">';return e.forEach(e=>{e.pegplan.trim().split("\n").forEach((n,i)=>{t+="<tr>",0==i&&(t+=`<td rowspan=2>${e.no}</td>`),t+=DB(n),t+="</tr>"})}),t+="</table>",t}{let e=(()=>{let e=KO.convert_new_index_to_numeric(!1,!1);return e=E$(e),yC(e)})(),t='<table border="1">';t+="<tr><th>No.</th><th>Pegplan</th><th>R1</th><th>R2</th></tr>";let n=1,i=n;return e.forEach((e,r)=>{let a=0;i=n,e.innerParts.forEach(e=>{a+=e.currentPart.trim().split("\n").length});let l=!1;e.innerParts.forEach((r,o)=>{const s=r.currentPart.trim().split("\n");s.forEach((n,d)=>{t+="<tr>",t+=`<td>${i}</td>`,t+=DB(n),0===d&&(t+=`<td rowspan="${s.length}">${r.innerRepeat}</td>`),l||0!=o||(t+=`<td rowspan="${a}">${e.outerRepeat}</td>`,l=!0),i++,t+="</tr>"}),n+=s.length*r.innerRepeat*e.outerRepeat})}),t+="</table>",t}},$B=()=>{const e={1:"200px",2:"200px",3:"200px",4:"300px"};let t=GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1);(e=>{let t=[];t.push(Number(Yp.value)),t.push(Number(Jp.value));let n=String(e).trim().split("\n"),i=GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1);for(let e=0;e<n.length;e++)"#"!=n[e].trim()&&t.push(n[e].trim().split(" ").filter(e=>"#"!=e).length);t=[...new Set(t)].filter(e=>e).sort(),String(i).includes("#")&&t.push("#");JSON.parse(localStorage.getItem("user")),JSON.parse(localStorage.getItem("company")),n.length;let r=((KO.rows()-l$.cells.length)/Number(lh.value)).toFixed(2),a=((n.length/Number(gh.value)).toFixed(2),Ju()),l=a-Number(Nr.value)-Number(Jr.value),o=Number(Nr.value)+Number(Jr.value),s=`${o?`${l} + ${o} = `:""} ${a}`,d=eh.value,c=Number(l/Number(d)).toFixed(2),u=l$.cells.length?(KO.rows()/r).toFixed(2):Number(lh.value).toFixed(2),p=Number(eh.value)+Number(Up.value)+Number(qp.value),h=(Number(Up.value)+Number(qp.value)?` ${Number(eh.value).toFixed(2)} + ${(Number(Up.value)+Number(qp.value)).toFixed(2)} = `:"")+String(p.toFixed(2)),g=Number(Up.value),m=`${String(Vp.value)-(g?2:0)}${g?" + 2 = "+Number(Vp.value):""}`,f=`${Kp.value} + ${Number(Xp.value)+Number(Zp.value)} = ${Qp.value}`;console.log("finalFabricFormValues =======>",lu);let y=`${parseInt(lu.warpOnLoomEpi)}X${parseInt(lu.weftOnLoomEpi)}X${parseInt(lu.reedSpaceOnLoomEpi)}"`,v=`${parseInt(lu.warpGriegeEpi)}X${parseInt(lu.weftGriegeEpi)}X${parseInt(lu.grayWidth)}"`,b=`${parseInt(lu.warpFinishEpi)}X${parseInt(lu.weftFinishEpi)}X${parseInt(lu.finishWidth)}"`;FB=[{label:"SORT NO.",value:ou.sortNo,key:"sortNo",tableNumber:1},{label:"CHECK BY.",value:ou.checkedBy,key:"checkBy",tableNumber:1},{label:`Reed/${gh.value} in`,value:`${zO.value}${t.map(e=>"/"+e).join("")}`,key:"reedPerTwoinch",tableNumber:1},{label:"Pick/IN",value:lh.value,key:"totalPicks",tableNumber:1},{label:"Avg EPI",value:c,key:"avgEpi",tableNumber:1},{label:"Avg.PPI",value:u,key:"avgPpi",tableNumber:1},{label:"C.F",value:"",key:"coverFactor",tableNumber:1},{label:"On Loom",value:y,key:"onLoom",tableNumber:1},{label:"ORDER NO.",value:ou.orderNo,key:"orderNo",tableNumber:2},{label:"G.GSM",value:"105.962",key:"G.GSM",tableNumber:2},{label:"G.GLM",value:"106.962",key:"G.GSM",tableNumber:2},{label:"G.MTR/KG",value:"9.44",key:"G.GSM",tableNumber:2},{label:"G.WR.SRNK%",value:lu.warpWeavingShrinkage+"%",key:"G.GSM",tableNumber:2},{label:"G.WF.SRNK%",value:lu.weftWeavingShrinkage+"%",key:"G.GSM",tableNumber:2},{label:"WR.WAST%",value:lu.warpWastage+"%",key:"warp-wastage",tableNumber:2},...Number(lu.warpWeavingShrinkage)&&Number(lu.weftWeavingShrinkage)?[{label:"GREIGE",value:v,key:"G.GSM",tableNumber:2}]:[],{label:"DEL.DATE",value:ou.deliveryDate,key:"G.GSM",tableNumber:3},{label:"F.GSM",value:"105.962",key:"G.GSM",tableNumber:3},{label:"F.GLM",value:"106.962",key:"G.GSM",tableNumber:3},{label:"F.MTR/KG",value:"",key:"warp-wastage",tableNumber:3},{label:"F.WR.SRNK%",value:lu.warpWeavingShrinkage+"%",key:"G.GSM",tableNumber:3},{label:"F.WF.SRNK%",value:lu.weftFinishShrinkage+"%",key:"G.GSM",tableNumber:3},{label:"WF.WAST%",value:lu.weftWastage+"%",key:"weft-wastage",tableNumber:3},...Number(lu.warpFinishShrinkage)||Number(lu.weftFinishShrinkage)?[{label:"FINISH",value:b,key:"G.GSM",tableNumber:3}]:[],{label:"DESIGN NAME",value:DE.innerText,key:"G.GSM",tableNumber:4},{label:"Customer",value:ou.customerName,key:"G.GSM",tableNumber:4},{label:"Weave",value:ou.weave,key:"G.GSM",tableNumber:4},{label:"COMPOSITION",value:"",key:"G.GSM",tableNumber:4},{label:"Shaft",value:m,key:"shaft",tableNumber:4},{label:"Reed Space",value:h,key:"reedSpace",tableNumber:4},{label:"Total Dent",value:f,key:"totalDent",tableNumber:4},{label:"Total Ends",value:s,key:"totalEnds",tableNumber:4}]})(XC(t));const n=FB.reduce((e,t)=>(e[t.tableNumber]=e[t.tableNumber]||[],e[t.tableNumber].push(t),e),{});let i='<div style="display: grid;grid-template-columns:repeat(4,1fr);">';for(const[t,r]of Object.entries(n))i+=`<table style="width:${e[t]};max-width:350px;height:min-content;border-collapse: collapse; margin: 0; padding: 0;">`,r.forEach(e=>{i+=`\n        <tr>\n         \n          <td width="110" bgcolor="#dfdfdf" height="18" style="border-style: solid; border-width: 1px; padding: 1px;font-size:12px;">${e.label}</td>\n          <td style="border:none;padding: 5px;font-size:12px;">${": "+e.value}</td>\n        </tr>`}),i+="</table>";return i+="</div>",i};function jB(e,t){const n=document.createElement("table");return n.innerHTML+=`<tr><td style="width:70px;">${"warp"==t?"Warp":"Weft"}</td><td style="width:30px;">Count</td><td>Yarn</td><td>WT %</td><td>KGS</td><td style="width:20px;">Total</td></tr>`,e.forEach((e,i)=>{const r=document.createElement("tr");r.setAttribute("valign","top");const a=document.createElement("td"),l=document.createElement("td");a.style.paddingLeft="2px",a.innerHTML=e.yarnname,e.isFooterRow||(a.style.backgroundColor=ua("weft"==t?$s[e.yarnname]:Ld[e.yarnname]),a.style.color=ca(a.style.backgroundColor)),e.isFooterRow&&(a.style.backgroundColor="white",a.style.border="none",l.style.backgroundColor="white",l.style.border="none"),r.appendChild(a);const o=document.createElement("td");o.style.paddingLeft="2px",o.innerHTML=e.type?e.type:"",r.appendChild(o),r.style.borderTop="1px solid black",e.isFooterRow&&(o.style.backgroundColor="white",o.style.border="none");const s=document.createElement("td");s.style.paddingLeft="2px",s.innerHTML="warp"==t?Ad[e.yarnname]?Ad[e.yarnname].yarnName:e.yarnname:Ws[e.yarnname]?Ws[e.yarnname].yarnName:e.yarnname,e.isFooterRow&&(s.style.backgroundColor="white",s.style.border="none"),r.appendChild(s);const d=document.createElement("td");d.style.paddingLeft="2px",d.innerHTML=e.percentage,e.isFooterRow&&(d.style.backgroundColor="white",d.style.border="none"),r.appendChild(d);const c=document.createElement("td");c.style.paddingLeft="2px",c.innerHTML=parseFloat(e.weight).toFixed(3),r.appendChild(c);const u=document.createElement("td");u.style.paddingLeft="2px",u.innerHTML=e.count?e.count:0,r.appendChild(u),n.appendChild(r)}),`<table class="singlepage-warp-weft-info-table">${n.innerHTML}</table>`}const WB=()=>{Yi(BB.id);const e=BB.querySelector("#modal-desc");let t=JSON.parse(localStorage.getItem("company")),n=[],i=[],r=[],a=[],l=UC(),o=qC(),s=Mc(l),d=Mc(o),{tableDraftData:c,wholeRepeat:u,totalPatternInputObjectForWarpWeftInfo:p}=(()=>{let e={},t={},n=GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1),i=XC(n);const r=String(i).split("\n").filter(e=>e.length>0).length,a=parseInt(Number(zO.value)/Number(gh.value)*Number(eh.value));let l=String(Math.floor(a/Number(r))),o=YC();e.bodyRepeat=l,e.rightsalvage=o.find(e=>"Right Selvedge"==e.Part),e.leftsalvage=o.find(e=>"Left Selvedge"==e.Part),t=JSON.parse(JSON.stringify(e));let s=a%Number(r),d=GO.new_get_extra_draft_data(ZO,s),c=tL(XC(d)),u=0!=c&&l>0;console.log("extra draft string is",d);let p=String(qC(!0)).split("\n").slice(0,hC(d)).join("\n"),h={draft:{outerRepeat:1,pattern:y$(p),withInnerRepeat:[{repeatedPart:d,dent:eL(XC(d)),pattern:y$(p),ends:c,innerRepeat:1}]},dent:eL(XC(d)),tar:c,pattern:"Pattern",Part:"Extra"},g=[];if(String(d).includes("X")){let e=EC(d);Array.isArray(e)&&e.forEach(e=>{g.push({...h,draft:e})})}else g=[h];if(t.extrapart=h,u){let t=o.filter(e=>"Right Selvedge"!=e.Part),n=o.find(e=>"Right Selvedge"==e.Part),i=a%Number(r),l=GO.new_get_extra_draft_data(ZO,i),s=tL(XC(l));console.log("extra draft string is",l);let d=String(qC(!0)).split("\n").slice(0,hC(l)).join("\n");Ru=y$(d);let c={draft:{outerRepeat:1,pattern:y$(d),withInnerRepeat:[{repeatedPart:l,dent:eL(XC(l)),pattern:y$(d),ends:s,innerRepeat:1}]},dent:eL(XC(l)),tar:s,pattern:"Pattern",Part:"Extra"},u=[];if(String(l).includes("X")){let e=EC(l);Array.isArray(e)&&e.forEach(e=>{u.push({...c,draft:e})})}else u=[c];e.extrapart=c,t=[...t,...u],t=t.map(e=>("Body"==e.Part&&(e.tar=String(Number(e.tar)-s)),e)),n&&t.push(n),o=t}return{tableDraftData:o,totalPatternInputObjectForWarpWeftInfo:t,wholeRepeat:l}})(),h=0,g=0,m=0,f=0;[...new Set(c.map(e=>e.Part))].forEach(e=>{let t=c.filter(t=>t.Part==e);"Body"==e?t.forEach(e=>{e.draft.withInnerRepeat.forEach(t=>{m+=t.ends*e.draft.outerRepeat})}):"Left Selvedge"==e?t.forEach(e=>{e.draft.withInnerRepeat.forEach(e=>{h+=e.ends})}):["Right Selvedge"].includes(e)?t.forEach(e=>{e.draft.withInnerRepeat.forEach(e=>{g+=e.ends})}):t.forEach(e=>{e.draft.withInnerRepeat.forEach(t=>{f+=t.ends*e.draft.outerRepeat})})});let y=g+h+m*u+f,v=Bv(p,!0);Object.keys(d).forEach(e=>{let t=Ld[e];i.push({color:t,yarndetail:e})}),Object.keys(s).forEach(e=>{n.push({color:$s[e],yarndetail:e})}),i.forEach(e=>{if(e.yarndetail.replace(/[^a-zA-Z]+/g,"")&&e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0]){if(-1==a.findIndex(t=>t.yarnname==e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0])){let t=e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0],n=Ad[t],i=parseInt(v.split(/[\s\n]+/).find(e=>e.includes(t)));i=isNaN(i)?0:i,a.push({yarnname:e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0],type:n&&n.yarnType?`${n.yarnType} ${l_(n.yarnUnit)}`:"",count:i,countInDenier:n&&n.yarnType?s_(n.yarnType,n.yarnUnit,"denier"):0})}a=a.sort((e,t)=>e.yarnname<t.yarnname?-1:e.yarnname>t.yarnname?1:0)}}),n.forEach(e=>{if(e.yarndetail.replace(/[^a-zA-Z]+/g,"")&&e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0]){if(-1==r.findIndex(t=>t.yarnname==String(e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0]).trim())){let t=e.yarndetail.replace(/[^a-zA-Z]+/g,"")[0],n=Ws[t];r.push({yarnname:t,type:n&&n.yarnType?`${n.yarnType} ${l_(n.yarnUnit)}`:"",count:s[t]?s[t]:0,yarnUnit:n&&n.yarnUnit?n.yarnUnit:"denier",countInDenier:n&&n.yarnType?s_(n.yarnType,n.yarnUnit,"denier"):0})}r=r.sort((e,t)=>e.yarnname<t.yarnname?-1:e.yarnname>t.yarnname?1:0)}});let b=r.reduce((e,t)=>e+t.count,0),w=Number(zp.value),E=Number(lh.value);r.forEach(e=>{e.percentage=Number(Number(e.count)/Number(b)*100).toFixed(2),e.weight=(Number(e.countInDenier)*w*(100+Number(lu.weftWeavingShrinkage))*E*e.percentage/9e8).toFixed(2)});let S=r.reduce((e,t)=>Number(e)+Number(t.weight),0);r.push({yarnname:"",type:"",count:b,yarnUnit:"",percentage:"",isFooterRow:!0,weight:Number(S).toFixed(2)});let x=a.reduce((e,t)=>e+t.count,0);a.forEach(e=>{e.weight=(e.countInDenier*e.count*(100+Number(lu.warpWeavingShrinkage))/9e6).toFixed(2),e.percentage=(Number(e.count)/Number(x)*100).toFixed(2)});let I=a.reduce((e,t)=>Number(e)+Number(t.weight),0);a.push({yarnname:"",type:"",count:x,yarnUnit:"",percentage:"",isFooterRow:!0,weight:Number(I).toFixed(2)}),e.innerHTML=`<div class="singlepageprint_container">\n  <div id="singlepage_print_item">\n  <div class="singlepageprint_header">\n     <div class="singlepageprint_company-details">\n        <div>\n           <h1 class="singlepageprint_company-name">${t.companyName}</h1>\n        </div>\n        <div class="singlepageprint_company_info">\n           <p class="singlepageprint_contact-info">Mo: ${t.mobileNo} | Email: <span>${t.email}</span></p>\n           <p class="singlepageprint_address">${t.address}</p>\n        </div>\n     </div>\n  </div>\n  <div class="singlepageprint_details_container">\n     ${$B()} \n  </div>\n\n  <div class="singlepage_warp_weft_info_container" style="display:grid">\n        <div class="warp-info-table-container">\n          ${jB(a,"warp")}\n        </div>\n        <div class="weft-info-table-container">\n          ${jB(r,"weft")}\n        </div>           \n  </div>\n  \n  <div class="singlepageprint_warp-section_row">\n     <div class="singlepageprint_warp-section">\n        <h2 class="singlepageprint_section-title">Warping Section</h2>\n        <table class="singlepageprint_warping_section_table">\n           <tbody>\n              ${h?`<tr>\n                 <td>Left Selvage</td>\n                 <td>${h}</td>\n                 <td>X</td>\n                 <td>1</td>\n                 <td>=</td>\n                 <td>${h}</td>\n              </tr>`:""}\n              <tr>\n                 <td>Body</td>\n                 <td>${m}</td>\n                 <td>X</td>\n                 <td>${u}</td>\n                 <td>=</td>\n                 <td>${Number(m)*Number(u)}</td>\n              </tr>\n              ${f?`<tr>\n                 <td>Extra</td>\n                 <td>${f}</td>\n                 <td>X</td>\n                 <td>1</td>\n                 <td>=</td>\n                 <td>${f}</td>\n              </tr>`:""}\n              ${g?`<tr>\n                 <td>Right Selvage</td>\n                 <td>${g}</td>\n                 <td>X</td>\n                 <td>1</td>\n                 <td>=</td>\n                 <td>${g}</td>\n              </tr>`:""}\n              <tr class="singlepageprint_total-row">\n                 <td colspan="5">Total</td> \n                 <td>${y}</td>\n              </tr>\n           </tbody>\n        </table>\n     </div>\n     <div class="singlepageprint_simulation">\n        <h2 class="singlepageprint_section-title">Simulation</h2>\n        <div id="singlepageprint_simulation_canvas_container" class="singlepageprint_simulation_canvas_container">\n          <canvas id="singlepageprint_simulation_canvas"></canvas>\n        </div>\n     </div>\n     </div>\n     <div class="singlepageprint_draft_table_row-container">\n        <div class="singlepageprint_draft_table-container">\n           <div>Draft Table</div>\n           <div>\n              ${(()=>{let e=document.createElement("table");e.innerHTML+="<thead><tr><th>Part</th><th>R1</th><th>R2</th></tr></thead>";let t=GO.convert_new_index_to_numeric_with_skip_dent(ZO,!1),n=TC(t,"");return console.log("draft_numeric_text==-----:>",t),n.forEach((t,n)=>{let i=!1,r=0;t.withInnerRepeat.forEach(e=>{String(e.repeatedPart).trim().split("\n").forEach(e=>{r+=1})}),t.withInnerRepeat.forEach((n,a)=>{let l=String(n.repeatedPart).trim().split("\n");l.forEach((a,o)=>{let s=document.createElement("tr"),d=document.createElement("td");if(d.innerHTML=a,s.appendChild(d),0==o){let e=document.createElement("td");e.innerHTML=n.innerRepeat,e.rowSpan=l.length,s.appendChild(e)}if(!i){let e=document.createElement("td");e.innerHTML=t.outerRepeat,e.rowSpan=r,s.appendChild(e),i=!0}e.appendChild(s)})})}),`<table style="border:1px solid #e0e0e0;">${e.innerHTML}</table>`})()}\n           </div>\n        </div>\n        <div class="singlepageprint_pegplan_table_container">\n        <div style="margin-right:5px;">\n        <div class="singlepageprint_warp_pattern_table">${""+MB(qC(),"warp")}\n        </div>\n        <div class="singlepageprint_weft_pattern_table">${""+MB(UC(),"weft")}</div>\n        </div>\n          \n           <div id="singlepageprint_pegplan_table_container" class="singlepageprint_pegplan_table">${OB()}</div>\n    \n        </div>\n     </div>\n     </div>\n     <div>${(()=>{let e=GO.convert_new_index_to_numeric(ZO),t=XC(e),n=(GO.rows(),String(t).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e).length));return n=[...new Set([...n])].sort(),`\n  <div class="print-preview-sidebar">\n    \n    <div class="print-preview-sidebar-container">\n      <div class="print-preview-sidebar-container-header">Pegplan View</div>\n\n      <div class="print-preview-sidebar-container-content">\n        <select\n          type="text"\n          name="printpreview-pegplan-view"\n          id="singlepage_print_pegplan_view"\n        \n        >\n          <option value="${yi.GRAPHICALYESWITHNUMERICNO}">Graphic</option>\n          <option value="${yi.GRAPHICALNOWITHNUMERICNO}">Numeric</option>\n          <option value=${yi.GRAPHICALNOWITHNUMERICYES}>Num Table</option>\n          <option value=${yi.GRAPHICALYESWITHNUMERICYES}>Graphic + Num</option>\n         \n        </select>\n\n       \n      </div>\n\n\n\n      <div class="print-preview-sidebar-container">\n<input type="checkbox" class="printpreview-sidebar-checkbox" id="singlepageprint-sidebar-checkbox-twopickletis" ${RB.isTwoPickLetisEnabled?"checked":""} />\n<label for="singlepageprint-sidebar-checkbox-twopickletis">2 Pick Letis</label>\n</div>\n    </div>\n    \n    \n    <div id="single_page_print_button">Print</div>\n  </div>\n\n`})()}</div>\n  </div>`;let k=BB.querySelector("#single_page_print_button"),_=BB.querySelector("#singlepageprint-sidebar-checkbox-twopickletis"),T=BB.querySelector("#singlepage_print_pegplan_view");T.value=RB.pegplanType,_.checked=RB.isTwoPickLetisEnabled,T.addEventListener("change",e=>{RB.pegplanType=e.target.value,HB()}),_.addEventListener("change",e=>{console.log("checked ccccc===>",e.target.checked),RB.isTwoPickLetisEnabled=e.target.checked,HB()}),k.addEventListener("click",()=>{console.log("print button clicked");let e=BB.querySelector("#singlepage_print_item");$(e).printThis({beforePrint:()=>{e.style.overflow="visible"},canvas:!0,afterPrint:()=>{e.style.overflow="scroll"}}),console.log("printitem",e)}),setTimeout(()=>{(()=>{let e=document.querySelector("#design-selection-input-part-1");console.log("first element is",e);e.querySelector("#start-x");const t=e.querySelector("#end-x"),n=(e.querySelector("#start-y"),e.querySelector("#end-y"));t.value=GO.cols(),n.value=KO.rows(),uf(!0),t.value=40,n.value=40;const i=document.getElementById("simulation-model-canvas");if(0==i.height||0==i.width)return;const r=i.getContext("2d"),a=document.getElementById("singlepageprint_simulation_canvas"),l=a.getContext("2d");let o=document.getElementById("singlepageprint_simulation_canvas_container");a.height=o.offsetHeight,a.width=o.offsetWidth;const s=r.getImageData(0,0,i.width,i.height);let d=Math.ceil(a.height/s.height);for(let e=0;e<d;e++)l.putImageData(s,0,e*s.height);console.log("printSimulationCanvas is",a)})()},0)},HB=()=>{BB.querySelector("#singlepageprint_pegplan_table_container").innerHTML=OB()},qB=()=>{BB.style.display="none";BB.querySelector("#modal-desc").innerHTML="",Yi("")},UB=async()=>{await zl("Do You Want Single Page Sheet?","Yes","No")?(WB(),Yi(BB.id),BB.style.display="block",BB.style.animation="slide-down 0.3s ease"):(wv(),Yi(Ky.id),Ky.style.display="block",Ky.style.animation="slide-down 0.3s ease")},zB=e=>{const t=JSON.parse(localStorage.getItem("user"))._id,n=localStorage.getItem("token");return Zo.post(ba+"/subscriber/logout",{token:e,user:t},{headers:{token:n}})},VB=e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/setting/get-uploded-imageURL",{path:e},{headers:{token:t}})},YB=document.getElementById("create-ticket-modal"),GB=document.getElementById("create-new-ticket-trigger"),JB=document.getElementById("avatar-support-modal"),XB=document.getElementById("create-ticket-modal-submit"),KB=e=>{e.preventDefault(),(e=>{const t=localStorage.getItem("token");return Zo.post(configObjectject.APP_API+"/complaint/create",e,{headers:{token:t}})})({company:JSON.parse(localStorage.getItem("company")).id,subscriber:JSON.parse(localStorage.getItem("user")),problem:document.getElementById("ticket-problem").value,subject:document.getElementById("ticket-subject").value,complaintType:document.getElementById("complaint-type").value}).then(e=>{"SUCCESS"===e.data.STATUS&&(Toastify({text:"Ticket Create Successfully!!",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast(),QB()),document.getElementById("ticket-problem").value="",document.getElementById("ticket-subject").value="",document.getElementById("complaint-type").value=""}).catch(e=>console.log("err",e))},ZB=()=>{JB.style.display="none",YB.style.display="block",YB.style.animation="slide-down 0.3s ease"},QB=()=>{YB.style.display="none"},eR=document.getElementById("copy-design-trigger"),tR=document.getElementById("copy-design-modal");const nR=e=>{"Escape"===e.key&&rR()},iR=()=>{(()=>{let e=document.querySelectorAll(".copy-design-tabs h3"),t=document.querySelectorAll(".copy-design-contents section");e.length>0&&t.length>0&&(e[0].classList.add("active"),t[0].classList.add("active"),t[0].style.display="block",t[1].style.display="none",t[2].style.display="none",e.forEach((n,i)=>{n.addEventListener("click",()=>{t.forEach(e=>{e.classList.remove("active"),e.style.display="none"}),e.forEach(e=>{e.classList.remove("active")}),t[i].classList.add("active"),t[i].style.display="block",e[i].classList.add("active")})}))})(),document.addEventListener("keydown",nR),Uf(),tR.style.display="block",tR.style.animation="slide-down 0.3s ease"},rR=()=>{document.removeEventListener("keydown",nR),tR.style.display="none"};function aR(e){let t=0,n=0,i=0,r=0;const a=e.querySelector(".modal-title");function l(a){a.preventDefault(),t=i-a.clientX,n=r-a.clientY,i=a.clientX,r=a.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"}function o(){document.onmouseup=null,document.onmousemove=null}a&&(a.onmousedown=function(e){e.preventDefault(),i=e.clientX,r=e.clientY,document.onmouseup=o,document.onmousemove=l})}const lR=document.getElementById("upload-bin-file-trigger"),oR=document.getElementById("upload-bin-file-input"),sR=()=>{oR.click()},dR=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{const t=new Uint8Array(e),n=t.byteLength/4;let i="",r=[],a=[],l="";for(let e=0;e<n;e++){let o=t.slice(4*e,4*(e+1)),s="",d="";o.forEach(e=>{s+=Number(e).toString(2).padStart(8,"0").split("").reverse().join("")});let c=s.at(23);Number(c)&&r.push(new aL("A",n-e-1));let u=s.slice(-8).search("1"),p=s.slice(20,23).search("1");-1!=p&&a.push(new aL(String.fromCharCode(65+p),n-e-1)),-1!=u&&(l+=String.fromCharCode(65+u)+"\n"),d=s.slice(0,20).split("").map((e,t)=>Number(e)?""+(t+1):"").filter(e=>e).join(" "),i+=d+"\n"}Pv("weft"),Sv.value=l,jv(!1,!0),l$.cells=r,s$.cells=a,Hh.value=i.trim(),Qh()})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},cR=document.getElementById("upload-ga731-file-trigger"),uR=document.getElementById("upload-ga731-file-input"),pR=()=>{uR.click()},hR=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{const t=new Uint8Array(e),n=t.byteLength/5;let i="",r=[],a=[],l="";for(let e=0;e<n;e++){let o=t.slice(5*e,5*(e+1)),s="",d="";o.forEach(e=>{s+=Number(e).toString(2).padStart(8,"0").split("").reverse().join("")});let c=s.at(35);Number(c)&&r.push(new aL("A",n-e-1));let u=s.slice(24,32).search("1"),p=s.slice(32,35).search("1");-1!=p&&a.push(new aL(String.fromCharCode(65+p),n-e-1)),-1!=u&&(l+=String.fromCharCode(65+u)+"\n"),d=s.slice(0,20).split("").map((e,t)=>Number(e)?""+(t+1):"").filter(e=>e).join(" "),i+=d+"\n"}Pv("weft"),Sv.value=l,jv(!1,!0),l$.cells=r,s$.cells=a,Hh.value=i.trim(),Qh()})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},gR=document.getElementById("upload-bnx-file-trigger"),mR=document.getElementById("upload-bnx-file-input"),fR=()=>{mR.click()},yR=e=>{let t=e[1],n=e[0],i=Number(t).toString(2).padStart(8,"0")+Number(n).toString(2).padStart(8,"0");return parseInt(i,2)},vR=e=>{const t=new Uint8Array(e);let n=!1;for(let e=6;e<t.length;e+=4)if(9==t[e]){n=!0;break}n?(e=>{if(e instanceof Uint8Array){let t="",n=yR(e.slice(0,2)),i=yR(e.slice(2,4)),r=[],a=0;if(i>16)return void nL("Shaft More than 16 are not supported in bnx file");let l="";for(let i=0;i<n;i++){let n=Array.from(e.slice(4*(i+1),4*(i+2)));if(9==n[2]){let o=yR(n.slice(0,2)),s=0,d="",c="",u=[];for(i+=1,n=Array.from(e.slice(4*(i+1),4*(i+2)));10!=n[2];){d+=n.slice(0,2).map(e=>Number(e).toString(2).padStart(8,"0").split("").reverse().join("")).join("").split("").map((e,t)=>Number(e)?t+1:e).filter(e=>Number(e)).join(" ")+"\n";let t=n.at(2).toString(2).padStart(8,0).split("").reverse().findIndex(e=>Number(e));c+=-1!=t?String.fromCharCode(65+t)+"\n":"A\n";let r=n.at(3).toString(2).padStart(8,0).split("").reverse().findIndex(e=>Number(e));-1!=r?u.push(String.fromCharCode(65+r)):u.push("A"),i++,n=Array.from(e.slice(4*(i+1),4*(i+2))),s++}u.forEach((e,t)=>{for(let n=0;n<o;n++)r.push(new aL(e,t+a+n*s))}),t+=`[${d.trim()}]X${o}\n\n\n`,l+=`[${c.trim()}]X${o}\n`,a+=s*o}else{t+=n.slice(0,2).map(e=>Number(e).toString(2).padStart(8,"0").split("").reverse().join("")).join("").split("").map((e,t)=>Number(e)?t+1:e).filter(e=>Number(e)).join(" ")+"\n";let e=n.at(2).toString(2).padStart(8,0).split("").reverse().findIndex(e=>Number(e));l+=-1!=e?String.fromCharCode(65+e)+"\n":"A\n";let i=n.at(3).toString(2).padStart(8,0).split("").reverse().findIndex(e=>Number(e));r.push(new aL(String.fromCharCode(65+i),a)),a++}}r=r.sort((e,t)=>e.index-t.index),s$.cells=r.map(e=>({...e,index:a-e.index-1})),Hh.value=t.trim(),KO.change_no_of_cols(i),Qh(),Pv("weft"),Sv.value=l,jv(!1,!0)}})(t):(e=>{if(e instanceof Uint8Array){let t="",n=yR(e.slice(0,2)),i=yR(e.slice(2,4));if(i>16)return void nL("Shaft More than 16 are not supported in bnx file");let r=[],a="";for(let i=0;i<n;i++){let l=Array.from(e.slice(4*(i+1),4*(i+2)));t+=l.slice(0,2).map(e=>Number(e).toString(2).padStart(8,"0").split("").reverse().join("")).join("").split("").map((e,t)=>Number(e)?t+1:e).filter(e=>Number(e)).join(" ")+"\n";let o=l.at(2).toString(2).padStart(8,0).split("").reverse().findIndex(e=>Number(e));a+=-1!=o?String.fromCharCode(65+o)+"\n":"A\n";let s=l.at(3).toString(2).padStart(8,0).split("").reverse().findIndex(e=>Number(e));r.push(new aL(String.fromCharCode(65+s),n-i-1))}Hh.value=t.trim(),KO.change_no_of_cols(i),s$.cells=r,Qh(),Pv("weft"),Sv.value=a,jv(!1,!0)}})(t)},bR=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){const t=e.target.result;vR(t)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},wR=document.getElementById("upload-dat-file-trigger"),ER=document.getElementById("upload-dat-file-input"),SR=()=>{ER.click()},xR=e=>{let t=_R(e);t.reverse();let n=IR(t.join("")).toString(2).padStart(16,"0").split("").reverse().join("");return kR(n)};function IR(e){const t=new ArrayBuffer(4),n=new DataView(t);return n.setUint32(0,parseInt(e,2)),n.getFloat32(0)}const kR=e=>{let t=[];for(let n=0;n<e.length;n++)"1"===e[n]&&t.push(n+1);return t.join(" ")};function _R(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}function TR(e){let t=[];for(let n=0;n<e.length;n+=4)t.push(e.slice(n,n+4));return t}const NR=e=>{let t=_R(e);return t.reverse(),IR(t.join(""))},CR=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{const t=new Uint8Array(e),n=176==(i=t[0])?"redflag":152==i?"old":232==i?"type2":"type1";var i;let r="",a="",l=[];if("type1"==n){const e=t.slice(40004,80004),n=t.slice(4,40004),i=t.slice(80004,120004);for(let t=0;t<e.length;t+=4){let o=e.slice(t,t+4),s="";o.forEach(e=>{s+=Number(e).toString(2).padStart(8,"0")}),r+=xR(s)+"\n";let d=n.slice(t,t+4),c="";d.forEach(e=>{c+=Number(e).toString(2).padStart(8,"0")});let u=NR(c);u&&(a+=String.fromCharCode(u+64)+"\n");let p=i.slice(t,t+4),h="";p.forEach(e=>{h+=Number(e).toString(2).padStart(8,"0")});let g=NR(h);if(g){let e=String.fromCharCode(g+64);l.push(new aL(e,t/4))}}Hh.value=r.trim(),Qh(),Pv("weft"),Sv.value=a,jv(!1),s$.cells=l.map(e=>new aL(e.color_code,l.length-e.index-1)),ud()}if("type2"==n){const e=[...t.slice(40008,60008),...t.slice(70008,1100008)],n=t.slice(8,40008),i=t.slice(60008,70004);let o=0;for(let t=0;t<e.length;t+=4){let s=e.slice(t,t+4),d="";s.forEach(e=>{d+=Number(e).toString(2).padStart(8,"0")}),r+=xR(d)+"\n";let c=n.slice(t,t+4),u="";c.forEach(e=>{u+=Number(e).toString(2).padStart(8,"0")});let p=NR(u);p&&(a+=String.fromCharCode(p+64)+"\n");let h=i.slice(t,t+4),g="";h.forEach(e=>{g+=Number(e).toString(2).padStart(8,"0")});let m=NR(g);if(m){TR(Number(m).toString(2).padStart(16,"0")).map(e=>String.fromCharCode(parseInt(e,2)+64)).filter(e=>/^[A-Z]$/.test(e)).forEach(e=>{l.push(new aL(e,o)),o++})}}Hh.value=r.trim(),Qh(),Pv("weft"),Sv.value=a,jv(!1),s$.cells=l.map(e=>new aL(e.color_code,l.length-e.index-1)),ud()}if("old"==n){const e=t.slice(8,20004),n=t.slice(20008,40004),i=t.slice(40008,60004);for(let t=0;t<e.length;t+=4){let o=e.slice(t,t+4),s="";o.forEach(e=>{s+=Number(e).toString(2).padStart(8,"0")}),r+=xR(s)+"\n";let d=n.slice(t,t+4),c="";d.forEach(e=>{c+=Number(e).toString(2).padStart(8,"0")});let u=NR(c);u&&(a+=String.fromCharCode(u+64)+"\n");let p=i.slice(t,t+4),h="";p.forEach(e=>{h+=Number(e).toString(2).padStart(8,"0")});let g=NR(h);if(g){let e=String.fromCharCode(g+64);l.push(new aL(e,t/4))}}Hh.value=r.trim(),Qh(),Pv("weft"),Sv.value=a,jv(!1),s$.cells=l.map(e=>new aL(e.color_code,l.length-e.index-1)),ud()}if("redflag"==n){let e=t.slice(160008,240008),n=[];for(let t=0;t<e.length;t+=4){let i=e.slice(t,t+4),r="";i.forEach(e=>{r+=Number(e).toString(2).padStart(8,"0")});let a=_R(r);a.reverse();let l=IR(a.join("")).toString(2).padStart(16,"0").split("").reverse().join(""),o=kR(l);n.push(o)}let i=t.slice(240008,320008),r=[];for(let e=0;e<i.length;e+=4){let t=i.slice(e,e+4),n="";t.forEach(e=>{n+=Number(e).toString(2).padStart(8,"0")});let a=_R(n);a.reverse();let l=IR(a.join(""));r.push(l)}let a="",l="";for(let e=0;e<2e3;e++){let t=n[e],i=r[e];if(0==i)break;if(0==t.length&&2!=i){let e=parseInt((i-3)/4);a+=1==e?l.trim()+"\n\n\n":`[${l.trim()}]X${e}\n\n\n`,l=""}if(t.length>0){let e=Number(i).toString(2).padStart(16,"0").slice(0,4).split("").reverse().join("").padStart(20,"0"),n=kR(e);l+=`${t}${n.length>0?" "+n:n}\n`}}let o=t.slice(8,80008),s=33,d="",c="";for(let e=0;e<o.length;e+=4){let t=o.slice(e,e+4),n="";t.forEach(e=>{n+=Number(e).toString(2).padStart(8,"0")});let i=_R(n);i.reverse();let r=IR(i.join(""));if(0==r)break;if(r>=33&&r<=48&&(c+=String.fromCharCode(r-s+65)+"\n"),r>=61){let e=parseInt((r-29)/32);d+=`[${c.trim()}]X${e}\n`,c=""}}let u=t.slice(80008,160008),p=33,h="",g="";for(let e=0;e<u.length;e+=4){let t=u.slice(e,e+4),n="";t.forEach(e=>{n+=Number(e).toString(2).padStart(8,"0")});let i=_R(n);i.reverse();let r=IR(i.join(""));if(0==r)break;if(r>=33&&r<=48&&(g+=String.fromCharCode(r-p+65)+"\n"),r>=61){let e=parseInt((r-29)/32);h+=`[${g.trim()}]X${e}\n`,g=""}}Hh.value=a.trim(),Qh(),Pv("weft"),Sv.value=d.trim(),jv(!1);let m=1,f=XC(h);String(f).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let n=0;n<t;n++)s$.update_cell(s$.size-m,GC(e)),m++})}),ud()}console.log("data is",t)})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},LR=document.getElementById("import-draft-texcad"),AR=document.getElementById("import-draft-texcad-file"),PR=()=>{AR.click()},BR=e=>{const t=e.target.files[0];if(!t)return;Uf(),eT();const n=new FileReader;n.onload=function(e){const t=e.target.result;(e=>{console.log(" drf buffer is",e);const t=new Uint8Array(e);let n=[],i=[],r="",a="";for(let e=0;e<1e3;e++){const l=13*e;let o=t.slice(l,l+12),s=t[l+12];if(o.forEach((e,t)=>{if(e)if(e>100){let t=tL(XC(a));i.push(t),a+=e-100+" "}else a+=50==e?"0 ":e+" "}),s){let e=tL(XC(r)),t=tL(XC(a));if(a.trim().length>0&&(r+=`[${a.trim()}]X${s}\n`,a=""),i.length>0){for(let r=0;r<s;r++)i.forEach(i=>{n.push(new aL("A",e+i+t*r))});i=[]}}else a=a.trim(),a+="\n"}console.log("Extra warp cells are",n),aE.value=r,o$.cells=n,bE()})(t),console.log("Processing Done",t)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},RR=document.getElementById("upload-file-trigger"),FR=document.getElementById("upload-file-input"),MR=()=>{FR.click()};function DR(e){let t=[];for(let n=0;n<8;n++)0!=(e&1<<n)&&t.push(n);return t}function OR(e){if(0===e)return-1;for(let t=0;t<8;t++)if(0!=(e&1<<t))return t}const $R=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){const t=e.target.result;(e=>{let t={};const n=new Uint8Array(e),i=new Uint8Array(4);let r=n.slice(0,12);if(3!=r[0]||49!=r[1]&&46!=r[2]&&48!=r[3])return void Toastify({text:"Please Selected Valid Mwd File",style:{background:"linear-gradient(135deg,#FF0200, #F6A5A5)"}}).showToast();i[0]=n[12],i[1]=n[13],i[2]=n[14],i[3]=n[15];const a=FI(i),l=new Uint8Array(4);l[0]=n[16],l[1]=n[17],l[2]=n[18],l[3]=n[19];const o=FI(l),s=new Uint8Array(4);s[0]=n[20],s[1]=n[21],s[2]=n[22],s[3]=n[23];const d=FI(s);t.designWidth=a,t.designHeight=o,t.shaft=d;let c=[],u=24,p=[],h=[],g="";const m={size:a,isWeftColor:!1,isFunctionCanvas:!1,isWarpColor:!1,isWarpCreamingCanvas:!0,isDencityCanvas:!1,cells:[],fixNumericText:""};for(let e=0;e<a;e++){n[u]>0&&m.cells.push(new aL("A",e));let t=`rgb(${n[u+4]},${n[u+5]},${n[u+6]})`,i=h.findIndex(e=>e==t);-1==i?(h.push(t),g+=String.fromCharCode(64+h.length)+"\n"):g+=String.fromCharCode(65+i)+"\n";const r=OR(n[u+8]),a=OR(n[u+9]),l=OR(n[u+10]),o=OR(n[u+11]);d>0&&d<=8?a>-1&&c.push(a+1):d>8&&d<=16?r>-1?r+1-16+d>0?c.push(r+1-(16-d)):c.push(0):a>-1&&9+a-16+d>0?c.push(9+a-(16-d)):c.push(0):d>16&&d<=24?(r>-1&&c.push(9+r-(24-d)),a>-1&&c.push(17+a-(24-d)),o>-1&&c.push(1+o-(24-d))):d>24&&d<=32?r>-1?c.push(32-d+r+9):l>-1?c.push(l+d-32+1):o>-1?c.push(32-d+o+1):c.push(0):d>32&&d<=40&&(r>-1?c.push(40-d+r+9):l>-1?c.push(l+d-40+1):o>-1?c.push(40-d+o+1):c.push(0)),n[u+24]<2?p.push(1):p.push(2),u+=28}let f="";c.length==p.length?(c.forEach((e,t)=>{p[t]!=p[t-1]?f+="\n":f+=" ",f+=e}),f=f.trim()):c.forEach((e,t)=>{f+=e+((t+1)%2==0?"\n":" ")});let y="",v=[],b="";for(let e=0;e<o;e++){let e=[],t=`rgb(${n[u+0]},${n[u+1]},${n[u+2]})`,i=v.findIndex(e=>e==t);-1==i?(v.push(t),b+=String.fromCharCode(64+v.length)+"\n"):b+=String.fromCharCode(65+i)+"\n";let r=DR(n[u+4]),a=DR(n[u+5]),l=DR(n[u+6]),o=DR(n[u+7]);if(r.length>0)for(let t=0;t<r.length;t++)e.push(16-r[t]);if(a.length>0)for(let t=0;t<a.length;t++)e.push(8-a[t]);if(l.length>0)for(let t=0;t<l.length;t++)e.push(32-l[t]);if(o.length>0)for(let t=0;t<o.length;t++)e.push(24-o[t]);u+=36,e=e.sort((e,t)=>e-t),y+=e.join(" ")+"\n"}let w={},E={};v.forEach((e,t)=>{w[String.fromCharCode(t+65)]=e}),u_(w),h.forEach((e,t)=>{E[String.fromCharCode(t+65)]=e}),p_(E),y=y.split("\n").reverse().join("\n").trim(),t.pegPlan=y,t.weftPattern=b,t.draftPlan=f,t.warpPattern=g,t.extraWarp=JSON.stringify(m),Jg(t)})(t),console.log("Processing Done",t)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},jR=document.getElementById("import-pegplan-texcad"),WR=document.getElementById("import-pegplan-texcad-file"),HR=()=>{WR.click()},qR=e=>{const t=e.target.files[0];if(!t)return;Uf(),eT();const n=new FileReader;n.onload=function(e){const t=e.target.result;(e=>{console.log(" drf buffer is",e);const t=new Uint8Array(e);let n=7500==t.byteLength,i=n?300:1e3,r=n?24:22,a="",l="",o=[],s=[];for(let e=0;e<i;e++){const i=25*e;let d=t.slice(i,i+r),c=n?0:t[i+23],u=t[i+24];if(d.forEach((e,t)=>{e&&(l+=t+1+" ")}),c){let e=eL(XC(l));s.push(e)}if(u){let e=eL(XC(a)),t=eL(XC(l));if(l.trim().length>0&&(a+=`[${l.trim()}]X${u}\n`,l=""),s.length>0){for(let n=0;n<u;n++)s.forEach(i=>{o.push(new aL("A",e+i+t*n))});s=[]}}else l=l.trim(),l+="\n"}Hh.value=a,Qh();let d=l$.size;l$.cells=o.map(e=>({...e,index:d-e.index})),cd()})(t),console.log("Processing Done",t)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},UR=(document.getElementById("upload-pt7-file-trigger"),document.getElementById("upload-pt7-file-input"),document.getElementById("upload-rfj-file-trigger")),zR=document.getElementById("upload-rfj-file-input"),VR=()=>{zR.click()};function YR(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}const GR=e=>{let t=e[1],n=e[0],i=Number(t).toString(2).padStart(8,"0")+Number(n).toString(2).padStart(8,"0");return parseInt(i,2)};function JR(e){return 0===e?-1:Math.log2(e&-e)+1}const XR=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{const t=new Uint8Array(e);let n="",i="",r="",a=GR(t.slice(4,6)),l=0;l+=6+4*a+4;for(let e=0;e<a;e++){let a=t.slice(6+4*e,10+4*e),o=GR(a.slice(0,2)),s=GR(a.slice(2,4)),d=4*o+4,c=t.slice(l,l+d);l+=d;let u="",p="",h="";for(let e=0;e<c.length;e+=4){let t=c.slice(e,e+4),n=t.slice(0,2),i=JR(t[2]),r=JR(t[3]),a=Array.from(n).map(e=>Number(e).toString(2).padStart(8,"0")).join("");a=YR(a).map(e=>String(e).split("").reverse().join("")).join(""),u+=a.split("").map((e,t)=>Number(e)?t+1:e).filter(e=>Number(e)).join(" ")+"\n",-1!=i&&(p+=String.fromCharCode(64+i)+"\n"),-1!=r&&(h+=String.fromCharCode(64+r)+"\n")}n+=`[${u.trim()}]X${s}\n\n\n`,i+=`[${p.trim()}]X${s}\n`,r+=`[${h.trim()}]X${s}\n`}Hh.value=n.trim(),Qh(),Pv("weft"),Sv.value=i,jv(!1,!0);let o=1,s=XC(r);String(s).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let n=0;n<t;n++)s$.update_cell(s$.size-o,GC(e)),o++})}),ud()})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},KR=document.getElementById("upload-tdw-file-trigger"),ZR=document.getElementById("upload-tdw-file-input"),QR=()=>{ZR.click()};function eF(e){let t=[];for(let n=0;n<e.length;n+=8)t.push(e.slice(n,n+8));return t}function tF(e){const t=new ArrayBuffer(4),n=new DataView(t);return n.setUint32(0,parseInt(e,2)),n.getFloat32(0)}const nF=e=>{let t=eF(e);return t.reverse(),tF(t.join(""))},iF=e=>{let t=eF(e);return t.reverse(),(e=>{let t=[];for(let n=0;n<e.length;n++)"1"===e[n]&&t.push(n+1);return t.join(" ")})(tF(t.join("")).toString(2).padStart(16,"0").split("").reverse().join(""))};function rF(e){for(let t=e.length-1;t>=0;t--)if("1"===e[t])return e.length-t;return-1}const aF=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{const t=new Uint8Array(e),n=t.slice(4,8);let i="";n.forEach(e=>{i+=Number(e).toString(2).padStart(8,"0")});let r=nF(i),a="",l=[],o="",s=[];for(let e=0;e<r;e++){let n=12+8*e,i=t.slice(n,n+8),r=i.slice(0,4),d="";r.forEach(e=>{d+=Number(e).toString(2).padStart(8,"0")}),a+=iF(d)+"\n";let c=i.slice(4,8),u="";c.forEach(e=>{u+=Number(e).toString(2).padStart(8,"0")});let p=nF(u),h=Number(p).toString(2).padStart(16,0),g=parseInt(h.slice(0,4),2),m=parseInt(h.slice(4,8),2),f=rF(h.slice(8,16));o+=String.fromCharCode(f+64)+"\n",l.push(new aL(String.fromCharCode(m+64),e)),s.push(new aL(String.fromCharCode(g+64),e))}Sv.value=o,jv(!1),Hh.value=a.trim(),Qh(),s$.cells=l.map(e=>new aL(e.color_code,l.length-e.index-1)),h$.cells=s.map(e=>new aL(e.color_code,l.length-e.index-1)),ud(),sd()})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsArrayBuffer(t)},lF=document.getElementById("upload-txt-file-trigger"),oF=document.getElementById("upload-txt-file-input"),sF=()=>{oF.click()},dF=e=>{if("0"==e)return"0";return(e=>{let t=[];for(let n=0;n<e.length;n++)"1"===e[n]&&t.push(n+1);return t.join(" ")})(Number(e).toString(2).padStart(20,"0").split("").reverse().join(""))},cF=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){(e=>{let t=String(e).trim().split("\n"),n="",i="",r="",a="",l="",o="",s="",d="",c=0;for(let e=0;e<t.length;e++){let u=t[e].split(",");if(5==u.length){let[e,t,p,h,g]=u;"100"==e?c=Number(t):"101"==e?(n+=`[${l.trim()}]X${c}\n`,i+=`[${o.trim()}]X${c}\n`,r+=`[${s.trim()}]X${c}\n`,a+=`[${d.trim()}]X${c}\n`,l="",o="",s="",d=""):(l+=String.fromCharCode(64+Number(e))+"\n",o+=dF(g)+"\n",d+=String.fromCharCode(64+Number(h))+"\n",s+=String.fromCharCode(64+Number(p))+"\n")}}Hh.value=i.trim(),Qh(),Pv("weft"),Sv.value=n,jv(!1,!0);let u=1,p=XC(r);String(p).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let n=0;n<t;n++)s$.update_cell(s$.size-u,GC(e)),u++})}),ud(),u=1;let h=XC(a);String(h).split("\n").filter(e=>e.length>0).forEach(e=>{e.split(" ").forEach(e=>{let t=isNaN(parseInt(e))?1:parseInt(e);for(let n=0;n<t;n++)h$.update_cell(h$.size-u,GC(e)),u++})}),sd()})(e.target.result)},n.onerror=function(e){console.error("Failed to read file: "+e.target.error.code)},n.readAsText(t)},uF=document.getElementById("upload-xml-file-trigger"),pF=document.getElementById("upload-xml-file-input"),hF=()=>{pF.click()},gF=(e,t)=>e.querySelector(`patternData[PatternNr="${t}"]`).querySelector("data").innerHTML.trim(),mF=(e,t)=>{let n="";return String(t).split(",").forEach(t=>{let[i,r]=t.split("in");for(let t=0;t<Number(i);t++)n+=e[Number(r)-1]+"\n"}),n.trim()},fF=e=>{const t=(new DOMParser).parseFromString(e,"application/xml");let n="",i="",r=[];t.querySelector('table[type="Dobby"]').querySelector("data").innerHTML.trim().split(",").forEach(e=>{r.push(Number(e).toString(2).split("").reverse().map((e,t)=>Number(e)?t+1:"").filter(e=>e).join(" "))});const a=t.querySelector('pattern[type="Dobby"]');let l=Number(a.querySelector("maxNrHarness").innerHTML),o=gF(a,0);String(o).split(",").forEach(e=>{if(e.includes("sp")){let[t,i]=e.split("sp"),l=gF(a,i);for(let e=0;e<Number(t);e++){let e=mF(r,l);n+=e+"\n"}n+="\n\n"}if(e.includes("in")){let t=mF(r,e);n+=t+"\n"}}),Hh.value=n.trim(),KO.change_no_of_cols(l);let s=n.trim().split("\n").filter(e=>e.trim()).length,d=[];t.querySelector('table[type="Color"]').querySelector("data").innerHTML.trim().split(",").forEach((e,t)=>{(e=>{Number(String(e).split("+").map(e=>e).reduce((e,t)=>Number(t)+Number(e)))})(e);d.push(String.fromCharCode(64+t+1))});const c=t.querySelector('pattern[type="Color"]');let u=gF(c,0);String(u).split(",").forEach(e=>{if(e.includes("sp")){let[t,n]=e.split("sp"),r=gF(c,n);for(let e=0;e<Number(t);e++)i+=mF(d,r)+"\n"}if(e.includes("in")){let t=mF(d,e);i+=t+"\n"}}),Pv("weft"),Sv.value=i;let p=[];const h=t.querySelector('pattern[type="CrammingMotion"]');if(h){let e=gF(h,0),t=0;String(e).split(",").forEach(e=>{if(e.includes("sp")){let[n,i]=e.split("sp"),r=gF(h,i);for(let e=0;e<Number(n);e++)String(r).split(",").forEach(e=>{let[n,i]=e.split("in");for(let e=0;e<Number(n);e++)2==Number(i)&&p.push(t),t++})}else e.includes("in")&&String(e).split(",").forEach(e=>{let[n,i]=e.split("in");for(let e=0;e<Number(n);e++)2==Number(i)&&p.push(t),t++})}),l$.size=s,l$.cells=p.map(e=>({index:s-e-1,color_code:"A"}))}const g=t.querySelector('pattern[type="PickDensity"]');let m=[];if(g){let e=[],n=[];t.querySelector('table[type="PickDensity"]').querySelector("data").innerHTML.trim().split(",").forEach((t,n)=>{e.push(String.fromCharCode(64+Number(n+1)))});let i=gF(g,0);String(i).split(",").forEach(t=>{if(t.includes("sp")){let[i,r]=t.split("sp"),a=gF(g,r);for(let t=0;t<Number(i);t++)n+=mF(e,a)+"\n"}t.includes("in")&&(n+=mF(e,t)+"\n")}),String(n).trim().split("\n").reverse().forEach((e,t)=>{m.push(new aL(e,t))})}Qh(),jv(!1,!0),g&&(s$.cells=m,ud())},yF=e=>{const t=e.target.files[0];if(!t)return;Uf();const n=new FileReader;n.onload=function(e){const t=e.target.result;fF(t)},n.onerror=function(e){console.error("Failed to read file")},n.readAsText(t)},vF=()=>{RR.addEventListener("click",MR),FR.addEventListener("change",$R),LR.addEventListener("click",PR),AR.addEventListener("change",BR),jR.addEventListener("click",HR),WR.addEventListener("change",qR),VI.addEventListener("click",GI),YI.addEventListener("change",JI),lR.addEventListener("click",sR),oR.addEventListener("change",dR),MI.addEventListener("click",OI),DI.addEventListener("change",jI),gR.addEventListener("click",fR),mR.addEventListener("change",bR),WI.addEventListener("click",qI),HI.addEventListener("change",zI),KR.addEventListener("click",QR),ZR.addEventListener("change",aF),wR.addEventListener("click",SR),ER.addEventListener("change",CR),uF.addEventListener("click",hF),pF.addEventListener("change",yF),cR.addEventListener("click",pR),uR.addEventListener("change",hR),UR.addEventListener("click",VR),zR.addEventListener("change",XR),lF.addEventListener("click",sF),oF.addEventListener("change",cF)};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object(xa.g)("firebase","10.13.0","app");const bF=document.getElementById("linked-devices-modal"),wF=document.getElementById("linked-devices-modal-trigger"),EF=e=>`<div class="modal-content">\n          <div class="close">\n            <span class="close-button">&times;</span>\n          </div>\n          <div class="modal-title">Devices</div>\n          <div id="modal-desc">\n          ${e.map((e,t)=>`\n            <div class="devices flex device-item" style="gap:15px;cursor:pointer;" data-index="${t}">\n              <div class="device-no" style="align-self:center">\n                  ${t+1}\n              </div>\n              <div class="device-icons" style="align-self:center">\n                ${((e,t)=>{if("browser"===e.toLowerCase()){if(t.toLowerCase().includes("chrome"))return'<img src="assets/chrome_48.png" alt="chrome" />';if(t.toLowerCase().includes("firefox")||t.toLowerCase().includes("mozilla"))return'<img src="assets/firefox_48.png" alt="mozilla" />';if(t.toLowerCase().includes("safari"))return'<img src="assets/safari_48.png" alt="safari" />'}return'<img src="assets/maxweavelogo.png" alt="default" style="height:48px;width:48px;object-fit:contain;" />'})(e.agentType,e.userAgent)}\n              </div>\n              <div class="device-name" style="align-self:center">${e.userAgent}(${e.deviceName?e.deviceName:e.ipAddress})</div>\n              <div class="device-login-date" style="align-self:center">${function(e){const t=new Date(e);return`${String(t.getDate()).padStart(2,"0")}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`}(e.createdAt)}</div>\n              <div class="device-logout" style="align-self:center"><input type="button" value="LOGOUT"/></div>\n            </div>\n          `).join("")}\n          </div>\n        </div>`,SF=()=>{bF.style.display="block",bF.style.animation="slide-down 0.3s ease",(()=>{const e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/subscriber/get-active-devices/${t}`,{headers:{token:e}})})().then(e=>{if("SUCCESS"===e.data.STATUS){const t=e.data.DATA;bF.innerHTML=EF(t);const n=bF.querySelector(".close-button");n?n.addEventListener("click",xF):console.error("Close button not found");bF.querySelectorAll(".device-item").forEach(e=>{e.addEventListener("click",e=>((e,t)=>{const n=t[e.currentTarget.dataset.index];confirm(`DO You Really Want to Log-out ${n.userAgent}(${n.ipAddress}) device???`)&&zB(n.token,t.user).then(e=>{"SUCCESS"===e.data.STATUS?(Toastify({text:"Device Logout Successfully!!",gravity:"top",backgroundColor:"linear-gradient(135deg,#FF0200, #F6A5A5)"}).showToast(),xF(),window.location.reload(!0)):Toastify({text:"Something Went Wrong!!",gravity:"top",backgroundColor:"linear-gradient(to right, #ff4040, #ff7373)"}).showToast()}).catch(e=>console.log("err",e))})(e,t))})}}).catch(e=>console.log("Error fetching active devices:",e))},xF=()=>{bF.style.display="none"},IF=document.getElementById("design-function-editor-trigger"),kF=document.getElementById("function-editor-modal");let _F,TF,NF,CF,LF="",AF=[],PF=[];const BF="add",RF="change",FF="delete";let MF=RF;const DF={WEFT:"weft",WARP:"warp",DELETE:"delete"},OF=e=>{"Escape"===e.key&&HF()},$F=e=>{MF=e.target.value},jF=()=>{let e=document.querySelectorAll('[name="function-editor-warp-mode"]'),t=document.querySelectorAll('[name="function-editor-weft-mode"]');e.forEach(e=>{e.removeEventListener("change",$F),e.addEventListener("change",$F)}),t.forEach(e=>{e.removeEventListener("change",$F),e.addEventListener("change",$F)})},WF=()=>{(()=>{let e=document.querySelectorAll(".function-editor-tabs h3"),t=document.querySelectorAll(".function-editor-contents section");e.length>0&&t.length>0&&(e[0].classList.add("active"),t[0].classList.add("active"),t[0].style.display="block",t[1].style.display="none",t[2].style.display="none",LF=DF.WEFT,e.forEach((n,i)=>{n.addEventListener("click",()=>{t.forEach(e=>{e.classList.remove("active"),e.style.display="none"}),e.forEach(e=>{e.classList.remove("active")}),t[i].classList.add("active"),t[i].style.display="block",e[i].classList.add("active"),LF=Object.values(DF)[i],MF=BF,document.querySelectorAll(`[value="${BF}"]`).forEach(e=>{e.checked=!0}),console.log("currentEditorMode",MF)})}))})(),document.addEventListener("keydown",OF),Uf(),(()=>{let e="";PF=MC(qC()),PF.forEach(t=>{e+=`<tr id=function-editor-warp-${t}>\n    <td>${t}</td>\n    <td>\n      <input type="checkbox" />\n    </td>\n    <td>\n      <input type="checkbox"/>\n    </td>\n  </tr>`});let t=`<div>\n  <div style="display:flex;justify-content:space-between;">\n  <div>\n    <input type="radio" name="function-editor-warp-mode" checked value="${BF}" />\n    <label>Add</label>\n    </div>\n    <div>\n    <input type="radio" name="function-editor-warp-mode"  value="${RF}" />\n    <label>Change</label>\n    </div>\n    <div>\n    <input type="radio" name="function-editor-warp-mode" value="${FF}" />\n    <label>Delete</label>\n    </div>\n  </div>\n\n\n  <table style="margin-top:4px;">\n  <tr>\n    <th>Warp</th>\n    <th>Extra Warp</th>\n    <th>Double Beam</th>\n  </tr>\n ${e}\n</table></div>`;CF.innerHTML=t,MF=BF,jF()})(),(()=>{let e="";AF=MC(UC()),AF.forEach(t=>{e+=`<tr id=function-editor-weft-${t}>\n    <td>${t}</td>\n    <td>\n      <input type="checkbox" />\n      <span>+1</span>\n      <input type="checkbox" />\n    </td>\n    <td>\n      <input type="number"/>\n      <span>+1</span>\n      <input type="checkbox" /> \n    </td>\n    <td>\n    <input type="number"/>\n    <span>+1</span>\n    <input type="checkbox" /> \n  </td>\n  </tr>`});let t=`<div>\n  <div style="display:flex;justify-content:space-between;">\n  <div>\n    <input type="radio" name="function-editor-weft-mode" checked value="${BF}" />\n    <label>Add</label>\n    </div>\n    <div>\n    <input type="radio" name="function-editor-weft-mode"  value="${RF}" />\n    <label>Change</label>\n    </div>\n    <div>\n    <input type="radio" name="function-editor-weft-mode" value="${FF}" />\n    <label>Delete</label>\n    </div>\n  </div>\n\n\n  <table style="margin-top:4px;">\n  <tr>\n    <th>Weft</th>\n    <th>Creaming</th>\n    <th>Density</th>\n    <th>Speed</th>\n  </tr>\n ${e}\n</table></div>`;NF.innerHTML=t,MF=BF,jF()})(),kF.style.display="block",kF.style.animation="slide-down 0.3s ease"},HF=()=>{document.removeEventListener("keydown",OF),kF.style.display="none"},qF=()=>{LF==DF.WEFT?(()=>{let e=[];AF.forEach(t=>{let n={},i=kF.querySelector("#function-editor-weft-"+t).querySelectorAll("input");n.yarn=t;for(let e=0;e<i.length;e++)0==e&&(n.creaming=i.item(e).checked),1==e&&(n.nextCreaming=i.item(e).checked),2==e&&(n.density=i.item(e).value),3==e&&(n.nextDensity=i.item(e).checked),4==e&&(n.speed=i.item(e).value),5==e&&(n.nextSpeed=i.item(e).checked);e.push(n)}),MF==BF&&e.forEach(e=>{let t=d$.get_all_element_index_with_color_code(e.yarn);if(Array.isArray(t)){if(e.creaming&&l$.addCreamingOnMultipleIndex(t),e.nextCreaming&&l$.addCreamingOnMultipleIndex(t.map(e=>e-1)),e.density&&s$.setDensityCellsAtMultipleIndexes(t,String.fromCharCode(Number(e.density)+64)),e.nextDensity){let n=t.map(e=>e-1);s$.setDensityCellsAtMultipleIndexes(n,String.fromCharCode(Number(e.density)+64))}if(e.speed&&h$.setDensityCellsAtMultipleIndexes(t,String.fromCharCode(Number(e.speed)+64)),e.nextSpeed){let n=t.map(e=>e-1);h$.setDensityCellsAtMultipleIndexes(n,String.fromCharCode(Number(e.speed)+64))}}}),MF==RF&&(l$.cells=[],s$.setDefaultDensityCells(),h$.setDefaultDensityCells(),e.forEach(e=>{let t=d$.get_all_element_index_with_color_code(e.yarn);if(Array.isArray(t)){if(e.creaming&&l$.addCreamingOnMultipleIndex(t),e.nextCreaming&&l$.addCreamingOnMultipleIndex(t.map(e=>e-1)),e.density&&s$.setDensityCellsAtMultipleIndexes(t,String.fromCharCode(Number(e.density)+64)),e.nextDensity){let n=t.map(e=>e-1);s$.setDensityCellsAtMultipleIndexes(n,String.fromCharCode(Number(e.density)+64))}if(e.speed&&h$.setDensityCellsAtMultipleIndexes(t,String.fromCharCode(Number(e.speed)+64)),e.nextSpeed){let n=t.map(e=>e-1);h$.setDensityCellsAtMultipleIndexes(n,String.fromCharCode(Number(e.speed)+64))}}})),MF==FF&&e.forEach(e=>{let t=d$.get_all_element_index_with_color_code(e.yarn);Array.isArray(t)&&(e.creaming&&l$.removeCreamingOnMultipleIndex(t),e.nextCreaming&&l$.removeCreamingOnMultipleIndex(t.map(e=>e-1)))});let t=iT.scrollTop;$T({target:{scrollTop:t}})})():LF==DF.WARP&&(()=>{console.log("warp apply called");let e=[];PF.forEach(t=>{let n={},i=kF.querySelector("#function-editor-warp-"+t).querySelectorAll("input");n.yarn=t;for(let e=0;e<i.length;e++)0==e&&(n.extraWarp=i.item(e).checked),1==e&&(n.doubleBeam=i.item(e).checked);e.push(n)}),MF==BF&&e.forEach(e=>{let t=c$.get_all_element_index_with_color_code(e.yarn);Array.isArray(t)&&(e.extraWarp&&o$.addExtraWarpOnMultipleIndex(t),e.doubleBeam&&p$.change_cells_value_at_multiple_indexes(t,2))}),MF==RF&&(o$.cells=[],p$.recet_cells(),e.forEach(e=>{let t=c$.get_all_element_index_with_color_code(e.yarn);Array.isArray(t)&&(e.extraWarp&&o$.addExtraWarpOnMultipleIndex(t),e.doubleBeam&&p$.change_cells_value_at_multiple_indexes(t,2))})),MF==FF&&e.forEach(e=>{let t=c$.get_all_element_index_with_color_code(e.yarn);Array.isArray(t)&&(e.extraWarp&&o$.removeExtraWarpOnMultipleIndex(t),e.doubleBeam&&p$.change_cells_value_at_multiple_indexes(t,1))});let t=yN.scrollLeft;Hd(),aC(),AN({target:{scrollLeft:t}})})()},UF=()=>{qF(),HF()},zF=()=>{(()=>{kF.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Function Editor</div>\n  <div id="modal-desc">\n    <div>\n      <div class="function-editor-tabs">\n        <h3 class="active" id="function-editor-weft-tab">Weft</h3>\n        <h3 id="function-editor-warp-tab">Warp</h3>\n        \n      </div>\n      <div class="function-editor-contents">\n        <section id="function-editor-weft-tab-content" class="tab-content active">\n          \n        </section>\n        <section id="function-editor-warp-tab-content" class="tab-content">\n          \n        </section>\n\n        <section id="function-editor-delete-tab-content" class="tab-content">\n          <table>\n            <tr>\n              <th>Function</th>\n              <th>Selection</th>\n            </tr>\n            <tr>\n              <td>Creaming</td>\n              <td><input type="checkbox" /></td>\n            </tr>\n            <tr>\n              <td>Density</td>\n              <td><input type="checkbox" /></td>\n            </tr>\n            <tr>\n              <td>Double Beam</td>\n              <td><input type="checkbox" /></td>\n            </tr>\n            <tr>\n              <td>Extra Warp</td>\n              <td><input type="checkbox" /></td>\n            </tr>\n          </table>\n        </section>\n      </div>\n    </div>\n  </div>\n  <div class="btn-group">\n    <button class="btn-submit" type="button" id="function-editor-ok">Ok</button>\n    <button class="btn-submit" type="button" id="function-editor-cancel">Cancel</button>\n  </div>\n</div>',NF=kF.querySelector("#function-editor-weft-tab-content"),CF=kF.querySelector("#function-editor-warp-tab-content"),_F=kF.querySelector("#function-editor-ok"),TF=kF.querySelector("#function-editor-cancel"),IF.addEventListener("click",WF),_F.addEventListener("click",UF),TF.addEventListener("click",HF);kF.querySelector(".close-button").addEventListener("click",HF)})(),(()=>{Oc.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Technical Data</div>\n  <div id="modal-desc">\n    <div>\n      <div class="technical-data-tabs">\n        <h3 class="active" id="technical-data-fabric-tab">Fabric</h3>\n        <h3 id="technical-data-additional-tab">Additional Data</h3>\n      </div>\n      <div class="technical-data-contents">\n        <section id="technical-data-fabric-tab-content" class="tab-content active">\n          <table>\n            <tr>\n              <th></th>\n              <th>On Loom EPI</th>\n              <th>Weaving Shrinkage</th>\n              <th>Greige Density</th>\n              <th>Finish Shrinkage</th>\n              <th>Finish Density</th>\n              <th>Wastage</th>\n            </tr>\n            <tr>\n              <td>Warp</td>\n              <td><input type="text" id="warp-loom-epi" /></td>\n              <td><input type="text" id="warp-weaving-shrinkage" /></td>\n              <td><input type="text" id="warp-greige-epi" /></td>\n              <td><input type="text" id="warp-finish-shrinkage" /></td>\n              <td><input type="text" id="warp-finish-epi" /></td>\n              <td><input type="text" id="warp-wastage" /></td>\n            </tr>\n            <tr>\n              <td>Weft</td>\n              <td><input type="text" id="weft-loom-epi" /></td>\n              <td><input type="text" id="weft-weaving-shrinkage" /></td>\n              <td><input type="text" id="weft-greige-epi" /></td>\n              <td><input type="text" id="weft-finish-shrinkage" /></td>\n              <td><input type="text" id="weft-finish-epi" /></td>\n              <td><input type="text" id="weft-wastage" /></td>\n            </tr>\n          </table>\n          <div>\n            <table>\n              <tr>\n                <th>Reed Space</th>\n                <th>Gray Width</th>\n                <th>Finish Width</th>\n              </tr>\n              <tr>\n                <td><input type="text" id="tech-reed-space" disabled /></td>\n                <td><input type="text" id="warp-gray-width" /></td>\n                <td><input type="text" id="warp-finish-width" /></td>\n              </tr>\n            </table>\n          </div>\n        </section>\n        <section id="technical-data-additional-tab-content" class="tab-content">\n          <form style="display:flex;flex-direction:column;">\n            <div style="display:flex;margin-top:4px;"> <label style="width:200px;white-space:nowrap;"\n                for="additional-data-sort-no">Sort No.</label>\n              <input type="text" id="additional-data-sort-no" name="additional-data-sort-no"></div>\n\n            <div style="display:flex;margin-top:4px;">\n              <label style="width:200px;white-space:nowrap;" for="additional-data-order-no">Order No.</label>\n              <input type="text" id="additional-data-order-no" name="additional-data-order-no">\n            </div>\n\n            <div style="display:flex;margin-top:4px;">\n            <label style="width:200px;white-space:nowrap;" for="additional-data-delivery-date">Delivery Date</label>\n            <input type="text" id="additional-data-delivery-date" name="additional-data-delivery-date">\n          </div>\n\n            <div style="display:flex;margin-top:4px;">\n              <label style="width:200px;white-space:nowrap;" for="additional-data-weave">Weave</label>\n              <input type="text" id="additional-data-weave" name="additional-data-weave">\n            </div>\n\n            <div style="display:flex;margin-top:4px;">\n              <label style="width:200px;white-space:nowrap;" for="additional-data-customer-name">Customer Name</label>\n              <input type="text" id="additional-data-customer-name" name="additional-data-customer-name">\n            </div>\n\n           \n\n           \n\n            <div style="display:flex;margin-top:4px;">\n              <label style="width:200px;white-space:nowrap;" for="additional-data-checked-by">Checked By</label>\n              <input type="text" id="additional-data-checked-by" name="additional-data-checked-by">\n            </div>\n\n          </form>\n        </section>\n      </div>\n    </div>\n  </div>\n  <div class="btn-group">\n    <button class="btn-submit" type="button" id="technical-data-ok">Ok</button>\n    <button class="btn-submit" type="button" id="technical-data-cancel">Cancel</button>\n  </div>\n</div>',$c=Oc.querySelector("#technical-data-ok"),jc=Oc.querySelector("#technical-data-cancel"),Dc.addEventListener("click",yu),$c.addEventListener("click",fu),jc.addEventListener("click",mu);const e=Oc.querySelector(".close-button");Hc=Oc.querySelector("#warp-loom-epi"),qc=Oc.querySelector("warp-weaving-shrinkage"),Uc=Oc.querySelector("#warp-greige-epi"),zc=Oc.querySelector("warp-finish-shrinkage"),Vc=Oc.querySelector("#warp-finish-epi"),Yc=Oc.querySelector("#warp-wastage"),Gc=Oc.querySelector("#weft-loom-epi"),Jc=Oc.querySelector("weft-weaving-shrinkage"),Xc=Oc.querySelector("#weft-greige-epi"),Kc=Oc.querySelector("weft-finish-shrinkage"),Zc=Oc.querySelector("#weft-finish-epi"),Qc=Oc.querySelector("#weft-wastage"),eu=Oc.querySelector("#additional-data-sort-no"),tu=Oc.querySelector("#additional-data-order-no"),nu=Oc.querySelector("#additional-data-delivery-date"),iu=Oc.querySelector("#additional-data-weave"),ru=Oc.querySelector("#additional-data-customer-name"),au=Oc.querySelector("#additional-data-checked-by"),e.addEventListener("click",mu)})()},VF=(document.getElementById("setting-design-general-form"),document.getElementById("avatar-setting-modal"));document.getElementById("design-fabric-type"),document.getElementById("design-shaft"),document.getElementById("design-ppi"),document.getElementById("design-default-view"),document.getElementById("design-body"),document.getElementById("design-selvedge"),document.getElementById("design-dent-body"),document.getElementById("design-dent-selvedge"),document.getElementById("design-reed"),document.getElementById("design-height-setting"),document.getElementById("design-width-setting"),document.getElementById("design-grid-height"),document.getElementById("design-grid-width"),document.getElementById("setting-modal-apply"),document.getElementById("setting-modal-submit"),document.getElementById("cbcompany-logo"),document.getElementById("cbcompany-address"),document.getElementById("cbcompany-name"),document.getElementById("cbcompany-mo"),document.getElementById("cbcompany-email"),document.getElementById("cbprint-desc"),document.getElementById("cbreed"),document.getElementById("cbreed-space"),document.getElementById("cbshaft"),document.getElementById("cbtotal-ends"),document.getElementById("cbtotal-picks"),document.getElementById("cbepi"),document.getElementById("cbppi"),document.getElementById("cbno-of-warp"),document.getElementById("cbno-of-weft"),document.getElementById("cbtotal-dent");const YF=document.querySelectorAll(".sidebar__list div"),GF=document.querySelectorAll(".setting-tab-contents section"),JF=e=>{GF.forEach(t=>{t.id.includes(e)?t.style.display="block":t.style.display="none"})},XF=()=>{VF.style.display="none"},KF=()=>{JF(),JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,XF(),(()=>{const e=JSON.parse(localStorage.getItem("company")),t=JSON.parse(localStorage.getItem("user-settings"));if(e){document.querySelector(".company-name > h3").innerText=e.companyName;document.querySelector(".company-address > p").innerText=e.address;document.querySelector(".company-mo").innerHTML=`Mo. : ${e.mobileNo} `;document.querySelector(".company-email").innerHTML="Email : "+e.email}if(t&&t.companyPicture){const e=document.querySelector(".setting-company-logo > img");VB(t.companyPicture).then(t=>{e.src=t.data.DATA}).catch(e=>console.log("err",e))}})();const e=document.querySelector(".sidebar__link.active-link"),t=e?e.textContent.trim().toLowerCase().replace(/\s/g,"-"):"";JF(t),YF.forEach(e=>{e.addEventListener("click",(function(){YF.forEach(e=>e.classList.remove("active-link")),this.classList.add("active-link");const e=this.textContent.trim().toLowerCase().replace(/\s/g,"-");JF(e)}))})},ZF=document.getElementById("avatar-support-modal"),QF=document.getElementById("support-modal-trigger");let eM="";const tM=()=>{ZF.style.display="block",ZF.style.animation="slide-down 0.3s ease";const e=document.getElementById("support-modal-contents-table");(()=>{const e=localStorage.getItem("token");let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/complaint/get-subcriber-complaint/${t}`,{headers:{token:e}})})().then(t=>{if(console.log(t),"SUCCESS"===t.data.STATUS){const n=t.data.DATA;e.innerHTML=`\n        <table>\n         <tr>\n         <th>Ticket No </th>\n                <th>\n                  Date And Time\n                </th>\n                <th>Subject</th>\n                <th>Status</th>\n              </tr>\n              ${n.map(e=>{return`\n                <tr>\n                  <td>\n                    ${e.complaintNo}\n                  </td>\n                  <td>\n                    ${e.complaintRegisterDateAndTime}\n                  </td>\n                  <td>\n                    ${e.subject}\n                  </td>\n                  <td>\n                    ${t=e.status,t===ha?"OPEN":t===ga?"ACCEPT":t===ma?"WORKING":t===fa?"FORWARD":t===ya?"WAITING":t===va?"COMPLETED":void 0}\n                  </td>\n                </tr>`;var t}).join("")}\n            </table>\n        `}}).catch(e=>console.log("err",e))},nM=()=>{ZF.style.display="none"},iM="design-fill-by-color",rM="design-fill-by-weft-number",aM=document.getElementById("fill-design-trigger"),lM=document.getElementById("fill-design-modal");let oM,sM,dM,cM,uM,pM,hM,gM,mM,fM,yM,vM,bM,wM=iM;const EM=e=>{"Escape"===e.key&&_M()},SM=()=>{let e="",t=KO.rows();if(wM==iM){MC(UC()).forEach(t=>{e+=`\n      <input type="checkbox" id="design-fill-weft-${t}" class="menu-checkbox design-fill-weft">\n      <label for="design-fill-weft-${t}">${t}</label>\n    `})}else{let n=1;e=`<div><label for="design-fill-start-weft-no">Start Weft No.</label><input min="${n}" max="${t}" onkeyup="if(value<${n}) value=${n};if(value>${t}) value=${t};" type="number" id="design-fill-start-weft-no" /></div><div><label for="design-fill-end-weft-no">End Weft No.</label><input min="1" max="${t}" type="number" id="design-fill-end-weft-no" onkeyup="if(value<${n}) value=${n};if(value>${t}) value=${t};" /></div>`}return e},xM=()=>{lM.querySelectorAll('input[name="pegplan-weft-type"]').forEach(e=>{e.addEventListener("change",(function(){this.checked&&(wM=this.id,yM.innerHTML=SM(),mM=lM.querySelector("#design-fill-start-weft-no"),fM=lM.querySelector("#design-fill-end-weft-no"),hM.checked=!1)}))})},IM=()=>{lM.innerHTML=(()=>{let e="",t=SM(),n=KO.cols();for(let t=1;t<=n;t++)e+=`\n    <div>\n        <input type="checkbox" id="design-fill-shaft-${t}" class="menu-checkbox design-fill-shaft">\n        <label for="design-fill-shaft-${t}">${String(t).padStart(2,"0")}</label>\n      </div>`;return` <div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Fill Design</div>\n  <div id="modal-desc">\n    <div class="fill-design-modal-content">\n      <div class="fill-design-modal-content-pegplan-shaft">\n        <div>\n          <h3>Pegplan Shaft</h3>\n        </div>\n        <div>\n          <div class="flex item-menu item-center" style="padding: 10px;display: flex;gap: 10px;">\n            <input type="checkbox" id="design-fill-all-shaft-checkbox" class="menu-checkbox">\n            <label for="design-fill-all-shaft-checkbox">\n              \x3c!-- <i class="fa-solid fa-file-alt"></i> --\x3e\n              All\n            </label>\n            <input type="radio" id="design-fill-add" name="design-fill-type" checked>\n            <label for="design-fill-add">\n              \x3c!-- <i class="fa-solid fa-file-alt"></i> --\x3e\n              Add\n            </label>\n            <input type="radio" id="design-fill-replace" class="menu-checkbox" name="design-fill-type">\n            <label for="design-fill-replace">\n              \x3c!-- <i class="fa-solid fa-file-alt"></i> --\x3e\n              Replace\n            </label>\n          </div>\n          <div style="padding: 10px;display: grid;grid-template-columns:repeat(10,1fr);gap: 10px;">\n            ${e}\n          </div>\n          <div>\n            <h3>Pegplan Weft</h3>\n          </div>\n          <div>\n            <div class="flex item-menu item-center" style="padding: 10px;gap: 10px;">\n              <input type="checkbox" id="design-fill-all-weft-checkbox" class="menu-checkbox">\n              <label for="design-fill-all-weft-checkbox"> \n                \x3c!-- <i class="fa-solid fa-file-alt"></i> --\x3e\n                All\n              </label>\n\n              <input type="radio" id="${iM}" name="pegplan-weft-type" ${wM==iM?"checked":""}>\n              <label for="${iM}">                \n                By Color\n              </label>\n              <input type="radio" id="${rM}" class="menu-checkbox" name="pegplan-weft-type" ${wM==rM?"checked":""}>\n              <label for="${rM}">                \n                By Weft Number\n              </label>\n            </div>\n            <div id="design-fill-pegplan-weft-container" style="padding: 10px;display: flex;gap: 10px;">\n              ${t}\n            </div>\n          </div>\n          <div>\n            <div>\n              <h3>Weave</h3>\n            </div>\n            <div style="display: flex;flex-direction: row;gap: 10px;">\n              <div style="display: flex;flex-direction: column;gap: 10px;">\n                <div>\n                  <label for="design-fill-design-height"></label>\n                  \x3c!-- <i class="fa-solid fa-file-alt"></i> --\x3e\n                  Design Height\n                  </label>\n                  <input type="number" min="1" max="16" id="design-fill-design-height">\n                </div>\n                <div>\n                  <label for="design-fill-design-width"></label>\n                  \x3c!-- <i class="fa-solid fa-file-alt"></i> --\x3e\n                  Design Width\n                  </label>\n                  <input type="number" min="1" max="16" id="design-fill-design-width">\n                </div>\n              </div>\n              <div>\n                <h3>Preview</h3>\n                <canvas id="design-fill-canvas" class="relative" height="60" width="60"></canvas>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div id="design-fill-error-message"></div>\n    <div class="btn flex justify-around">\n      <button class="btn-submit" type="button" id="fill-design-model-ok">Ok</button>\n      <button type="button" class="btn-submit" id="fill-design-model-no">cancel</button>\n    </div>\n  </div>\n</div>`})(),xM(),aR(lM),gM=lM.querySelector("#design-fill-error-message"),pM=lM.querySelector("#design-fill-all-shaft-checkbox"),hM=lM.querySelector("#design-fill-all-weft-checkbox"),oM=lM.querySelector("#fill-design-model-ok"),mM=lM.querySelector("#design-fill-start-weft-no"),fM=lM.querySelector("#design-fill-end-weft-no"),sM=lM.querySelector("#fill-design-model-no"),dM=lM.querySelector("#design-fill-canvas"),yM=lM.querySelector("#design-fill-pegplan-weft-container"),cM=lM.querySelector("#design-fill-design-width"),uM=lM.querySelector("#design-fill-design-height"),dM.addEventListener("mousedown",AM),dM.addEventListener("mouseup",BM),dM.addEventListener("mousemove",PM),uM.value=2,cM.value=2,cM.addEventListener("change",RM),uM.addEventListener("change",FM),pM.addEventListener("change",MM),hM.addEventListener("change",DM),vM=dM.getContext("2d");lM.querySelector(".close-button").addEventListener("click",_M),sM.addEventListener("click",_M),oM.addEventListener("click",NM),CM()},kM=()=>{Yi("fill-design-modal"),IM(),document.addEventListener("keydown",EM),Uf(),lM.style.display="block",lM.style.animation="slide-down 0.3s ease"},_M=()=>{Yi(""),document.removeEventListener("keydown",EM),lM.style.display="none"},TM=()=>{if(KO.rows()!=d$.size)return e="Weft And Design Height Are Not same",gM.style.display="block",gM.innerHTML=e,gM.style.color="red",void setTimeout(()=>{gM.style.display="none"},3e3);var e;let t=[];lM.querySelectorAll(".design-fill-shaft:checked").forEach(e=>{t.push(e.nextElementSibling.innerText.trim())});const n=lM.querySelector("input[name='design-fill-type']:checked"),i=n?n.nextElementSibling.innerText.trim():"None";let r=[];if(wM==iM){let e=[];lM.querySelectorAll(".design-fill-weft:checked").forEach(t=>{e.push(t.nextElementSibling.innerText.trim())}),r=d$.get_index_from_color_code(e),r=r.sort((e,t)=>e-t)}else{const e=Number(mM.value),t=Number(fM.value);for(let n=e;n<=t;n++)r.push(n-1)}KO.apply_design_fill(i,u$,t,r,YO,GO,QO),WT()},NM=()=>{TM()},CM=()=>{u$.rows();const e=u$.rows(),t=qi,n=qi,i=u$.get_visible_cells(),r=rL(i)?JSON.parse(i):[],a=u$.cols(),l=e;if(dM.width=Math.ceil(a*t),dM.height=Math.ceil(l*n),0!=dM.height&&0!=dM.width){vM.clearRect(0,0,dM.width,dM.height),vM.fillStyle="white",vM.fillRect(0,0,dM.width,dM.height),vM.fillStyle="black",r.forEach((e,i)=>{e.forEach(e=>{vM.fillRect(i*t,(l-e)*n,t,n)})});for(let e=0;e<a+1;e++)vM.beginPath(),vM.strokeStyle="grey",vM.moveTo(e*t,0),vM.lineTo(e*t,l*n),vM.lineWidth=e%$n==0?1.5:.5,vM.stroke(),vM.closePath();for(let e=0;e<l+1;e++)vM.beginPath(),vM.strokeStyle="grey",vM.moveTo(0,e*n),vM.lineTo(a*t,e*n),vM.lineWidth=(l-e+0-1)%jn==0?1.5:.5,vM.stroke(),vM.closePath();vM.closePath()}},LM=e=>{const t=dM.getBoundingClientRect(),n=qi,i=qi,r=u$.rows(),a=(u$.cols(),e.clientX-t.left),l=(e.clientY-t.top)%(r*i),o=r-parseInt(l/i),s=parseInt(a/n);if(!bM){let e=u$.check_if_index_exist_or_not(o,s);bM=e?gs:hs}bM==hs?(u$.add_cell_new(o,s),CM()):bM==gs&&(u$.remove_cell_new(o,s),CM())},AM=e=>{Vi(!0),LM(e)},PM=e=>{$i&&0==e.button&&LM(e)},BM=()=>{bM=null,Vi(!1)},RM=e=>{e.target.value.length&&(u$.change_cols(Number(e.target.value)),CM())},FM=e=>{e.target.value.length&&(u$.change_rows(Number(e.target.value)),CM())},MM=e=>{document.querySelectorAll(".design-fill-shaft").forEach(t=>{t.checked=e.target.checked})},DM=e=>{if(wM==iM){const t=".design-fill-weft";document.querySelectorAll(t).forEach(t=>{t.checked=e.target.checked})}else mM.value=1,fM.value=KO.rows()},OM=document.getElementById("accept-design-modal");let $M,jM,WM,HM,qM,UM=null;const zM=e=>{Uf(),(e=>{console.log("accepted item",e),$M.value=e.name,jM.value=`${e.sendByDetails.company.companyName}-${e.sendByDetails.firstName} ${e.sendByDetails.lastName}`,UM=e})(e),OM.style.display="block",OM.style.animation="slide-down 0.3s ease"},VM=()=>{OM.style.display="none"},YM=async()=>{if(UM)try{await(e=>{const t=localStorage.getItem("token");return Zo.get(`${ba}/share-design/accept-share-design/${e}`,{headers:{token:t}})})(UM._id),Jg(UM),VM()}catch(e){console.log("accept shared design failed",e)}},GM=()=>{VM()},JM=document.getElementById("notificaton-icon");let XM=null;const KM="RECEIVED_DESIGN",ZM="SHARED_DESIGN",QM=()=>{async function e(){const e=document.getElementById("loader"),n=document.getElementById("notification-list");e.style.display="block",n.style.display="none";let i=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;try{const r=(await(e=>{const t=localStorage.getItem("token");return Zo.get(`${ba}/share-design/${e}`,{headers:{token:t}})})(i)).data.DATA;Array.isArray(r)&&r.length>0?(n.innerHTML=r.map((e,t)=>{const{name:n,sendByDetails:r,sendToDetails:a,createdAt:l}=e,o=a._id==i?KM:ZM;return`\n          <div class="notification">\n            <div class="notification-content">\n              <span>${o===KM?`${r.firstName} Shared you a design "${n}"`:`${a.firstName} Accepted shared design "${n}"`}</span>\n              <div class="notification-timestamp">${moment(l).format("DD-MM-YYYY HH:mm")}</div>\n            </div>\n            ${o===KM?`<button class="notification-accept-btn" data-index="${t}">Accept</button>`:""}\n          </div>\n        `}).join(""),document.querySelectorAll(".notification-accept-btn").forEach(e=>{e.addEventListener("click",n=>{const i=e.getAttribute("data-index"),a=r[i];t(a)})})):(XM.style.overflowY="auto",n.innerHTML='<span style="font-size:14px;text-align:center">No Notifcations Found.</span>'),e.style.display="none",n.style.display="block"}catch(t){console.error("Error fetching notifications:",t),e.textContent="Failed to load notifications."}}const t=async function(e){console.log("You accepted the design",e),zM(e),n()};function n(){XM||(XM=document.createElement("div"),XM.id="notification-container",XM.style.display="none",XM.innerHTML='\n      <div class="notification-box">\n        <div id="loader" class="loader">Loading...</div>\n        <div id="notification-list" style="display: none;"></div>\n      </div>\n    ',document.body.appendChild(XM)),"none"===XM.style.display?(XM.style.display="block",e()):XM.style.display="none"}JM.addEventListener("click",n),document.addEventListener("click",(function(e){XM&&"block"===XM.style.display&&!XM.contains(e.target)&&e.target!==JM&&(XM.style.display="none")}))},eD=document.getElementById("share-design-modal"),tD=document.getElementById("shared-design-modal"),nD=document.getElementById("share-icon");let iD,rD,aD,lD,oD,sD,dD,cD,uD,pD=null,hD=1,gD=5,mD="",fD="",yD=[];const vD="SHARED_BY_ME",bD="SHARED_WITH_ME",wD=()=>{eD.style.display="none"},ED=async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=oD.value,n=Bw==_i?GO.convert_new_index_to_numeric(ZO):GO.get_fix_numeric_text(),i=XC(n);const r=lC(String(i).split("\n").filter(e=>e.length>0).map(e=>e.split(" ").filter(e=>e)));let a=FT==Pi?KO.convert_new_index_to_numeric(!1,!1):KO.get_fix_numeric_text(),l=XC(a,!0);const o=String(l).split("\n").length;let s="",d="",c="",u="",p=0;if(Bw==_i){for(let e=d$.size-1;e>=d$.getMinimumIndex();e--){let t=d$.findElementFromIndex(e);t?(p>0&&(s+=p.toString()+"\n"),s+=t.color_code+"\n",p=0):p++}p=0,c=y$(s.toUpperCase());for(let e=0;e<=c$.getMaximumIndex();e++){let t=c$.findElementFromIndex(e);t?(p>0&&(d+=p.toString()+"\n"),d+=t.color_code+"\n",p=0):p++}u=y$(d.toUpperCase())}else u=c$.fixNumericText,c=d$.fixNumericText;let h=await hS();const g=new Uint32Array(I$.memory.buffer,ZO.click_cells(),ZO.click_dentgrid_length()).toString(),m=Array.from(new Uint32Array(I$.memory.buffer,GO.compress_split_array(),GO.compress_split_array_length())),f=Array.from(new Uint32Array(I$.memory.buffer,KO.compress_split_array(),KO.compress_split_array_length())),y=Array.from(new Uint32Array(I$.memory.buffer,KO.compress_file_loop_split_array(),KO.compress_file_loop_split_array_length())),v=new Uint32Array(I$.memory.buffer,p$.cells(),p$.selected_beamgrid_length()).toString();console.log("color palette id is",h),dh.value=KO.rows(),ch.value=GO.cols();let b="all"==function(){const e=document.getElementsByName("shared-design-data-type");for(const t of e)if(t.checked)return t.value;return null}(),w={email:sD.value,sendBy:e,pegPlan:a,draftPlan:b?n:"[0]X20",warpPattern:b?u:"20A",weftPattern:c,user:e,name:t,shaft:GO.rows().toString(),picks:o.toString(),ends:r.toString(),unit:hh.value,reed:zO.value,draftCompressSplitArray:b?m:[],pegplanCompressSplitArray:f,pegplanFileSplitArray:y,perinch:gh.value,leftSalvageWidth:jp,bodyWidth:Hp,rightSalvageWidth:Wp,leftSalvageWarpDent:Yp.value,bodyWarpDent:Gp.value,rightSalvageWarpDent:Jp.value,warpDencity:ah.value,weftDencity:lh.value,designHeight:dh.value,designWidth:ch.value,gridHeight:oh.value,gridWidth:sh.value,weftHeight:uh.value,warpWidth:ph.value,skipDent:b?g:"0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",doubleBeam:b?v:"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1",draftWithPart:{designWithPart:b?wy:[],draftParts:b?Kf:[]},extraWarp:b?JSON.stringify(o$):JSON.stringify({size:20,isWeftColor:!1,isFunctionCanvas:!1,isWarpColor:!1,isWarpCreamingCanvas:!0,isDencityCanvas:!1,cells:[],fixNumericText:""}),creaming:JSON.stringify(l$),density:JSON.stringify(s$),leftSalvage:JSON.stringify(Ec),rightSalvage:JSON.stringify(Sc),weftSelectorMapping:JSON.stringify(Mg),densityMapping:JSON.stringify(fp),draftDesignModeType:Bw,pegPlanDesignModeType:FT,warpWeavingShrinkage:lu.warpWeavingShrinkage,warpFinishShrinkage:lu.warpFinishShrinkage,weftFinishShrinkage:lu.weftFinishShrinkage,weftWeavingShrinkage:lu.weftWeavingShrinkage,weftWastage:lu.weftWastage,warpWastage:lu.warpWastage,notes:Qd,remarks:ou.remarks,designerName:ou.designerName,designType:ou.designType,customerName:ou.customerName,contanctNo:ou.contanctNo,deliveryDate:ou.deliveryDate,checkedBy:ou.checkedBy,colorPaletteId:h,shareDesignNotes:dD.value};try{let e=await(e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/share-design/",e,{headers:{token:t}})})(w);wD(),Toastify({text:"File Shared Successfully",className:"info",style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast(),console.log("resData is",e)}catch(e){console.log("inside error",e)}Uf(),Uf()},SD=()=>{uD.style.display="none"},xD=()=>{"block"===uD.style.display?SD():uD.style.display="block"};const ID=(e=[],t=[])=>{console.log("notification list data is",e);let n=pD==vD?"sendToDetails":"sendByDetails";return`\n  <div class="modal-content" style="width: 600px; border: 1px solid #ccc; background: #f9f9f9;">\n  <div class="close" style="text-align: right;">\n    <span class="close-button" style="cursor: pointer; font-size: 16px;">&times;</span>\n  </div>\n  <div class="modal-title" style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">${pD==vD?"Shared By Me":"Shared With Me"}</div>\n\n  <div class="modal-filters" style="margin-bottom: 10px; display: flex; gap: 10px;">\n  <select id="accpet-design-date-filter" style="padding: 5px; border: 1px solid #ccc; flex: 1;">\n    <option value="">All Dates</option>\n    ${["Today","Last 7 Days","Last 30 Days"].map(e=>`<option value="${e}">${e}</option>`).join("")}\n  </select>\n  <select id="company-filter" style="padding: 5px; border: 1px solid #ccc; flex: 1;">\n    <option value="">All Companies</option>\n    ${t.map(e=>`<option value="${e._id}">${e.firstName} ${e.lastName}</option>`).join("")}\n  </select>\n</div>\n  <div class="modal-desc" style="overflow-x: auto; padding: 4px;">\n    <table style="width: 100%; border-collapse: collapse; font-size: 14px; text-align: left;">\n      <thead>\n        <tr style="background: #ddd;">\n          <th style="border: 1px solid #ccc; padding: 8px;">Company</th>\n          <th style="border: 1px solid #ccc; padding: 8px;">Email</th>\n          <th style="border: 1px solid #ccc; padding: 8px;">Design Name</th>\n          <th style="border: 1px solid #ccc; padding: 8px;">Select Date</th>\n          <th style="border: 1px solid #ccc; padding: 8px;">Action</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${e.map(e=>`\n          <tr>\n            <td style="border: 1px solid #ccc; padding: 8px;">${e[n].company.companyName}</td>\n            <td style="border: 1px solid #ccc; padding: 8px;">${e[n].email}</td>\n            <td style="border: 1px solid #ccc; padding: 8px;">${e.name}</td>\n            <td style="border: 1px solid #ccc; padding: 8px;">${moment(e.createdAt).format("DD-MM-YYYY HH:mm")}</td>\n            <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">\n              <button class="shareddesign-open-button" id=${e._id}  style="background: #007BFF; color: #fff; border: none; padding: 5px 10px; cursor: pointer;">Open</button>\n            </td>\n          </tr>`).join("")}\n      </tbody>\n    </table>\n    <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">\n      <div></div>\n      <div style="display: flex; align-items: center;">\n        <button id="shared-design-history-prevPage" style="border: none; background: none; font-size: 16px; cursor: pointer;"></button>\n        <span style="margin: 0 8px;" id="shared-design-currentPage">1</span>\n        <button id="shared-design-history-nextPage" style="border: none; background: none; font-size: 16px; cursor: pointer;"></button>\n      </div>\n    </div>\n    <div style="margin-top: 10px; text-align: right;">\n      <button id="shared-design-cancel-element" class="btn-submit">Cancel</button>\n    </div>\n  </div>\n</div>`},kD=async()=>{const e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t=document.getElementById("accpet-design-date-filter"),n=document.getElementById("company-filter");let i={pageNumber:hD,perPage:10,userId:e,sharedDesignType:pD,dateFilter:t&&t.value,companyFilter:n&&n.value},r=await(e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/share-design/get-shared-design/",e,{headers:{token:t}})})(i),a=await(e=>{const t=localStorage.getItem("token"),n=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.post(`${ba}/share-design/get-company-dropdown/${n}`,e,{headers:{token:t}})})({sharedDesignType:pD});console.log("companyDropDownValueResponse========>",a.data.DATA),yD=[...a.data.DATA];const l=r.data.DATA.data,o=r.data.DATA.pagination;hD=o.pageNumber,gD=o.totalPages,tD.innerHTML=ID(l,yD);const s=document.getElementById("accpet-design-date-filter"),d=document.getElementById("company-filter");s.value=mD,d.value=fD;const c=tD.querySelector("#shared-design-cancel-element");tD.querySelector(".close-button").addEventListener("click",ND),c.addEventListener("click",ND);const u=tD.querySelector("#shared-design-history-prevPage"),p=tD.querySelector("#shared-design-history-nextPage"),h=tD.querySelector("#shared-design-currentPage");u.addEventListener("click",()=>{hD>1&&(hD--,h.innerText=hD,kD(),console.log("Changed to page: "+hD))}),s.addEventListener("change",e=>{mD=e.target.value,kD()}),d.addEventListener("change",e=>{fD=e.target.value,kD()}),p.addEventListener("click",()=>{console.log("clickedddd"),hD<gD&&(hD++,h.innerText=hD,kD(),console.log("Changed to page: "+hD))});tD.querySelectorAll(".shareddesign-open-button").forEach(e=>{e.addEventListener("click",e=>{let t=l.find(t=>t._id==e.target.id);Jg(t),ND()})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&ND()}),document.addEventListener("click",_D)},_D=e=>{const t=tD.querySelector(".modal-content");"block"===tD.style.display&&t&&!t.contains(e.target)&&ND()},TD=e=>{pD=e,(async()=>{hD=1,gD=1,await kD()})(),tD.style.display="block",console.log("open called"),tD.style.animation="slide-down 0.3s ease"},ND=()=>{tD.style.display="none",tD.innerHTML=""},CD=()=>{uD=document.createElement("div"),uD.innerHTML='\n    <div class="dropdown-menu" style="position: absolute; background: #fff; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); border-radius: 5px; padding: 10px; z-index: 100;right:60px;">\n      <div class="menu-item" id="menu-share" style="display: flex; align-items: center; padding: 5px; cursor: pointer;">\n        <span style="margin-right: 10px;"></span> Share\n      </div>\n      <div class="menu-item" id="menu-shared-button" style="display: flex; align-items: center; padding: 5px; cursor: pointer;">\n        <span style="margin-right: 10px;"></span> Shared\n      </div>\n      <div class="menu-item" id="menu-shared-with-me-button" style="display: flex; align-items: center; padding: 5px; cursor: pointer;">\n        <span style="margin-right: 10px;"></span> Shared With Me\n      </div>\n    </div>',uD.style.display="none",nD.parentElement.appendChild(uD),nD.addEventListener("click",e=>{e.stopPropagation(),xD(),XM&&(XM.style.display="none")}),document.addEventListener("click",SD),uD.querySelector("#menu-share").addEventListener("click",()=>{SD(),eD.style.display="block",eD.style.animation="slide-down 0.3s ease"}),eD.innerHTML='\n    <div class="modal-content">\n      <div class="close">\n        <span class="close-button">&times;</span>\n      </div>\n      <div class="modal-title">Share Design</div>\n      <div class="modal-desc">\n        <input type="text" id="share-design-name" placeholder="Design Name" style="width: 100%; padding: 10px; margin-bottom: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;" />\n        <input type="text" id="share-design-email" placeholder="Email" style="width: 100%; padding: 10px; margin-bottom: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;" />\n        <textarea placeholder="Message" rows="5" id="share-design-notes" style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; resize: none;"></textarea>\n        <div style="margin-top: 10px; border: 1px solid #ccc; border-radius: 5px; padding: 10px; display: flex; align-items: center;">\n          <label style="margin-right: 20px; display: flex; align-items: center; font-size: 14px;">\n            <input type="radio" checked name="shared-design-data-type" style="margin-right: 5px;" value="all"/>\n            <span style="color: #000; font-weight: 600;">Design</span>\n           \n          </label>\n          <label style="display: flex; align-items: center; font-size: 14px;">\n            <input type="radio" name="shared-design-data-type" value="pegplan"  style="margin-right: 5px;" />\n            <span style="color: #000; font-weight: 600;">Pegplan</span>\n           \n          </label>\n        </div>\n        <p id="share-design-error" style="color: red; font-size: 14px; display: none; margin-top: 5px; font-weight: bold;">Please select a radio button before proceeding.</p>\n        <div class="btn-group">\n          <button class="btn-submit" type="button" id="share-design-cancel">Cancel</button>\n          <button class="btn-submit" type="button" id="share-design-ok">Send</button>\n        </div>\n      </div>\n    </div>',tD.innerHTML=ID([]),aD=uD.querySelector("#menu-shared-button"),lD=uD.querySelector("#menu-shared-with-me-button"),iD=eD.querySelector("#share-design-cancel"),cD=eD.querySelector("#share-design-error"),rD=eD.querySelector("#share-design-ok"),oD=eD.querySelector("#share-design-name"),sD=eD.querySelector("#share-design-email"),dD=eD.querySelector("#share-design-notes");eD.querySelector(".close-button").addEventListener("click",wD),rD.addEventListener("click",ED);tD.querySelector(".close-button").addEventListener("click",ND),aD.addEventListener("click",()=>TD(vD)),lD.addEventListener("click",()=>TD(bD))},LD=document.getElementById("shift-shaft-trigger"),AD=document.getElementById("shift-shaft-modal");let PD,BD,RD;const FD="shift-shaft-pegplan",MD="shift-shaft-draftplan",DD="shift-shaft-both",OD=e=>{RD.style.display="block",RD.innerHTML=e,RD.style.color="red",setTimeout(()=>{RD.style.display="none"},3e3)},$D=()=>{Yi("shift-shaft-modal"),AD.innerHTML=(()=>{let e="",t=KO.cols();for(let n=1;n<=t;n++)e+=`\n          <div style="width:210px;display:flex;justify-content:space-between;">\n              <input type="number" disabled value=${n} class="shift-shaft-input" id="shift-shaft-origin-${n}" />\n              <input type="number" value=${n} class="shift-shaft-input"  id="shift-shaft-to-${n}" />\n          </div>`;return`<div class="modal-content">\n        <div class="close">\n          <span class="close-button">&times;</span>\n        </div>\n        <div class="modal-title">Shift Shaft</div>\n        <div id="modal-desc">\n          <div class="fill-design-modal-content">\n            <div class="fill-design-modal-content-pegplan-shaft">\n              \n              <div>\n                <div class="flex item-menu item-center" style="padding: 10px;display: flex;gap: 10px;">\n                  <input type="radio" id="${FD}" name="shift-shaft-type" checked>\n                  <label for="${FD}">\n                    Pegplan\n                  </label>\n                  <input type="radio" id="${MD}" class="menu-checkbox" name="shift-shaft-type">\n                  <label for="${MD}">\n                    Draft\n                  </label>\n                  <input type="radio" id="${DD}" class="menu-checkbox" name="shift-shaft-type">\n                  <label for="${DD}">\n                  Both\n                </label>\n                </div>\n                <div style="padding: 10px;display: grid;grid-template-columns:1fr;gap: 10px;height:60vh;overflow-y:scroll;">\n                <div style="display:flex;width:210px;justify-content:space-between;">\n                <div style="border:1px solid black;text-align:center;padding:3px;width:84px;">Origin</div>\n                <div style="border:1px solid black;text-align:center;padding:3px;width:84px;">Shift To</div>\n                </div>\n                  ${e}\n                </div>\n              </div>\n            </div>\n          </div>\n          <div id="shift-shaft-error-message"></div>\n          <div class="btn flex justify-around">\n            <button class="btn-submit" type="button" id="shift-shaft-model-ok">Ok</button>\n            <button type="button" class="btn-submit" id="shift-shaft-model-no">cancel</button>\n          </div>\n        </div>\n      </div>`})(),BD=AD.querySelector("#shift-shaft-model-ok"),RD=AD.querySelector("#shift-shaft-error-message"),PD=AD.querySelector("#shift-shaft-model-no");AD.querySelector(".close-button").addEventListener("click",WD),BD.addEventListener("click",HD),PD.addEventListener("click",qD)},jD=()=>{$D(),Uf(),AD.style.display="block",AD.style.animation="slide-down 0.3s ease"},WD=()=>{Yi(""),AD.style.display="none",AD.innerHTML=""},HD=()=>{let e={},t=KO.cols(),n=new Set,i=[];for(let i=1;i<=t;i++){let t=AD.querySelector("#shift-shaft-origin-"+i),r=AD.querySelector("#shift-shaft-to-"+i);e[t.value]=r.value,n.add(r.value)}for(let e=1;e<=t;e++)n.has(e.toString())||i.push(e);let r=(()=>{const e=AD.querySelector('input[name="shift-shaft-type"]:checked');return e?(console.log(e.id),e.id):(console.log("No option selected"),null)})();i.length>0?OD(`Shafts ${i.join(",")} are missing`):r==FD?(KO.shift_shaft(JSON.stringify(e)),S$(YO,GO,KO,QO),WT()):r==MD?(GO.shift_shaft(JSON.stringify(e)),S$(YO,GO,KO,QO),Jw()):r==DD?(KO.shift_shaft(JSON.stringify(e)),GO.shift_shaft(JSON.stringify(e)),S$(YO,GO,KO,QO),Jw(),WT()):OD("Please Select Shift Shaft Type")},qD=()=>{WD()},UD=document.getElementById("device-name-modal");let zD,VD;const YD=()=>{JD("Please enter device name and save it!!")},GD=async()=>{wk(zD.value),await(e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/subscriber/set-device-name",{deviceName:e,token:t},{headers:{token:t}})})(zD.value),UD.style.display="none",Yi("")},JD=e=>{VD.innerText=e,VD.style.display="block",setTimeout(()=>{VD.style.display="none"},3e3)},XD=()=>{UD.innerHTML='<div class="modal-content">\n<div class="close">\n  <span class="close-button">&times;</span>\n</div>\n<div class="modal-title">\n  Device Name\n</div>\n<div class="modal-desc" style="padding:10px;">\n  <label for="device-name-input-element">Device Name</label>\n  <input id="device-name-input-element" />\n</div>\n<div class="error-message" id="device-name-error-message"></div>\n<div class="btn-group">\n  <button class="btn-submit" type="button" id="device-name-modal-cancel">Cancel</button>\n  <button class="btn-submit" type="button" id="device-name-modal-ok">ok</button>\n</div>\n</div>\n</div>';UD.querySelector(".close-button").addEventListener("click",YD);const e=UD.querySelector("#device-name-modal-cancel"),t=UD.querySelector("#device-name-modal-ok");zD=UD.querySelector("#device-name-input-element"),VD=UD.querySelector("#device-name-error-message"),e.addEventListener("click",YD),t.addEventListener("click",GD),bk()||(zD.value=bk(),Yi("device-name-modal"),UD.style.display="block",UD.style.animation="slide-down 0.3s ease")},KD=e=>{const t=localStorage.getItem("token");let n=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/sequence/get-seq/${n}`,{params:{type:e}},{headers:{token:t}})},ZD=document.getElementById("open-seq-modal"),QD=document.getElementById("open-warpseq-modal-trigger"),eO=document.getElementById("open-weftseq-modal-trigger");let tO,nO,iO,rO,aO,lO="";const oO=e=>{lO=e},sO=e=>{for(let e=0;e<IO.length;e++){document.getElementById(IO[e].id).classList.remove("seq-file-active")}let t=IO.find(t=>t.id==e.currentTarget.id);e.currentTarget.classList.add("seq-file-active"),iO=t,dO(iO)},dO=e=>{rO.value=e.name},cO=async()=>{try{let e=await KD(lO);_O(e.data.DATA),nO.innerHTML="";for(let e=0;e<IO.length;e++)nO.innerHTML+=`<div id="${IO[e].id}">\n      \n        <img src="maxweave.png" width="100" height="100">\n      \n      <div id="open-seq-name-container">${IO[e].name}</div>\n      \n    </div>`;for(let e=0;e<IO.length;e++){document.getElementById(IO[e].id).addEventListener("click",sO)}}catch(e){console.log("err is",e)}},uO=()=>{document.addEventListener("keydown",gO),document.getElementById("warpcolor-context-menu")&&(document.getElementById("warpcolor-context-menu").style.display="none"),document.getElementById("weftcolor-context-menu")&&(document.getElementById("weftcolor-context-menu").style.display="none"),Yi("open-seq-modal"),aO.innerHTML="warp"==lO?"Open Warp":"Open Weft",Uf(),cO(),ZD.style.display="block",ZD.style.animation="slide-down 0.3s ease"},pO=()=>{nO.innerHTML="",ZD.style.display="none",iO=null,document.removeEventListener("keydown",gO),Yi("")},hO=()=>{Sv.value=iO.numeric,Pv(lO),jv(),pO()},gO=async e=>{iO&&"Delete"==e.key&&(await zl("Are you sure you want to permanently delete this file?")?(console.log("delete design",iO),(e=>{const t=localStorage.getItem("token");return Zo.get(`${ba}/sequence/delete-seq/${e}`,{headers:{token:t}})})(iO.id).then(e=>{console.log("delete seq Plan succuss fully",e.data),cO(),openDraftFileName.value="",iO=null,dO(null)}).catch(e=>console.log("delete design failed"))):console.log("do not delete it"))},mO=e=>{let t=String(tO.value),n=IO.filter(e=>0==t.length||String(e.name).toLowerCase().includes(t.toLowerCase()));for(let e=0;e<IO.length;e++){document.getElementById(IO[e].id).style.display="none"}for(let e=0;e<n.length;e++){document.getElementById(n[e].id).style.display="block"}};const fO=document.getElementById("save-seq-modal"),yO=document.getElementById("save-warpseq-modal-trigger"),vO=document.getElementById("save-weftseq-modal-trigger");let bO,wO,EO,SO,xO="",IO=[];const kO=e=>{for(let e=0;e<IO.length;e++){document.getElementById(IO[e].id).classList.remove("save-seq-file-active")}e.currentTarget.classList.add("save-seq-file-active")},_O=e=>{IO=e},TO=()=>{document.getElementById("warpcolor-context-menu")&&(document.getElementById("warpcolor-context-menu").style.display="none"),document.getElementById("weftcolor-context-menu")&&(document.getElementById("weftcolor-context-menu").style.display="none"),Uf(),Yi("save-seq-modal"),(async()=>{SO.innerHTML="warp"==lO?"Save Warp":"Save Weft";try{let e=await KD(lO);_O(e.data.DATA),EO.innerHTML="";for(let e=0;e<IO.length;e++)EO.innerHTML+=`<div class="open-pegplan-data-container-content" id="${IO[e].id}">\n      <div class="open-pegplan-data-content-image">\n        <img src="maxweavefev.png" width="100">\n       </div>\n    \n        <div class="open-pegplan-data-content-file-name">${IO[e].name}</div>\n    </div>`;for(let e=0;e<IO.length;e++){document.getElementById(IO[e].id).addEventListener("click",kO)}for(let e=0;e<IO.length;e++)document.getElementById(IO[e].id).addEventListener("click",()=>{var t;t=IO[e],bO.value=t.name})}catch(e){console.log("err is",e)}})(),fO.style.display="block",fO.style.animation="slide-down 0.3s ease"},NO=()=>{fO.style.display="none",Yi("")},CO=e=>{let t=String(e.target.value);if(t.length>0){let e=IO.filter(e=>String(e.name).toLowerCase().includes(t.toLowerCase()));for(let e=0;e<IO.length;e++){document.getElementById(IO[e].id).style.display="none"}for(let t=0;t<e.length;t++){document.getElementById(e[t].id).style.display="block"}}else for(let e=0;e<IO.length;e++){document.getElementById(IO[e].id).style.display="block"}},LO=async()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id,t="",n="",i=0;if("20A"==c$.fixNumericText||$d==Ni){for(let e=0;e<=c$.getMaximumIndex();e++){let t=c$.findElementFromIndex(e);t?(i>0&&(n+=i.toString()+"\n"),n+=t.color_code+"\n",i=0):i++}t=y$(n.toUpperCase())}else t=c$.fixNumericText;let r=IO.find(e=>e.name.trim()==bO.value.trim());xO=r?r.id:"";let a={numeric:t,user:e,name:bO.value,type:lO,sequenceId:xO,size:20};try{await(e=>{const t=localStorage.getItem("token");return Zo.post(ba+"/sequence/create",e,{headers:{token:t}})})(a)}catch(e){console.log("inside error",e)}},AO=()=>{LO(),NO()},PO=document.getElementById("open-file-type-modal"),BO=document.getElementById("open-maindesign-modal-trigger");const RO=()=>{Uf(),Yi(PO.id),PO.style.display="block",PO.style.animation="slide-down 0.3s ease"},FO=()=>{PO.style.display="none",Yi("")},MO=document.getElementById("main-canvas"),DO=(document.getElementById("warp-canvas"),document.getElementById("weft-canvas")),OO=document.getElementById("loading-animation"),$O=document.getElementById("l-salvage-weft-canvas"),jO=document.getElementById("r-salvage-dent-container"),WO=document.getElementById("logout-trigger"),HO=document.getElementById("r-salvage-weft-canvas"),qO=(document.getElementById("weft-color-canvas"),document.getElementById("weft-color-side-canvas"),document.getElementById("weft-scale-canvas"),document.getElementById("warp-color-canvas"),document.getElementById("warp-scale-canvas"),document.getElementById("grid-nav-content")),UO=document.getElementById("site-reload-trigger"),zO=(document.getElementById("avatar-trigger"),document.getElementById("reed")),VO=document.getElementById("treadles");var YO,GO,JO,XO,KO,ZO,QO,e$,t$,n$,i$,r$,a$,l$,o$,s$,d$,c$,u$,p$,h$,g$,m$,f$,y$,v$,b$,w$,E$,S$,x$,I$;d$=new lL(Op,!0,!1,!1,!1),l$=new lL(Op,!1,!0,!1,!1,!1),s$=new lL(Op,!1,!1,!1,!1,!0),h$=new lL(Op,!1,!1,!1,!1,!0),c$=new lL(Dp,!1,!1,!0,!1,!1),o$=new lL(Dp,!1,!1,!1,!0,!1),Promise.all([n.e(0),n.e(2)]).then(n.bind(null,52)).then(async({MainGrid:e,WeftGrid:t,WarpGrid:i,DentGrid:r,SalvageMainGrid:a,SalvageWeftGrid:l,SalvageDentGrid:o,TieupGrid:s,BeamGrid:d,PrintObject:c,DesignFill:u,compress_seq_string:p,compress_string:h,compress_seq_prefix_string:g,set_main_grid:m,generate_wjl_file:f,generate_heb_file:y})=>{I$=await n.e(0).then(n.bind(null,51)),y$=p,E$=h,w$=g,x$=c,v$=f,b$=y,S$=m,UO.addEventListener("dblclick",()=>{location.reload(!0)});const v=()=>{oh.value=4,sh.value=4,Vp.value=12,qp.value=.5,Up.value=.5,eh.value=45.5,gh.value=2,hh.value="inch",zp.value=parseFloat(46.5).toFixed(2),zO.value=96,Xp.value=parseInt(96/Number(gh.value)*Number(.5)),Kp.value=parseInt(96/Number(gh.value)*Number(45.5)),Zp.value=parseInt(96/Number(gh.value)*Number(.5)),Qp.value=Number(Xp.value)+Number(Kp.value)+Number(Zp.value),Yp.value=4,Gp.value=2,Jp.value=4,th.value=Xp.value*Number(Yp.value),nh.value=Kp.value*Number(Gp.value),ih.value=Zp.value*Number(Jp.value),bh(Number(th.value)),Eh(Number(ih.value)),rh.value=Number(th.value)+Number(nh.value)+Number(ih.value),lh.value=52..toFixed(2),ah.value=parseFloat(Number(nh.value)/Number(eh.value)).toFixed(2),dh.value=Fp,ch.value=Rp,uh.value=Op,ph.value=Dp,(()=>{for(let e=65;e<=90;e++){const t=e<=91,n=e<=80;e<=91&&(Ld[""+String.fromCharCode(e)]=vr[e-65],Nk.innerHTML+=`<div class="color-items relative">\n        \n        <button class="color-item" style="background-color:${vr[e-65]};color:${["#000000","rgb(0,0,0)"].includes(vr[e-65])?"white":"black"}" id="warp-color-${String.fromCharCode(e)}">${String.fromCharCode(e)}</button>\n      </div>`),t&&($s[""+String.fromCharCode(e)]=br[e-65],Ck.innerHTML+=`<div class="color-items relative">\n      <button class="color-item" style="background-color:${br[e-65]};color:${["#000000","rgb(0,0,0)"].includes(br[e-65])?"white":"black"}" id="weft-color-${String.fromCharCode(e)}">${String.fromCharCode(e)}</button>\n    </div>`),n&&(js[""+String.fromCharCode(e)]=wr[e-65],Pk.innerHTML+=`<div class="color-items relative">\n      <button class="color-item" style="background-color:${wr[e-65]};color:${["#000000","rgb(0,0,0)"].includes(wr[e-65])?"white":"black"}" id="function-color-${String.fromCharCode(e)}">${e-65+1}</button>\n    </div>`)}for(let e=65;e<=90;e++){let t=document.getElementById("warp-color-"+String.fromCharCode(e)),n=document.getElementById("weft-color-"+String.fromCharCode(e)),i=document.getElementById("function-color-"+String.fromCharCode(e));t&&E_(t,"Yarn Editor",!0),n&&E_(n,"Yarn Editor",!0),i&&E_(i,"Function Color",!0)}Mk.style.backgroundColor=document.getElementById("warp-color-A").style.backgroundColor,Dk.style.backgroundColor=document.getElementById("weft-color-A").style.backgroundColor,Ok.style.backgroundColor=document.getElementById("function-color-"+Os).style.backgroundColor,["#000000","rgb(0,0,0)"].includes(br[0])&&(Dk.style.color="white"),["#000000","rgb(0,0,0)"].includes(vr[0])&&(Mk.style.color="white"),Nk.style.width="65vw",Ck.style.width="65vw",Pk.style.width="65vw",Pk.style.overflowX="hidden",Nk.style.overflowX="hidden",Ck.style.overflowX="hidden",$k.addEventListener("click",m_),jk.addEventListener("click",v_),document.getElementById("increaseBtn").addEventListener("click",(function(){"warp"==Qk.value&&(e_=(e_+1)%r_.length,document.getElementById("model-letter-box").value=r_[e_],Wk.value=sa(Ld[r_[e_]]),Hk.value=Ad[r_[e_]]?Ad[r_[e_]].yarnName:"",qk.value=Ad[r_[e_]]?Ad[r_[e_]].yarnType:"",zk.value=Ad[r_[e_]]?Ad[r_[e_]].yarnUnit:"denier",t_=zk.value),"weft"==Qk.value&&(e_=(e_+1)%r_.length,document.getElementById("model-letter-box").value=r_[e_],Wk.value=sa($s[r_[e_]]),Hk.value=Ws[r_[e_]]?Ws[r_[e_]].yarnName:"",qk.value=Ws[r_[e_]]?Ws[r_[e_]].yarnType:"",zk.value=Ws[r_[e_]]?Ws[r_[e_]].yarnUnit:"denier",t_=zk.value)})),document.getElementById("decreaseBtn").addEventListener("click",(function(){"warp"==Qk.value&&(e_=(e_-1+r_.length)%r_.length,document.getElementById("model-letter-box").value=r_[e_],Wk.value=sa(Ld[r_[e_]]),Hk.value=Ad[r_[e_]]?Ad[r_[e_]].yarnName:"",qk.value=Ad[r_[e_]]?Ad[r_[e_]].yarnType:"",zk.value=Ad[r_[e_]]?Ad[r_[e_]].yarnUnit:"denier",t_=zk.value),"weft"==Qk.value&&(e_=(e_-1+r_.length)%r_.length,document.getElementById("model-letter-box").value=r_[e_],Wk.value=sa($s[r_[e_]]),Hk.value=Ws[r_[e_]]?Ws[r_[e_]].yarnName:"",qk.value=Ws[r_[e_]]?Ws[r_[e_]].yarnType:"",zk.value=Ws[r_[e_]]?Ws[r_[e_]].yarnUnit:"denier",t_=zk.value)})),Kk.addEventListener("click",e=>{c_(Nk)}),Zk.addEventListener("click",e=>{d_(Nk)}),Yk.addEventListener("click",e=>{c_(Ck)}),Gk.addEventListener("click",e=>{d_(Ck)}),Jk.addEventListener("click",e=>{c_(Pk)}),Xk.addEventListener("click",e=>{d_(Pk)}),Mk.addEventListener("click",()=>{o_(n_.WARP)}),Dk.addEventListener("click",()=>{o_(n_.WEFT)}),Ok.addEventListener("click",()=>{o_(n_.FUNCTION)}),Qk.addEventListener("change",e=>{"weft"==e.target.value?(Wk.value=$s[Vk.value],Hk.value=Ws[Vk.value]?Ws[Vk.value].yarnName:"",qk.value=Ws[Vk.value]?Ws[Vk.value].yarnType:"",zk.value=Ws[r_[e_]]?Ws[r_[e_]].yarnUnit:"denier",t_=zk.value):(Wk.value=Ld[Vk.value],Hk.value=Ad[Vk.value]?Ad[Vk.value].yarnName:"",qk.value=Ad[Vk.value]?Ad[Vk.value].yarnType:"",zk.value=Ad[r_[e_]]?Ad[r_[e_]].yarnUnit:"denier",t_=zk.value)}),_k.addEventListener("click",f_),Tk.addEventListener("click",y_)})()};g$=()=>{YO=e.new(Rp,Fp,qi,(parseFloat(ah.value)/parseFloat(lh.value)).toFixed(2)*qi),GO=t.new(Rp,Ap,qi),JO=t.new(2,Ap,qi),KO=i.new(Ap,Fp,qi),QO=s.new(Ap,Ap,qi),XO=i.new(Ap,2,qi),ZO=r.new(Dp,2,qi),n$=o.new(Pp,2,qi),t$=l.new(Pp,Ap,qi),e$=a.new(Pp,Fp,qi,qi),a$=o.new(Bp,2,qi),r$=l.new(Bp,Ap,qi),i$=a.new(Bp,Fp,qi,qi),p$=d.new(Rp,2,qi),u$=u.new(2,2,qi),r.new(Rp,2,qi)},m$=()=>{f$();let e=$O.width+DO.width+HO.width+500;qO.style.width=e<window.innerWidth?"100vw":e+"px",jO.style.marginLeft=MO.width-md.width+10+"px"},f$=()=>{Jw(),WT(),iE(),PN()};document.addEventListener("click",(function(e){document.querySelector("#avatar-trigger").contains(e.target)||document.querySelector(".menu-container").classList.remove("active")}));const b=()=>{(()=>{const e=localStorage.getItem("token");let t=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;return Zo.get(`${ba}/setting/get-user-settings/${t}`,{headers:{token:e}})})().then(e=>{localStorage.setItem("user-settings",JSON.stringify(e.data.DATA))}).catch(e=>console.log("err",e))};navigator.userAgent.includes("Chrome")&&navigator.vendor.includes("Google Inc")||window.location.replace("login.html"),Object(xa.f)({apiKey:"AIzaSyDCzcbaqheWLLGqjjZeSlGmK3MG8L-hrng",authDomain:"maxweave-dev.firebaseapp.com",projectId:"maxweave-dev",storageBucket:"maxweave-dev.appspot.com",messagingSenderId:"702964694189",appId:"1:702964694189:web:b91063fd1c8a24dc15da24",measurementId:"G-3W6S5LP1XF"}),eR.addEventListener("click",iR),tR.innerHTML='<div class="modal-content">\n      <div class="close">\n        <span class="close-button">&times;</span>\n      </div>\n      <div class="modal-title">Copy</div>\n      <div id="modal-desc">\n        <div>\n          <div class="copy-design-tabs">\n            <h3 class="active" id="copy-design-pegplan-tab">Pegplan</h3>\n            <h3 id="copy-design-draft-tab">Draft</h3>\n            <h3 id="copy-design-delete-tab">Delete</h3>\n          </div>\n          <div class="copy-design-contents">\n            <section id="copy-design-pegplan-tab-content" class="tab-content active">\n              <form>\n                <div style="display: flex;flex-direction: row;gap: 25px;">\n                  <div style="display: flex;flex-direction: column;row-gap: 5px;">\n\n                    <div style="display: flex;justify-content: space-between;">\n                      <label for="cb-copy-all-pegplan">All</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-all-pegplan" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-copy-pegplan">Pegplan</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-pegplan" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-copy-weft">Weft</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-weft" />\n                    </div>\n\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-copy-creaming">Creaming</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-creaming" />\n                    </div>\n\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="cb-copy-density">Density</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-density" />\n                    </div>\n\n                  </div>\n                  <div style="display: flex;flex-direction: column;row-gap: 5px;">\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="from-copy-pegplan">From</label>\n                      <input type="number" id="from-copy-pegplan" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="to-copy-pegplan">To</label>\n                      <input type="number" id="to-copy-pegplan" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="times-copy-pegplan">Times</label>\n                      <input type="number" id="times-copy-pegplan" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="after-copy-pegplan">After</label>\n                      <input type="number" id="after-copy-pegplan" />\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </section>\n            <section id="copy-design-draft-tab-content" class="tab-content">\n              <form>\n                <div style="display: flex;flex-direction: row;gap: 25px;">\n                  <div style="display: flex;flex-direction: column;row-gap: 5px;">\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-copy-all-draft">All</label>\n                      <input type="checkbox" name="rd-draft" id="cb-copy-all-draft" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-copy-draft">Draft</label>\n                      <input type="checkbox" name="rd-draft" id="cb-copy-draft" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-copy-warp">Warp</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-warp" />\n                    </div>\n\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-copy-reed">Reed</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-reed" />\n                    </div>\n\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="cb-copy-extra-warp">Extra Warp</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-extra-warp" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="cb-copy-double-beam">Double Beam</label>\n                      <input type="checkbox" name="rd-pegplan" id="cb-copy-double-beam" />\n                    </div>\n\n                  </div>\n                  <div style="display: flex;flex-direction: column;row-gap: 5px;">\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="from-copy-draft">From</label>\n                      <input type="number" id="from-copy-draft" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="to-copy-draft">To</label>\n                      <input type="number" id="to-copy-draft" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="times-copy-draft">Times</label>\n                      <input type="number" id="times-copy-draft" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="after-copy-draft">After</label>\n                      <input type="number" id="after-copy-draft" />\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </section>\n\n            <section id="copy-design-delete-tab-content" class="tab-content">\n              <form>\n                <div style="display: flex;flex-direction: row;gap: 25px;">\n                  <div style="display: flex;flex-direction: column;row-gap: 5px;">\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="cb-delete-pegplan-function">Pegplan + Function</label>\n                      <input type="checkbox" name="cb-delete-pegplan-function" id="cb-delete-pegplan-function" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px">\n                      <label for="cb-delete-draft-function">Draft + All Function</label>\n                      <input type="checkbox" name="cb-delete-draft-function" id="cb-delete-draft-function" />\n                    </div>\n                  </div>\n                  <div style="display: flex;flex-direction: column;row-gap: 5px;">\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="from-copy-delete">From</label>\n                      <input type="number" id="from-copy-delete" />\n                    </div>\n\n                    <div style="display: flex;justify-content: space-between;gap: 5px;">\n                      <label for="to-copy-delete">To</label>\n                      <input type="number" id="to-copy-delete" />\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </section>\n          </div>\n        </div>\n      </div>\n      <div class="btn-group">\n        <button class="btn-submit" type="button" id="design-copy-ok">Ok</button>\n        <button class="btn-submit" type="button" id="design-copy-cancel">Cancel</button>\n      </div>\n    </div>',tR.querySelector(".close-button").addEventListener("click",rR),aM.addEventListener("click",kM),LD.addEventListener("click",jD),(()=>{const e=localStorage.getItem("token");if(e)axios.get(`${Yy}/subscriber/redirect-url/${e}`).then(e=>{if(e.data.DATA){let t=e.data.DATA.company,n=e.data.DATA.user,i=e.data.DATA.activePlan;if(n){let e=`${n.firstName} ${n.lastName}`;document.getElementById("submenu-user-name").innerText=e;const t=Ol();$l(t,e),jl(t,"custom_event_test",{userName:e}),localStorage.setItem("user",JSON.stringify(n))}i&&localStorage.setItem("activePlan",JSON.stringify(i)),t&&(document.getElementById("submenu-company-name").innerText=""+t.companyName,localStorage.setItem("company",JSON.stringify(t)),OO.style.display="none")}}).catch(e=>{console.log("err",e),window.location.replace("login.html");let t=getDeviceNameFromLocalStorage();localStorage.clear(),setDeviceNameToLocalStorage(t)});else{window.location.replace("login.html");let e=getDeviceNameFromLocalStorage();localStorage.clear(),setDeviceNameToLocalStorage(e)}})(),(()=>{const e=localStorage.getItem("token");WO.addEventListener("click",()=>{zB(e).then(e=>{if("SUCCESS"===e.data.STATUS){window.location.replace("login.html");let e=bk();localStorage.clear(),wk(e)}})})})(),b(),(()=>{const e=document.getElementById("profile-picture-image"),t=document.getElementById("profile-info-image"),n=document.getElementById("avatar-image"),i=JSON.parse(localStorage.getItem("user-settings")),r=document.getElementById("avatar-trigger");if(i&&i.profilePicture)VB(i.profilePicture).then(i=>{"SUCCESS"===i.data.STATUS&&(e.src=i.data.DATA,t.src=i.data.DATA,r.classList.remove(),r.innerHTML=`<img class="avatarimg" src=${i.data.DATA} />`,n.src=i.data.DATA)}).catch(e=>{console.log("err",e)});else{const e=JSON.parse(localStorage.getItem("user"));r.classList.add("icon","avatar"),r.innerHTML=e&&e.firstName?e.firstName.toString().charAt(0):"A"}})(),(()=>{const e=document.getElementById("company-info-image"),t=JSON.parse(localStorage.getItem("user-settings"));t&&t.companyPicture&&VB(t.companyPicture).then(t=>{"SUCCESS"===t.data.STATUS&&(e.src=t.data.DATA)}).catch(e=>{console.log("err",e)})})(),v(),g$(),m$(),AN({target:{scrollLeft:0}}),$T({target:{scrollTop:0}}),Ik(),UN(),tE(),KT(),Ir.addEventListener("mousedown",Mr),Ir.addEventListener("mousemove",Fr),Ir.addEventListener("mouseup",Rr),Pr.addEventListener("mousedown",Dr),_r.addEventListener("mousedown",Or),qr.addEventListener("mousedown",ea),qr.addEventListener("mousemove",Qr),Vr.addEventListener("mousedown",la),Gr.addEventListener("mousedown",oa),md.addEventListener("mousedown",Sd),md.addEventListener("mousemove",kd),md.addEventListener("mouseleave",HN),md.addEventListener("mouseup",xd),fd.addEventListener("mousemove",_d),fd.addEventListener("mousedown",Id),fd.addEventListener("mouseleave",HN),XN.addEventListener("mousedown",iC),XN.addEventListener("mouseup",tC),XN.addEventListener("mousemove",nC),XN.addEventListener("mouseleave",HN),document.getElementById("full-screen-icon").addEventListener("click",IA),window.addEventListener("wheel",SA,{passive:!1}),window.addEventListener("keydown",xA,{passive:!1}),(()=>{let e=document.querySelectorAll(".arrow");for(var t=0;t<e.length;t++)e[t].addEventListener("click",e=>{e.target.parentElement.parentElement.classList.toggle("showMenu")});let n=document.querySelector(".sidebar"),i=document.querySelector(".fa-bars");document.querySelector(".bx-log-out").addEventListener("click",()=>{n.classList.toggle("close"),n.style.visibility="hidden"}),i.addEventListener("click",()=>{n.classList.toggle("close"),n.style.visibility="visible"})})(),document.getElementById("edit-draft-apply").addEventListener("click",()=>bE(!0)),document.getElementById("edit-draft-ok").addEventListener("click",wE),sE.addEventListener("click",EE),aE.addEventListener("input",yE),aE.addEventListener("keyup",gE),aE.addEventListener("mouseup",gE),Wh(aE),xs.style.display=Zn?"block":"none",Is.style.display=ei?"block":"none",tT(Ps,Rs),Ps.addEventListener("mousedown",Qs),Ps.addEventListener("mousemove",ed),Ps.addEventListener("mouseleave",HN),_s.addEventListener("mousedown",td),_s.addEventListener("mousemove",ad),_s.addEventListener("mouseup",nd),Ns.addEventListener("mousedown",id),Ns.addEventListener("mousemove",ld),Ls.addEventListener("mousedown",rd),Ls.addEventListener("mousemove",od),Ls.addEventListener("mouseleave",HN),_s.addEventListener("mouseleave",HN),Ns.addEventListener("mouseleave",HN),tT(Bd,Fd),Bd.addEventListener("mousedown",Vd),Bd.addEventListener("mousemove",Gd),Bd.addEventListener("mouseleave",HN),Md.addEventListener("mousemove",Jd),Md.addEventListener("mouseleave",HN),Md.addEventListener("mousedown",Yd),document.getElementById("edit-sequance-apply").addEventListener("click",()=>jv(!1,!1)),document.getElementById("edit-sequance-ok").addEventListener("click",qv),Lv.addEventListener("click",Hv),Sv.addEventListener("input",Ov),Sv.addEventListener("keyup",Uv),Sv.addEventListener("mouseup",Uv),Nv.addEventListener("click",Mv),Cv.addEventListener("click",Dv),Wh(Sv),document.getElementById("pegplan-apply").addEventListener("click",()=>Qh(!0)),document.getElementById("pegplan-ok").addEventListener("click",ng),Vh.addEventListener("click",tg),Hh.addEventListener("input",Xh),Hh.addEventListener("keyup",eg),Hh.addEventListener("mouseup",eg),Yh.addEventListener("click",ig),Gh.addEventListener("click",rg),Wh(Hh),(()=>{Af.addEventListener("click",()=>{Bf.classList.add("none"),Ff.classList.add("none"),Cf.classList.toggle("none")});for(var e=document.getElementsByClassName("menu-click"),t=0;t<e.length;t++)e[t].addEventListener("click",zf);document.addEventListener("click",(function(t){var n=t.target;Array.from(e).some((function(e){return e.contains(n)}))||!jf||jf.contains(n)||(jf.classList.remove("absolute"),jf.classList.add("none"),jf=null)})),Rf.addEventListener("click",()=>{Ff.classList.add("none"),Cf.classList.add("none"),Bf.classList.toggle("none")}),Mf.addEventListener("click",()=>{Cf.classList.add("none"),Bf.classList.add("none"),Ff.classList.toggle("none")}),$f.addEventListener("click",()=>{Pf.classList.add("none"),Lf.classList.toggle("none"),Bf.classList.toggle("none")}),Wf.addEventListener("click",()=>{bf(),Uf()}),Hf.addEventListener("click",()=>{tr(),yf(),Uf()}),qf.addEventListener("click",()=>{wf(),Uf()}),Df.addEventListener("click",()=>{_f()}),Of.addEventListener("click",()=>{kf()})})(),ow(Hb,qb,0,Gb,"New File"),ow(Jb,Kb,0,!1,"Edit-Sequence"),ow(Xb,Kb,0,!1,"Edit-Sequence"),ow(Db,Kb,0,!1,"Edit-Sequence"),ow(Ob,Kb,0,!1,"Edit-Sequence"),ow($b,Zb,0,!1,"Edit-Dent"),ow(Vb,Yb,0,!1,"Weave Generator"),ow(Qb,nw,0,!1,"Draft Edit Number"),ow(jb,nw,0,!1,"Draft Edit Number"),ow(Wb,rw,0,!1,"Pegplan Edit Num"),ow(iw,rw,0,!1,"Pegplan Edit Num"),ow(Ub,zb,0,!1,"Selvedge Draft And Warp Sequence"),ow(aw,lw,0,!1,"Generate Machine File"),ow(ew,tw,0,!1,"Setting"),Q_(),Nf(),Dh(),(()=>{const e=Ic.querySelector(".close-button");Ic.addEventListener("keydown",e=>{"Escape"==e.key&&Pc()}),e.addEventListener("click",Pc),xc.addEventListener("click",Ac),hc.addEventListener("click",Lc),gc.addEventListener("click",Cc),bc.addEventListener("change",Tc),wc.addEventListener("change",Nc)})(),(async()=>{XI.addEventListener("click",()=>yk(!1)),KI.addEventListener("click",lk),ZI.addEventListener("click",uk),QI.addEventListener("click",hk),nk.addEventListener("change",mk),tk.querySelector(".close").addEventListener("click",fk);const e=tk.querySelector(".modal-title");e&&(e.innerText="Loom Profile");let t=await Sa();if(t.data.DATA){let e=t.data.DATA.loomProfileData;if(Array.isArray(e)){rk=e;let t=rk.find(e=>e.isDefault);t&&(nk.value=t.profileName,mk({target:{value:t.profileName}},""),t.fidderStart&&(hi.start=t.fidderStart,hi.end=t.fidderEnd),t.densityStart&&(fi.start=t.densityStart,fi.end=t.densityEnd),t.crammingStart&&(gi.start=t.crammingStart,gi.end=t.crammingEnd),t.shaftStart&&(mi.start=t.shaftStart,mi.end=t.shaftEnd))}}})(),eb.querySelectorAll(".close-button"),Qv.addEventListener("click",ub),tb.addEventListener("click",sb),nb.addEventListener("click",cb),(()=>{document.querySelectorAll(".close-button");ow(pb,hb,0,!1,"Pattern Editor")})(),(()=>{let e=Sk();Object.keys(e).forEach(t=>{rL(e[t])?Qy[t]=JSON.parse(e[t]):Qy[t]=e[t]})})(),ec.innerHTML=cp(),ec.querySelector(".close-button").addEventListener("click",dc),nc=document.getElementById("design-notes"),ic=document.getElementById("design-notes-apply"),rc=document.getElementById("design-notes-ok"),tc.addEventListener("click",sc),ic.addEventListener("click",lc),rc.addEventListener("click",oc),Zg(),PB(),(()=>{Wm.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">\n    Simulation\n  </div>\n  <div class="modal-desc">\n   <div class="simulations-options-container">\n   <select type="text" id="simulation-options-menu">\n    <option value="selected">Selected</option>\n    <option value="single_repeat">Single Repeat</option>\n    <option value="repeat">Repeat</option>  \n  </select>\n\n  <select class="none" type="text" id="simulation-view-type">\n    <option value="color">Color</option>\n    <option value="interlacement">Interlacement</option>\n  </select>\n  <div id="design-selection-parent">\n    <div id="design-selection-input-part-parent" class="print-selection-show-hide-part">\n    </div>\n    <div id="add-start-end-part-button" style="display:flex;justify-content:center;">+</div>\n\n    <div style="display:flex;justify-content:space-between;margin-top:10px;">\n      <div id="simulation-set-button" class="print-selection-show-hide-part" style="border:1px solid black;width:75px;text-align:center;padding:4px;cursor:pointer;">Set</div>\n      <div id="simulation-print-button" style="border:1px solid black;width:75px;text-align:center;padding:4px;cursor:pointer">Print</div>\n    </div>\n   </div>\n  </div>\n   <div class="simulation-canvas-container"><canvas id="simulation-model-canvas"></canvas></div> \n  </div>\n</div>',Wm.querySelector(".close-button").addEventListener("click",sf);const e=Wm.querySelector(".modal-desc");Wm.addEventListener("click",t=>{t.composedPath().includes(e)||sf()}),Hm.addEventListener("click",of),qm.addEventListener("click",of),Jm=document.getElementById("simulation-options-menu"),Qm=document.getElementById("add-start-end-part-button"),ef=document.getElementById("design-selection-parent"),Xm=document.getElementById("simulation-set-button"),Km=document.getElementById("simulation-print-button"),Zm=document.getElementById("simulation-view-type"),Jm.addEventListener("change",df),Zm.addEventListener("change",cf),Qm.addEventListener("click",pf),0==rf&&pf(),Xm.addEventListener("click",gf),Km.addEventListener("click",hf),document.addEventListener("keydown",e=>{"Escape"===e.key&&sf()})})(),(()=>{const e=TL.querySelector(".modal-title"),t=TL.querySelector(".close-button");e.innerHTML="Cost Calulation",t.addEventListener("click",rA),_L.addEventListener("click",iA),QL.addEventListener("click",tA),eA.addEventListener("click",nA),CL.addEventListener("change",aA),AL.addEventListener("change",aA),LL.addEventListener("change",aA),BL.addEventListener("change",aA),PL.addEventListener("change",aA),PL.addEventListener("change",aA),FL.addEventListener("change",aA),DL.addEventListener("change",aA),ML.addEventListener("change",aA),RL.addEventListener("change",aA),OL.addEventListener("change",aA),jL.addEventListener("change",aA),$L.addEventListener("change",aA),HL.addEventListener("change",aA),WL.addEventListener("change",aA),UL.addEventListener("change",aA),qL.addEventListener("change",aA),VL.addEventListener("change",aA),zL.addEventListener("change",aA),YL.addEventListener("change",aA),JL.addEventListener("change",aA),GL.addEventListener("change",aA),KL.addEventListener("change",aA),XL.addEventListener("change",aA),ZL.addEventListener("change",aA)})(),rs.addEventListener("click",ws),as.addEventListener("click",Ss),ls.addEventListener("click",Es),as.parentElement.style.backgroundColor="#d2cbcba6",(()=>{Vf.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">\n    Draft In Part\n  </div>\n  <div class="modal-desc">\n    <div class="add-remove-part-button-container">\n      <button class="btn-submit" type="button" id="draft-in-part-modal-addpart">Add Part</button>\n      <button class="btn-submit" type="button" id="draft-in-part-modal-removepart">Remove Part</button>\n  </div>\n  <div id="all-draft-in-part-parent"></div>\n  <div class="btn-group">\n    <button class="btn-submit" type="button" id="draft-in-part-modal-apply">Apply</button>\n    <button class="btn-submit" type="button" id="draft-in-part-modal-ok">ok</button>\n  </div>\n</div>\n</div>',Yf.addEventListener("click",Zf),Vf.querySelector(".close-button").addEventListener("click",ey);const e=Vf.querySelector("#draft-in-part-modal-addpart"),t=Vf.querySelector("#draft-in-part-modal-removepart"),n=Vf.querySelector("#draft-in-part-modal-apply"),i=Vf.querySelector("#draft-in-part-modal-ok");Gf=Vf.querySelector("#all-draft-in-part-parent"),n.addEventListener("click",cy),i.addEventListener("click",py),e.addEventListener("click",()=>{ny()}),t.addEventListener("click",sy)})(),(()=>{hy.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">\n    Design Draft & Warp Pattern With Part\n  </div>\n<div class="modal-desc">\n  <div id="design-with-part-width"></div>\n  <div class="add-remove-part-button-container">\n  <button class="btn-submit" type="button" id="design-with-part-modal-addpart">Add Part</button>\n  <button class="btn-submit" type="button" id="design-with-part-modal-removepart">Remove Part</button>\n</div>\n  <div class="design-with-part-table-container">\n\n    <table ><tbody id="design-with-part-table"></tbody><tfoot id="design-with-part-table-footer"></tfoot></table>\n  </div>\n\n  <div class="error-message" id="design-with-part-error-message"></div>\n  <div class="btn-group">\n    <button class="btn-submit" type="button" id="design-with-part-modal-apply">Apply</button>\n    <button class="btn-submit" type="button" id="design-with-part-modal-ok">ok</button>\n\n  </div>\n</div>\n</div>',vy=hy.querySelector("#design-with-part-error-message"),gy.addEventListener("click",_y);const e=hy.querySelector(".close-button");my=hy.querySelector("#design-with-part-table"),fy=hy.querySelector("#design-with-part-table-footer"),e.addEventListener("click",Ny);const t=hy.querySelector("#design-with-part-modal-apply"),n=hy.querySelector("#design-with-part-modal-ok"),i=hy.querySelector("#design-with-part-modal-addpart"),r=hy.querySelector("#design-with-part-modal-removepart");i.addEventListener("click",Uy),r.addEventListener("click",zy),t.addEventListener("click",Ly),n.addEventListener("click",Ay)})(),iE(),PN(),(()=>{const e=document.getElementById("cbcompany-name"),t=document.querySelector(".company-name");e.addEventListener("change",(function(){e.checked?t.style.display="block":t.style.display="none"}));const n=document.getElementById("cbcompany-logo"),i=document.querySelector("#company-logo");n.addEventListener("change",(function(){n.checked?i.style.display="block":i.style.display="none"}));const r=document.getElementById("cbcompany-address"),a=document.querySelector(".company-address");r.addEventListener("change",(function(){r.checked?a.style.display="block":a.style.display="none"}));const l=document.getElementById("cbcompany-mo"),o=document.querySelector(".company-mo");l.addEventListener("change",(function(){l.checked?o.style.display="block":o.style.display="none"}));const s=document.getElementById("cbcompany-email"),d=document.querySelector(".company-email");s.addEventListener("change",(function(){s.checked?d.style.display="block":d.style.display="none"}));const c=document.getElementById("cbprint-desc"),u=document.querySelector(".print-desc");c.addEventListener("change",(function(){c.checked?u.style.display="block":u.style.display="none"}))})(),KF(),[{checkboxId:"cbdesign-name",elementClass:".design-name"},{checkboxId:"cbshaft",elementClass:".shaft"},{checkboxId:"cbreed-space",elementClass:".reed-space"},{checkboxId:"cbreed",elementClass:".reed"},{checkboxId:"cbavg-EPI",elementClass:".avg-epi"},{checkboxId:"cbtotal-dent",elementClass:".total-dent"},{checkboxId:"cbtotal-picks",elementClass:".total-pick"},{checkboxId:"cbavg-PPI",elementClass:".avg-ppi"},{checkboxId:"cbtotal-ends",elementClass:".total-ends"}].forEach(({checkboxId:e,elementClass:t})=>{const n=document.getElementById(e),i=document.querySelector(".data-sheet-details-header "+t);n&&i&&(i.classList.toggle("data-sheet-details-header-element-visible",n.checked),i.classList.toggle("data-sheet-details-header-element-hidden",!n.checked),n.addEventListener("change",(function(e){i.classList.toggle("data-sheet-details-header-element-visible",e.target.checked),i.classList.toggle("data-sheet-details-header-element-hidden",!e.target.checked)})))}),document.querySelector("#avatar-trigger").addEventListener("click",(function(){document.querySelector(".menu-container").classList.toggle("active")})),(()=>{NA.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">\n    Save Color Palette\n  </div>\n<div class="modal-desc">\n\n<div class="flex color-paletter-searchbar">\n  <label for="search-save-color-palette">Search</label>\n  <input id="search-save-color-palette" />\n</div>\n<div id="save-color-palette-data-container">\n\n</div>\n<div class="flex file-name-container">\n<div class="flex">\n<span>File Name</span>\n<input id="save-color-palette-file-name" type="text"/>\n</div>\n <div>\n \n <button class="btn-submit" type="button" id="save-color-palette-modal-ok">Save</button>\n </div>\n\n</div>\n</div>\n</div>',LA=document.getElementById("save-color-palette-file-name");for(let e=0;e<CA.length;e++)CA.item(e).addEventListener("click",RA);AA=document.getElementById("search-save-color-palette"),PA=document.getElementById("save-color-palette-data-container"),NA.querySelector(".close-button").addEventListener("click",FA),document.getElementById("save-color-palette-modal-ok").addEventListener("click",MA),AA.addEventListener("input",DA)})(),(()=>{fg.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">\n   Open Color Palette\n  </div>\n<div class="modal-desc">\n\n<div class="flex color-paletter-searchbar">\n\n\n<label for="search-open-color-palette">Search</label>\n  <input id="search-open-color-palette" />\n\n</div>\n<div class="flex">\n  <div id="color-palette-data-container"></div>\n  <div id="color-palette-preview-container">\n    <div></div>\n    <div id="color-palette-preview-content" class="flex"></div>\n  </div>\n</div>\n\n \n  <div class="flex file-name-container">\n  <div class="flex">\n  <span>File Name</span>\n  <input readonly id="open-color-palette-file-name" type="text"/>\n  </div>\n   <div>\n   \n   <button class="btn-submit" type="button" id="open-color-palette-modal-ok">Open</button>\n   </div>\n\n  </div>\n</div>\n</div>',Sg=document.getElementById("search-open-color-palette"),vg=document.getElementById("color-palette-data-container"),bg=document.getElementById("color-palette-preview-content"),Eg=document.getElementById("open-color-palette-file-name");for(let e=0;e<yg.length;e++)yg.item(e).addEventListener("click",Tg);fg.querySelector(".close-button").addEventListener("click",Ng),document.getElementById("open-color-palette-modal-ok").addEventListener("click",Cg),Sg.addEventListener("input",_g)})(),(()=>{$A.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Draft Library</div>\n  <div class="modal-desc">\n    <div class="flex color-paletter-searchbar">\n      <label for="search-save-draft">Search</label>\n      <input id="search-save-draft" />\n    </div>\n    <div id="save-draft-data-container"></div>\n    <div class="flex file-name-container">\n      <div class="flex">\n        <span>File Name</span>\n        <input id="save-draft-file-name" type="text" />\n      </div>\n      <div>\n        <button\n          class="btn-submit"\n          type="button"\n          id="save-draft-modal-ok"\n        >\n          Save\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n',jA.addEventListener("click",GA),WA=document.getElementById("save-draft-file-name");const e=$A.querySelector(".close-button");HA=document.getElementById("search-save-draft"),qA=document.getElementById("save-draft-data-container"),HA.addEventListener("input",XA),document.getElementById("save-draft-modal-ok").addEventListener("click",ZA),e.addEventListener("click",JA)})(),QA.innerHTML='<div class="modal-content">\n<div class="close">\n  <span class="close-button">&times;</span>\n</div>\n<div class="modal-title">\n Open Draft\n</div>\n<div class="modal-desc">\n\n<div class="flex color-paletter-searchbar">\n\n\n<label for="search-open-draft">Search</label>\n<input id="search-open-draft" />\n\n<label for="search-shaft-open-draft">Shaft</label>\n<select id="search-shaft-open-draft"></select>\n\n\n<label for="search-ends-open-draft">Ends</label>\n<select id="search-ends-open-draft"></select>\n\n</div>\n<div>\n<div id="open-draft-data-container"></div>\n<div id="draft-preview-container">\n  <div></div>\n  <div id="draft-preview-content" class="flex"></div>\n</div>\n</div>\n\n\n<div class="flex file-name-container">\n<div class="flex">\n<span>File Name</span>\n<input id="open-draft-file-name" type="text"/>\n</div>\n <div>\n \n <button class="btn-submit" type="button" id="open-draft-modal-ok">Open</button>\n </div>\n\n</div>\n</div>\n</div>\n',tP=document.getElementById("search-open-draft"),nP=document.getElementById("search-ends-open-draft"),iP=document.getElementById("search-shaft-open-draft"),rP=document.getElementById("open-draft-data-container"),aP=document.getElementById("draft-preview-content"),oP=document.getElementById("open-draft-file-name"),eP.addEventListener("click",uP),QA.querySelector(".close-button").addEventListener("click",pP),document.getElementById("open-draft-modal-ok").addEventListener("click",hP),tP.addEventListener("input",mP),nP.addEventListener("change",mP),iP.addEventListener("change",mP),(()=>{fO.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Draft Library</div>\n  <div class="modal-desc">\n    <div class="flex color-paletter-searchbar">\n      <label for="search-save-seq">Search</label>\n      <input id="search-save-seq" />\n    </div>\n    <div id="save-seq-data-container"></div>\n    <div class="flex file-name-container">\n      <div class="flex">\n        <span>File Name</span>\n        <input id="save-seq-file-name" type="text" />\n      </div>\n      <div>\n        <button\n          class="btn-submit"\n          type="button"\n          id="save-seq-modal-ok"\n        >\n          Save\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n',SO=fO.querySelector(".modal-title"),yO.addEventListener("click",()=>{oO("warp"),TO()}),vO.addEventListener("click",()=>{oO("weft"),TO()}),bO=document.getElementById("save-seq-file-name");const e=fO.querySelector(".close-button");wO=document.getElementById("search-save-seq"),EO=document.getElementById("save-seq-data-container"),wO.addEventListener("input",CO),document.getElementById("save-seq-modal-ok").addEventListener("click",AO),e.addEventListener("click",NO)})(),ZD.innerHTML='<div class="modal-content">\n<div class="close">\n  <span class="close-button">&times;</span>\n</div>\n<div class="modal-title">\n Open seq\n</div>\n<div class="modal-desc">\n\n<div class="flex color-paletter-searchbar">\n\n\n<label for="search-open-seq">Search</label>\n<input id="search-open-seq" />\n\n\n\n</div>\n<div>\n<div id="open-seq-data-container"></div>\n\n</div>\n\n\n<div class="flex file-name-container">\n<div class="flex">\n<span>File Name</span>\n<input id="open-seq-file-name" type="text"/>\n</div>\n <div>\n \n <button class="btn-submit" type="button" id="open-seq-modal-ok">Open</button>\n </div>\n\n</div>\n</div>\n</div>\n',aO=ZD.querySelector(".modal-title"),tO=document.getElementById("search-open-seq"),nO=document.getElementById("open-seq-data-container"),rO=document.getElementById("open-seq-file-name"),QD.addEventListener("click",()=>{oO("warp"),uO()}),eO.addEventListener("click",()=>{oO("weft"),uO()}),ZD.querySelector(".close-button").addEventListener("click",pO),document.getElementById("open-seq-modal-ok").addEventListener("click",hO),tO.addEventListener("input",mO),(()=>{fP.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Pegplan Library</div>\n  <div class="modal-desc">\n    <div class="flex color-paletter-searchbar">\n      <label for="search-save-pegplan">Search</label>\n      <input id="search-save-pegplan" />\n    </div>\n    <div id="save-pegplan-data-container"></div>\n    <div class="flex file-name-container">\n      <div class="flex">\n        <span>File Name</span>\n        <input id="save-pegplan-file-name" type="text" />\n      </div>\n      <div>\n        <button\n          class="btn-submit"\n          type="button"\n          id="save-pegplan-modal-ok"\n        >\n          Save\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n',yP.addEventListener("click",kP),vP=document.getElementById("save-pegplan-file-name");const e=fP.querySelector(".close-button");bP=document.getElementById("search-save-pegplan"),wP=document.getElementById("save-pegplan-data-container"),bP.addEventListener("input",TP),document.getElementById("save-pegplan-modal-ok").addEventListener("click",CP),e.addEventListener("click",_P)})(),(()=>{ME.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Save Design</div>\n  <div class="context-menu absolute none" id="savemaindesign-renameDeleteMenu">\n<div class="context-content">\n  <ul class="list-none flex colunm dropdown-list">\n    <li class="dropdown-item menu-side" id="savemaindesign-rename-trigger-element">\n      Rename\n    </li>\n    <li class="dropdown-item menu-side" id="savemaindesign-delete-trigger-element">\n      Delete\n    </li>\n   \n  </ul>\n</div>\n</div>\n  <div class="modal-desc">\n    <div class="flex color-paletter-searchbar">\n    <div style="display:flex;align-items:center;">\n      <label for="search-save-maindesign">Search</label>\n      <input id="search-save-maindesign" />\n      </div>\n      <div>\n      <button id="save-modal-create-new-folder-button"><img src="add-folder.png" width="25" /></button>\n    </div>\n    <div>\n      <button id="save-modal-reset-open-design-filter"><img src="reset.png" width="25" height="25" /></button>\n    </div>\n    </div>\n\n \n    <div id="save-maindesign-data-container"></div>\n    <div class="flex file-name-container">\n      <div class="flex">\n        <span>File Name</span>\n        <input id="save-maindesign-file-name" type="text" />\n      </div>\n      <div>\n        <button\n          class="btn-submit"\n          type="button"\n          id="save-maindesign-modal-ok"\n        >\n          Save\n        </button>\n      </div>\n      \n    </div>\n  </div>\n</div>\n',HE=document.getElementById("save-modal-create-new-folder-button"),qE=document.getElementById("save-modal-reset-open-design-filter"),OE.addEventListener("click",()=>bS(!1,!1)),$E.addEventListener("click",()=>{Ki(null),bS(!1,!0)}),jE.addEventListener("click",fS),WE=document.getElementById("save-maindesign-file-name");const e=ME.querySelector(".close-button");UE=document.getElementById("search-save-maindesign"),zE=document.getElementById("save-maindesign-data-container"),HE.addEventListener("click",yS),qE.addEventListener("click",vS),UE.addEventListener("input",pS),document.getElementById("save-maindesign-modal-ok").addEventListener("click",mS),e.addEventListener("click",cS)})(),(()=>{GP.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Save Weave</div>\n  <div class="modal-desc">\n    <div class="flex color-paletter-searchbar">\n      <label for="search-save-weavedesign">Search</label>\n      <input id="search-save-weavedesign" />\n    </div>\n    <div id="save-weavedesign-data-container"></div>\n    <div class="flex file-name-container">\n      <div class="flex">\n        <span>File Name</span>\n        <input id="save-weavedesign-file-name" type="text" />\n      </div>\n      <div>\n        <button\n          class="btn-submit"\n          type="button"\n          id="save-weavedesign-modal-ok"\n        >\n          Save\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n',JP.addEventListener("click",iB),XP=document.getElementById("save-weavedesign-file-name");const e=GP.querySelector(".close-button");KP=document.getElementById("search-save-weavedesign"),ZP=document.getElementById("save-weavedesign-data-container"),KP.addEventListener("input",aB),document.getElementById("save-weavedesign-modal-ok").addEventListener("click",oB),e.addEventListener("click",rB)})(),LP.innerHTML='<div class="modal-content">\n<div class="close">\n  <span class="close-button">&times;</span>\n</div>\n<div class="modal-title">\n Open Pegplan\n</div>\n<div class="modal-desc">\n\n<div class="flex color-paletter-searchbar">\n\n\n<label for="search-open-pegplan">Search</label>\n<input id="search-open-pegplan" />\n\n<label for="search-shaft-open-pegplan">Shaft</label>\n<select id="search-shaft-open-pegplan"></select>\n\n\n<label for="search-picks-open-pegplan">Picks</label>\n<select id="search-picks-open-pegplan"></select>\n\n</div>\n<div class="flex">\n<div id="open-pegplan-data-container">\n</div>\n<div id="pegplan-preview-container">\n  <div id="pegplan-preview-content"></div>\n</div>\n</div>\n\n\n<div class="flex file-name-container">\n<div class="flex">\n<span>File Name</span>\n<input id="open-pegplan-file-name" type="text"/>\n</div>\n<div>\n <button class="btn-submit" type="button" id="open-pegplan-modal-ok">Open</button>\n </div>\n</div>\n</div>\n</div>\n',PP=document.getElementById("search-open-pegplan"),BP=document.getElementById("search-picks-open-pegplan"),RP=document.getElementById("search-shaft-open-pegplan"),FP=document.getElementById("open-pegplan-data-container"),MP=document.getElementById("pegplan-preview-content"),OP=document.getElementById("open-pegplan-file-name"),AP.addEventListener("click",HP),LP.querySelector(".close-button").addEventListener("click",qP),document.getElementById("open-pegplan-modal-ok").addEventListener("click",UP),PP.addEventListener("input",VP),BP.addEventListener("change",VP),RP.addEventListener("change",VP),_A.addEventListener("click",TA),Qg.innerHTML='<div class="modal-content">\n<div class="close">\n  <span class="close-button">&times;</span>\n</div>\n<div class="modal-title">\n Open Design\n</div>\n<div class="context-menu absolute none" id="renameDeleteMenu">\n<div class="context-content">\n  <ul class="list-none flex colunm dropdown-list">\n    <li class="dropdown-item menu-side" id="rename-trigger-element">\n      Rename\n    </li>\n    <li class="dropdown-item menu-side" id="delete-trigger-element">\n      Delete\n    </li>\n   \n  </ul>\n</div>\n</div>\n<div class="modal-desc">\n\n<div class="flex color-paletter-searchbar">\n\n<div style="display:flex;align-items:center;">\n<label for="search-open-maindesign">Search</label>\n<input style="height:80%;" id="search-open-maindesign" />\n</div>\n<div>\n<label for="search-shaft-open-maindesign">Shaft</label>\n<select id="search-shaft-open-maindesign"></select>\n</div>\n<div>\n<label for="search-picks-open-maindesign">Picks</label>\n<select id="search-picks-open-maindesign"></select>\n</div>\n<div>\n  <label for="search-ends-open-maindesign">Ends</label>\n  <select id="search-ends-open-maindesign"></select>\n</div>\n<div>\n  <button id="create-new-folder-button"><img src="add-folder.png" width="25" /></button>\n</div>\n<div>\n  <button id="reset-open-design-filter"><img src="reset.png" width="25" height="25" /></button>\n</div>\n</div>\n<div class="flex">\n<div id="open-maindesign-data-container"></div>\n<div id="maindesign-preview-container">\n  <div></div>\n  <div id="maindesign-preview-content"></div>\n</div>\n</div>\n<div class="flex file-name-container">\n<div class="flex">\n<span>File Name</span>\n<input readonly id="open-maindesign-file-name" type="text"/>\n</div>\n <div>\n \n <button class="btn-submit" type="button" id="open-maindesign-modal-ok">Open</button>\n </div>\n\n</div>\n</div>\n</div>\n',am=document.getElementById("search-open-maindesign"),lm=document.getElementById("search-picks-open-maindesign"),sm=document.getElementById("search-shaft-open-maindesign"),dm=document.getElementById("create-new-folder-button"),cm=document.getElementById("reset-open-design-filter"),om=document.getElementById("search-ends-open-maindesign"),um=document.getElementById("open-maindesign-data-container"),pm=document.getElementById("maindesign-preview-content"),gm=document.getElementById("open-maindesign-file-name"),Qg.querySelector(".close-button").addEventListener("click",Nm),document.getElementById("open-maindesign-modal-ok").addEventListener("click",Cm),am.addEventListener("input",Om),lm.addEventListener("change",Om),sm.addEventListener("change",Om),om.addEventListener("change",Om),dm.addEventListener("click",$m),cm.addEventListener("click",jm),pp.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">\n    Edit Function\n  </div>\n  <div class="modal-desc">\n\n  <div class="dencity-modal-content-parent">\n      <div>\n        <div class="dencity-modal-row-element">\n            <div>No</div>\n            <div>Density</div>\n            <div>Speed</div>\n        </div>\n        <div class="dencity-modal-row-element">\n            <div>1</div>\n            <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d1"/></div>\n            <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d1"/></div>\n        </div>\n        <div class="dencity-modal-row-element">\n            <div>2</div>\n            <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d2"/></div>\n            <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d2"/></div>\n        \n        </div>\n        <div class="dencity-modal-row-element">\n            <div>3</div>\n            <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d3"/></div>\n            <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d3"/></div>\n        </div>\n        <div class="dencity-modal-row-element">\n            <div>4</div>\n            <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d4"/></div>\n            <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d4"/></div>\n         </div>\n         <div class="dencity-modal-row-element">\n            <div>5</div>\n            <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d5"/></div>\n            <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d5"/></div>\n          </div>\n\n          <div class="dencity-modal-row-element">\n              <div>6</div>\n              <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d6"/></div>\n              <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d6"/></div>\n          </div>\n          <div class="dencity-modal-row-element">\n          <div>7</div>\n          <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d7"/></div>\n          <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d7"/></div>\n      </div>\n      <div class="dencity-modal-row-element">\n          <div>8</div>\n          <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d8"/></div>\n          <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d8"/></div>\n      \n      </div>\n     \n      </div>\n      <div>\n      <div class="dencity-modal-row-element">\n      <div>No</div>\n      <div>Density</div>\n      <div>Speed</div>\n  </div>\n  \n  <div class="dencity-modal-row-element">\n      <div>9</div>\n      <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d9"/></div>\n      <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d9"/></div>\n  </div>\n  <div class="dencity-modal-row-element">\n      <div>10</div>\n      <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d10"/></div>\n      <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d10"/></div>\n   </div>\n   <div class="dencity-modal-row-element">\n      <div>11</div>\n      <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d11"/></div>\n      <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d11"/></div>\n    </div>\n\n    <div class="dencity-modal-row-element">\n        <div>12</div>\n        <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d12"/></div>\n        <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d12"/></div>\n    </div>\n\n\n    <div class="dencity-modal-row-element">\n    <div>13</div>\n    <div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d13"/></div>\n    <div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d13"/></div>\n</div>\n\n<div class="dencity-modal-row-element">\n<div>14</div>\n<div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d14"/></div>\n<div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d14"/></div>\n</div>\n\n<div class="dencity-modal-row-element">\n<div>15</div>\n<div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d15"/></div>\n<div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d15"/></div>\n</div>\n<div class="dencity-modal-row-element">\n<div>16</div>\n<div class="dencity-modal-input-parent"><input class="dencity-modal-input" id="dencity-modal-input-d16"/></div>\n<div class="dencity-modal-input-parent"><input class="speed-modal-input" id="speed-modal-input-d16"/></div>\n</div>\n    </div>\n  </div>\n\n  <div class="btn-group">\n  <button class="btn-submit" type="button" id="dencity-modal-apply">Apply</button>\n  <button class="btn-submit" type="button" id="dencity-modal-ok">Ok</button>\n  <button class="btn-submit" type="button" id="dencity-modal-cancel">Cancel</button>\n</div>\n  </div>\n</div>',hp=document.getElementById("dencity-modal-apply"),gp=document.getElementById("dencity-modal-ok"),mp=document.getElementById("dencity-modal-cancel"),up.addEventListener("click",Ep),hp.addEventListener("click",xp),gp.addEventListener("click",Ip),mp.addEventListener("click",Sp),pp.querySelector(".close-button").addEventListener("click",Sp),oL.addEventListener("click",IL),sL.querySelector(".close-button").addEventListener("click",kL),Lg.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Weft Selector</div>\n  <div id="modal-desc">\n    \n  </div>\n  <div class="error-message" id="weft-selector-error-message"></div>\n  <div class="btn-group">\n    <button class="btn-submit" type="button" id="weft-selector-modal-apply">Apply</button>\n    <button class="btn-submit" type="button" id="weft-selector-modal-ok">Ok</button>\n    <button class="btn-submit" type="button" id="weft-selector-modal-cancel">Cancel</button>\n  </div>\n</div>',Pg=document.getElementById("weft-selector-modal-apply"),Bg=document.getElementById("weft-selector-modal-cancel"),Fg=Lg.querySelector("#weft-selector-error-message"),Rg=document.getElementById("weft-selector-modal-ok"),Lg.querySelector(".close-button").addEventListener("click",jg),Ag.addEventListener("click",$g),Pg.addEventListener("click",Wg),Rg.addEventListener("click",Hg),Bg.addEventListener("click",qg),sB.innerHTML='<div class="modal-content">\n<div class="close">\n  <span class="close-button">&times;</span>\n</div>\n<div class="modal-title">\n Open Weave\n</div>\n<div class="modal-desc">\n\n<div class="flex color-paletter-searchbar">\n<label for="search-open-weavedesign">Search</label>\n<input id="search-open-weavedesign" />\n\n<label for="search-shaft-open-weavedesign">Shaft</label>\n<select id="search-shaft-open-weavedesign"></select>\n\n\n<label for="search-picks-open-weavedesign">Picks</label>\n<select id="search-picks-open-weavedesign"></select>\n\n\n<label for="search-ends-open-weavedesign">Ends</label>\n<select id="search-ends-open-weavedesign"></select>\n</div>\n<div class="flex">\n<div id="open-weavedesign-data-container"></div>\n<div id="weavedesign-preview-container">\n  <div></div>\n  <div id="weavedesign-preview-content"></div>\n</div>\n</div>\n\n\n<div class="flex file-name-container">\n<div class="flex">\n<span>File Name</span>\n<input readonly id="open-weavedesign-file-name" type="text"/>\n</div>\n <div>\n \n <button class="btn-submit" type="button" id="open-weavedesign-modal-ok">Open</button>\n </div>\n\n</div>\n</div>\n</div>\n',cB=document.getElementById("search-open-weavedesign"),uB=document.getElementById("search-picks-open-weavedesign"),hB=document.getElementById("search-shaft-open-weavedesign"),pB=document.getElementById("search-ends-open-weavedesign"),gB=document.getElementById("open-weavedesign-data-container"),mB=document.getElementById("weavedesign-preview-content"),yB=document.getElementById("open-weavedesign-file-name"),dB.addEventListener("click",EB),sB.querySelector(".close-button").addEventListener("click",SB),document.getElementById("open-weavedesign-modal-ok").addEventListener("click",xB),cB.addEventListener("input",kB),uB.addEventListener("change",kB),hB.addEventListener("change",kB),pB.addEventListener("change",kB),(()=>{const e=document.getElementById("cbcompany-name"),t=document.querySelector(".company-name");e.addEventListener("change",(function(){e.checked?t.style.display="block":t.style.display="none"}));const n=document.getElementById("cbcompany-logo"),i=document.querySelector("#company-logo");n.addEventListener("change",(function(){n.checked?i.style.display="block":i.style.display="none"}));const r=document.getElementById("cbcompany-address"),a=document.querySelector(".company-address");r.addEventListener("change",(function(){r.checked?a.style.display="block":a.style.display="none"}));const l=document.getElementById("cbcompany-mo"),o=document.querySelector(".company-mo");l.addEventListener("change",(function(){l.checked?o.style.display="block":o.style.display="none"}));const s=document.getElementById("cbcompany-email"),d=document.querySelector(".company-email");s.addEventListener("change",(function(){s.checked?d.style.display="block":d.style.display="none"}));const c=document.getElementById("cbprint-desc"),u=document.querySelector(".print-desc");c.addEventListener("change",(function(){c.checked?u.style.display="block":u.style.display="none"}))})(),lA.addEventListener("change",(function(){lA.checked?oA.style.display="block":oA.style.display="none"})),sA.addEventListener("change",(function(){sA.checked?dA.style.display="block":dA.style.display="none"})),cA.addEventListener("change",(function(){cA.checked?uA.style.display="block":uA.style.display="none"})),pA.addEventListener("change",(function(){pA.checked?hA.style.display="block":hA.style.display="none"})),gA.addEventListener("change",(function(){gA.checked?mA.style.display="block":mA.style.display="none"})),fA.addEventListener("change",(function(){fA.checked?yA.style.display="block":yA.style.display="none"})),vA.addEventListener("change",(function(){vA.checked?bA.style.display="block":bA.style.display="none"})),wA.addEventListener("change",(function(){wA.checked?EA.style.display="block":EA.style.display="none"})),_B(),TB(),ZF.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Support</div>\n  <div id="modal-desc">\n    <div class="support-modal-contents">\n      <div class="flex" style="justify-content: end;">\n        <button class="btn-submit" type="button" style="width: 150px;" id="create-new-ticket-trigger">Create New Ticket</button>\n      </div>\n      <br/>\n      <div id="support-modal-contents-table"></div>\n      <div>\n        <p>\n          Note : \n        </p>\n        <p>\n          Please let us know if you are unhappy with the support services that you have received <br/>\n          from us or by the partner , Please <b>Click Here</b> to escalate to the dedicated team.We <br  />\n          will respond to your query with in next 4 business hours.\n        </p>\n      </div>\n    </div>\n  </div>\n</div>',eM=document.getElementById("create-new-ticket-trigger"),ZF.querySelector(".close-button").addEventListener("click",nM),QF.addEventListener("click",tM),eM.addEventListener("click",ZB),wF.addEventListener("click",SF),YB.querySelector(".close-button").addEventListener("click",QB),GB&&GB.addEventListener("click",ZB),XB.addEventListener("click",KB),(()=>{const e=document.getElementById("radio-even"),t=document.getElementById("radio-manual"),n=document.getElementById("edit-dent-even-content"),i=document.getElementById("edit-dent-manual-content");function r(){e.checked?(Ab=Cb,n.style.display="block",i.style.display="none"):t.checked&&(Ab=Lb,kb.value=ZO.cells_to_numeric_text(),Mb({target:{value:kb.value}}),n.style.display="none",i.style.display="block")}e.addEventListener("change",r),t.addEventListener("change",r),r(),Eb.addEventListener("click",Pb),Sb.addEventListener("click",Bb),kb.addEventListener("input",Mb)})(),document.addEventListener("beforeExportProcessDone",_I),II.addEventListener("click",kI),Gx(),vF(),window.addEventListener("beforeunload",kA),zF(),Jy.addEventListener("click",UB),Zy.addEventListener("click",UB),BB.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title">Single Page Print</div>\n  <div id="modal-desc">\n   \n  </div>\n  \n  </div>',BB.querySelector(".close-button").addEventListener("click",qB),QM(),CD(),OM.innerHTML='\n    <div class="modal-content" style="border: 1px solid #ccc; background: #f9f9f9;">\n    <div class="close" style="text-align: right;">\n      <span class="close-button" style="cursor: pointer; font-size: 16px;">&times;</span>\n    </div>\n    <div class="modal-title" style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Shared Design</div>\n    <div class="modal-desc" style="overflow-x: auto; padding: 4px;">\n    <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">\n    <input\n      type="text"\n        id="accept-design-name"\n      style="padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; color: #4b5563;"\n      readonly\n    />\n    <input\n      type="text"\n        id="accept-design-company-name"\n      style="padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; color: #4b5563;"\n      readonly\n    />\n    <textarea\n    id="accept-design-notes"\n      style="padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; color: #4b5563; resize: none; height: 80px;"\n    ></textarea>\n  </div>\n    </div>\n    <div class="btn-group">\n    <button class="btn-submit" type="button" id="accept-design-cancel">Cancel</button>\n    <button class="btn-submit" type="button" id="accept-design-ok">Accpet</button>\n  </div>\n  </div>',$M=OM.querySelector("#accept-design-name"),jM=OM.querySelector("#accept-design-company-name"),WM=OM.querySelector("#accept-design-notes"),qM=OM.querySelector("#accept-design-ok"),HM=OM.querySelector("#accept-design-cancel"),qM.addEventListener("click",YM),HM.addEventListener("click",GM),XD(),(()=>{let e=JSON.parse(localStorage.getItem("user"))&&JSON.parse(localStorage.getItem("user"))._id;const t=io(wa,{query:{userId:e}});t.on("connect",()=>{console.log("Connected to server at:",moment().format("YYYY-MM-DD HH:mm:ss"))}),t.on("disconnect",()=>{console.log("Disconnected from server at:",moment().format("YYYY-MM-DD HH:mm:ss"))})})(),NE.addEventListener("click",()=>CE(!1)),(()=>{Ug.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title" style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 10px;">\n    Save File to:\n  </div>\n  <div class="modal-desc" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 10px;">\n    \n    <div id="save-to-device-option" style="display: flex; flex-direction: column; align-items: center; width: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">\n      <img src="assets/harddisk.png" width="40" height="40" alt="Device">\n      <span>Device</span>\n    </div>\n    <div id="save-to-cloud-option" style="display: flex; flex-direction: column; align-items: center; width: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">\n      <img src="assets/cloud.png" width="40" height="40" alt="Dropbox">\n      <span>Cloud</span>\n    </div>\n    \n  </div>\n\n</div>',Ug.querySelector(".close-button").addEventListener("click",Yg);const e=Ug.querySelector("#save-to-device-option"),t=Ug.querySelector("#save-to-cloud-option");e.addEventListener("click",()=>{Ki(zg),Yg(),bS(!1,!0)}),t.addEventListener("click",()=>{Ki(Vg),Yg(),bS(!1,!0)})})(),(()=>{PO.innerHTML='<div class="modal-content">\n  <div class="close">\n    <span class="close-button">&times;</span>\n  </div>\n  <div class="modal-title" style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 10px;">\n    Open File From:\n  </div>\n  <div class="modal-desc" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 10px;">\n    \n    <div id="open-to-device-option" style="display: flex; flex-direction: column; align-items: center; width: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">\n      <img src="assets/harddisk.png" width="40" height="40" alt="Device">\n      <span>Device</span>\n    </div>\n    <div id="open-to-cloud-option" style="display: flex; flex-direction: column; align-items: center; width: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">\n      <img src="assets/cloud.png" width="40" height="40" alt="Dropbox">\n      <span>Cloud</span>\n    </div>\n    \n  </div>\n\n</div>',BO.addEventListener("click",RO),PO.querySelector(".close-button").addEventListener("click",FO);const e=PO.querySelector("#open-to-device-option"),t=PO.querySelector("#open-to-cloud-option");e.addEventListener("click",()=>{Ki(zg),_E(),FO()}),t.addEventListener("click",()=>{Ki(Vg),Tm(),FO()})})(),document.addEventListener("click",()=>{$h.style.display="none"}),document.getElementById("textarea-contextmenu-cut").addEventListener("click",()=>{jh&&(jh.focus(),document.execCommand("cut")),$h.style.display="none"}),document.getElementById("textarea-contextmenu-copy").addEventListener("click",()=>{jh&&(jh.focus(),document.execCommand("copy")),$h.style.display="none"}),document.getElementById("textarea-contextmenu-paste").addEventListener("click",async()=>{if(jh)try{const e=await navigator.clipboard.readText();jh.setRangeText(e,jh.selectionStart,jh.selectionEnd,"end"),jh.focus()}catch(e){alert("Paste not supported in this browser.")}$h.style.display="none"}),document.getElementById("textarea-contextmenu-selectAll").addEventListener("click",()=>{jh&&jh.select(),$h.style.display="none"}),document.getElementById("textarea-contextmenu-delete").addEventListener("click",()=>{if(jh){const{selectionStart:e,selectionEnd:t}=jh;e!==t&&jh.setRangeText("",e,t,"end")}$h.style.display="none"}),window.addEventListener("resize",()=>$h.style.display="none"),window.addEventListener("scroll",()=>$h.style.display="none"),(()=>{const e=document.querySelectorAll(".modal");for(let t=0;t<e.length;t++){let n=e.item(t);"print-preview-model"!=n.id&&"fill-design-modal"!=n.id&&"shift-shaft-modal"!=n.id&&aR(n)}})(),document.addEventListener("contextmenu",e=>{e.preventDefault()})});const k$=e=>{c$=e},_$=e=>{d$=e},T$=e=>{l$=e},N$=e=>{s$=e},C$=e=>{h$=e},L$=e=>{o$=e}}]);